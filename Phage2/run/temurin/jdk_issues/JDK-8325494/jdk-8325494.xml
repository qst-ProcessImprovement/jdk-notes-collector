<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:46:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8325494] C2: Broken graph after not skipping CastII node anymore for Assertion Predicates after JDK-8309902</title>
                <link>https://bugs.openjdk.org/browse/JDK-8325494</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt; removed code to skip a CastII node for the Initialized Assertion Predicate expression to fix a bug since it was not evident that the CastII is still required for correctness. &lt;br/&gt;
&lt;br/&gt;
I now found a fuzzer case which can be traced back to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;, i.e. that we would still require to skip the CastII node. In the test case, we do not skip the CastII node when initializing an Assertion Predicate and as a result, the Assertion Predicate is not folded away.&lt;br/&gt;
&lt;br/&gt;
We might need to revisit the fix of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Note that (at least after an initial analysis) the full fix for missing Assertion Predicates (&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8288981&quot; title=&quot;[Umbrella] C2: Fix issues with Skeleton/Assertion Predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8288981&quot;&gt;&lt;strike&gt;JDK-8288981&lt;/strike&gt;&lt;/a&gt;) does not help here since we have an Assertion Predicate in place - but it&amp;#39;s unable to fold the dead path away.&lt;br/&gt;
&lt;br/&gt;
To reproduce:&lt;br/&gt;
$ java -XX:-TieredCompilation -Xcomp -XX:CompileOnly=Test::test Test.java&lt;br/&gt;
$ java -XX:-TieredCompilation -Xcomp -XX:CompileOnly=Reduced::test Reduced.java&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/0db9c48f-6638-40d0-9a4b-bd9cc7533eb8-S9853/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/56009ff3-1ef9-43a1-9ae7-76a9d407dde0/runs/c23ecd31-3420-4318-b56a-b489ae5be3b0/workspace/open/src/hotspot/share/opto/loopopts.cpp:1675), pid=78706, tid=78753&lt;br/&gt;
#  assert(!n-&amp;gt;is_Store() &amp;amp;&amp;amp; !n-&amp;gt;is_LoadStore()) failed: no node with a side effect&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (23.0+7) (fastdebug build 23-ea+7-448)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 23-ea+7-448, compiled mode, sharing, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x12c2f48]  PhaseIdealLoop::try_sink_out_of_loop(Node*)+0xbb8&lt;br/&gt;
...........&lt;br/&gt;
Command Line: -XX:CompileCommand=quiet -XX:-TieredCompilation -Xcomp -XX:CompileOnly=Test::* Test&lt;br/&gt;
...........&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:655    6    b        Test::lMeth (286 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007f0104e00000,0x00007f0104f00000],  sp=0x00007f0104efa9c0,  free space=1002k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x12c2f48]  PhaseIdealLoop::try_sink_out_of_loop(Node*)+0xbb8  (loopopts.cpp:1675)&lt;br/&gt;
V  [libjvm.so+0x12c3023]  PhaseIdealLoop::split_if_with_blocks_post(Node*)+0x83&lt;br/&gt;
V  [libjvm.so+0x12c3896]  PhaseIdealLoop::split_if_with_blocks(VectorSet&amp;amp;, Node_Stack&amp;amp;)+0x96&lt;br/&gt;
V  [libjvm.so+0x12b64a7]  PhaseIdealLoop::build_and_optimize()+0xe87&lt;br/&gt;
V  [libjvm.so+0x9f3f08]  PhaseIdealLoop::optimize(PhaseIterGVN&amp;amp;, LoopOptsMode)+0x388&lt;br/&gt;
V  [libjvm.so+0x9ecb55]  Compile::optimize_loops(PhaseIterGVN&amp;amp;, LoopOptsMode)+0x75&lt;br/&gt;
V  [libjvm.so+0x9ef301]  Compile::Optimize()+0xe21&lt;br/&gt;
V  [libjvm.so+0x9f2924]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x1b44&lt;br/&gt;
V  [libjvm.so+0x846ce5]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x1d5&lt;br/&gt;
V  [libjvm.so+0x9fe61c]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0x92c&lt;br/&gt;
V  [libjvm.so+0x9ff2a8]  CompileBroker::compiler_thread_loop()+0x468&lt;br/&gt;
V  [libjvm.so+0xec18dc]  JavaThread::thread_main_inner()+0xcc&lt;br/&gt;
V  [libjvm.so+0x17ae046]  Thread::call_run()+0xb6&lt;br/&gt;
V  [libjvm.so+0x14b43b7]  thread_native_entry(Thread*)+0x127</description>
                <environment></environment>
        <key id="5121030">JDK-8325494</key>
            <summary>C2: Broken graph after not skipping CastII node anymore for Assertion Predicates after JDK-8309902</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roland">Roland Westrelin</assignee>
                                    <reporter username="chagedorn">Christian Hagedorn</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>javafuzzer</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-23</label>
                    </labels>
                <created>Thu, 8 Feb 2024 04:34:17 -0800</created>
                <updated>Mon, 24 Jun 2024 02:21:17 -0700</updated>
                            <resolved>Wed, 17 Apr 2024 08:27:42 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14683165" author="roboduke" created="Thu, 20 Jun 2024 02:51:26 -0700"  >[jdk21u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 21.0.5-oracle. Applies cleanly, but I have disabled a part of an assertion because it needs &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8305636&quot; title=&quot;Expand and clean up predicate classes and move them into separate files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8305636&quot;&gt;&lt;strike&gt;JDK-8305636&lt;/strike&gt;&lt;/a&gt; which is not supposed to go into 21.0.5. This backport is very small, has been reviewed and tier 1-4 have passed. The included test fails without this fix and passes with it.</comment>
                            <comment id="14682136" author="roboduke" created="Mon, 17 Jun 2024 09:04:38 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/734&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/734&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-17 15:58:39 +0000</comment>
                            <comment id="14666187" author="shade" created="Thu, 18 Apr 2024 02:43:51 -0700"  >This also needs infrastructure from &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8305636&quot; title=&quot;Expand and clean up predicate classes and move them into separate files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8305636&quot;&gt;&lt;strike&gt;JDK-8305636&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14666027" author="roland" created="Wed, 17 Apr 2024 08:54:43 -0700"  >That&amp;#39;s right: &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8319372&quot; title=&quot;C2 compilation fails with &amp;quot;Bad immediate dominator info&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8319372&quot;&gt;&lt;strike&gt;JDK-8319372&lt;/strike&gt;&lt;/a&gt; is the one that allows making that change (and then not running into &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;).</comment>
                            <comment id="14666026" author="shade" created="Wed, 17 Apr 2024 08:51:39 -0700"  >Help me understand this. AFAICS, this change effectively reverts &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;. So how does it not re-introduce the bug fixed by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;? From the PR comments, I gather &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8319372&quot; title=&quot;C2 compilation fails with &amp;quot;Bad immediate dominator info&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8319372&quot;&gt;&lt;strike&gt;JDK-8319372&lt;/strike&gt;&lt;/a&gt; might have resolved the issue: &amp;quot;The change from 8282592 caused issues because we used to narrow the type of a cast based on the condition that guards it. That was removed by 8319372.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Is this correct? If so, we want this fix in JDK 21u+.</comment>
                            <comment id="14666024" author="dukebot" created="Wed, 17 Apr 2024 08:27:41 -0700"  >Changeset: 9fd78022&lt;br/&gt;
Author:    Roland Westrelin &amp;lt;&lt;a href=&apos;mailto:roland@openjdk.org&apos;&gt;roland@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-04-17 15:25:41 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/9fd78022b19149ade40f92749f0b585ecfd41410&quot;&gt;https://git.openjdk.org/jdk/commit/9fd78022b19149ade40f92749f0b585ecfd41410&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14664409" author="roboduke" created="Wed, 10 Apr 2024 06:48:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/18724&quot;&gt;https://git.openjdk.org/jdk/pull/18724&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-10 13:41:11 +0000</comment>
                            <comment id="14647655" author="chagedorn" created="Thu, 8 Feb 2024 04:35:50 -0800"  >[~roland] since you worked on &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309902&quot; title=&quot;C2: assert(false) failed: Bad graph detected in build_loop_late after JDK-8305189&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309902&quot;&gt;&lt;strike&gt;JDK-8309902&lt;/strike&gt;&lt;/a&gt;, do you want to have a look at that?</comment>
                            <comment id="14647654" author="chagedorn" created="Thu, 8 Feb 2024 04:35:14 -0800"  >ILW = Broken graph leading to assertion failure, single fuzzer test, disable compilation of affected test = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5131750">JDK-8334175</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5132512">JDK-8334842</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="5097951">JDK-8305636</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5113922">JDK-8319372</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5069568">JDK-8282592</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5103024">JDK-8309902</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="108213" name="FuzzerUtils.java" size="13240" author="chagedorn" created="Thu, 8 Feb 2024 04:31:39 -0800"/>
                            <attachment id="108211" name="Reduced.java" size="592" author="chagedorn" created="Thu, 8 Feb 2024 04:31:52 -0800"/>
                            <attachment id="108214" name="Test.java" size="10457" author="chagedorn" created="Thu, 8 Feb 2024 04:31:35 -0800"/>
                            <attachment id="108212" name="hs_err_pid78706.log" size="67839" author="chagedorn" created="Thu, 8 Feb 2024 04:31:46 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34x6z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17414"><![CDATA[b19]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>