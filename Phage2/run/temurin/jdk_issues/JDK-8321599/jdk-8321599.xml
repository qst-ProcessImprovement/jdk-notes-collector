<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 11:15:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8321599] Data loss in AVX3 Base64 decoding</title>
                <link>https://bugs.openjdk.org/browse/JDK-8321599</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Base64 appears to give different (wrong) results in some rare cases when AVX3 is enabled. This has been observed in one of our services.&lt;br/&gt;
&lt;br/&gt;
The attached reproducer fails reliably with -XX:UseAVX3 on my host with these CPU details (an AWS EC2 c6i.large instance):&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
vendor_id       : GenuineIntel&lt;br/&gt;
cpu family      : 6&lt;br/&gt;
model           : 106&lt;br/&gt;
model name      : Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz&lt;br/&gt;
stepping        : 6&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
The same reproducer passes reliably with `-XX:UseAVX=2`.&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
java -XX:UseAVX=2 Base64Avx3.java&lt;br/&gt;
Test complete, no invalid decodes detected&lt;br/&gt;
&lt;br/&gt;
java -XX:UseAVX=3 Base64Avx3.java&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.IllegalStateException: Mismatch for iouMjY6PkJGSk5SVlpeYmZqbnJ2en6ChoqOkpaanqKmqq6ytrq+wsbKztLW2t7i5uru8vb6/wMHCw8TFxsfIycrLzM3Oz9DR0tPU1dbX2Nna29zd3t/g4eLj5OXm5+jp6uvs7e7v8PHy8/T19vf4+fr7/P3+/wABAgMEBQYHCAkKCwwNDg8QERITFBU=&lt;br/&gt;
&lt;br/&gt;
Expected:&lt;br/&gt;
8A 8B 8C 8D 8E 8F 90 91 92 93 94 95 96 97 98 99 9A 9B 9C 9D 9E 9F A0 A1 A2 A3 A4 A5 A6 A7 A8 A9 AA AB AC AD AE AF B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 BA BB BC BD BE BF C0 C1 C2 C3 C4 C5 C6 C7 C8 C9 CA CB CC CD CE CF D0 D1 D2 D3 D4 D5 D6 D7 D8 D9 DA DB DC DD DE DF E0 E1 E2 E3 E4 E5 E6 E7 E8 E9 EA EB EC ED EE EF F0 F1 F2 F3 F4 F5 F6 F7 F8 F9 FA FB FC FD FE FF 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15&lt;br/&gt;
&lt;br/&gt;
Actual:&lt;br/&gt;
8A 8B 8C 8D 8E 8F 90 91 92 93 94 95 96 97 98 99 9A 9B 9C 9D 9E 9F A0 A1 A2 A3 A4 A5 A6 A7 A8 A9 AA AB AC AD AE AF B0 B1 B2 B3 B4 B5 B6 B7 B8 B9 BA BB BC BD BE BF C0 C1 C2 C3 C4 C5 C6 C7 C8 C9 CA CB CC CD CE CF D0 D1 D2 D3 D4 D5 D6 D7 D8 D9 DA DB DC DD DE DF E0 E1 E2 E3 E4 E5 E6 E7 E8 E9 EA EB EC ED EE EF F0 F1 F2 F3 F4 F5 F6 F7 F8 F9 FA FB FC FD FE FF 00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14&lt;br/&gt;
	at Base64Avx3.decodeAndCheck(Base64Avx3.java:68)&lt;br/&gt;
	at Base64Avx3.main(Base64Avx3.java:55)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
It may be related to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8268276&quot; title=&quot;Base64 Decoding optimization for x86 using AVX-512&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8268276&quot;&gt;&lt;strike&gt;JDK-8268276&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Note also that the bug requires that the CPU supports avx512bw *and* avx512vbmi.</description>
                <environment></environment>
        <key id="5116482">JDK-8321599</key>
            <summary>Data loss in AVX3 Base64 decoding</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sgibbons">Scott Gibbons</assignee>
                                    <reporter username="ogillespie">Oli Gillespie</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>hgupdate-sync</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-23</label>
                    </labels>
                <created>Fri, 8 Dec 2023 07:09:34 -0800</created>
                <updated>Mon, 19 Feb 2024 23:33:01 -0800</updated>
                            <resolved>Wed, 3 Jan 2024 17:38:26 -0800</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="14637402" author="roboduke" created="Thu, 4 Jan 2024 04:02:58 -0800"  >[jdk21u-fix-request] Approval Request from olivergillespie&lt;br/&gt;
Clean backport, fairly simple fix with reproducer for important issue (incorrect result from intrinsic).</comment>
                            <comment id="14637401" author="roboduke" created="Thu, 4 Jan 2024 04:02:30 -0800"  >[jdk17u-fix-request] Approval Request from olivergillespie&lt;br/&gt;
Nearly clean backport, fairly simple fix with reproducer for important issue (incorrect result from intrinsic).</comment>
                            <comment id="14637381" author="roboduke" created="Thu, 4 Jan 2024 02:29:18 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2100&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2100&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-04 10:23:52 +0000</comment>
                            <comment id="14637370" author="roboduke" created="Thu, 4 Jan 2024 01:53:52 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/122&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/122&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-04 09:48:48 +0000</comment>
                            <comment id="14637310" author="roboduke" created="Wed, 3 Jan 2024 22:19:09 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22/pull/28&quot;&gt;https://git.openjdk.org/jdk22/pull/28&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-04 06:13:11 +0000</comment>
                            <comment id="14637268" author="dukebot" created="Wed, 3 Jan 2024 17:38:25 -0800"  >Changeset: 13c11487&lt;br/&gt;
Author:    Scott Gibbons &amp;lt;&lt;a href=&apos;mailto:sgibbons@openjdk.org&apos;&gt;sgibbons@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Sandhya Viswanathan &amp;lt;&lt;a href=&apos;mailto:sviswanathan@openjdk.org&apos;&gt;sviswanathan@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-01-04 01:36:28 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/13c11487f7126a370d9ce8e62f661ea83eedefe6&quot;&gt;https://git.openjdk.org/jdk/commit/13c11487f7126a370d9ce8e62f661ea83eedefe6&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14636968" author="thartmann" created="Tue, 2 Jan 2024 22:22:19 -0800"  >ILW = Incorrect result of compiled code, Base64 decoding with AVX3, -XX:DisableIntrinsic=_base64_decodeBlock = HMM = P2</comment>
                            <comment id="14635570" author="JIRAUSER19713" created="Tue, 19 Dec 2023 10:42:26 -0800"  >Security issues have been evaluated and resolved.  Re-opening the PR.</comment>
                            <comment id="14632768" author="roboduke" created="Fri, 8 Dec 2023 13:02:18 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/17039&quot;&gt;https://git.openjdk.org/jdk/pull/17039&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-08 20:56:52 +0000</comment>
                            <comment id="14632754" author="JIRAUSER19713" created="Fri, 8 Dec 2023 11:43:23 -0800"  >I have found the problem and am testing the fix.&lt;br/&gt;
&lt;br/&gt;
This problem will only occur when all of the following are true:&lt;br/&gt;
1. The source offset of the string to be decoded is != 0.&lt;br/&gt;
2. The characters at the beginning of the string (minus the offset) plus the string length mod 64 are either &amp;quot;=&amp;quot; or &amp;quot;==&amp;quot;.&lt;br/&gt;
3. The string is &amp;gt;= 32 characters.&lt;br/&gt;
4. The string is not MIME encoded.&lt;br/&gt;
&lt;br/&gt;
If any of these conditions are not met, the decode works as expected.  This was due to omitting the source offset of the string when checking for padding characters.</comment>
                            <comment id="14632690" author="simonis" created="Fri, 8 Dec 2023 08:12:46 -0800"  >I&amp;#39;d argue that base64 a very basic and common algorithm and wrong bas64 encoding/decoding can easily lead to undetected data loss or corruption. Because this can happen in the LTS releases 17 &amp;amp; 21, I think it is justified to raised the priority to P2.</comment>
                            <comment id="14632687" author="simonis" created="Fri, 8 Dec 2023 08:04:51 -0800"  >Can be worked around with:&lt;br/&gt;
```&lt;br/&gt;
-XX:+UnlockDiagnosticVMOptions -XX:DisableIntrinsic=_base64_decodeBlock&lt;br/&gt;
```</comment>
                            <comment id="14632674" author="JIRAUSER19713" created="Fri, 8 Dec 2023 07:21:11 -0800"  >I&amp;#39;ll take a look at it today.  Thanks for the heads-up.</comment>
                            <comment id="14632673" author="eastigeevich" created="Fri, 8 Dec 2023 07:19:32 -0800"  >Adding [~jbhateja] to the issue.</comment>
                            <comment id="14632672" author="JIRAUSER20804" created="Fri, 8 Dec 2023 07:14:59 -0800"  >@sgibbons Are you able to take a look at this? It seems it may be related to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8268276&quot; title=&quot;Base64 Decoding optimization for x86 using AVX-512&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8268276&quot;&gt;&lt;strike&gt;JDK-8268276&lt;/strike&gt;&lt;/a&gt;. </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5117964">JDK-8322889</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118276">JDK-8323160</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118277">JDK-8323161</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118434">JDK-8323304</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118417">JDK-8323288</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5121691">JDK-8326052</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5051174">JDK-8268276</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="107619" name="Base64Avx3.java" size="4088" author="ogillespie" created="Fri, 8 Dec 2023 07:06:02 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i345nn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>