<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:35:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8306042] C2: failed: Missed optimization opportunity in PhaseCCP (adding LShift-&gt;Cast-&gt;Add notification)</title>
                <link>https://bugs.openjdk.org/browse/JDK-8306042</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Occurred during execution of JavaFuzzer&lt;br/&gt;
&lt;br/&gt;
Missed Value optimization:&lt;br/&gt;
dist dump&lt;br/&gt;
---------------------------------------------&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1   142  ConI  === 0  [[ 1778 681 228 228 198 200 201 231 3534 657 227 203 1777 204 205 206 233 234 3874 208 209 210 229 217 211 212 213 230 66 232 3884 1776 68 62 1763 1763 1764 1764 1765 1765 1766 1766 1767 1768 1769 972 1770 237 1771 1772 1375 1760 1759 1758 1757 1756 1755 1754 1753 1752 236 235 1364 1751 1750 1749 1748 1747 1746 1745 1744 1743 1742 1741 1773 1377 65 238 3568 1774 1775 4076 ]]  #int:13&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1  3875  CastII  === 3829 188  [[ 3874 ]]  #int unconditional dependency&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0  3874  AndI  === _ 3875 142  [[ 3806 ]]  !orig=[380],[577] !jvms: Test::mainTest @ bci:164 (line 175)&lt;br/&gt;
Current type:&lt;br/&gt;
int:0&lt;br/&gt;
Optimized type:&lt;br/&gt;
int:0..13:www&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (c:\sb\prod\1681507186\workspace\open\src\hotspot\share\opto\phaseX.cpp:2010), pid=23224, tid=59124&lt;br/&gt;
#  assert(!failure) failed: Missed optimization opportunity in PhaseCCP&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0+19) (fastdebug build 21-ea+19-LTS-1517)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-ea+19-LTS-1517, compiled mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, windows-amd64)&lt;br/&gt;
# Core dump will be written. Default location: C:\sb\prod\1681642304\testoutput\test-support\jtreg_closed_test_hotspot_jtreg_applications_javafuzzer_BigTest_java\tmp\fuzzer.tmp.J3bHs5hCgO\hs_err_pid23224.mdmp&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
---------------  S U M M A R Y ------------&lt;br/&gt;
&lt;br/&gt;
Command Line: -Xmx1G -Xcomp -Xbatch -XX:CompileOnly=Test -XX:CompileCommand=quiet -XX:MaxRAMPercentage=4.16667 -Dtest.boot.jdk=c:\ade\mesos\work_dir\jib-master\install\jdk\19\36\bundles\windows-x64\jdk-19_windows-x64_bin.zip\jdk-19 -Djava.io.tmpdir=c:\sb\prod\1681642304\testoutput\test-support\jtreg_closed_test_hotspot_jtreg_applications_javafuzzer_BigTest_java\tmp Test&lt;br/&gt;
&lt;br/&gt;
Host: AMD EPYC 7J13 64-Core Processor                , 12 cores, 23G,  Windows Server 2016 , 64 bit Build 14393 (10.0.14393.3630)&lt;br/&gt;
Time: Sun Apr 16 16:44:11 2023 /GM elapsed time: 2.077967 seconds (0d 0h 0m 2s)&lt;br/&gt;
&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&lt;br/&gt;
Current thread (0x000002ada11b9910):  JavaThread &amp;quot;C2 CompilerThread0&amp;quot; daemon [_thread_in_native, id=59124, stack(0x000000d943d00000,0x000000d943e00000)]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:   2078   84   !b  4       Test::mainTest (609 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x000000d943d00000,0x000000d943e00000]&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [jvm.dll+0xbd5dd1]  os::win32::platform_print_native_stack+0xf1  (os_windows_x86.cpp:236)&lt;br/&gt;
V  [jvm.dll+0xe4ef99]  VMError::report+0x1019  (vmError.cpp:815)&lt;br/&gt;
V  [jvm.dll+0xe50bf5]  VMError::report_and_die+0x645  (vmError.cpp:1588)&lt;br/&gt;
V  [jvm.dll+0xe51304]  VMError::report_and_die+0x64  (vmError.cpp:1353)&lt;br/&gt;
V  [jvm.dll+0x53101b]  report_vm_error+0x5b  (debug.cpp:191)&lt;br/&gt;
V  [jvm.dll+0xc1adc6]  PhaseCCP::analyze+0x996  (phaseX.cpp:1994)&lt;br/&gt;
V  [jvm.dll+0xc17478]  PhaseCCP::PhaseCCP+0xe8  (phaseX.cpp:1933)&lt;br/&gt;
V  [jvm.dll+0x4c5415]  Compile::Optimize+0xbb5  (compile.cpp:2373)&lt;br/&gt;
V  [jvm.dll+0x4c27e8]  Compile::Compile+0x1458  (compile.cpp:841)&lt;br/&gt;
V  [jvm.dll+0x3e0daa]  C2Compiler::compile_method+0x11a  (c2compiler.cpp:121)&lt;br/&gt;
V  [jvm.dll+0x4ddcf1]  CompileBroker::invoke_compiler_on_method+0x881  (compileBroker.cpp:2268)&lt;br/&gt;
V  [jvm.dll+0x4db2c6]  CompileBroker::compiler_thread_loop+0x396  (compileBroker.cpp:1945)&lt;br/&gt;
V  [jvm.dll+0x7af2f4]  JavaThread::thread_main_inner+0x224  (javaThread.cpp:718)&lt;br/&gt;
V  [jvm.dll+0xdc56cb]  Thread::call_run+0x1cb  (thread.cpp:229)&lt;br/&gt;
V  [jvm.dll+0xbd4700]  os::win32::thread_native_entry+0xa0  (os_windows.cpp:551)&lt;br/&gt;
C  [ucrtbase.dll+0x1fb80]&lt;br/&gt;
C  [KERNEL32.DLL+0x84d4]&lt;br/&gt;
C  [ntdll.dll+0x51791]&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5098467">JDK-8306042</key>
            <summary>C2: failed: Missed optimization opportunity in PhaseCCP (adding LShift-&gt;Cast-&gt;Add notification)</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="dholmes">David Holmes</reporter>
                        <labels>
                            <label>c2</label>
                            <label>javafuzzer</label>
                            <label>oracle-triage-11</label>
                            <label>oracle-triage-17</label>
                            <label>oracle-triage-21</label>
                    </labels>
                <created>Sun, 16 Apr 2023 14:41:16 -0700</created>
                <updated>Mon, 10 Jul 2023 00:11:24 -0700</updated>
                            <resolved>Wed, 3 May 2023 03:48:01 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14578736" author="dukebot" created="Wed, 3 May 2023 03:47:58 -0700"  >Changeset: e9807a4b&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-03 10:45:30 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/e9807a4b0f3533512623fba96042472b69d4ac34&quot;&gt;https://git.openjdk.org/jdk/commit/e9807a4b0f3533512623fba96042472b69d4ac34&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14576524" author="roboduke" created="Mon, 24 Apr 2023 23:23:01 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13611&quot;&gt;https://git.openjdk.org/jdk/pull/13611&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-24 11:32:48 +0000</comment>
                            <comment id="14576031" author="JIRAUSER19821" created="Mon, 24 Apr 2023 04:40:02 -0700"  >Draft:&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/pull/13611&quot;&gt;https://github.com/openjdk/jdk/pull/13611&lt;/a&gt;</comment>
                            <comment id="14574994" author="thartmann" created="Wed, 19 Apr 2023 01:39:16 -0700"  >I think we should fix it properly and handle an arbitrary chain of CastIIs. Otherwise, we risk issues like &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8288683&quot; title=&quot;C2: And node gets wrong type due to not adding it back to the worklist in CCP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8288683&quot;&gt;&lt;strike&gt;JDK-8288683&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14574772" author="JIRAUSER19821" created="Tue, 18 Apr 2023 10:22:59 -0700"  >Simplified it just a bit more, and added some comments:&lt;br/&gt;
./java -Xcomp -XX:CompileOnly=Test2 -XX:CompileCommand=quiet Test2.java</comment>
                            <comment id="14574744" author="JIRAUSER19821" created="Tue, 18 Apr 2023 09:44:32 -0700"  >Initial analysis:&lt;br/&gt;
We have a case like this:&lt;br/&gt;
Phi -&amp;gt; ShiftL -&amp;gt; CastII -&amp;gt; AndI&lt;br/&gt;
&lt;br/&gt;
The Phi has an updated type, so we should re-run Value on the AndI.&lt;br/&gt;
&lt;br/&gt;
In PhaseCCP::push_and, we do update a similar pattern:&lt;br/&gt;
X -&amp;gt; ShiftL -&amp;gt; AndI&lt;br/&gt;
&lt;br/&gt;
So the missing part is the CastII. The question is if I should fix this by skipping a single CastII, or if we should traverse an arbitrary chain of CastII?&lt;br/&gt;
Because &amp;quot;shift = shift-&amp;gt;uncast();&amp;quot; in MulNode::AndIL_shift_and_mask_is_always_zero skips an arbitrary number of CastII nodes.</comment>
                            <comment id="14574057" author="thartmann" created="Sun, 16 Apr 2023 23:21:55 -0700"  >Attached a reduced test:&lt;br/&gt;
java -Xcomp -XX:CompileOnly=TestReduced -XX:CompileCommand=quiet TestReduced.java</comment>
                            <comment id="14574046" author="thartmann" created="Sun, 16 Apr 2023 22:54:13 -0700"  >Reproducible with attached Test.java and &amp;quot;-Xmx1G -Xcomp -Xbatch -XX:CompileOnly=Test -XX:CompileCommand=quiet&amp;quot;&lt;br/&gt;
Fails since the verification code was introduced with &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8257197&quot; title=&quot;Add additional verification code to PhaseCCP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8257197&quot;&gt;&lt;strike&gt;JDK-8257197&lt;/strike&gt;&lt;/a&gt; and also with latest JDK 21.&lt;br/&gt;
&lt;br/&gt;
ILW = Imprecise type information leading to missed optimization opportunities and could hit assertion in CCP verification code, rare, no workaround = MLH = P4</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5100315">JDK-8307619</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5035767">JDK-8257197</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="103456" name="Test.java" size="9031" author="thartmann" created="Sun, 16 Apr 2023 22:52:56 -0700"/>
                            <attachment id="103480" name="Test2.java" size="625" author="epeter" created="Tue, 18 Apr 2023 10:22:34 -0700"/>
                            <attachment id="103465" name="TestReduced.java" size="507" author="thartmann" created="Sun, 16 Apr 2023 23:21:37 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31437:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17412"><![CDATA[b21]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>