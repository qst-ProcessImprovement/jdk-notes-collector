<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 16:02:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8300915] G1: incomplete SATB because nmethod entry barriers don&apos;t get armed</title>
                <link>https://bugs.openjdk.org/browse/JDK-8300915</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Symptom:&lt;br/&gt;
--------&lt;br/&gt;
&lt;br/&gt;
Crashes as described in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8299956&quot; title=&quot;[BACKOUT] 8297487: G1 Remark: no need to keep alive oop constants of nmethods on stack&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8299956&quot;&gt;&lt;strike&gt;JDK-8299956&lt;/strike&gt;&lt;/a&gt; because of class/nmethod unloading even though a nmethod is on stack.&lt;br/&gt;
&lt;br/&gt;
The crashes are reproducible with the release build running test/langtools:tier1 repeatedly with a concurrency of 6 within 15 - 180 minutes.&lt;br/&gt;
&lt;br/&gt;
Analysis:&lt;br/&gt;
--------&lt;br/&gt;
&lt;br/&gt;
Debugging code after G1ConcurrentMark::finalize_marking() shows there are&lt;br/&gt;
nmethods with dead oops (mostly classloaders) on stack if MarkingCodeBlobClosure&lt;br/&gt;
is changed not to mark oops during G1 remark.&lt;br/&gt;
&lt;br/&gt;
The following steps lead to a G1 concurrent marking cycle without arming nmethod entry barriers.&lt;br/&gt;
This could cause the symptom because nmethod barriers should be armed to keep oop constants&lt;br/&gt;
of nmethods alive.&lt;br/&gt;
&lt;br/&gt;
Step 1&lt;br/&gt;
&lt;br/&gt;
CodeCache::on_gc_marking_cycle_start() is called and nmethods are armed in&lt;br/&gt;
G1CollectedHeap::start_codecache_marking_cycle_if_inactive() before young GC&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Stack:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CodeCache::on_gc_marking_cycle_start() : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1CollectedHeap::start_codecache_marking_cycle_if_inactive() : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1ConcurrentMark::pre_concurrent_start(enum GCCause::Cause) : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1YoungCollector::pre_evacuate_collection_set(G1EvacInfo *) : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1YoungCollector::collect() : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1CollectedHeap::do_collection_pause_at_safepoint_helper() : void&lt;br/&gt;
&lt;br/&gt;
Step 2&lt;br/&gt;
&lt;br/&gt;
Concurrent marking start is undone at same safepoint&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;Stack:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1ConcurrentMarkThread::start_undo_mark() : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1CollectedHeap::start_concurrent_cycle(bool) : void&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1CollectedHeap::do_collection_pause_at_safepoint_helper() : void  &lt;br/&gt;
&lt;br/&gt;
Step 3&lt;br/&gt;
&lt;br/&gt;
Because of the undo the CodeCache::on_gc_marking_cycle_finish() in G1ConcurrentMark::remark() is not reached.&lt;br/&gt;
&lt;br/&gt;
Step 4&lt;br/&gt;
&lt;br/&gt;
Next concurrent cycle starts. Same stack as in Step 1. Nmethods are not armed&lt;br/&gt;
because CodeCache::is_gc_marking_cycle_active() returns true in&lt;br/&gt;
G1CollectedHeap::start_codecache_marking_cycle_if_inactive()&lt;br/&gt;
&lt;br/&gt;
This can cause the issues given in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8299956&quot; title=&quot;[BACKOUT] 8297487: G1 Remark: no need to keep alive oop constants of nmethods on stack&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8299956&quot;&gt;&lt;strike&gt;JDK-8299956&lt;/strike&gt;&lt;/a&gt;. The dead loaders are most&lt;br/&gt;
probably loaders of (maybe inlined) optimized virtual calls that aren&amp;#39;t&lt;br/&gt;
reachable anymore. Nevertheless the referencing nmethods must not be unloaded if&lt;br/&gt;
they are on stack. The backout done with &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8299956&quot; title=&quot;[BACKOUT] 8297487: G1 Remark: no need to keep alive oop constants of nmethods on stack&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8299956&quot;&gt;&lt;strike&gt;JDK-8299956&lt;/strike&gt;&lt;/a&gt; prevents this by iterating&lt;br/&gt;
all frames and marking the oops of nmethods on stack.&lt;br/&gt;
&lt;br/&gt;
A better fix would be to make sure nmethod entry barriers are armed when g1 marking starts.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5092255">JDK-8300915</key>
            <summary>G1: incomplete SATB because nmethod entry barriers don&apos;t get armed</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rrich">Richard Reingruber</assignee>
                                    <reporter username="rrich">Richard Reingruber</reporter>
                        <labels>
                            <label>gc-g1</label>
                            <label>gc-g1-marking</label>
                    </labels>
                <created>Mon, 23 Jan 2023 11:19:51 -0800</created>
                <updated>Tue, 14 Feb 2023 07:21:32 -0800</updated>
                            <resolved>Mon, 30 Jan 2023 00:45:34 -0800</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14555348" author="dukebot" created="Mon, 30 Jan 2023 00:45:32 -0800"  >Changeset: 3db558b6&lt;br/&gt;
Author:    Richard Reingruber &amp;lt;&lt;a href=&apos;mailto:rrich@openjdk.org&apos;&gt;rrich@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-30 08:43:15 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/3db558b67bebfe559833331475f481c588147084&quot;&gt;https://git.openjdk.org/jdk/commit/3db558b67bebfe559833331475f481c588147084&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14554371" author="roboduke" created="Wed, 25 Jan 2023 05:53:52 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12194&quot;&gt;https://git.openjdk.org/jdk/pull/12194&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-25 13:32:27 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="5094124">JDK-8302462</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5091115">JDK-8299956</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5077637">JDK-8288970</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3021n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17337"><![CDATA[b08]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>