<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:38:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8189338] JMX RMI Remote Mbean server connection hangs if the server stops responding during a SSL Handshake</title>
                <link>https://bugs.openjdk.org/browse/JDK-8189338</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>FULL PRODUCT VERSION :&lt;br/&gt;
openjdk version &amp;quot;1.8.0_111&amp;quot;&lt;br/&gt;
OpenJDK Runtime Environment (build 1.8.0_111-b15)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 25.111-b15, mixed mode)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
ADDITIONAL OS VERSION INFORMATION :&lt;br/&gt;
Linux, RHEL 7&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
Remote RMI server connection hangs if the server stops responding(goes out of network/crashes abruptly) during a SSL handshake. The connection hangs as the thread blocks at SocketInputStream.read and never times-out.&lt;br/&gt;
&lt;br/&gt;
The options of setting the system property sun.rmi.transport.tcp.handshakeTimeout and sun.rmi.transport.tcp.responseTimeout does not help here as the connection hangs before the java.net.Socket.setSoTimeout(int) is called based on these system properties. Refer the below thread dump.&lt;br/&gt;
&lt;br/&gt;
Shouldn&amp;#39;t the value set by sun.rmi.transport.tcp.handshakeTimeout used to set the SoTimeout before the writing to the DataOutputStream which triggers SSL handshake if it&amp;#39;s a SSL socket?&lt;br/&gt;
&lt;br/&gt;
The socketFactory to be used for the connection(to customize the socket) can&amp;#39;t be decided and set at the client side always as the client socketFactory can be exported on the server side and serialized to client in the remote stub. &lt;br/&gt;
&lt;br/&gt;
&amp;quot;TaskRunnerThreadPool&amp;quot; #1391 prio=5 os_prio=0 tid=0x00007f6ebc494800 nid=0x24a2 runnable [0x00007f6da928a000]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Thread.State: RUNNABLE&lt;br/&gt;
	at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)&lt;br/&gt;
	at java.net.SocketInputStream.read(SocketInputStream.java:171)&lt;br/&gt;
	at java.net.SocketInputStream.read(SocketInputStream.java:141)&lt;br/&gt;
	at sun.security.ssl.InputRecord.readFully(InputRecord.java:465)&lt;br/&gt;
	at sun.security.ssl.InputRecord.read(InputRecord.java:503)&lt;br/&gt;
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:983)&lt;br/&gt;
	- locked &amp;lt;0x00000006eb2394a8&amp;gt; (a java.lang.Object)&lt;br/&gt;
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1385)&lt;br/&gt;
	- locked &amp;lt;0x00000006eb2395a0&amp;gt; (a java.lang.Object)&lt;br/&gt;
	at sun.security.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:757)&lt;br/&gt;
	at sun.security.ssl.AppOutputStream.write(AppOutputStream.java:123)&lt;br/&gt;
	- locked &amp;lt;0x00000006eb23b5f0&amp;gt; (a sun.security.ssl.AppOutputStream)&lt;br/&gt;
	at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)&lt;br/&gt;
	at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)&lt;br/&gt;
	- locked &amp;lt;0x00000006eb23b608&amp;gt; (a java.io.BufferedOutputStream)&lt;br/&gt;
	at java.io.DataOutputStream.flush(DataOutputStream.java:123)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:229)&lt;br/&gt;
	at sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:202)&lt;br/&gt;
	at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:129)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnectionImpl_Stub.invoke(Unknown Source)&lt;br/&gt;
	at javax.management.remote.rmi.RMIConnector$RemoteMBeanServerConnection.invoke(RMIConnector.java:1020)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Refer the description.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
REPRODUCIBILITY :&lt;br/&gt;
This bug can be reproduced often.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="4942158">JDK-8189338</key>
            <summary>JMX RMI Remote Mbean server connection hangs if the server stops responding during a SSL Handshake</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djelinski">Daniel Jelinski</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>8-bp</label>
                            <label>additional-information-received</label>
                            <label>dcsfai</label>
                            <label>openjdk</label>
                            <label>reproducer-hard</label>
                            <label>webbug</label>
                    </labels>
                <created>Fri, 13 Oct 2017 04:55:41 -0700</created>
                <updated>Fri, 21 Jul 2023 07:34:50 -0700</updated>
                            <resolved>Wed, 4 Jan 2023 05:19:53 -0800</resolved>
                                    <version>8u111</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14554916" author="mbaesken" created="Fri, 27 Jan 2023 00:07:32 -0800"  >Hi  [~djelinski] ,  I created  &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8301214&quot;&gt;https://bugs.openjdk.org/browse/JDK-8301214&lt;/a&gt; and assigned it to you .</comment>
                            <comment id="14554763" author="JIRAUSER19825" created="Thu, 26 Jan 2023 09:24:14 -0800"  >Hi [~mbaesken] could you create a ticket and assign it to me? I&amp;#39;ll file a PR when I&amp;#39;m back from vacation next week. Thanks!</comment>
                            <comment id="14554652" author="mbaesken" created="Thu, 26 Jan 2023 03:38:33 -0800"  >&amp;gt; division by 4 instead of 2?&lt;br/&gt;
&lt;br/&gt;
Hi [~djelinski] ,  so far no new issues appeared in our nightly tests with this patch.  Do you want to create a PR ? Or should I do it ?&lt;br/&gt;
</comment>
                            <comment id="14553957" author="mbaesken" created="Tue, 24 Jan 2023 01:18:16 -0800"  >Hi [~djelinski] ,  we did not see the issue any more after 18th January after the patch was added to our nightly test patch queues for openjdk21.&lt;br/&gt;
Not sure if sometimes the issue still might happen, but at least the adjustment seems to be an improvement regarding stability.</comment>
                            <comment id="14551628" author="mbaesken" created="Tue, 17 Jan 2023 04:23:07 -0800"  >Hi [~djelinski] , I put your suggested patch in our nightly test patch queues. Let&amp;#39;s if this helps.&lt;br/&gt;
I want to run it under the nightly load/test env situations for a while.</comment>
                            <comment id="14551581" author="JIRAUSER19825" created="Tue, 17 Jan 2023 01:12:09 -0800"  >Hi [~mbaesken] thanks for reporting!&lt;br/&gt;
Does it help if you change lines 59-60 in the test to:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.setProperty(&amp;quot;sun.rmi.transport.tcp.handshakeTimeout&amp;quot;,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String.valueOf(TIMEOUT / 4));&lt;br/&gt;
&lt;br/&gt;
i.e. division by 4 instead of 2?&lt;br/&gt;
</comment>
                            <comment id="14551575" author="mbaesken" created="Tue, 17 Jan 2023 00:48:18 -0800"  >Hi [~djelinski] , after this change went in, I see on one of our test macOS machines (macOS 12.4) this error every 2-3 days in java/rmi/transport/handshakeTimeout/HandshakeTimeout.java :&lt;br/&gt;
&lt;br/&gt;
remote call failed with exception:&lt;br/&gt;
java.rmi.ConnectIOException: error during JRMP connection establishment; nested exception is: &lt;br/&gt;
	java.net.SocketTimeoutException: Read timed out&lt;br/&gt;
	at java.rmi/sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:308)&lt;br/&gt;
	at java.rmi/sun.rmi.transport.tcp.TCPChannel.newConnection(TCPChannel.java:204)&lt;br/&gt;
	at java.rmi/sun.rmi.server.UnicastRef.newCall(UnicastRef.java:345)&lt;br/&gt;
	at java.rmi/sun.rmi.registry.RegistryImpl_Stub.lookup(RegistryImpl_Stub.java:116)&lt;br/&gt;
	at HandshakeTimeout$Connector.run(HandshakeTimeout.java:133)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1623)&lt;br/&gt;
Caused by: java.net.SocketTimeoutException: Read timed out&lt;br/&gt;
	at java.base/sun.nio.ch.NioSocketImpl.timedRead(NioSocketImpl.java:273)&lt;br/&gt;
	at java.base/sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:299)&lt;br/&gt;
	at java.base/sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:341)&lt;br/&gt;
	at java.base/sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:791)&lt;br/&gt;
	at java.base/java.net.Socket$SocketInputStream.read(Socket.java:1099)&lt;br/&gt;
	at java.base/java.io.BufferedInputStream.fill(BufferedInputStream.java:258)&lt;br/&gt;
	at java.base/java.io.BufferedInputStream.implRead(BufferedInputStream.java:292)&lt;br/&gt;
	at java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:279)&lt;br/&gt;
	at java.base/java.io.DataInputStream.readUnsignedByte(DataInputStream.java:288)&lt;br/&gt;
	at java.base/java.io.DataInputStream.readByte(DataInputStream.java:268)&lt;br/&gt;
	at java.rmi/sun.rmi.transport.tcp.TCPChannel.createConnection(TCPChannel.java:247)&lt;br/&gt;
	... 5 more&lt;br/&gt;
&lt;br/&gt;
TEST PASSED: java.rmi.ConnectException or ConnectIOException thrown&lt;br/&gt;
STATUS:Passed.&lt;br/&gt;
--------------------------------&lt;br/&gt;
java.lang.RuntimeException: TEST FAILED: remote call did not time out&lt;br/&gt;
	at HandshakeTimeout.main(HandshakeTimeout.java:94)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainThread.run(MainWrapper.java:125)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1623)&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException: TEST FAILED: remote call did not time out&lt;br/&gt;
JavaTest Message: shutting down test&lt;br/&gt;
&lt;br/&gt;
STATUS:Failed.`main&amp;#39; threw exception: java.lang.RuntimeException: TEST FAILED: remote call did not time out	</comment>
                            <comment id="14548663" author="dukebot" created="Wed, 4 Jan 2023 05:19:51 -0800"  >Changeset: 41900b57&lt;br/&gt;
Author:    Daniel Jeli&#324;ski &amp;lt;&lt;a href=&apos;mailto:djelinski@openjdk.org&apos;&gt;djelinski@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-04 13:17:29 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/41900b57af084e0cfc1453681b24fe5606e11ab2&quot;&gt;https://git.openjdk.org/jdk/commit/41900b57af084e0cfc1453681b24fe5606e11ab2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14548302" author="roboduke" created="Tue, 3 Jan 2023 06:06:09 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/11829&quot;&gt;https://git.openjdk.org/jdk/pull/11829&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-03 13:35:32 +0000</comment>
                            <comment id="14322148" author="mwthomps" created="Tue, 3 Mar 2020 14:48:49 -0800"  >This looks to be an RMI issue</comment>
                            <comment id="14131942" author="fmatte" created="Thu, 16 Nov 2017 21:11:46 -0800"  >Received additional information from submitter&lt;br/&gt;
==&lt;br/&gt;
Set VM args as(just to provide the keystore/truststore to create a SSLContext): -Djavax.net.ssl.trustStore=C:\Users\vedasena\Desktop\jars\default_truststore.bcfks -Djavax.net.ssl.trustStorePassword=RAgvBfq02Ym4Y4J3 -Djavax.net.ssl.keyStore=C:\Users\vedasena\Desktop\jars\container_tls_keystore.bcfks -Djavax.net.ssl.keyStorePassword=RAgvBfq02Ym4Y4J3  -Djavax.net.ssl.trustStoreType=BCFKS -Djavax.net.ssl.keyStoreType=BCFKS&lt;br/&gt;
&lt;br/&gt;
I also tried setting sun.rmi.transport.tcp.handshakeTimeout and sun.rmi.transport.tcp.responseTimeout to finite values. But these take effect only after the SSL handshake is complete(and the connection can gets stuck during the handshake).&lt;br/&gt;
&lt;br/&gt;
On the client side call MBeanServerConnection.invoke(new ObjectName(beanName), operationName, params, signature);&lt;br/&gt;
&lt;br/&gt;
And refer the below stack trace to where it can get stuck if SO_TIMEOUT is not set on the socket. The socket is created by the SslRMIClientSocketFactory which is sent to the client in the remote stub. So, there is no way to set it for the given connection.  &lt;br/&gt;
==&lt;br/&gt;
&lt;br/&gt;
Attached is the server and client code</comment>
                            <comment id="14122967" author="fmatte" created="Sun, 15 Oct 2017 21:08:05 -0700"  >Issue reported on Openjdk build. Requested submitter to verify on Oracle binary and provide the below information&lt;br/&gt;
1. We need to know whar are the vm arguments used to start the jvm?&lt;br/&gt;
2. Test case to reproduce this issue.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4274568">JDK-4322806</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="73631" name="InvokeJMX.java" size="1615" author="fmatte" created="Thu, 16 Nov 2017 21:09:29 -0800"/>
                            <attachment id="73632" name="SSLJMXConnector.java" size="3483" author="fmatte" created="Thu, 16 Nov 2017 21:09:22 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2asgr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="247"><![CDATA[java.rmi]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>