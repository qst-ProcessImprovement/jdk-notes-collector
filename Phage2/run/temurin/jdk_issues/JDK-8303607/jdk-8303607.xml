<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:27:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303607] SunMSCAPI provider leaks memory and keys</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303607</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>In some (if not all) cases the SunMSCAPI provider leaks keys.  When getting the keys and building certificate chains the provider silently gets the keys as a test which are then freed.  The Windows API for CryptAcquireCertificatePrivateKey details that the caller needs to release the key if the output value of pfCallerFreeProvOrNCryptKey is true.  The existing code handled this case but did not use the correct free in all cases.  There&amp;#39;s a second output (pdwKeySpec) value which tells you whether to use CryptReleaseContext or NCryptFreeObject.  However the current code always calls CryptReleaseContext.&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a repro case (watch the handle counts in the windows task manager grow) for both java.exe and lsass.exe&lt;br/&gt;
&lt;br/&gt;
Note that this issue existed prior to the support for localmachine stores was added&lt;br/&gt;
&lt;br/&gt;
import java.security.*;&lt;br/&gt;
&lt;br/&gt;
class AcpTest {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public static void main(String[] args)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while (true)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{     &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;KeyStore keyStore = KeyStore.getInstance(&amp;quot;Windows-MY&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;keyStore.load(null, null);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;} catch (Exception ex) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(&amp;quot;Error!&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ex.printStackTrace();            &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}</description>
                <environment></environment>
        <key id="5095509">JDK-8303607</key>
            <summary>SunMSCAPI provider leaks memory and keys</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="macarte">Mat Carter</assignee>
                                    <reporter username="macarte">Mat Carter</reporter>
                        <labels>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>noreg-hard</label>
                    </labels>
                <created>Fri, 3 Mar 2023 12:06:08 -0800</created>
                <updated>Thu, 12 Oct 2023 15:09:15 -0700</updated>
                            <resolved>Mon, 6 Mar 2023 18:14:16 -0800</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>19</version>
                                    <fixVersion>21</fixVersion>
                                    <component>security-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14617305" author="JIRAUSER19300" created="Tue, 10 Oct 2023 16:41:39 -0700"  >Fix request [11u]&lt;br/&gt;
&lt;br/&gt;
I backported this for 11 as the handle leak is still a real issue in jdk11&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes.</comment>
                            <comment id="14617301" author="roboduke" created="Tue, 10 Oct 2023 16:25:01 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2174&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2174&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-10 23:15:23 +0000</comment>
                            <comment id="14616354" author="JIRAUSER19300" created="Thu, 5 Oct 2023 15:43:01 -0700"  >Okay maybe not a problem as the original change was in tip before 21 was created, so the hash is the same in both repos</comment>
                            <comment id="14616351" author="JIRAUSER19300" created="Thu, 5 Oct 2023 15:23:16 -0700"  >^ I backported from tip, but just realized I might have had to backport from jdk21u - which is right, does it matter</comment>
                            <comment id="14616324" author="JIRAUSER19300" created="Thu, 5 Oct 2023 12:42:49 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backported this for 17 as the handle leak is still a real issue in jdk17&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes.</comment>
                            <comment id="14616320" author="roboduke" created="Thu, 5 Oct 2023 12:37:56 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1848&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1848&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-05 19:32:38 +0000</comment>
                            <comment id="14616299" author="roboduke" created="Thu, 5 Oct 2023 11:58:32 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1846&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1846&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-05 18:53:21 +0000</comment>
                            <comment id="14564913" author="dukebot" created="Mon, 6 Mar 2023 18:14:13 -0800"  >Changeset: c51d40cf&lt;br/&gt;
Author:    Mat Carter &amp;lt;&lt;a href=&apos;mailto:macarte@openjdk.org&apos;&gt;macarte@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Weijun Wang &amp;lt;&lt;a href=&apos;mailto:weijun@openjdk.org&apos;&gt;weijun@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-07 02:12:30 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/c51d40cfebe793b2e979db0f2d91ac3b136311bb&quot;&gt;https://git.openjdk.org/jdk/commit/c51d40cfebe793b2e979db0f2d91ac3b136311bb&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14564873" author="roboduke" created="Mon, 6 Mar 2023 13:34:38 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12891&quot;&gt;https://git.openjdk.org/jdk/pull/12891&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-06 21:27:07 +0000</comment>
                            <comment id="14564461" author="JIRAUSER19300" created="Fri, 3 Mar 2023 12:08:12 -0800"  >Testing a fix</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5112005">JDK-8317762</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5112320">JDK-8318052</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17007"><![CDATA[windows_xp]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30m4j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17339"><![CDATA[b13]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="229"><![CDATA[javax.crypto]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>