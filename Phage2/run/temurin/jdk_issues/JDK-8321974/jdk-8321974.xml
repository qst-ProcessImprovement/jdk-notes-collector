<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 11:15:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8321974] Crash in ciKlass::is_subtype_of because TypeAryPtr::_klass is not initialized</title>
                <link>https://bugs.openjdk.org/browse/JDK-8321974</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8297933&quot; title=&quot;[REDO] Compiler should only use verified interface types for optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8297933&quot;&gt;&lt;strike&gt;JDK-8297933&lt;/strike&gt;&lt;/a&gt; added code that relies on lazy initialization of the `TypeAryPtr::_klass` field. However, there are cases when the field is not yet initialized, leading to a null pointer dereference at C2 compilation time.&lt;br/&gt;
&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  SIGSEGV (0xb) at pc=0x00007f13e88b11b4, pid=3086758, tid=3086774&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (22.0+26) (build 22-ea+26-2088)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (22-ea+26-2088, mixed mode, sharing, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x5ae1b4]  ciKlass::is_subtype_of(ciKlass*)+0xb4&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:85   12    b        TestUninitializedKlassField::test (27 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007f13be74e000,0x00007f13be84f000],  sp=0x00007f13be84a860,  free space=1010k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x5ae1b4]  ciKlass::is_subtype_of(ciKlass*)+0xb4&lt;br/&gt;
V  [libjvm.so+0xe3e7eb]  CmpPNode::sub(Type const*, Type const*) const+0x13b&lt;br/&gt;
V  [libjvm.so+0xd24c7f]  PhaseIterGVN::transform_old(Node*)+0x13f&lt;br/&gt;
V  [libjvm.so+0xd1f47c]  PhaseIterGVN::optimize()+0x6c&lt;br/&gt;
V  [libjvm.so+0x641d72]  Compile::Optimize()+0x1c2&lt;br/&gt;
V  [libjvm.so+0x643afd]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0xedd&lt;br/&gt;
V  [libjvm.so+0x56acd1]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x1f1&lt;br/&gt;
V  [libjvm.so+0x6494b1]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0xae1&lt;br/&gt;
V  [libjvm.so+0x64c558]  CompileBroker::compiler_thread_loop()+0x498&lt;br/&gt;
V  [libjvm.so+0x904868]  JavaThread::thread_main_inner() [clone .part.0]+0xb8&lt;br/&gt;
V  [libjvm.so+0xead2df]  Thread::call_run()+0x9f&lt;br/&gt;
V  [libjvm.so+0xcd12d5]  thread_native_entry(Thread*)+0xd5&lt;br/&gt;
&lt;br/&gt;
The issue only reproduces with release builds because additional verification code in Type::meet_helper in debug builds calls klass() which leads to eager initialization of the _klass field. When disabling the verification code, the issue also reproduces with debug builds and we hit:&lt;br/&gt;
&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/oracle/valhalla/open/src/hotspot/share/opto/type.cpp:6895), pid=3089473, tid=3089490&lt;br/&gt;
#  Error: assert(this_one-&amp;gt;_klass != nullptr &amp;amp;&amp;amp; other-&amp;gt;_klass != nullptr) failed&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (22.0) (fastdebug build 22-lworld4ea-2023-11-20-1024510.tobias...)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 22-lworld4ea-2023-11-20-1024510.tobias..., mixed mode, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x1838e42]  TypeAryPtr::is_same_java_type_as_helper(TypeOopPtr const*) const+0x232&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:    371   29    b        TestUninitializedKlassField::test (27 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007f685c628000,0x00007f685c729000],  sp=0x00007f685c7243e0,  free space=1008k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x1838e42]  TypeAryPtr::is_same_java_type_as_helper(TypeOopPtr const*) const+0x232  (type.cpp:6895)&lt;br/&gt;
V  [libjvm.so+0x1763660]  CmpPNode::sub(Type const*, Type const*) const+0x1b0  (type.hpp:1201)&lt;br/&gt;
V  [libjvm.so+0x1587e0f]  PhaseIterGVN::transform_old(Node*)+0x30f  (phaseX.cpp:1241)&lt;br/&gt;
V  [libjvm.so+0x157e8b8]  PhaseIterGVN::optimize()+0x88  (phaseX.cpp:1051)&lt;br/&gt;
V  [libjvm.so+0xa24b2e]  Compile::Optimize()+0x1de  (compile.cpp:2725)&lt;br/&gt;
V  [libjvm.so+0xa28d81]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x1b61  (compile.cpp:867)&lt;br/&gt;
V  [libjvm.so+0x87268b]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x13b  (c2compiler.cpp:119)&lt;br/&gt;
V  [libjvm.so+0xa34750]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0x980  (compileBroker.cpp:2285)&lt;br/&gt;
V  [libjvm.so+0xa35438]  CompileBroker::compiler_thread_loop()+0x4a8  (compileBroker.cpp:1946)&lt;br/&gt;
V  [libjvm.so+0xefa3fc]  JavaThread::thread_main_inner()+0xcc  (javaThread.cpp:721)&lt;br/&gt;
V  [libjvm.so+0x1809e8a]  Thread::call_run()+0xba  (thread.cpp:220)&lt;br/&gt;
V  [libjvm.so+0x14eff5a]  thread_native_entry(Thread*)+0x12a  (os_linux.cpp:785)&lt;br/&gt;
&lt;br/&gt;
Thanks to [~mowerfel] for reporting!</description>
                <environment></environment>
        <key id="5116889">JDK-8321974</key>
            <summary>Crash in ciKlass::is_subtype_of because TypeAryPtr::_klass is not initialized</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thartmann">Tobias Hartmann</assignee>
                                    <reporter username="thartmann">Tobias Hartmann</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>hgupdate-sync</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-23</label>
                            <label>regression</label>
                    </labels>
                <created>Wed, 13 Dec 2023 03:34:25 -0800</created>
                <updated>Sat, 29 Jun 2024 01:16:44 -0700</updated>
                            <resolved>Wed, 13 Dec 2023 23:25:41 -0800</resolved>
                                    <version>21</version>
                    <version>22</version>
                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14637355" author="roboduke" created="Thu, 4 Jan 2024 01:27:15 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/119&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/119&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-04 09:20:01 +0000</comment>
                            <comment id="14637354" author="roboduke" created="Thu, 4 Jan 2024 01:25:16 -0800"  >[jdk21u-fix-request] Approval Request from Aleksey Shipil&amp;#xEB;v&lt;br/&gt;
Clean backport to fix C2 regression in JDK 21. Applies cleanly. The regression test, unfortunately, still passes without the fix.</comment>
                            <comment id="14635375" author="shade" created="Tue, 19 Dec 2023 02:41:14 -0800"  >For current JDK 21u-dev, this clashes with &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309203&quot; title=&quot;C2: remove copy-by-value of GrowableArray for InterfaceSet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309203&quot;&gt;&lt;strike&gt;JDK-8309203&lt;/strike&gt;&lt;/a&gt;, which should go in first.</comment>
                            <comment id="14634208" author="roboduke" created="Wed, 13 Dec 2023 23:47:28 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22/pull/12&quot;&gt;https://git.openjdk.org/jdk22/pull/12&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-14 07:41:03 +0000</comment>
                            <comment id="14634201" author="dukebot" created="Wed, 13 Dec 2023 23:25:40 -0800"  >Changeset: c8ad7b7f&lt;br/&gt;
Author:    Tobias Hartmann &amp;lt;&lt;a href=&apos;mailto:thartmann@openjdk.org&apos;&gt;thartmann@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-12-14 07:23:21 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/c8ad7b7f84ead3f850f034e1db6335bbbac41589&quot;&gt;https://git.openjdk.org/jdk/commit/c8ad7b7f84ead3f850f034e1db6335bbbac41589&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14633916" author="roboduke" created="Wed, 13 Dec 2023 04:03:20 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/17085&quot;&gt;https://git.openjdk.org/jdk/pull/17085&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-13 11:57:42 +0000</comment>
                            <comment id="14633913" author="thartmann" created="Wed, 13 Dec 2023 03:39:16 -0800"  >ILW = Crash during compilation due to null pointer dereference (regression in JDK 21), reproducible with simple test, no workaround but disable compilation of affected method = HMM = P2</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5116904">JDK-8321989</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5117598">JDK-8322553</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118147">JDK-8323048</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5117008">JDK-8322083</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                            <outwardlinks description="blocks">
                                                        </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5128469">JDK-8331518</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5088685">JDK-8297933</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="107676" name="hs_err_pid3086758.log" size="63063" author="thartmann" created="Wed, 13 Dec 2023 03:33:28 -0800"/>
                            <attachment id="107675" name="replay_pid3086758.log" size="141140" author="thartmann" created="Wed, 13 Dec 2023 03:33:28 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17455"><![CDATA[b05]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34863:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17305"><![CDATA[b03]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>