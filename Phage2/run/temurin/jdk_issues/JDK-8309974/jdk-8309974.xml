<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:00:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8309974] some JVMCI tests fail when VM options include -XX:+EnableJVMCI</title>
                <link>https://bugs.openjdk.org/browse/JDK-8309974</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>make LOG=info TEST=&amp;quot;compiler/jvmci&amp;quot; TEST_OPTS=VM_OPTIONS=&amp;quot;-XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI&amp;quot; test&lt;br/&gt;
&lt;br/&gt;
results in these tests failing:&lt;br/&gt;
&lt;br/&gt;
compiler/jvmci/events/JvmciShutdownEventTest.java&lt;br/&gt;
compiler/jvmci/jdk.vm.ci.hotspot.test/src/jdk/vm/ci/hotspot/test/HotSpotConstantReflectionProviderTest.java&lt;br/&gt;
compiler/jvmci/meta/StableFieldTest.java&lt;br/&gt;
&lt;br/&gt;
Adding TEST_MODE=othervm makes the tests pass:&lt;br/&gt;
&lt;br/&gt;
make LOG=info TEST=&amp;quot;compiler/jvmci&amp;quot; TEST_OPTS=VM_OPTIONS=&amp;quot;-XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI&amp;quot; JTREG=TEST_MODE=othervm test&lt;br/&gt;
&lt;br/&gt;
As far as I can tell, this has something to do with these tests using the ClassFileInstaller to install a JVMCI specific test class AND requiring JVMCI modules to be exported. For example:&lt;br/&gt;
&lt;br/&gt;
/**&lt;br/&gt;
&amp;nbsp;* @test&lt;br/&gt;
&amp;nbsp;* @bug 8151664&lt;br/&gt;
&amp;nbsp;* @requires vm.jvmci&lt;br/&gt;
&amp;nbsp;* @library /test/lib /&lt;br/&gt;
&amp;nbsp;* @modules java.base/jdk.internal.misc&lt;br/&gt;
&amp;nbsp;* @modules java.base/jdk.internal.vm.annotation&lt;br/&gt;
&amp;nbsp;*          jdk.internal.vm.ci/jdk.vm.ci.hotspot&lt;br/&gt;
&amp;nbsp;*          jdk.internal.vm.ci/jdk.vm.ci.meta&lt;br/&gt;
&amp;nbsp;*          jdk.internal.vm.ci/jdk.vm.ci.runtime&lt;br/&gt;
&amp;nbsp;*&lt;br/&gt;
&amp;nbsp;* @compile StableFieldTest.java&lt;br/&gt;
&amp;nbsp;* @run driver jdk.test.lib.helpers.ClassFileInstaller compiler.jvmci.meta.StableFieldTest&lt;br/&gt;
&amp;nbsp;* @run main/othervm -XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI -XX:-UseJVMCICompiler -Xbootclasspath/a:. compiler.jvmci.meta.StableFieldTest&lt;br/&gt;
&amp;nbsp;*/&lt;br/&gt;
&lt;br/&gt;
I think what happens is that `TEST_OPTS=VM_OPTIONS=&amp;quot;-XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI&amp;quot;` causes `@requires vm.jvmci` to evaluate to true but when ` jdk.test.lib.helpers.ClassFileInstaller compiler.jvmci.meta.StableFieldTest` is run, the java subprocess does not inherit the `-XX:+UnlockExperimentalVMOptions -XX:+EnableJVMCI` options and so it fails when trying to export the JVMCI modules:&lt;br/&gt;
&lt;br/&gt;
ACTION: driver -- Error. Can&amp;#39;t init module exports: module not found: jdk.internal.vm.ci&lt;br/&gt;
REASON: User specified action: run driver jdk.test.lib.helpers.ClassFileInstaller compiler.jvmci.meta.StableFieldTest&lt;br/&gt;
TIME:   0.213 seconds&lt;br/&gt;
messages:&lt;br/&gt;
command: driver jdk.test.lib.helpers.ClassFileInstaller compiler.jvmci.meta.StableFieldTest&lt;br/&gt;
reason: User specified action: run driver jdk.test.lib.helpers.ClassFileInstaller compiler.jvmci.meta.StableFieldTest&lt;br/&gt;
started: Tue Jun 13 22:47:43 CEST 2023&lt;br/&gt;
Mode: agentvm&lt;br/&gt;
Agent id: 2&lt;br/&gt;
Additional exports to unnamed modules from @modules: java.base/jdk.internal.misc java.base/jdk.internal.vm.annotation jdk.internal.vm.ci/jdk.vm.ci.hotspot jdk.internal.vm.ci/jdk.vm.ci.meta jdk.internal.vm.ci/jdk.vm.ci.runtime&lt;br/&gt;
finished: Tue Jun 13 22:47:44 CEST 2023&lt;br/&gt;
elapsed time (seconds): 0.213&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5103109">JDK-8309974</key>
            <summary>some JVMCI tests fail when VM options include -XX:+EnableJVMCI</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dnsimon">Douglas Simon</assignee>
                                    <reporter username="dnsimon">Douglas Simon</reporter>
                        <labels>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-SQE-ok-next</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jvmci</label>
                            <label>noreg-self</label>
                            <label>oracle-triage-22</label>
                    </labels>
                <created>Tue, 13 Jun 2023 13:49:37 -0700</created>
                <updated>Wed, 9 Oct 2024 23:35:36 -0700</updated>
                            <resolved>Thu, 15 Jun 2023 08:55:25 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14616509" author="roboduke" created="Fri, 6 Oct 2023 10:14:40 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1855&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1855&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-06 17:05:57 +0000</comment>
                            <comment id="14616508" author="roboduke" created="Fri, 6 Oct 2023 10:12:13 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/230&quot;&gt;https://git.openjdk.org/jdk21u/pull/230&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-06 17:04:22 +0000</comment>
                            <comment id="14616504" author="goetz" created="Fri, 6 Oct 2023 10:01:21 -0700"  >Fix request [21u, 17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.10-oracle.&lt;br/&gt;
No risk, only a test change.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Tests pass. SAP nightly testing passed.</comment>
                            <comment id="14595046" author="dnsimon" created="Tue, 11 Jul 2023 07:50:50 -0700"  >[~jjg] is there an issue for the jtreg bug (&lt;a href=&quot;https://github.com/openjdk/jdk/pull/14476#issuecomment-1593324748&quot;&gt;https://github.com/openjdk/jdk/pull/14476#issuecomment-1593324748&lt;/a&gt;) that can be linked to this issue?</comment>
                            <comment id="14589675" author="dukebot" created="Thu, 15 Jun 2023 08:55:24 -0700"  >Changeset: 8b4af46b&lt;br/&gt;
Author:    Doug Simon &amp;lt;&lt;a href=&apos;mailto:dnsimon@openjdk.org&apos;&gt;dnsimon@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-15 15:53:08 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/8b4af46be4447a7bc3b58f4054488e8bc50ee111&quot;&gt;https://git.openjdk.org/jdk/commit/8b4af46be4447a7bc3b58f4054488e8bc50ee111&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14589392" author="roboduke" created="Wed, 14 Jun 2023 13:10:08 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14476&quot;&gt;https://git.openjdk.org/jdk/pull/14476&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-14 20:04:41 +0000</comment>
                            <comment id="14589380" author="dnsimon" created="Wed, 14 Jun 2023 12:26:03 -0700"  >[~jjg] helped me diagnose the problem. In the process, we discovered there&amp;#39;s a bug in jtreg in that the TEST_MODE=othervm execution mentioned in the issue description should also have failed.&lt;br/&gt;
&lt;br/&gt;
The solution is that the test needs the execution of ClassFileInstaller to inherit any extra VM options passed to jtreg. This is achieved by using `@run main/othervm` instead of `@run driver` to execute the ClassFileInstaller.&lt;br/&gt;
&lt;br/&gt;
[~jjg] explanation of `@run driver` helped me so I&amp;#39;m copying it here as a useful reference: The intended use of driver is for cases to either &amp;quot;extend&amp;quot; jtreg functionality or to allow script-like functionality to be written in Java, and in both cases, the intent is to run with the class with &amp;quot;default&amp;quot; options.   It is expected that the functionality being tested is not in the driver class, it is in a class that is run, in some non-standard custom way, by the driver class.</comment>
                            <comment id="14589202" author="chagedorn" created="Wed, 14 Jun 2023 01:25:40 -0700"  >ILW = Multiple JVMCI test failures with -XX:+EnableJVMCI, few tests, use -XX:-EnableJVMCI = MML = P4</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5110138">JDK-8316127</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5112072">JDK-8317826</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5112129">JDK-8317883</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                                        </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104286" name="StableFieldTest.jtr.txt" size="26090" author="dnsimon" created="Tue, 13 Jun 2023 13:51:11 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31w4b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17305"><![CDATA[b03]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>