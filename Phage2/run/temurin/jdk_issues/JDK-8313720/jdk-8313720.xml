<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:50:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8313720] C2 SuperWord: wrong result with -XX:+UseVectorCmov -XX:+UseCMoveUnconditionally</title>
                <link>https://bugs.openjdk.org/browse/JDK-8313720</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Found this while trying to find a reproducer for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8313345&quot; title=&quot;SuperWord fails due to CMove without matching Bool pack&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8313345&quot;&gt;&lt;strike&gt;JDK-8313345&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Reproduce:&lt;br/&gt;
java -Xbatch -XX:CompileCommand=compileonly,Test2::test -XX:+TraceLoopOpts -XX:+UseVectorCmov -XX:+UseCMoveUnconditionally -XX:+TraceSuperWord -XX:+TraceNewVectors -XX:MaxVectorSize=64 Test2.java&lt;br/&gt;
&lt;br/&gt;
fail: 100 1.0 != 0.0 : 1.0 1.0&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.RuntimeException: There were wrong results&lt;br/&gt;
	at Test2.verify(Test2.java:56)&lt;br/&gt;
	at Test2.main(Test2.java:44)&lt;br/&gt;
&lt;br/&gt;
I suspect the reason is the mixed comparison values in the Bool pack (le / lt):&lt;br/&gt;
Pack: 11&lt;br/&gt;
&amp;nbsp;align: 0 	 1708  Bool  === _ 1709  [[ 1707 ]] [le] !orig=1462,1241,163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 4 	 1702  Bool  === _ 1703  [[ 1701 ]] [lt] !orig=1456,1235,255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 8 	 1696  Bool  === _ 1697  [[ 1695 ]] [le] !orig=1450,163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 12 	 1690  Bool  === _ 1691  [[ 1689 ]] [lt] !orig=1444,255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 16 	 1684  Bool  === _ 1685  [[ 1683 ]] [le] !orig=1241,163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 20 	 1678  Bool  === _ 1679  [[ 1677 ]] [lt] !orig=1235,255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 24 	 1666  Bool  === _ 1667  [[ 1665 ]] [le] !orig=163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 28 	 1660  Bool  === _ 1661  [[ 1659 ]] [lt] !orig=255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 32 	 1462  Bool  === _ 1463  [[ 1461 ]] [le] !orig=1241,163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 36 	 1456  Bool  === _ 1457  [[ 1455 ]] [lt] !orig=1235,255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 40 	 1450  Bool  === _ 1451  [[ 1449 ]] [le] !orig=163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 44 	 1444  Bool  === _ 1445  [[ 1443 ]] [lt] !orig=255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 48 	 1241  Bool  === _ 1242  [[ 1240 ]] [le] !orig=163 !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 52 	 1235  Bool  === _ 1236  [[ 1234 ]] [lt] !orig=255 !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&amp;nbsp;align: 56 	  163  Bool  === _ 162  [[ 317 ]] [le] !jvms: Test2::test @ bci:24 (line 16)&lt;br/&gt;
&amp;nbsp;align: 60 	  255  Bool  === _ 254  [[ 318 ]] [lt] !jvms: Test2::test @ bci:48 (line 17)&lt;br/&gt;
&lt;br/&gt;
The logic I implemented in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8306302&quot; title=&quot;C2 Superword fix: use VectorMaskCmp and VectorBlend instead of CMoveVF/D&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8306302&quot;&gt;&lt;strike&gt;JDK-8306302&lt;/strike&gt;&lt;/a&gt; did not take account of hand unrolled loops, where the comparisons can be different.</description>
                <environment></environment>
        <key id="5107381">JDK-8313720</key>
            <summary>C2 SuperWord: wrong result with -XX:+UseVectorCmov -XX:+UseCMoveUnconditionally</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="epeter">Emanuel Peter</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>c2-superword</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-17</label>
                            <label>oracle-triage-22</label>
                            <label>regression</label>
                    </labels>
                <created>Thu, 3 Aug 2023 15:52:53 -0700</created>
                <updated>Fri, 29 Dec 2023 06:11:27 -0800</updated>
                            <resolved>Wed, 16 Aug 2023 00:18:26 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14636405" author="roboduke" created="Tue, 26 Dec 2023 05:13:01 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/98&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/98&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-26 13:08:16 +0000</comment>
                            <comment id="14636403" author="goetz" created="Tue, 26 Dec 2023 04:56:34 -0800"  >Fix request [21u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 21.0.3-oracle.&lt;br/&gt;
Typical risk of a C2 change, Good repro case.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes and fails without the fix. SAP nightly testing passed.</comment>
                            <comment id="14604271" author="dukebot" created="Wed, 16 Aug 2023 00:18:25 -0700"  >Changeset: d46f0fb3&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-08-16 07:15:43 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d46f0fb31888db75f5b2b78a162fec16dfc5d0d9&quot;&gt;https://git.openjdk.org/jdk/commit/d46f0fb31888db75f5b2b78a162fec16dfc5d0d9&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14604010" author="roboduke" created="Tue, 15 Aug 2023 06:28:06 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15274&quot;&gt;https://git.openjdk.org/jdk/pull/15274&lt;/a&gt;&lt;br/&gt;
Date: 2023-08-14 14:57:39 +0000</comment>
                            <comment id="14601821" author="chagedorn" created="Thu, 3 Aug 2023 23:30:56 -0700"  >ILW = Wrong result with superword, edge case?, use -XX:-UseVectorCmov -XX:-UseCMoveUnconditionally = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5116811">JDK-8321905</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5117839">JDK-8322776</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5098743">JDK-8306302</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104998" name="Test2.java" size="1669" author="epeter" created="Thu, 3 Aug 2023 15:50:12 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32md7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>