<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:47:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8272613] CharsetDecoder.decode(ByteBuffer) throws IllegalArgumentException</title>
                <link>https://bugs.openjdk.org/browse/JDK-8272613</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
If CharsetDecoder.decode(ByteBuffer) is called on a ByteBuffer with size close to Integer.MAX_VALUE, IllegalArgumentException is thrown due to integer overflow in output buffer size allocation.&lt;br/&gt;
&lt;br/&gt;
In most cases (characters per byte 1.0 or less), decode() should handle up to Integer.MAX_VALUE sized ByteBuffers. In cases where characters per byte can be greater than one and output size would exceed Integer.MAX_VALUE, then perhaps some new subclass of CharacterCodingException, such as &amp;quot;OutputSizeException&amp;quot; could be thrown.&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Run as:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;java -Xms8G -Xmx8G CharsetDecoderBug&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
No output.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.IllegalArgumentException: capacity &amp;lt; 0: (-2000127 &amp;lt; 0)&lt;br/&gt;
	at java.base/java.nio.Buffer.createCapacityException(Buffer.java:278)&lt;br/&gt;
	at java.base/java.nio.CharBuffer.allocate(CharBuffer.java:360)&lt;br/&gt;
	at java.base/java.nio.charset.CharsetDecoder.decode(CharsetDecoder.java:814)&lt;br/&gt;
	at CharsetDecoderBug.main(CharsetDecoderBug.java:14)&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
import java.nio.charset.*;&lt;br/&gt;
import java.nio.*;&lt;br/&gt;
&lt;br/&gt;
public class CharsetDecoderBug {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;public static void main(String[] args) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Charset charset = Charset.forName(&amp;quot;utf8&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CharsetDecoder decoder = charset.newDecoder();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// This works. // int size = Integer.MAX_VALUE - 10000000;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int size = Integer.MAX_VALUE - 1000000;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;byte[] bytes = new byte[size];&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ByteBuffer bb = ByteBuffer.wrap(bytes, 0, size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;decoder.decode(bb);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch (CharacterCodingException ignored) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Enforce a lower limit on the size of the ByteBuffer before calling decode().&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5056857">JDK-8272613</key>
            <summary>CharsetDecoder.decode(ByteBuffer) throws IllegalArgumentException</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="naoto">Naoto Sato</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>dcsaw</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Tue, 17 Aug 2021 12:11:48 -0700</created>
                <updated>Fri, 21 Jul 2023 07:35:11 -0700</updated>
                            <resolved>Wed, 29 Mar 2023 09:10:55 -0700</resolved>
                                    <version>16</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14570466" author="dukebot" created="Wed, 29 Mar 2023 09:10:54 -0700"  >Changeset: f07decb7&lt;br/&gt;
Author:    Naoto Sato &amp;lt;&lt;a href=&apos;mailto:naoto@openjdk.org&apos;&gt;naoto@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-29 16:08:57 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/f07decb74b525072cf035b1e11569d43390952ed&quot;&gt;https://git.openjdk.org/jdk/commit/f07decb74b525072cf035b1e11569d43390952ed&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14569226" author="roboduke" created="Thu, 23 Mar 2023 18:55:59 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13131&quot;&gt;https://git.openjdk.org/jdk/pull/13131&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-21 22:40:48 +0000</comment>
                            <comment id="14442534" author="tongwan" created="Tue, 17 Aug 2021 22:58:50 -0700"  >The observation on Windows 10:&lt;br/&gt;
JDK 16: got java.lang.IllegalArgumentException: capacity &amp;lt; 0: (-2000127 &amp;lt; 0)&lt;br/&gt;
&lt;br/&gt;
This looks like an enhancement.  Moved to JDK for more evaluations.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10400">
                    <name>CSR</name>
                                            <outwardlinks description="csr for">
                                        <issuelink>
            <issuekey id="5097025">JDK-8304842</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="96055" name="CharsetDecoderBug.java" size="585" author="tongwan" created="Tue, 17 Aug 2021 22:57:10 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u2k3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17312"><![CDATA[b16]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="294"><![CDATA[java.nio.charsets]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>