<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:23:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8307955] Prefer to PTRACE_GETREGSET instead of PTRACE_GETREGS in method &apos;ps_proc.c::process_get_lwp_regs&apos;</title>
                <link>https://bugs.openjdk.org/browse/JDK-8307955</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>As the man page of `ptrace` states [1], `PTRACE_GETREGS and PTRACE_GETFPREGS are not present on all architectures`, we should prefer using `PTRACE_GETREGSET` instead of `PTRACE_GETREGS` when invoking the method &amp;#39;ptrace&amp;#39;.&lt;br/&gt;
&lt;br/&gt;
The code of `ps_proc.c::process_get_lwp_regs` [2] try to use `PTRACE_GETREGS` first, and `PTRACE_GETREGSET` is a second option. It leads the `process_get_lwp_regs` fails at some special ENVs. In my local riscv-linux env, several tests failed.&lt;br/&gt;
&lt;br/&gt;
The failed test is shown below:&lt;br/&gt;
```&lt;br/&gt;
serviceability/sa/ClhsdbCDSJstackPrintAll.java &lt;br/&gt;
serviceability/sa/ClhsdbDumpheap.java&lt;br/&gt;
serviceability/sa/ClhsdbFindPC.java#no-xcomp-process &lt;br/&gt;
serviceability/sa/ClhsdbJdis.java &lt;br/&gt;
serviceability/sa/ClhsdbJstack.java#id1 &lt;br/&gt;
serviceability/sa/ClhsdbPrintAs.java&lt;br/&gt;
serviceability/sa/ClhsdbSource.java &lt;br/&gt;
serviceability/sa/ClhsdbThreadContext.java &lt;br/&gt;
serviceability/sa/ClhsdbWhere.java &lt;br/&gt;
serviceability/sa/TestClhsdbJstackLock.java &lt;br/&gt;
serviceability/sa/TestJhsdbJstackLock.java &lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
The log of the failed test `serviceability/sa/ClhsdbCDSJstackPrintAll.java`:&lt;br/&gt;
```&lt;br/&gt;
java.lang.RuntimeException: Test ERROR java.lang.RuntimeException: &amp;#39;LingeredApp.steadyState&amp;#39; missing from stdout/stderr&lt;br/&gt;
	at ClhsdbCDSJstackPrintAll.main(ClhsdbCDSJstackPrintAll.java:117)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainThread.run(MainWrapper.java:125)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1583)&lt;br/&gt;
Caused by: java.lang.RuntimeException: &amp;#39;LingeredApp.steadyState&amp;#39; missing from stdout/stderr&lt;br/&gt;
	at jdk.test.lib.process.OutputAnalyzer.shouldMatch(OutputAnalyzer.java:340)&lt;br/&gt;
	at ClhsdbLauncher.runCmd(ClhsdbLauncher.java:166)&lt;br/&gt;
	at ClhsdbLauncher.run(ClhsdbLauncher.java:203)&lt;br/&gt;
	at ClhsdbCDSJstackPrintAll.main(ClhsdbCDSJstackPrintAll.java:113)&lt;br/&gt;
	... 4 more&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException: Test ERROR java.lang.RuntimeException: &amp;#39;LingeredApp.steadyState&amp;#39; missing from stdout/stderr&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;https://man7.org/linux/man-pages/man2/ptrace.2.html&quot;&gt;https://man7.org/linux/man-pages/man2/ptrace.2.html&lt;/a&gt;&lt;br/&gt;
[2] &lt;a href=&quot;https://github.com/openjdk/jdk/blob/5d6cce0f8543e8ae966798aad685b190cc8101aa/src/jdk.hotspot.agent/linux/native/libsaproc/ps_proc.c#L148&quot;&gt;https://github.com/openjdk/jdk/blob/5d6cce0f8543e8ae966798aad685b190cc8101aa/src/jdk.hotspot.agent/linux/native/libsaproc/ps_proc.c#L148&lt;/a&gt;</description>
                <environment></environment>
        <key id="5100752">JDK-8307955</key>
            <summary>Prefer to PTRACE_GETREGSET instead of PTRACE_GETREGS in method &apos;ps_proc.c::process_get_lwp_regs&apos;</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gli">Guoxiong Li</assignee>
                                    <reporter username="gli">Guoxiong Li</reporter>
                        <labels>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                    </labels>
                <created>Thu, 11 May 2023 11:17:02 -0700</created>
                <updated>Tue, 27 Feb 2024 23:15:54 -0800</updated>
                            <resolved>Tue, 16 May 2023 20:10:04 -0700</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14652156" author="JIRAUSER20521" created="Mon, 26 Feb 2024 01:59:40 -0800"  >Fix Request (11u):&lt;br/&gt;
Hi, This is also needed for riscv-port-jdk11u repo where we have full-reatured linux-riscv port for the same reason as jdk17u backport. The backport is not clean because the sparc architecture related code still exists. Risk is low as this is a small change prefering using PTRACE_GETREGSET instead of PTRACE_GETREGS. Tested on linux-aarch64 and linux-x86_64 platforms.</comment>
                            <comment id="14652076" author="roboduke" created="Sun, 25 Feb 2024 22:22:33 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2549&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2549&lt;/a&gt;&lt;br/&gt;
Date: 2024-02-26 06:18:33 +0000</comment>
                            <comment id="14642262" author="roboduke" created="Mon, 22 Jan 2024 03:50:39 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2152&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2152&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-22 11:45:00 +0000</comment>
                            <comment id="14642261" author="luhenry" created="Mon, 22 Jan 2024 03:44:34 -0800"  >Fix request for jdk17u: &lt;br/&gt;
Without this change, the test `test/jdk/sun/tools/jhsdb/HeapDumpTest.java` fails on RISC-V because the `ptrace(PTRACE_GETREGSET)` call returns EIO. We can observe the same resulting issue of not capturing the current frame and only the caller frames on each thread.</comment>
                            <comment id="14582209" author="dukebot" created="Tue, 16 May 2023 20:10:03 -0700"  >Changeset: 2f1c6548&lt;br/&gt;
Author:    Guoxiong Li &amp;lt;&lt;a href=&apos;mailto:gli@openjdk.org&apos;&gt;gli@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-17 03:07:56 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/2f1c65486b1e584f9c4a2eb7af2414d032a02748&quot;&gt;https://git.openjdk.org/jdk/commit/2f1c65486b1e584f9c4a2eb7af2414d032a02748&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14581082" author="JIRAUSER19202" created="Thu, 11 May 2023 18:06:09 -0700"  >I attach the log files before (`ClhsdbCDSJstackPrintAll-before-patch.jtr`) and after (`ClhsdbCDSJstackPrintAll-after-patch.jtr`) my patch.&lt;br/&gt;
&lt;br/&gt;
The main difference is the output of the thread `SteadyStateThread` when using `jstack -v`. It reports `WARNING: getThreadIntegerRegisterSet0: get_lwp_regs failed for lwp`.&lt;br/&gt;
&lt;br/&gt;
original test (before my patch):&lt;br/&gt;
```&lt;br/&gt;
&amp;quot;SteadyStateThread&amp;quot; #19 prio=5 tid=0x0000003fac19f250 nid=3640 waiting for monitor entry [0x0000003f579fd000]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;JavaThread state: _thread_blocked&lt;br/&gt;
WARNING: getThreadIntegerRegisterSet0: get_lwp_regs failed for lwp (3640)&lt;br/&gt;
&amp;nbsp;- jdk.test.lib.apps.LingeredApp$1.run() @bci=4, line=573, pc=0x0000003f9bd1e3e2, Method*=0x0000003f78404518 (Interpreted frame)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
after my patch:&lt;br/&gt;
```&lt;br/&gt;
&amp;quot;SteadyStateThread&amp;quot; #19 prio=5 tid=0x0000003f7c19f250 nid=226624 waiting for monitor entry [0x0000003f2f5fd000]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;JavaThread state: _thread_blocked&lt;br/&gt;
&amp;nbsp;- jdk.test.lib.apps.LingeredApp.steadyState(java.lang.Object) @bci=8, line=567, pc=0x0000003f6bd30a26, Method*=0x0000003f48403ae0 (Interpreted frame)&lt;br/&gt;
	- waiting to lock &amp;lt;0x00000000e5523de0&amp;gt; (a java.lang.Object)&lt;br/&gt;
&amp;nbsp;- jdk.test.lib.apps.LingeredApp$1.run() @bci=4, line=573, pc=0x0000003f6bd1e3e2, Method*=0x0000003f48404518 (Interpreted frame)&lt;br/&gt;
```</comment>
                            <comment id="14581031" author="cjplummer" created="Thu, 11 May 2023 13:28:55 -0700"  >Can you include some more info from the .jtr file? The exception you&amp;#39;ve included is from the main test that checks the output of the &amp;quot;jhsdb clhsdb&amp;quot; command. It&amp;#39;d be interested in seeing what that output looks like.</comment>
                            <comment id="14581018" author="roboduke" created="Thu, 11 May 2023 11:40:22 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13939&quot;&gt;https://git.openjdk.org/jdk/pull/13939&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-11 18:32:36 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5119725">JDK-8324435</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5122692">JDK-8326918</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="103813" name="ClhsdbCDSJstackPrintAll-after-patch.jtr" size="106705" author="gli" created="Thu, 11 May 2023 18:01:29 -0700"/>
                            <attachment id="103814" name="ClhsdbCDSJstackPrintAll-before-patch.jtr" size="119697" author="gli" created="Thu, 11 May 2023 18:01:29 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31hr7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17433"><![CDATA[b23]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="2072"><![CDATA[svc-agent]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>