<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:16:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8309515] Stale cached data from Matcher.namedGroups() after Matcher.usePattern()</title>
                <link>https://bugs.openjdk.org/browse/JDK-8309515</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ADDITIONAL SYSTEM INFORMATION :&lt;br/&gt;
OS independent; bug can be seen in java.util.regex.Matcher source code, introduced in commit openjdk/jdk@ce85cac for issue 8065554.&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
In addressing issue &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8065554&quot; title=&quot;MatchResult should provide values of named-capturing groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8065554&quot;&gt;&lt;strike&gt;JDK-8065554&lt;/strike&gt;&lt;/a&gt; (MatchResult should provide values of named-capturing groups), commit openjdk/jdk@ce85cac added a namedGroups field in Matcher to cache the map from parentPattern.namedGroups().&lt;br/&gt;
&lt;br/&gt;
The map is lazily cached, only when the field is null and namedGroups() is called (which may be indirectly through a call of start(String), end(String), or group(String). The same cached value will then continue to be returned even if Matcher.usePattern is later called and the new Pattern has different named groups, or no named groups, or the same named groups mapped to different integers. Therefore, symptoms can include seeing the wrong results when retrieving by named groups, or spurious IllegalArgumentExceptions for groups that the new pattern provides, or exceptions not thrown for groups that the new pattern doesn&amp;#39;t provide, or exceptions for an invalid group index when calling a method that takes a group name.&lt;br/&gt;
&lt;br/&gt;
Could be fixed by eliminating the local copy and simply having Matcher.namedGroups() call parentPattern.namedGroups() unconditionally, or by having Matcher.usePattern simply null the field, so the correct map will be lazily cached when next needed.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
REGRESSION : Last worked in version 17&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
jshell in version 20:&lt;br/&gt;
&lt;br/&gt;
var p1 = Pattern.compile(&amp;quot;(?&amp;lt;a&amp;gt;...)(?&amp;lt;b&amp;gt;...)&amp;quot;);&lt;br/&gt;
var p2 = Pattern.compile(&amp;quot;(?&amp;lt;b&amp;gt;...)(?&amp;lt;a&amp;gt;...)&amp;quot;);&lt;br/&gt;
var m = p1.matcher(&amp;quot;foobar&amp;quot;);&lt;br/&gt;
m.matches()&lt;br/&gt;
// ==&amp;gt; true&lt;br/&gt;
m.group(&amp;quot;a&amp;quot;)&lt;br/&gt;
// ==&amp;gt; &amp;quot;foo&amp;quot;&lt;br/&gt;
m.usePattern(p2)&lt;br/&gt;
m.matches()&lt;br/&gt;
// ==&amp;gt; true&lt;br/&gt;
m.group(&amp;quot;a&amp;quot;)&lt;br/&gt;
// ==&amp;gt; &amp;quot;foo&amp;quot;  WRONG RESULT: should be &amp;quot;bar&amp;quot; for p2&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
Using p1, (?&amp;lt;a&amp;gt;...)(?&amp;lt;b&amp;gt;...), on the string &amp;quot;foobar&amp;quot; should return &amp;quot;foo&amp;quot; for group a.&lt;br/&gt;
Using p2, (?&amp;lt;b&amp;gt;...)(?&amp;lt;a&amp;gt;...), on the string &amp;quot;foobar&amp;quot; should return &amp;quot;bar&amp;quot; for group a.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
After usePattern(p2) on the string &amp;quot;foobar&amp;quot;, &amp;quot;foo&amp;quot; is incorrectly returned for group a, because the group name to group index mapping for pattern p1 is still cached.&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Calls to m.namedGroups() on a Matcher m can be replaced with calls to m.pattern().namedGroups(), and any calls to m.start(String), m.end(String), or m.group(String) can be replaced with code that maps the name string to an integer index using m.pattern().namedGroups(), throwing the proper exception if not found, and then calls start(int), end(int), or group(int).&lt;br/&gt;
&lt;br/&gt;
In code that must also compile on Java &amp;lt; 20 where the namedGroups() method is unknown, a MethodHandle can be constructed for it at runtime, or variant code can be supplied in a multi-version jar.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5102549">JDK-8309515</key>
            <summary>Stale cached data from Matcher.namedGroups() after Matcher.usePattern()</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgiulietti">Raffaello Giulietti</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>dcsaw</label>
                            <label>regression</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Mon, 5 Jun 2023 11:00:26 -0700</created>
                <updated>Fri, 21 Jul 2023 07:36:36 -0700</updated>
                            <resolved>Wed, 7 Jun 2023 14:42:42 -0700</resolved>
                                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14589437" author="tongwan" created="Wed, 14 Jun 2023 18:39:06 -0700"  >Additional information from the submitter:&lt;br/&gt;
While &amp;quot;REGRESSION : Last worked in version 17&amp;quot; appears in the report, I have had no problems in 18 or 19 either. The named groups functionality seems to have been reliable from 8 through 19, with this regression first appearing in 20.</comment>
                            <comment id="14587784" author="dukebot" created="Wed, 7 Jun 2023 14:42:40 -0700"  >Changeset: 90027ff2&lt;br/&gt;
Author:    Raffaello Giulietti &amp;lt;&lt;a href=&apos;mailto:rgiulietti@openjdk.org&apos;&gt;rgiulietti@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-07 21:39:53 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/90027ff204fcf441db6bd0076e253474631757c8&quot;&gt;https://git.openjdk.org/jdk/commit/90027ff204fcf441db6bd0076e253474631757c8&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14587596" author="roboduke" created="Wed, 7 Jun 2023 04:27:06 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14350&quot;&gt;https://git.openjdk.org/jdk/pull/14350&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-07 11:20:02 +0000</comment>
                            <comment id="14587245" author="tongwan" created="Tue, 6 Jun 2023 00:34:47 -0700"  >The observations on Windows 10:&lt;br/&gt;
JDK 17: Passed, p2 returned &amp;quot;bar&amp;quot;&lt;br/&gt;
JDK 20ea+17: Passed.&lt;br/&gt;
JDK 20ea+18: Failed.&lt;br/&gt;
JDK 21ea+20: Failed.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4755917">JDK-8065554</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104194" name="Main.java" size="578" author="tongwan" created="Mon, 5 Jun 2023 23:41:47 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17554"><![CDATA[b18]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22023">20</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31soj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17357"><![CDATA[b26]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="333"><![CDATA[java.util.regex]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>