<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:26:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8310130] C2: assert(false) failed: scalar_input is neither phi nor a matchin reduction</title>
                <link>https://bugs.openjdk.org/browse/JDK-8310130</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The attached Java Fuzzer test starts to fail after &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302652&quot; title=&quot;[SuperWord] Reduction should happen after loop, when possible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8302652&quot;&gt;&lt;strike&gt;JDK-8302652&lt;/strike&gt;&lt;/a&gt;:&lt;br/&gt;
&lt;br/&gt;
To reproduce:&lt;br/&gt;
$ java -Xcomp -XX:CompileCommand=compileonly,Test::* Test.java&lt;br/&gt;
$ java -Xcomp -XX:CompileCommand=compileonly,Reduced::* Reduced.java&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/cd627e65-f015-4fb1-a1d2-b6c9b8127f98-S9638/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/7cab5968-cfac-4917-b50c-ee11433deb3c/runs/89e28e37-02bc-4ad0-8809-7a3c3140d816/workspace/open/src/hotspot/share/opto/loopopts.cpp:4249), pid=1696577, tid=1696600&lt;br/&gt;
#  assert(false) failed: scalar_input is neither phi nor a matchin reduction&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0+26) (fastdebug build 21-ea+26-LTS-2328)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-ea+26-LTS-2328, compiled mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x12b07f6]  PhaseIdealLoop::move_unordered_reduction_out_of_loop(IdealLoopTree*)+0x896&lt;br/&gt;
..........&lt;br/&gt;
Command Line: -Xmx1G -Xcomp -Xbatch -XX:CompileOnly=Test -XX:CompileCommand=quiet -XX:MaxRAMPercentage=4.16667 -Dtest.boot.jdk=/opt/mach5/mesos/work_dir/jib-master/install/jdk/20/36/bundles/linux-x64/jdk-20_linux-x64_bin.tar.gz/jdk-20 -Djava.io.tmpdir=/opt/mach5/mesos/work_dir/slaves/741e9afd-8c02-45c3-b2e2-9db1450d0832-S161740/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/a03df349-195e-43a5-997a-9d6208db5f95/runs/30281575-d526-4e59-b473-1cda18ba846e/testoutput/test-support/jtreg_closed_test_hotspot_jtreg_applications_javafuzzer_BigTest_java/tmp Test&lt;br/&gt;
........&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:    471    8    b  4       Test::vMeth (313 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007f0aeda00000,0x00007f0aedb00000],  sp=0x00007f0aedafac00,  free space=1003k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x12b07f6]  PhaseIdealLoop::move_unordered_reduction_out_of_loop(IdealLoopTree*)+0x896  (loopopts.cpp:4249)&lt;br/&gt;
V  [libjvm.so+0x1296c54]  PhaseIdealLoop::build_and_optimize()+0x1414  (loopnode.cpp:4673)&lt;br/&gt;
V  [libjvm.so+0x9f2939]  PhaseIdealLoop::optimize(PhaseIterGVN&amp;amp;, LoopOptsMode)+0x3b9  (loopnode.hpp:1124)&lt;br/&gt;
V  [libjvm.so+0x9ef4a7]  Compile::Optimize()+0xe97  (compile.cpp:2156)&lt;br/&gt;
V  [libjvm.so+0x9f16d6]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x1b96  (compile.cpp:842)&lt;br/&gt;
V  [libjvm.so+0x84b3e4]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x3c4  (c2compiler.cpp:118)&lt;br/&gt;
V  [libjvm.so+0x9fd5e0]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0xa00  (compileBroker.cpp:2265)&lt;br/&gt;
V  [libjvm.so+0x9fe468]  CompileBroker::compiler_thread_loop()+0x618  (compileBroker.cpp:1944)&lt;br/&gt;
V  [libjvm.so+0xeb651c]  JavaThread::thread_main_inner()+0xcc  (javaThread.cpp:719)&lt;br/&gt;
V  [libjvm.so+0x1795d7a]  Thread::call_run()+0xba  (thread.cpp:217)&lt;br/&gt;
V  [libjvm.so+0x149623c]  thread_native_entry(Thread*)+0x11c  (os_linux.cpp:778)&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5103292">JDK-8310130</key>
            <summary>C2: assert(false) failed: scalar_input is neither phi nor a matchin reduction</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="chagedorn">Christian Hagedorn</reporter>
                        <labels>
                            <label>c2</label>
                            <label>c2-superword</label>
                            <label>hgupdate-sync</label>
                            <label>javafuzzer</label>
                            <label>oracle-triage-11</label>
                            <label>oracle-triage-17</label>
                            <label>oracle-triage-22</label>
                            <label>regression</label>
                    </labels>
                <created>Thu, 15 Jun 2023 03:48:12 -0700</created>
                <updated>Wed, 12 Jul 2023 13:36:14 -0700</updated>
                            <resolved>Tue, 27 Jun 2023 22:53:46 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14592538" author="roboduke" created="Wed, 28 Jun 2023 07:46:00 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/77&quot;&gt;https://git.openjdk.org/jdk21/pull/77&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-28 14:38:43 +0000</comment>
                            <comment id="14592434" author="dukebot" created="Tue, 27 Jun 2023 22:53:45 -0700"  >Changeset: 526dba1a&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-28 05:52:26 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/526dba1a2942e444bf11d03d8eaf014b5ef20ccf&quot;&gt;https://git.openjdk.org/jdk/commit/526dba1a2942e444bf11d03d8eaf014b5ef20ccf&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14590197" author="roboduke" created="Mon, 19 Jun 2023 01:53:29 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14494&quot;&gt;https://git.openjdk.org/jdk/pull/14494&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-15 14:42:14 +0000</comment>
                            <comment id="14589651" author="JIRAUSER19821" created="Thu, 15 Jun 2023 07:56:05 -0700"  >Constructed a quite different example of the same issue:&lt;br/&gt;
&lt;br/&gt;
./java -Xcomp -XX:-TieredCompilation -XX:CompileCommand=compileonly,Reduced3::test -XX:+TraceNewVectors -XX:+TraceSuperWord -XX:+TraceLoopOpts -XX:MaxVectorSize=16 Reduced3.java</comment>
                            <comment id="14589627" author="JIRAUSER19821" created="Thu, 15 Jun 2023 06:39:16 -0700"  >Reduced it a bit more:&lt;br/&gt;
&lt;br/&gt;
java -Xcomp -XX:-TieredCompilation -XX:CompileCommand=compileonly,Reduced2::test -XX:+TraceNewVectors -XX:+TraceSuperWord -XX:UseAVX=2 -XX:+TraceLoopOpts Reduced2.java</comment>
                            <comment id="14589606" author="JIRAUSER19821" created="Thu, 15 Jun 2023 05:27:03 -0700"  >Had a quick look. The reduction loop looks like this:&lt;br/&gt;
&lt;br/&gt;
(rr) p current-&amp;gt;dump_bfs(10,current,&amp;quot;#dA&amp;quot;)&lt;br/&gt;
dist apd dump&lt;br/&gt;
---------------------------------------------&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;5   6   852  Phi  === 844 497 999  [[ 834 ]]  #long !orig=[752],[683],[641],[331],253 !jvms: Reduced::test @ bci:36 (line 16)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;4   6   834  OrL  === _ 852 835  [[ 828 ]]  !orig=[742],[668],[321],255 !jvms: Reduced::test @ bci:39 (line 16)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;3   6   828  OrL  === _ 834 829  [[ 817 ]]  !orig=[734],[321],255 !jvms: Reduced::test @ bci:39 (line 16)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;2   6   817  OrL  === _ 828 818  [[ 816 ]]  !orig=[668],[321],255 !jvms: Reduced::test @ bci:39 (line 16)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1   6   816  OrL  === _ 817 824  [[ 999 ]]  !orig=[321],255 !jvms: Reduced::test @ bci:39 (line 16)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0   0   999  OrReductionV  === _ 816 998  [[ 320 852 ]]  !orig=[742],[668],[321],255 !jvms: Reduced::test @ bci:39 (line 16)&lt;br/&gt;
&lt;br/&gt;
This means we have a mix of scalar and vector reductions. This is probably due to partial reduction.&lt;br/&gt;
I added the assert we hit here because I was not sure if something like this could ever happen. Now we have an example.&lt;br/&gt;
I&amp;#39;ll investigate more, but most likely we will just remove the assert and accept the bailout of this specific optimization.</comment>
                            <comment id="14589576" author="chagedorn" created="Thu, 15 Jun 2023 03:49:36 -0700"  >ILW = C2 assertion failure, single Java Fuzzer test, use -XX:-UseSuperWord or disable compilation of affected method = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5104342">JDK-8311058</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5104685">JDK-8311358</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5094345">JDK-8302652</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104311" name="FuzzerUtils.java" size="13240" author="chagedorn" created="Thu, 15 Jun 2023 03:46:55 -0700"/>
                            <attachment id="104310" name="Reduced.java" size="440" author="chagedorn" created="Thu, 15 Jun 2023 03:46:58 -0700"/>
                            <attachment id="104320" name="Reduced2.java" size="336" author="epeter" created="Thu, 15 Jun 2023 06:38:52 -0700"/>
                            <attachment id="104321" name="Reduced3.java" size="559" author="epeter" created="Thu, 15 Jun 2023 07:55:42 -0700"/>
                            <attachment id="104312" name="Test.java" size="7633" author="chagedorn" created="Thu, 15 Jun 2023 03:46:51 -0700"/>
                            <attachment id="104309" name="hs_err_pid1696577.log" size="101827" author="chagedorn" created="Thu, 15 Jun 2023 03:48:10 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17624"><![CDATA[b24]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31x8r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>