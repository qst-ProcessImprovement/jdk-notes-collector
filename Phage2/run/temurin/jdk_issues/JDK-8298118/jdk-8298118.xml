<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 14:35:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8298118] split-if optimization causes empty loop to temporarily have more than one phi </title>
                <link>https://bugs.openjdk.org/browse/JDK-8298118</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK20 CI:&lt;br/&gt;
&lt;br/&gt;
applications/javafuzzer/BigTest.java&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
Summary of the JavaFuzzer run:&lt;br/&gt;
------------------------------&lt;br/&gt;
Host:     ol9-x64-653811&lt;br/&gt;
Tests:    12 x 300&lt;br/&gt;
Args:     -conf config.yml&lt;br/&gt;
&lt;br/&gt;
Started  at: Mon Dec  5 07:26:26 UTC 2022&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
r7- 300: 183 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 117 Reference Java failures&lt;br/&gt;
r5- 300: 178 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 122 Reference Java failures&lt;br/&gt;
r1- 300: 184 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 116 Reference Java failures&lt;br/&gt;
r11- 300: 175 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 125 Reference Java failures&lt;br/&gt;
r10- 300: 170 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 130 Reference Java failures&lt;br/&gt;
r8- 300: 194 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 106 Reference Java failures&lt;br/&gt;
r6- 300: 174 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 126 Reference Java failures&lt;br/&gt;
r12- 300: 181 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 119 Reference Java failures&lt;br/&gt;
r2- 300: 172 passed, 0 crashes, 0 fails, 1 hangs, 0 incorrect tests, 127 Reference Java failures&lt;br/&gt;
r9- 300: 180 passed, 2 crashes, 0 fails, 0 hangs, 0 incorrect tests, 119 Reference Java failures&lt;br/&gt;
r4- 300: 186 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 114 Reference Java failures&lt;br/&gt;
r3- 300: 179 passed, 0 crashes, 0 fails, 0 hangs, 0 incorrect tests, 121 Reference Java failures&lt;br/&gt;
&lt;br/&gt;
Finished at: Mon Dec  5 15:34:04 UTC 2022&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/0c72054a-24ab-4dbb-944f-97f9341a1b96-S137551/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/d38ec7f3-948d-490e-9c1f-f54015d7f963/runs/14cf096c-70f7-49b6-b667-8e738b11d2c0/workspace/open/src/hotspot/share/opto/loopTransform.cpp:3641), pid=2082216, tid=2082233&lt;br/&gt;
#  assert(iv == __null) failed: Too many phis&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (20.0+27) (fastdebug build 20-ea+27-2094)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 20-ea+27-2094, compiled mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x148d3bc]  IdealLoopTree::do_remove_empty_loop(PhaseIdealLoop*) [clone .part.0]+0x36c&lt;br/&gt;
#&lt;br/&gt;
# Core dump will be written. Default location: Core dumps may be processed with &amp;quot;/opt/core.sh %p&amp;quot; (or dumping to /tmp/fuzzer.tmp.ZMKvo9CUBY/core.2082216)&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/0c72054a-24ab-4dbb-944f-97f9341a1b96-S137551/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/d38ec7f3-948d-490e-9c1f-f54015d7f963/runs/14cf096c-70f7-49b6-b667-8e738b11d2c0/workspace/open/src/hotspot/share/opto/loopTransform.cpp:3641), pid=2082457, tid=2082478&lt;br/&gt;
#  assert(iv == __null) failed: Too many phis&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (20.0+27) (fastdebug build 20-ea+27-2094)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 20-ea+27-2094, compiled mode, sharing, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x148d3bc]  IdealLoopTree::do_remove_empty_loop(PhaseIdealLoop*) [clone .part.0]+0x36c&lt;br/&gt;
#&lt;br/&gt;
# Core dump will be written. Default location: Core dumps may be processed with &amp;quot;/opt/core.sh %p&amp;quot; (or dumping to /tmp/fuzzer.tmp.ZMKvo9CUBY/core.2082457)&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
[2022-12-05T15:34:04.490226215Z] Waiting for completion for process 2036310&lt;br/&gt;
[2022-12-05T15:34:04.490407488Z] Waiting for completion finished for process 2036310&lt;br/&gt;
----------System.err:(13/728)----------&lt;br/&gt;
java.lang.RuntimeException: assertEquals: expected 1 to equal 2&lt;br/&gt;
	at jdk.test.lib.Asserts.fail(Asserts.java:594)&lt;br/&gt;
	at jdk.test.lib.Asserts.assertEquals(Asserts.java:205)&lt;br/&gt;
	at jdk.test.lib.Asserts.assertEquals(Asserts.java:189)&lt;br/&gt;
	at applications.javafuzzer.JavaFuzzerRunner.main(JavaFuzzerRunner.java:245)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainActionHelper$AgentVMRunnable.run(MainActionHelper.java:312)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1599)&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException&lt;br/&gt;
JavaTest Message: shutting down test&lt;br/&gt;
&lt;br/&gt;
result: Failed. Execution failed: `main&amp;#39; threw exception: java.lang.RuntimeException: assertEquals: expected 1 to equal 2&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s the crashing thread&amp;#39;s stack:&lt;br/&gt;
&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&lt;br/&gt;
Current thread (0x00007f62c0341180):  JavaThread &amp;quot;C2 CompilerThread0&amp;quot; daemon [_thread_in_native, id=2082233, stack(0x00007f62a8cfe000,0x00007f62a8dfe000)]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:    392   12   !b  4       Test::vMeth1 (259 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007f62a8cfe000,0x00007f62a8dfe000],  sp=0x00007f62a8df7f40,  free space=999k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x148d3bc]  IdealLoopTree::do_remove_empty_loop(PhaseIdealLoop*) [clone .part.0]+0x36c  (loopTransform.cpp:3641)&lt;br/&gt;
V  [libjvm.so+0x1490fcf]  IdealLoopTree::iteration_split_impl(PhaseIdealLoop*, Node_List&amp;amp;)+0x6f  (loopTransform.cpp:3616)&lt;br/&gt;
V  [libjvm.so+0x1491639]  IdealLoopTree::iteration_split(PhaseIdealLoop*, Node_List&amp;amp;)+0x109  (loopTransform.cpp:3931)&lt;br/&gt;
V  [libjvm.so+0x14c0951]  PhaseIdealLoop::build_and_optimize()+0xc61  (loopnode.cpp:4533)&lt;br/&gt;
V  [libjvm.so+0xb00b21]  PhaseIdealLoop::optimize(PhaseIterGVN&amp;amp;, LoopOptsMode)+0x261  (loopnode.hpp:1082)&lt;br/&gt;
V  [libjvm.so+0xafc8b3]  Compile::Optimize()+0xe13  (compile.cpp:2146)&lt;br/&gt;
V  [libjvm.so+0xafef6e]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x18ce  (compile.cpp:830)&lt;br/&gt;
V  [libjvm.so+0x90f0a7]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x4e7  (c2compiler.cpp:113)&lt;br/&gt;
V  [libjvm.so+0xb0be4c]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0xa7c  (compileBroker.cpp:2237)&lt;br/&gt;
V  [libjvm.so+0xb0cc38]  CompileBroker::compiler_thread_loop()+0x608  (compileBroker.cpp:1916)&lt;br/&gt;
V  [libjvm.so+0x107d1b6]  JavaThread::thread_main_inner()+0x206  (javaThread.cpp:697)&lt;br/&gt;
V  [libjvm.so+0x1a81520]  Thread::call_run()+0x100  (thread.cpp:224)&lt;br/&gt;
V  [libjvm.so+0x1713773]  thread_native_entry(Thread*)+0x103  (os_linux.cpp:739)</description>
                <environment></environment>
        <key id="5088919">JDK-8298118</key>
            <summary>split-if optimization causes empty loop to temporarily have more than one phi </summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dfenacci">Damon Fenacci</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>c2</label>
                            <label>javafuzzer</label>
                            <label>oracle-triage-20</label>
                            <label>tier8</label>
                    </labels>
                <created>Mon, 5 Dec 2022 11:57:56 -0800</created>
                <updated>Tue, 17 Oct 2023 02:34:17 -0700</updated>
                            <resolved>Wed, 25 Jan 2023 23:42:35 -0800</resolved>
                                    <version>8</version>
                    <version>11</version>
                    <version>17</version>
                    <version>19</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14554601" author="dukebot" created="Wed, 25 Jan 2023 23:42:33 -0800"  >Changeset: 4b0e656b&lt;br/&gt;
Author:    Damon Fenacci &amp;lt;&lt;a href=&apos;mailto:damon.fenacci@oracle.com&apos;&gt;damon.fenacci@oracle.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Tobias Hartmann &amp;lt;&lt;a href=&apos;mailto:thartmann@openjdk.org&apos;&gt;thartmann@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-26 07:41:15 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/4b0e656bb6a823f50507039df7855183ab98cd83&quot;&gt;https://git.openjdk.org/jdk/commit/4b0e656bb6a823f50507039df7855183ab98cd83&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14553937" author="roboduke" created="Tue, 24 Jan 2023 00:20:08 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12148&quot;&gt;https://git.openjdk.org/jdk/pull/12148&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-23 17:41:01 +0000</comment>
                            <comment id="14553105" author="JIRAUSER20518" created="Fri, 20 Jan 2023 07:36:07 -0800"  >A preliminary analysis shows that the issue is caused by an assert that checks that only one phi node can be attached to an empty counted loop when trying to remove it (the one of the induction variable).&lt;br/&gt;
We get to this situation because a split-if block optimization leaves the graph as shown in the &amp;quot;cl-dead-phi.png&amp;quot; attachment, with counted loop node 397 with 2 phi nodes, one for the induction variable (398) and another one with no uses (495).&lt;br/&gt;
Then, while doing loop optimization, the body of that counted loop gets &amp;quot;cleaned&amp;quot; (IdealLoopTree::DCE_loop_body) by removing dead nodes from the body (one of this nodes is phi node 495, since it has no uses). This in the end reveals that the loop is actually empty and can therefore be removed, but phi node 495 is still referenced by counted loop node 397.&lt;br/&gt;
</comment>
                            <comment id="14543075" author="chagedorn" created="Tue, 6 Dec 2022 01:44:51 -0800"  >Attached reduced test case Reduced.java:&lt;br/&gt;
&lt;br/&gt;
$ java -Xcomp -XX:CompileOnly=Reduced Reduced.java</comment>
                            <comment id="14542986" author="dlong" created="Mon, 5 Dec 2022 20:15:09 -0800"  >Reproduces with jdk-19+36, jdk-17+35, &amp;quot;11.0.17.0.3+1-LTS-3&amp;quot; builds, so it seems to be an old bug.</comment>
                            <comment id="14542985" author="dlong" created="Mon, 5 Dec 2022 20:02:31 -0800"  >ILW = Assert during C2 compilation (bailout in product), reproducible with generated test, no workaround = MMM = P3 </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5112234">JDK-8318291</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="101909" name="FuzzerUtils.java" size="13240" author="dlong" created="Mon, 5 Dec 2022 20:07:03 -0800"/>
                            <attachment id="101912" name="Reduced.java" size="460" author="chagedorn" created="Tue, 6 Dec 2022 01:44:12 -0800"/>
                            <attachment id="101908" name="Test.java" size="7171" author="dlong" created="Mon, 5 Dec 2022 20:07:03 -0800"/>
                            <attachment id="102366" name="cl-dead-phi.png" size="175222" author="dfenacci" created="Fri, 20 Jan 2023 06:28:06 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zhr7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17337"><![CDATA[b08]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>