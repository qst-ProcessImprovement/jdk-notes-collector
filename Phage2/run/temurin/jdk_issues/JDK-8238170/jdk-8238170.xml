<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:42:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8238170] BeanContextSupport remove and propertyChange can deadlock</title>
                <link>https://bugs.openjdk.org/browse/JDK-8238170</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Report by Adrian Nistor &amp;lt;&lt;a href=&apos;mailto:adrnisto@amazon.com&apos;&gt;adrnisto@amazon.com&lt;/a&gt;&amp;gt;. &lt;br/&gt;
&lt;br/&gt;
The code in BeanContextSupport.java acquires synchronization objects in different orders. Once acquires BeanContext.globalHierarchyLock and then children, another acquires children and then BeanContext.globalHierarchyLock).&lt;br/&gt;
&lt;br/&gt;
Acquiring synchronization objects in different orders can cause a circular wait (deadlock).&lt;br/&gt;
&lt;br/&gt;
Here is the first order: (1) first acquire BeanContext.globalHierarchyLock and then children:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;enter public method remove(Object) at line 484&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;call remove(Object, boolean) at line 485&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;acquire synchronization on BeanContext.globalHierarchyLock at line 502&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;acquire synchronization on children at line 534&lt;br/&gt;
&lt;br/&gt;
Here is the second order: (2) first acquire children and then BeanContext.globalHierarchyLock:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;enter public method propertyChange() at line 1110&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;acquire synchronization on children at line 1114&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;call remove(Object, boolean) at line 1121&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;acquire synchronization on BeanContext.globalHierarchyLock at line 502&lt;br/&gt;
&lt;br/&gt;
A potential fix always acquires synchronization in only 1 order: first BeanContext.globalHierarchyLock and then children. Add a synchronized(BeanContext.globalHierarchyLock) before the synchronized(children) at line 1114.&lt;br/&gt;
&lt;br/&gt;
This fix is correct because it does not add any new synchronization on BeanContext.globalHierarchyLock.&lt;br/&gt;
&lt;br/&gt;
This is because a call to propertyChange() at line 1110 already performs synchronized(BeanContext.globalHierarchyLock) at line 502. See the 4th line of the call stack for the second order above.&lt;br/&gt;
&lt;br/&gt;
I.e., this fix just calls synchronized(BeanContext.globalHierarchyLock) a bit earlier, which allows it to enforce only 1 order.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public void propertyChange(PropertyChangeEvent pce) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;String propertyName = pce.getPropertyName();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Object source       = pce.getSource();&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;synchronized(BeanContext.globalHierarchyLock) { &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; added this. See above discussion that this does *not* add new synchronization, just changes the lock order&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;synchronized(children) {&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5009562">JDK-8238170</key>
            <summary>BeanContextSupport remove and propertyChange can deadlock</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="serb">Sergey Bylokhov</assignee>
                                    <reporter username="phh">Paul Hohensee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jan 2020 07:53:08 -0800</created>
                <updated>Wed, 1 Feb 2023 22:51:42 -0800</updated>
                            <resolved>Sun, 29 Jan 2023 12:07:08 -0800</resolved>
                                    <version>11</version>
                    <version>13</version>
                    <version>14</version>
                    <version>15</version>
                                    <fixVersion>21</fixVersion>
                                    <component>client-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14555273" author="dukebot" created="Sun, 29 Jan 2023 12:07:06 -0800"  >Changeset: d4e9f5e5&lt;br/&gt;
Author:    Sergey Bylokhov &amp;lt;&lt;a href=&apos;mailto:serb@openjdk.org&apos;&gt;serb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-29 20:04:37 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d4e9f5e5f2c92964c3602f34a59b92947d1595a5&quot;&gt;https://git.openjdk.org/jdk/commit/d4e9f5e5f2c92964c3602f34a59b92947d1595a5&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14554027" author="roboduke" created="Tue, 24 Jan 2023 05:53:49 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12158&quot;&gt;https://git.openjdk.org/jdk/pull/12158&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-24 03:15:50 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5010079">JDK-8238569</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2m42r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17337"><![CDATA[b08]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="295"><![CDATA[java.beans]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>