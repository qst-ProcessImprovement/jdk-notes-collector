<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:07:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8313873] java/nio/channels/DatagramChannel/SendReceiveMaxSize.java  fails on AIX due to small default RCVBUF size and different IPv6 Header interpretation</title>
                <link>https://bugs.openjdk.org/browse/JDK-8313873</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When trying to receive (recvfrom()) the greatest possible UDP Datagram package of size 65507 Bytes, the recvfrom() API got stuck due to a smaller default udp_recvspace of 42080 Bytes. This can be checked by the command&amp;#xA0;&lt;br/&gt;
&lt;br/&gt;
no -a | grep space&lt;br/&gt;
&lt;br/&gt;
&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tcp_recvspace = 16384&lt;br/&gt;
&lt;br/&gt;
&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; tcp_sendspace = 16384&lt;br/&gt;
&lt;br/&gt;
&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; udp_recvspace = 42080&lt;br/&gt;
&lt;br/&gt;
&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0; udp_sendspace = 9216&lt;br/&gt;
&lt;br/&gt;
There are at least two ways to fix this. Either in the test program itself, by dynamically enlarging the receiver buffer of the socket used in recvfrom() explicitly, or by raising the OS default to a higher limit (The linux default seems to be about 200KB). Setting the AIX default can be done with the command e.g. (value should be at least greater than 65535)&lt;br/&gt;
&lt;br/&gt;
no -r -o udp_recvspace=132768&lt;br/&gt;
&lt;br/&gt;
I would prefer raising the default, and document it for the customer, so he knows he cannot use larger datagram packets than 42080 without raising the default size of the udp_recvspace when he does not want his program ending in a hang state.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The second bug comes from a different interpretation of the IPv6 header field Payload Length. Here is the background:&lt;br/&gt;
&lt;br/&gt;
An IP Packet consists of the IP Header and the IP Payload (e.g. a Datagram). in IPv4 the IP-Header contains the&amp;#xA0;16-Bit Field Total Length&lt;br/&gt;
&lt;br/&gt;
Total Length: &amp;#xA0;This&amp;#xA0;16-bit&amp;#xA0;field defines the entire packet size in bytes, including header and data.&lt;br/&gt;
&lt;br/&gt;
[Internet Protocol version 4 - Wikipedia|&lt;a href=&quot;https://en.wikipedia.org/wiki/Internet_Protocol_version_4#Total_Length&quot;&gt;https://en.wikipedia.org/wiki/Internet_Protocol_version_4#Total_Length&lt;/a&gt;]&lt;br/&gt;
&lt;br/&gt;
This means the total IP-Packet could have only 65535 Bytes. From this value you have to subtract 20 Bytes for the IP-Header and additional 8 Bytes for the UDP-Header to receive maximum of 65507 UDP Datagram Payload Bytes. Here AIX and Linux both have the same opinion.&lt;br/&gt;
&lt;br/&gt;
In IPv6 the IP-Header contains the field Payload Length&lt;br/&gt;
&lt;br/&gt;
Payload Length (16 bits) The size of the payload in octets, including any extension headers. The length is set to zero when a&amp;#xA0;Hop-by-Hop extension header carries a Jumbo Payload&amp;#xA0;option.&lt;br/&gt;
&lt;br/&gt;
[IPv6 packet - Wikipedia|&lt;a href=&quot;https://en.wikipedia.org/wiki/IPv6_packet&quot;&gt;https://en.wikipedia.org/wiki/IPv6_packet&lt;/a&gt;]&lt;br/&gt;
&lt;br/&gt;
This means not the total length of IP Packet is restricted to 65535 Bytes, but the size of the Payload. The IP-Packet could have a size of 65535+40 (IPv6-Header has&amp;#xA0;40 Bytes). Linux is going this way and therefore allows a UDP Payload of&amp;#xA0; 65535 -8 (UDP-Header has 8 Bytes) = 65527.&lt;br/&gt;
&lt;br/&gt;
IBM seems to interpret this field like IPv4 and still uses 65535 as maximum IPv6 Packet size. Then the resulting size for the UDP-Payload is 40 Bytes less; e.g.&amp;#xA0; 65535 - 40 - 8 = 65487&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
If we use the maximum value for linux (65527) then the sendto() API of AIX claims that this is too large and breaks in error.&lt;br/&gt;
&lt;br/&gt;
So to fix this we can use 65527 for all other platforms and 65487 only for AIX. This has to be adopted in java/nio/channels/DatagramChannel/SendReceiveMaxSize.java itself.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5107550">JDK-8313873</key>
            <summary>java/nio/channels/DatagramChannel/SendReceiveMaxSize.java  fails on AIX due to small default RCVBUF size and different IPv6 Header interpretation</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tobermeier">Thomas Obermeier</assignee>
                                    <reporter username="jkern">Joachim Kern</reporter>
                        <labels>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>noreg-self</label>
                    </labels>
                <created>Mon, 7 Aug 2023 03:00:34 -0700</created>
                <updated>Wed, 29 May 2024 03:31:28 -0700</updated>
                            <resolved>Thu, 31 Aug 2023 02:53:23 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14676691" author="roboduke" created="Tue, 28 May 2024 02:11:44 -0700"  >[jdk17u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 17.0.13-oracle. Applies cleanly except Copyright year update. Tier1-4 have passed.</comment>
                            <comment id="14676553" author="roboduke" created="Mon, 27 May 2024 08:41:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2496&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2496&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-27 15:36:49 +0000</comment>
                            <comment id="14610790" author="roboduke" created="Wed, 13 Sep 2023 01:46:14 -0700"  >[jdk21u-fix-request] Approval Request from JoKern65&lt;br/&gt;
Backport of test fix for AIX. No risk, clean backport.</comment>
                            <comment id="14610415" author="roboduke" created="Tue, 12 Sep 2023 07:11:58 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/155&quot;&gt;https://git.openjdk.org/jdk21u/pull/155&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-12 14:03:06 +0000</comment>
                            <comment id="14608011" author="dukebot" created="Thu, 31 Aug 2023 02:53:22 -0700"  >Changeset: 486fa08d&lt;br/&gt;
Author:    Thomas Obermeier &amp;lt;&lt;a href=&apos;mailto:thomas.obermeier@sap.com&apos;&gt;thomas.obermeier@sap.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Thomas Stuefe &amp;lt;&lt;a href=&apos;mailto:stuefe@openjdk.org&apos;&gt;stuefe@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-08-31 09:51:13 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/486fa08d4b22243443d39efa34c78d7e9eb44775&quot;&gt;https://git.openjdk.org/jdk/commit/486fa08d4b22243443d39efa34c78d7e9eb44775&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14602995" author="roboduke" created="Wed, 9 Aug 2023 08:06:14 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15209&quot;&gt;https://git.openjdk.org/jdk/pull/15209&lt;/a&gt;&lt;br/&gt;
Date: 2023-08-09 14:35:26 +0000</comment>
                            <comment id="14602312" author="clanger" created="Mon, 7 Aug 2023 09:22:53 -0700"  >Thanks, [~jkern], for the analysis.&lt;br/&gt;
&lt;br/&gt;
Regarding the RCVBUF, would it be an option to always check its size and enlarge it if necessary to a value beyond the maximum packet size when creating a socket on AIX? Then this could work transparently without a user&amp;#39;s need to configure anything. Any hints, [~alanb]?&lt;br/&gt;
&lt;br/&gt;
As for the IPv6 maximum packet size, I guess the different size for AIX should be implemented as you described.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5110221">JDK-8316198</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5129250">JDK-8332107</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130575">JDK-8333163</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                                                <inwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5107164">JDK-8313551</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17024"><![CDATA[ppc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="18900"><![CDATA[aix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32ner:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17407"><![CDATA[b14]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="228"><![CDATA[java.nio]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>