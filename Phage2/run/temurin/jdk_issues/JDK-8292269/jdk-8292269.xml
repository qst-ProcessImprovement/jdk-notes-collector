<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 14:04:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8292269] Replace FileMapInfo::fail_continue() with Unified Logging</title>
                <link>https://bugs.openjdk.org/browse/JDK-8292269</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Background:&lt;br/&gt;
&lt;br/&gt;
The FileMapInfo::fail_continue() method reports the reason when the CDS archive cannot be mapped. This API predates &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8046148&quot; title=&quot;JEP 158: Unified JVM Logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8046148&quot;&gt;&lt;strike&gt;JDK-8046148&lt;/strike&gt;&lt;/a&gt; (Unified JVM Logging, aka UL). It has rather ad-hoc behavior, depending on the -Xshare mode.&lt;br/&gt;
&lt;br/&gt;
In -Xshare:auto mode, print the message to the &amp;quot;info&amp;quot; log and continue execution:&lt;br/&gt;
&lt;br/&gt;
The original reason to use the &amp;quot;info&amp;quot; channel is to avoid excessive logging when the CDS archive cannot be mapped for a normal reason. For example, before &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8231610&quot; title=&quot;Relocate the CDS archive if it cannot be mapped to the requested address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8231610&quot;&gt;&lt;strike&gt;JDK-8231610&lt;/strike&gt;&lt;/a&gt;, the OS would often refuse to load the archive at the requested location due to Address Space Layout Randmization (ASLR), up to 50% of the time for some Windows configurations.&lt;br/&gt;
&lt;br/&gt;
In -Xshare:on mode, print the message to stderr and exit the JVM immediately:&lt;br/&gt;
&lt;br/&gt;
-Xshare:on is used for HotSpot regression testing only. Many tests have been written to expect (a) the reason is printed in the stdout/stderr of the JVM, and (b) the JVM exits when archive(s) cannot be mapped.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Proposal:&lt;br/&gt;
&lt;br/&gt;
This RFE replaces the FileMapInfo::fail_continue() calls with proper UL calls. The goals are:&lt;br/&gt;
&lt;br/&gt;
- Use UL so that the logging style is consistent with the rest of HotSpot.&lt;br/&gt;
- Sometimes the CDS archive cannot be mapped due to a genuine failure (e.g., the archive is corrupted). Log these messages in the warning channel to improve visibility.&lt;br/&gt;
- The behavior of -Xshare:on should be comparable with (not necessarily identical to) the previous behavior. It&amp;#39;s acceptable to make small adjustments to a small number of the existing CDS tests that run in -Xshare:on mode.&lt;br/&gt;
&lt;br/&gt;
Specifically, it&amp;#39;s not necessary to exit the JVM immediately after the message is printed (or else we need to add an exit call after every UL log). Instead, we exit the VM at the end of MetaspaceShared::initialize_runtime_shared_and_meta_spaces(). This behavior change does not affect the existing tests.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Info vs Warning Channel:&lt;br/&gt;
&lt;br/&gt;
Consider the following cases:&lt;br/&gt;
&lt;br/&gt;
[1] The CDS archive is valid, but we cannot use it because the user has chosen an incompatible command-line option (-XX:-UseCompressedClassPointers). &lt;br/&gt;
&lt;br/&gt;
This is an example where the messages should remain in &amp;quot;info&amp;quot;. CDS is just an optimization, and is not guaranteed to work under all circumstances. In this case, the failure is expected. Logging it as a warning would be too verbose.&lt;br/&gt;
&lt;br/&gt;
$ java -XX:-UseCompressedClassPointers -Xlog:cds -version&lt;br/&gt;
&lt;br/&gt;
[0.011s][info][cds] trying to map /jdk3/bld/nep-fastdebug/images/jdk/lib/server/classes.jsa&lt;br/&gt;
[0.011s][info][cds] Opened archive /jdk3/bld/nep-fastdebug/images/jdk/lib/server/classes.jsa.&lt;br/&gt;
[0.011s][info][cds] Archive was created with UseCompressedOops = 1, UseCompressedClassPointers = 1&lt;br/&gt;
[0.011s][info][cds] Unable to use shared archive.&lt;br/&gt;
The saved state of UseCompressedOops and UseCompressedClassPointers is different from runtime, CDS will be disabled.&lt;br/&gt;
[0.011s][info][cds] Initialize static archive failed.&lt;br/&gt;
[0.011s][info][cds] Unable to map shared spaces&lt;br/&gt;
...&lt;br/&gt;
&lt;br/&gt;
Other similar cases:&lt;br/&gt;
- CDS is disabled because early JVMTI ClassFileLoadHook is in use.&lt;br/&gt;
&lt;br/&gt;
[2] A bad CDS archive is used:&lt;br/&gt;
&lt;br/&gt;
In this example, we have a user error -- an invalid archive is file is specified. This should be logged as a warning so the user can take steps to fix the problem&lt;br/&gt;
&lt;br/&gt;
$ rm Foo.jsa&lt;br/&gt;
$ touch Foo.jsa&lt;br/&gt;
$ java -XX:-UseCompressedClassPointers -Xlog:cds -XX:SharedArchiveFile=Foo.jsa -version&lt;br/&gt;
[0.000s][info][cds] Specified shared archive not found (Foo.jsa)&lt;br/&gt;
[0.001s][info][cds] Unable to use shared archive: invalid archive&lt;br/&gt;
&lt;br/&gt;
Other similar cases:&lt;br/&gt;
- CRC error&lt;br/&gt;
- Archive is out of date&lt;br/&gt;
- classpath is incompatible with the CDS archive</description>
                <environment></environment>
        <key id="5081482">JDK-8292269</key>
            <summary>Replace FileMapInfo::fail_continue() with Unified Logging</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matsaave">Matias Saavedra Silva</assignee>
                                    <reporter username="iklam">Ioi Lam</reporter>
                        <labels>
                            <label>cds</label>
                            <label>logging</label>
                    </labels>
                <created>Thu, 11 Aug 2022 16:59:20 -0700</created>
                <updated>Wed, 8 Mar 2023 23:31:12 -0800</updated>
                            <resolved>Fri, 3 Mar 2023 11:02:18 -0800</resolved>
                                    <version>20</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14564442" author="dukebot" created="Fri, 3 Mar 2023 11:02:15 -0800"  >Changeset: cd4b88d0&lt;br/&gt;
Author:    Matias Saavedra Silva &amp;lt;&lt;a href=&apos;mailto:matsaave@openjdk.org&apos;&gt;matsaave@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Calvin Cheung &amp;lt;&lt;a href=&apos;mailto:ccheung@openjdk.org&apos;&gt;ccheung@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-03 19:00:27 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/cd4b88d0d25958d3b5de2982233bc540ba5a4e3b&quot;&gt;https://git.openjdk.org/jdk/commit/cd4b88d0d25958d3b5de2982233bc540ba5a4e3b&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14557308" author="roboduke" created="Fri, 3 Feb 2023 19:02:19 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12419&quot;&gt;https://git.openjdk.org/jdk/pull/12419&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-03 21:02:01 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5095759">JDK-8303810</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5068681">JDK-8281941</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5071690">JDK-8284313</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y8pn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17339"><![CDATA[b13]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>