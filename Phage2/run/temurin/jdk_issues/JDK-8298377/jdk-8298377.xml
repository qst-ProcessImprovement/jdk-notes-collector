<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 14:41:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8298377] JfrVframeStream causes deadlocks in ZGC</title>
                <link>https://bugs.openjdk.org/browse/JDK-8298377</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The JfrVFrameStream is used while generating stack traces for events. One of the events are the ZPage allocation event. This event is sometimes sent when ZGC is relocating. The current implementation of JfrVFrameStream uses WalkContinuation::include, which causes JFR to walk the continuation and perform GC barriers. This is problematic, since ZGC has a requirement that we never perform load barriers while running the relocation code. If we do, we might end up performing other reloctions from the the relocation code, and in some cases that causes dead locks.&lt;br/&gt;
&lt;br/&gt;
I propose that JFR doesn&amp;#39;t walk the continuations when sending events. An alternative could be to limit this to ZGC, but I&amp;#39;d like to get some feedback around that from JFR / Loom devs.</description>
                <environment></environment>
        <key id="5089214">JDK-8298377</key>
            <summary>JfrVframeStream causes deadlocks in ZGC</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefank">Stefan Karlsson</assignee>
                                    <reporter username="stefank">Stefan Karlsson</reporter>
                        <labels>
                            <label>hgupdate-sync</label>
                            <label>jdk20-fix-request</label>
                            <label>jdk20-fix-yes</label>
                            <label>loom</label>
                            <label>noreg-hard</label>
                            <label>zgc</label>
                    </labels>
                <created>Thu, 8 Dec 2022 03:16:20 -0800</created>
                <updated>Thu, 29 Jun 2023 14:43:52 -0700</updated>
                            <resolved>Thu, 19 Jan 2023 05:50:53 -0800</resolved>
                                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14556718" author="dukebot" created="Wed, 1 Feb 2023 14:37:53 -0800"  >Changeset: 1330d4ea&lt;br/&gt;
Author:    Stefan Karlsson &amp;lt;&lt;a href=&apos;mailto:stefank@openjdk.org&apos;&gt;stefank@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-01 13:19:26 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/1330d4eaa54790b468f69e61574b3c5d522be120&quot;&gt;https://git.openjdk.org/jdk/commit/1330d4eaa54790b468f69e61574b3c5d522be120&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14556492" author="roboduke" created="Wed, 1 Feb 2023 02:40:43 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk20/pull/120&quot;&gt;https://git.openjdk.org/jdk20/pull/120&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-01 10:31:00 +0000</comment>
                            <comment id="14555499" author="kvn" created="Mon, 30 Jan 2023 09:09:20 -0800"  >Fix request for JDK 20 approved.</comment>
                            <comment id="14555332" author="stefank" created="Sun, 29 Jan 2023 23:43:38 -0800"  >Fix Request JDK 20:&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d like to request a backport of this bug from JDK 21 to JDK 20. It causes deadlocks and crashes when running Loom with ZGC with JFR. The fix is small, but has two parts to it:&lt;br/&gt;
&lt;br/&gt;
1) Prevent JFR from walking the Loom heap stacks if ZGC hasn&amp;#39;t even started to process the current thread, or if ZGC is currently in progress of starting the processing the thread. All other GCs will continue as before.&lt;br/&gt;
&lt;br/&gt;
2) Update to JFR&amp;#39;s async profiler. Make sure that we start GC processing of a thread before it is sampled. This ensures that we get the full stack traces even after (1).&lt;br/&gt;
&lt;br/&gt;
This is a small patch, that only affects ZGC when running with the Loom preview, so I would like to consider this a low risk fix.&lt;br/&gt;
&lt;br/&gt;
The original bug was found in Oracle&amp;#39;s tier8 CI runs. This has been tested with a manual reproducer which increases the reproducibility of the bug. The fix for JDK 21 has been running in the CI pipeline for about a week.&lt;br/&gt;
&lt;br/&gt;
Reviewed and discussed with Erik&amp;#xD6; and MarkusG. </comment>
                            <comment id="14552732" author="dukebot" created="Thu, 19 Jan 2023 05:50:52 -0800"  >Changeset: 453dbd12&lt;br/&gt;
Author:    Stefan Karlsson &amp;lt;&lt;a href=&apos;mailto:stefank@openjdk.org&apos;&gt;stefank@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-19 13:49:14 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/453dbd12ee42731d7ebfd1a856338099429277c8&quot;&gt;https://git.openjdk.org/jdk/commit/453dbd12ee42731d7ebfd1a856338099429277c8&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14547635" author="roboduke" created="Fri, 23 Dec 2022 06:13:38 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/11778&quot;&gt;https://git.openjdk.org/jdk/pull/11778&lt;/a&gt;&lt;br/&gt;
Date: 2022-12-23 14:06:07 +0000</comment>
                            <comment id="14543862" author="roboduke" created="Thu, 8 Dec 2022 03:33:02 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/11586&quot;&gt;https://git.openjdk.org/jdk/pull/11586&lt;/a&gt;&lt;br/&gt;
Date: 2022-12-08 11:23:57 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5091959">JDK-8300660</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5093548">JDK-8301974</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5093552">JDK-8301978</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5088843">JDK-8298058</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zjkr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17335"><![CDATA[b07]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="374"><![CDATA[jfr]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>