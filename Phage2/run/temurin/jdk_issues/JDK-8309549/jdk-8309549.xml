<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:17:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8309549] com/sun/tools/attach/warnings/DynamicLoadWarningTest.java fails on AIX</title>
                <link>https://bugs.openjdk.org/browse/JDK-8309549</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>After push of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8307478&quot; title=&quot;Implementation of Prepare to Restrict The Dynamic Loading of Agents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8307478&quot;&gt;&lt;strike&gt;JDK-8307478&lt;/strike&gt;&lt;/a&gt; , the following test started to fail on AIX :&lt;br/&gt;
com/sun/tools/attach/warnings/DynamicLoadWarningTest.java ; it always fails on AIX with the output :&lt;br/&gt;
&lt;br/&gt;
----------System.err:(294/28579)----------&lt;br/&gt;
STARTED DynamicLoadWarningTest::testLoadJavaAgent &amp;#39;testLoadJavaAgent()&amp;#39;&lt;br/&gt;
SUCCESSFUL DynamicLoadWarningTest::testLoadJavaAgent &amp;#39;testLoadJavaAgent()&amp;#39;&lt;br/&gt;
STARTED DynamicLoadWarningTest::testLoadOneJvmtiAgent &amp;#39;[1] DynamicLoadWarningTest$$Lambda/0x000000040020bd88@600d90bb&amp;#39;&lt;br/&gt;
org.opentest4j.AssertionFailedError: expected: &amp;lt;1&amp;gt; but was: &amp;lt;2&amp;gt;&lt;br/&gt;
at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)&lt;br/&gt;
at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:132)&lt;br/&gt;
at org.junit.jupiter.api.AssertEquals.failNotEqual(AssertEquals.java:197)&lt;br/&gt;
at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:150)&lt;br/&gt;
at org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:145)&lt;br/&gt;
at org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:528)&lt;br/&gt;
at DynamicLoadWarningTest$AppRunner.stderrShouldContain(DynamicLoadWarningTest.java:298)&lt;br/&gt;
at DynamicLoadWarningTest.testLoadOneJvmtiAgent(DynamicLoadWarningTest.java:125)&lt;br/&gt;
at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
at java.base/java.lang.reflect.Method.invoke(Method.java:580)&lt;br/&gt;
&amp;nbsp;</description>
                <environment></environment>
        <key id="5102607">JDK-8309549</key>
            <summary>com/sun/tools/attach/warnings/DynamicLoadWarningTest.java fails on AIX</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbaesken">Matthias Baesken</assignee>
                                    <reporter username="mbaesken">Matthias Baesken</reporter>
                        <labels>
                            <label>hgupdate-sync</label>
                    </labels>
                <created>Tue, 6 Jun 2023 08:14:03 -0700</created>
                <updated>Tue, 4 Jul 2023 16:35:58 -0700</updated>
                            <resolved>Mon, 12 Jun 2023 00:09:12 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-svc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14590854" author="roboduke" created="Wed, 21 Jun 2023 00:34:57 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/44&quot;&gt;https://git.openjdk.org/jdk21/pull/44&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-21 07:29:03 +0000</comment>
                            <comment id="14589833" author="mbaesken" created="Fri, 16 Jun 2023 01:10:07 -0700"  >I created &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8310191&quot; title=&quot;com/sun/tools/attach/warnings/DynamicLoadWarningTest.java second failure on AIX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8310191&quot;&gt;&lt;strike&gt;JDK-8310191&lt;/strike&gt;&lt;/a&gt; to address the second issue.</comment>
                            <comment id="14588421" author="alanb" created="Mon, 12 Jun 2023 00:44:03 -0700"  >[~mbaesken] The 4th test in testLoadOneJvmtiAgent also loads the same agent twice, the first via the command line, the second into the running VM, a warning is not expected as the agent library is previously loaded. So same issue as &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309549&quot; title=&quot;com/sun/tools/attach/warnings/DynamicLoadWarningTest.java fails on AIX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8309549&quot;&gt;&lt;strike&gt;JDK-8309549&lt;/strike&gt;&lt;/a&gt;, needs to be skipped on AIX.</comment>
                            <comment id="14588416" author="mbaesken" created="Mon, 12 Jun 2023 00:30:55 -0700"  >After the issue above has been fixed we unfortunately still get this  new error :&lt;br/&gt;
&lt;br/&gt;
java.lang.RuntimeException: &amp;#39;WARNING: A JVM TI agent has been loaded dynamically&amp;#39; found in stderr&lt;br/&gt;
	at jdk.test.lib.process.OutputAnalyzer.stderrShouldNotContain(OutputAnalyzer.java:320)&lt;br/&gt;
	at DynamicLoadWarningTest$AppRunner.stderrShouldNotContain(DynamicLoadWarningTest.java:308)&lt;br/&gt;
	at DynamicLoadWarningTest.testLoadOneJvmtiAgent(DynamicLoadWarningTest.java:138)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)&lt;br/&gt;
&lt;br/&gt;
And indeed &amp;#39;WARNING: A JVM TI agent has been loaded dynamically&amp;#39;  can be found in the log on AIX, so there is still something wrong .</comment>
                            <comment id="14588410" author="dukebot" created="Mon, 12 Jun 2023 00:09:11 -0700"  >Changeset: 4d66d977&lt;br/&gt;
Author:    Matthias Baesken &amp;lt;&lt;a href=&apos;mailto:mbaesken@openjdk.org&apos;&gt;mbaesken@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-12 07:07:38 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/4d66d977450e083214da3dba6ad4ed851c6c1cb4&quot;&gt;https://git.openjdk.org/jdk/commit/4d66d977450e083214da3dba6ad4ed851c6c1cb4&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14588165" author="roboduke" created="Fri, 9 Jun 2023 06:43:54 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14393&quot;&gt;https://git.openjdk.org/jdk/pull/14393&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-09 13:39:26 +0000</comment>
                            <comment id="14588138" author="alanb" created="Fri, 9 Jun 2023 04:23:28 -0700"  >[~mbaesken] It would be great if you have time to take this one. Skipping the duplicate warning test should be as simple as&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
--- a/test/jdk/com/sun/tools/attach/warnings/DynamicLoadWarningTest.java&lt;br/&gt;
+++ b/test/jdk/com/sun/tools/attach/warnings/DynamicLoadWarningTest.java&lt;br/&gt;
@@ -119,10 +119,13 @@ class DynamicLoadWarningTest {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;test().whenRunning(loadJvmtiAgent1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;.stderrShouldContain(JVMTI_AGENT_WARNING);&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
-        // dynamically load loadJvmtiAgent1 twice, should be one warning&lt;br/&gt;
-        test().whenRunning(loadJvmtiAgent1)&lt;br/&gt;
-                .whenRunning(loadJvmtiAgent1)&lt;br/&gt;
-                .stderrShouldContain(JVMTI_AGENT_WARNING, 1);&lt;br/&gt;
+        // dynamically load loadJvmtiAgent1 twice, should be one warning on platforms&lt;br/&gt;
+        // that can detect if an agent library was previously loaded&lt;br/&gt;
+        if (!Platform.isAix()) {&lt;br/&gt;
+            test().whenRunning(loadJvmtiAgent1)&lt;br/&gt;
+                    .whenRunning(loadJvmtiAgent1)&lt;br/&gt;
+                    .stderrShouldContain(JVMTI_AGENT_WARNING, 1);&lt;br/&gt;
+        }&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
but I have no way to test it.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</comment>
                            <comment id="14588097" author="mbaesken" created="Thu, 8 Jun 2023 23:57:37 -0700"  >Hi [~alanb],&lt;br/&gt;
&amp;gt;The spec doesn&amp;#39;t require that warnings be de-duplicated so maybe it can be tolerated on AIX, in which case one of the tests in testLoadOneJvmtiAgent should be &amp;gt;skipped when Platform.isAix() is true. WDYT?&lt;br/&gt;
&lt;br/&gt;
I think the skipping you suggested makes sense - do you want to post a PR or should I test/try it and post one ?</comment>
                            <comment id="14587856" author="alanb" created="Thu, 8 Jun 2023 00:27:37 -0700"  >[~mbaesken] Thanks for the links. The check to see if an agent library was previously loaded assumes the the same handle is returned if dlopen&amp;#39;ed a second or subsequent time. It would be possible to check canonical path or compare st_dev/st_ino but it would add complexity. A simple string compare of agent name or os_lib_path isn&amp;#39;t sufficient in some cases, esp. when the path is relative.  The spec doesn&amp;#39;t require that warnings be de-duplicated so maybe it can be tolerated on AIX, in which case one of the tests in testLoadOneJvmtiAgent should be skipped when Platform.isAix() is true. WDYT?</comment>
                            <comment id="14587675" author="mwthomps" created="Wed, 7 Jun 2023 08:10:27 -0700"  >ILW=MMH=P3</comment>
                            <comment id="14587578" author="mbaesken" created="Wed, 7 Jun 2023 02:11:22 -0700"  >This is what I find in the manpage  of AIX 7.2 or 7.3 :&lt;br/&gt;
&lt;a href=&quot;https://www.ibm.com/docs/en/aix/7.2?topic=d-dlopen-subroutine&quot;&gt;https://www.ibm.com/docs/en/aix/7.2?topic=d-dlopen-subroutine&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://www.ibm.com/docs/en/aix/7.3?topic=d-dlopen-subroutine&quot;&gt;https://www.ibm.com/docs/en/aix/7.3?topic=d-dlopen-subroutine&lt;/a&gt;&lt;br/&gt;
&amp;quot;If the module is already loaded, it is not loaded again, but a new, unique value will be returned by the dlopen subroutine.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Sounds different to what Linux documents in the manpage:&lt;br/&gt;
&lt;a href=&quot;https://man7.org/linux/man-pages/man3/dlopen.3.html&quot;&gt;https://man7.org/linux/man-pages/man3/dlopen.3.html&lt;/a&gt;&lt;br/&gt;
&amp;quot;If the same shared object is opened again with dlopen(), the same object handle is returned.&amp;quot;&lt;br/&gt;
&lt;br/&gt;
Should I check for more details with our local AIX experts?</comment>
                            <comment id="14587567" author="alanb" created="Wed, 7 Jun 2023 01:24:27 -0700"  >One of the tests in testLoadOneJvmtiAgent is to load the same agent twice, it expects one warning. In the output we see:&lt;br/&gt;
&lt;br/&gt;
WARNING: A JVM TI agent has been loaded dynamically (/priv/testr/outputdir/grmpf/testdata/jtreg/jtreg_test_21/test/jdk/jtreg/native/libJvmtiAgent1.so)&lt;br/&gt;
WARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning&lt;br/&gt;
WARNING: Dynamic loading of agents will be disallowed by default in a future release&lt;br/&gt;
&lt;br/&gt;
WARNING: A JVM TI agent has been loaded dynamically (/priv/testr/outputdir/grmpf/testdata/jtreg/jtreg_test_21/test/jdk/jtreg/native/libJvmtiAgent1.so)&lt;br/&gt;
WARNING: If a serviceability tool is in use, please run with -XX:+EnableDynamicAgentLoading to hide this warning&lt;br/&gt;
WARNING: Dynamic loading of agents will be disallowed by default in a future release&lt;br/&gt;
&lt;br/&gt;
so we&amp;#39;ve got two warnings. &lt;br/&gt;
&lt;br/&gt;
JvmtiAgentList::is_dynamic_lib_loaded is the function that is called to check if an agent library was previously loaded. It&amp;#39;s looking at os_lib, the handle returned by dlopen. The man pages for dlopen on Linux and macOS are clear that a second call to dlopen with the same path returns the same handle. I suspend the issue is that dlopen on AIX working differently and that a different handle is being returned. Is that something you could check?</comment>
                            <comment id="14587554" author="mbaesken" created="Wed, 7 Jun 2023 00:33:15 -0700"  >I attached a slightly modified jtr file of the failing test.</comment>
                            <comment id="14587366" author="alanb" created="Tue, 6 Jun 2023 08:23:11 -0700"  >com/sun/tools/attach/warnings/DynamicLoadWarningTest.java is a new test added by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8307478&quot; title=&quot;Implementation of Prepare to Restrict The Dynamic Loading of Agents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8307478&quot;&gt;&lt;strike&gt;JDK-8307478&lt;/strike&gt;&lt;/a&gt; (implementation of JEP 451). The check for a duplicate agent library appears to be problematic on AIX, maybe dlopen behaves differently on that platform? &lt;br/&gt;
&lt;br/&gt;
[~mbaesken] Is there any way that you could attach a sample .jtr file, maybe editing it to avoid revealing things about the environment that you don&amp;#39;t want to reveal? </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5103744">JDK-8310515</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5104642">JDK-8311315</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5100152">JDK-8307478</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5103368">JDK-8310191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104211" name="DynamicLoadWarningTest_aix.jtr" size="72418" author="mbaesken" created="Wed, 7 Jun 2023 00:32:45 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17024"><![CDATA[ppc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="18900"><![CDATA[aix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31t1f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17317"><![CDATA[b02]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="368"><![CDATA[tools]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>