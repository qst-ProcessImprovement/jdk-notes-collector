<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:42:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8306460] Clear JVM_ACC_QUEUED flag on methods when dumping dynamic CDS archive</title>
                <link>https://bugs.openjdk.org/browse/JDK-8306460</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When using dynamic CDS archive I noticed some of the methods are not getting compiled during the run time (i.e. when using the dynamic CDS archive). These methods do get compiled when not using dynamic CDS archive.&lt;br/&gt;
With dynamic CDs when -XX:+PrintTieredEvents is enabled, logs show such methods are already in compilation queue even though there is no COMPILE event for the methods in the logs.&lt;br/&gt;
This points out the methods where in the compile queue when the dynamic CDS archive was dumped and the flag JVM_ACC_QUEUED was not cleared during dump time. I verified this by using the  following patch:&lt;br/&gt;
&lt;br/&gt;
-------&lt;br/&gt;
--- a/src/hotspot/share/cds/archiveBuilder.cpp&lt;br/&gt;
+++ b/src/hotspot/share/cds/archiveBuilder.cpp&lt;br/&gt;
@@ -968,8 +968,9 @@ class ArchiveBuilder::CDSMapLogger : AllStatic {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;static void log_method(Method* m, address runtime_dest, const char* type_name, int bytes, Thread* current) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ResourceMark rm(current);&lt;br/&gt;
-    log_debug(cds, map)(_LOG_PREFIX &amp;quot; %s&amp;quot;,&lt;br/&gt;
-                        p2i(runtime_dest), type_name, bytes,  m-&amp;gt;external_name());&lt;br/&gt;
+    bool queued = m-&amp;gt;queued_for_compilation();&lt;br/&gt;
+    log_debug(cds, map)(_LOG_PREFIX &amp;quot; %s %s&amp;quot;,&lt;br/&gt;
+                        p2i(runtime_dest), type_name, bytes,  m-&amp;gt;external_name(), queued ? &amp;quot;queued&amp;quot; : &amp;quot;&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
-------&lt;br/&gt;
&lt;br/&gt;
With this patch I created the dynamic archive, dumped cds map suing -Xlog:cds+map=trace:file=cds.map and noticed a number of methods marked as &amp;quot;queued&amp;quot; in the cds.map file.&lt;br/&gt;
&lt;br/&gt;
This can be fixed by calling `clear_queued_for_compilation()` in Method::unlink_method().</description>
                <environment></environment>
        <key id="5098916">JDK-8306460</key>
            <summary>Clear JVM_ACC_QUEUED flag on methods when dumping dynamic CDS archive</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asmehra">Ashutosh Mehra</assignee>
                                    <reporter username="asmehra">Ashutosh Mehra</reporter>
                        <labels>
                            <label>cds</label>
                    </labels>
                <created>Wed, 19 Apr 2023 08:09:56 -0700</created>
                <updated>Mon, 22 May 2023 00:54:32 -0700</updated>
                            <resolved>Tue, 16 May 2023 15:38:15 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14582041" author="dukebot" created="Tue, 16 May 2023 15:38:13 -0700"  >Changeset: d3e50652&lt;br/&gt;
Author:    Ashutosh Mehra &amp;lt;&lt;a href=&apos;mailto:asmehra@redhat.com&apos;&gt;asmehra@redhat.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Ioi Lam &amp;lt;&lt;a href=&apos;mailto:iklam@openjdk.org&apos;&gt;iklam@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-16 22:36:44 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d3e5065284441647564a9eede79d69e7b0ac80be&quot;&gt;https://git.openjdk.org/jdk/commit/d3e5065284441647564a9eede79d69e7b0ac80be&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14576762" author="roboduke" created="Tue, 25 Apr 2023 11:08:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13652&quot;&gt;https://git.openjdk.org/jdk/pull/13652&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-25 18:00:39 +0000</comment>
                            <comment id="14576722" author="coleenp" created="Tue, 25 Apr 2023 09:04:57 -0700"  >[~asmehra] sure, you can take it.  I have a patch that moves the ACC_QUEUED flag out of AccessFlags, but calling clear_queued_for_compilation() seems like the appropriate fix and doesn&amp;#39;t affect my patch.</comment>
                            <comment id="14576704" author="JIRAUSER20510" created="Tue, 25 Apr 2023 08:34:49 -0700"  >@coleen I have a fix for this sitting in my branch. I would open a PR for it some time today. Do you mind if I assign it myself?</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i316ur:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17433"><![CDATA[b23]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>