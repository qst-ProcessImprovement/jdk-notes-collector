<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:07:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8307306] Change some ConstantPool::name_ref_at calls to uncached_name_ref_at</title>
                <link>https://bugs.openjdk.org/browse/JDK-8307306</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ConstantPool::name_ref_at calls(int which) eventually comes to here with (uncached == false):&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/8c106b0c8e4562a44ecd1e069c0911acfc428ecf/src/hotspot/share/oops/constantPool.cpp#L689-L692&quot;&gt;https://github.com/openjdk/jdk/blob/8c106b0c8e4562a44ecd1e069c0911acfc428ecf/src/hotspot/share/oops/constantPool.cpp#L689-L692&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
int ConstantPool::impl_name_and_type_ref_index_at(int which, bool uncached) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;int i = which;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (!uncached &amp;amp;&amp;amp; cache() != nullptr) { &amp;lt;&amp;lt;&amp;lt; HERE&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (ConstantPool::is_invokedynamic_index(which)) {&lt;br/&gt;
&lt;br/&gt;
name_ref_at calls expects that the &amp;quot;which&amp;quot; parameter to be an index rewritten by rewriter.cpp. However, if the class is rewritten, cache() cannot be null.&lt;br/&gt;
&lt;br/&gt;
The only reason we have the &amp;quot;&amp;amp;&amp;amp; cache() != nullptr&amp;quot; check is we have buggy code that calls name_ref_at calls not with a rewritten index, but with a regular constant pool index. &lt;br/&gt;
&lt;br/&gt;
Example:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/8c106b0c8e4562a44ecd1e069c0911acfc428ecf/src/hotspot/share/interpreter/rewriter.cpp#L231&quot;&gt;https://github.com/openjdk/jdk/blob/8c106b0c8e4562a44ecd1e069c0911acfc428ecf/src/hotspot/share/interpreter/rewriter.cpp#L231&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
void Rewriter::maybe_rewrite_invokehandle(address opc, int cp_index, int cache_index, bool reverse) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (!reverse) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (_pool-&amp;gt;klass_ref_at_noresolve(cp_index) == vmSymbols::java_lang_invoke_MethodHandle() &amp;amp;&amp;amp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;MethodHandles::is_signature_polymorphic_name(vmClasses::MethodHandle_klass(),&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;_pool-&amp;gt;name_ref_at(cp_index))) {&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Here we clearly have a cp_index, and we are *before* the class was rewritten). This call should be changed to &lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;_pool-&amp;gt;uncached_name_ref_at(cp_index))) {&lt;br/&gt;
&lt;br/&gt;
To catch all these errors we should change the (!uncached &amp;amp;&amp;amp; cache() != nullptr) check to:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (!uncached) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assert(cache() != nullptr, &amp;quot;&amp;#39;which&amp;#39; is a rewritten index so this class must have been rewritten&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
=================&lt;br/&gt;
Similarly, some other calls like uncached_klass_ref_index_at(), signature_ref_at(), etc, should be changed to their uncached_xxx() variant.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5099958">JDK-8307306</key>
            <summary>Change some ConstantPool::name_ref_at calls to uncached_name_ref_at</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matsaave">Matias Saavedra Silva</assignee>
                                    <reporter username="iklam">Ioi Lam</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 May 2023 14:00:30 -0700</created>
                <updated>Wed, 10 May 2023 23:51:50 -0700</updated>
                            <resolved>Fri, 5 May 2023 07:31:05 -0700</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14579391" author="dukebot" created="Fri, 5 May 2023 07:31:02 -0700"  >Changeset: 6fe959c6&lt;br/&gt;
Author:    Matias Saavedra Silva &amp;lt;&lt;a href=&apos;mailto:matsaave@openjdk.org&apos;&gt;matsaave@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-05 14:24:40 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/6fe959c62d6475b8f4c9ada2a8eb7b36d22d5e5e&quot;&gt;https://git.openjdk.org/jdk/commit/6fe959c62d6475b8f4c9ada2a8eb7b36d22d5e5e&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14578887" author="roboduke" created="Wed, 3 May 2023 13:49:32 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13786&quot;&gt;https://git.openjdk.org/jdk/pull/13786&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-03 19:18:18 +0000</comment>
                            <comment id="14578435" author="iklam" created="Tue, 2 May 2023 14:12:43 -0700"  >I have a prototype at&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/compare/master...iklam:jdk:8307306-prototype-uncached-name-ref-at?expand=1&quot;&gt;https://github.com/openjdk/jdk/compare/master...iklam:jdk:8307306-prototype-uncached-name-ref-at?expand=1&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
It can build linux-x64-debug and pass all the CDS tests, but I don&amp;#39;t know if I caught all the cases.</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31cur:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17415"><![CDATA[b22]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>