<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 22:46:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8349213] G1: Clearing bitmaps during collection set merging not claimed by region</title>
                <link>https://bugs.openjdk.org/browse/JDK-8349213</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>There is some (seldom) executed code during merging the remembered set where G1 needs to clear the bitmap of old regions during GC.&lt;br/&gt;
&lt;br/&gt;
The problem is that this clearing (and actually all other code executed in that G1ClearBitmapClosure) is not claimed by G1HeapRegion, i.e. every thread does that reset work for every region, duplicating work.&lt;br/&gt;
&lt;br/&gt;
This is unnecessary - it is enough that a G1HeapRegion gets cleared once by whatever thread.&lt;br/&gt;
&lt;br/&gt;
I.e. in this code in G1RemSet.cpp / G1MergeHeapRootsTask::work():&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// 2. collection set&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1MergeCardSetClosure merge(_scan_state);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1ClearBitmapClosure clear(g1h);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1CombinedClosure combined(&amp;amp;merge, &amp;amp;clear);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (_initial_evacuation) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;G1HeapRegionRemSet::iterate_for_merge(g1h-&amp;gt;young_regions_cardset(), merge);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;g1h-&amp;gt;collection_set_iterate_increment_from(&amp;amp;combined, nullptr, worker_id);&lt;br/&gt;
&lt;br/&gt;
Since that last call does not have a HeapRegionClaimer, G1ClearBitmapClosure is executed for every region for every thread. Note that the G1MergeCardSetClosure does internal claiming so it is not affected (i.e. does not do duplicate work).&lt;br/&gt;
&lt;br/&gt;
Caused by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296954&quot; title=&quot;G1: Enable parallel scanning for heap region remset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296954&quot;&gt;&lt;strike&gt;JDK-8296954&lt;/strike&gt;&lt;/a&gt;.</description>
                <environment></environment>
        <key id="5149735">JDK-8349213</key>
            <summary>G1: Clearing bitmaps during collection set merging not claimed by region</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tschatzl">Thomas Schatzl</assignee>
                                    <reporter username="tschatzl">Thomas Schatzl</reporter>
                        <labels>
                            <label>gc-g1</label>
                            <label>gc-performance</label>
                            <label>jdk21u-todo</label>
                            <label>jdk24u-fix-SQE-ok-next</label>
                            <label>jdk24u-fix-request</label>
                            <label>jdk24u-fix-yes</label>
                    </labels>
                <created>Mon, 3 Feb 2025 03:39:35 -0800</created>
                <updated>Tue, 12 Aug 2025 04:34:52 -0700</updated>
                            <resolved>Tue, 11 Feb 2025 01:57:09 -0800</resolved>
                                    <version>20</version>
                    <version>21</version>
                    <version>23</version>
                    <version>24</version>
                    <version>25</version>
                                    <fixVersion>25</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14758546" author="roboduke" created="Thu, 6 Mar 2025 07:27:30 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk24u/pull/109&quot;&gt;https://git.openjdk.org/jdk24u/pull/109&lt;/a&gt;&lt;br/&gt;
Date: 2025-03-05 11:01:19 +0000</comment>
                            <comment id="14756430" author="tschatzl" created="Wed, 26 Feb 2025 01:59:56 -0800"  >jdk24u Fix request:&lt;br/&gt;
&lt;br/&gt;
Impact: the change can cause unexpectedly high gc pause times for g1 in some corner cases&lt;br/&gt;
RIsk: low. Has been running in jdk25 for three weeks now&lt;br/&gt;
</comment>
                            <comment id="14750950" author="dukebot" created="Tue, 11 Feb 2025 01:57:08 -0800"  >Changeset: 8e858294&lt;br/&gt;
Branch: master&lt;br/&gt;
Author:    Thomas Schatzl &amp;lt;&lt;a href=&apos;mailto:tschatzl@openjdk.org&apos;&gt;tschatzl@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2025-02-11 09:52:38 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/8e8582949669d5f3dcb68886ccb6a719393d1a9e&quot;&gt;https://git.openjdk.org/jdk/commit/8e8582949669d5f3dcb68886ccb6a719393d1a9e&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14748853" author="tschatzl" created="Tue, 4 Feb 2025 04:34:20 -0800"  >Actually this issue has only been noticed by running some internal changes that adds some extra work in that phase, which caused regressions on huge (150GB or so) young gens.</comment>
                            <comment id="14746842" author="roboduke" created="Mon, 3 Feb 2025 07:21:01 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/23419&quot;&gt;https://git.openjdk.org/jdk/pull/23419&lt;/a&gt;&lt;br/&gt;
Date: 2025-02-03 14:11:20 +0000</comment>
                            <comment id="14746828" author="tschatzl" created="Mon, 3 Feb 2025 06:21:54 -0800"  >Overall performance impact in current builds should be fairly low:&lt;br/&gt;
* bitmap clearing is only executed when the gc happens during clearing the mark bitmap (and during shutdown, but that&amp;#39;s probably not an issue)&lt;br/&gt;
* only done for old gen regions in the collection set, so limited in impact&lt;br/&gt;
&lt;br/&gt;
Still it may cause sudden gc spikes.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5152503">JDK-8351631</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5154047">JDK-8352968</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                                                <inwardlinks description="caused by">
                                        <issuelink>
            <issuekey id="5087505">JDK-8296954</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17438"><![CDATA[b26]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22023">20</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39oqz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17338"><![CDATA[b10]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>