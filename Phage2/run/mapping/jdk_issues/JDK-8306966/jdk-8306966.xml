<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:59:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8306966] RISC-V: Support vector cast node for Vector API</title>
                <link>https://bugs.openjdk.org/browse/JDK-8306966</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Hi, &lt;br/&gt;
&lt;br/&gt;
we have added some implementations related to vector cast, It was implemented by referring to RVV v1.0 [1]. please take a look and have some reviews. Thanks a lot.&lt;br/&gt;
&lt;br/&gt;
We can use the VectorReshapeTests.java[2]  to print the compilation log, verify and observe the generation of nodes.&lt;br/&gt;
&lt;br/&gt;
For example, we can use the following command to print the compilation log of a jtreg test case:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
/home/zifeihan/jdk-tools/jtreg/bin/jtreg \&lt;br/&gt;
-v:default \&lt;br/&gt;
-concurrency:16 -timeout:50 \&lt;br/&gt;
-javaoption:-XX:+UnlockExperimentalVMOptions \&lt;br/&gt;
-javaoption:-XX:+UseRVV \&lt;br/&gt;
-javaoption:-XX:+PrintOptoAssembly \&lt;br/&gt;
-javaoption:-XX:LogFile=/home/zifeihan/jdk-rvv/VectorReshapeTests_PrintOptoAssembly_20230426.log \&lt;br/&gt;
-jdk:/home/zifeihan/jdk-rvv/build/linux-riscv64-server-fastdebug/jdk \&lt;br/&gt;
-compilejdk:/home/zifeihan/jdk-rvv/build/linux-x86_64-server-release/images/jdk \&lt;br/&gt;
/home/zifeihan/jdk/test/jdk/jdk/incubator/vector/VectorReshapeTests.java&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
#### VectorCast/VectorCastB2X/VectorCastD2X/VectorCastF2X/VectorCastI2X/VectorCastL2X/VectorCastS2X&lt;br/&gt;
There are too many nodes here, and the following shows the log of `VectorCastB2X` nodes:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1ba0    ld  R28, [R23, #280]	# ptr, #@loadP&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1ba4    addi  R29, R7, #32	# ptr, #@addP_reg_imm&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1ba8    reinterpretResize V1, V5&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1bb0    vcvtBtoX V4, V1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;1bb8    far_bgeu  R29, R28, B465	#@far_cmpP_branch  P=0.000100 C=-1.000000&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;```&lt;br/&gt;
&lt;br/&gt;
#### VectorRearrange/VectorReinterpret&lt;br/&gt;
&lt;br/&gt;
When the original vector is transformed to the target vector, if the actual number of elements of the original vector is larger than the number of elements of the target vector, a slice action is performed to provide data for the subsequent cast nodes. the slice action depends on the `VectorRearrange` and `VectorReinterpret` nodes.&lt;br/&gt;
&lt;br/&gt;
The compilation log for the `VectorRearrange` node:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;```&lt;br/&gt;
1f6     spill R7 -&amp;amp;gt; [sp, #320]	# spill size = 64&lt;br/&gt;
1f8     spill [sp, #128] -&amp;amp;gt; V1	# vector spill size = 256&lt;br/&gt;
200     spill [sp, #160] -&amp;amp;gt; V2	# vector spill size = 256&lt;br/&gt;
208     rearrange V3, V1, V2&lt;br/&gt;
210     spill V3 -&amp;amp;gt; [sp, #96]	# vector spill size = 256&lt;br/&gt;
218     li R11, #4	# int, #@loadConI&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;```&lt;br/&gt;
&lt;br/&gt;
The compilation log for the `VectorReinterpret` node:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
1218    spill [sp, #32] -&amp;amp;gt; V4	# vector spill size = 256&lt;br/&gt;
1220    spill [sp, #176] -&amp;amp;gt; V3	# vector spill size = 256&lt;br/&gt;
1228    rearrange V2, V4, V3&lt;br/&gt;
1230    spill [sp, #72] -&amp;amp;gt; V0	# vmask spill size = 32&lt;br/&gt;
123c    vmerge_vvm V1, V1, V2, v0	#@vector blend&lt;br/&gt;
1244    reinterpretResize V2, V1&lt;br/&gt;
124c    vcvtStoX_extend V5, V2&lt;br/&gt;
1254    bgeu  R28, R7, B169	#@cmpP_branch  P=0.000100 C=-1.000000&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
####  LShiftCntV/RShiftCntV/MaskAll&lt;br/&gt;
&lt;br/&gt;
We have merged `LShiftCntV`, `RShiftCntV` nodes and support boolean types&lt;br/&gt;
&lt;br/&gt;
The compilation log for the LShiftCntV/RShiftCntV node:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
24c     vasrB V3, V1, V2&lt;br/&gt;
260     storeV [R19], V3	# vector (rvv)&lt;br/&gt;
268     lbu  R19, [R29, #48]	# byte, #@loadUB&lt;br/&gt;
26c     andi  R19, R19, #7	#@andI_reg_imm&lt;br/&gt;
270     loadV V1, [R25]	# vector (rvv)&lt;br/&gt;
278     vshiftcnt V2, R19&lt;br/&gt;
280     vasrB V3, V1, V2&lt;br/&gt;
294     storeV [R26], V3	# vector (rvv)&lt;br/&gt;
29c     lbu  R19, [R29, #80]	# byte, #@loadUB&lt;br/&gt;
2a0     andi  R19, R19, #7	#@andI_reg_imm&lt;br/&gt;
2a4     loadV V1, [R22]	# vector (rvv)&lt;br/&gt;
2ac     vshiftcnt V2, R19&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
By the way, the mask version of MaskAll is supported.&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;https://github.com/riscv/riscv-v-spec/blob/v1.0/v-spec.adoc&quot;&gt;https://github.com/riscv/riscv-v-spec/blob/v1.0/v-spec.adoc&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
[2] &lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/test/jdk/jdk/incubator/vector/VectorReshapeTests.java&quot;&gt;https://github.com/openjdk/jdk/blob/master/test/jdk/jdk/incubator/vector/VectorReshapeTests.java&lt;/a&gt;&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5099585">JDK-8306966</key>
            <summary>RISC-V: Support vector cast node for Vector API</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gcao">Gui Cao</assignee>
                                    <reporter username="gcao">Gui Cao</reporter>
                        <labels>
                            <label>oraclejdk-na</label>
                            <label>performance</label>
                            <label>vectorapi</label>
                    </labels>
                <created>Wed, 26 Apr 2023 20:07:24 -0700</created>
                <updated>Wed, 10 May 2023 23:53:42 -0700</updated>
                            <resolved>Sun, 7 May 2023 18:16:14 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14579627" author="dukebot" created="Sun, 7 May 2023 18:16:13 -0700"  >Changeset: 495f2688&lt;br/&gt;
Author:    Gui Cao &amp;lt;&lt;a href=&apos;mailto:gcao@openjdk.org&apos;&gt;gcao@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Fei Yang &amp;lt;&lt;a href=&apos;mailto:fyang@openjdk.org&apos;&gt;fyang@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-08 01:15:12 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/495f2688d64ca0393906487a0b9ac6ed4c679ffa&quot;&gt;https://git.openjdk.org/jdk/commit/495f2688d64ca0393906487a0b9ac6ed4c679ffa&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14577191" author="roboduke" created="Wed, 26 Apr 2023 20:41:13 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13684&quot;&gt;https://git.openjdk.org/jdk/pull/13684&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-27 03:37:00 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                                                <inwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5089173">JDK-8298342</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="20300"><![CDATA[riscv]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31ajv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17415"><![CDATA[b22]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>