<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:01:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8308387] CLD created and unloading list sharing _next node pointer leads to concurrent YC missing CLD roots</title>
                <link>https://bugs.openjdk.org/browse/JDK-8308387</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8307106&quot; title=&quot;Allow concurrent GCs to walk CLDG without ClassLoaderDataGraph_lock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8307106&quot;&gt;&lt;strike&gt;JDK-8307106&lt;/strike&gt;&lt;/a&gt; introduced the ability to walk the created CLDs list in the CLDG without a lock. This was primarily introduced to allow lockless concurrent CLD roots scanning for young collections in generational ZGC. However because the CLD _next node pointer is shared between the two list this can lead to a concurrent iteration of the created CLDs missing list entries. Specifically a young root scanning which occurs concurrently with class unloading.&lt;br/&gt;
&lt;br/&gt;
This change introduces a second _unloading_next node pointer which is used for the unloading CLDs list. The set_next is now maintains the invariant that it only ever unlinks is_unloading() CLDs and maintains a consistent view of the tail list for anyone reading the list concurrently&lt;br/&gt;
&lt;br/&gt;
Below is the crash which is a symptom of this. What effectively happens is that some CLD roots are not traced due to the race described above, which means that the young collection ends is mark phase with a broken object graph (some roots are not the correctly coloured/proccessed). This then confuses the load barriers in the verification step which is run before the young collection enters its relocation phase to try an relocated the object, which then catches the bug with assert(_generation-&amp;gt;is_phase_relocate()).&lt;br/&gt;
&lt;br/&gt;
The following test failed in the JDK21 CI:&lt;br/&gt;
&lt;br/&gt;
gc/stringdedup/TestStringDeduplicationPrintOptions.java#Z&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
#section:driver&lt;br/&gt;
----------messages:(8/405)----------&lt;br/&gt;
command: driver gc.stringdedup.TestStringDeduplicationPrintOptions Z&lt;br/&gt;
reason: User specified action: run driver gc.stringdedup.TestStringDeduplicationPrintOptions Z &lt;br/&gt;
started: Thu May 18 19:48:00 UTC 2023&lt;br/&gt;
Mode: agentvm&lt;br/&gt;
Agent id: 9&lt;br/&gt;
Additional opens to unnamed modules from @modules: java.base/jdk.internal.misc java.base/java.lang&lt;br/&gt;
finished: Thu May 18 19:48:05 UTC 2023&lt;br/&gt;
elapsed time (seconds): 5.182&lt;br/&gt;
----------configuration:(18/1749)*----------&lt;br/&gt;
&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
&lt;br/&gt;
----------System.out:(29/3505)*----------&lt;br/&gt;
Command line: [c:\\ade\\mesos\\work_dir\\jib-master\\install\\jdk-21+24-2008\\windows-x64-debug.jdk\\jdk-21\\fastdebug\\bin\\java.exe -cp C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\classes\\5\\gc\\stringdedup\\TestStringDeduplicationPrintOptions_Z.d;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jdk-21+24-2008\\src.full\\open\\test\\hotspot\\jtreg\\gc\\stringdedup;C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\classes\\5;C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\classes\\5\\test\\lib;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jtreg\\7.2\\1\\bundles\\jtreg-7.2+1.zip\\jtreg\\lib\\jtreg.jar;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jtreg\\7.2\\1\\bundles\\jtreg-7.2+1.zip\\jtreg\\lib\\junit-platform-console-standalone-1.9.2.jar;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jtreg\\7.2\\1\\bundles\\jtreg-7.2+1.zip\\jtreg\\lib\\testng-7.3.0.jar;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jtreg\\7.2\\1\\bundles\\jtreg-7.2+1.zip\\jtreg\\lib\\jcommander-1.78.jar;C:\\ade\\mesos\\work_dir\\jib-master\\install\\jtreg\\7.2\\1\\bundles\\jtreg-7.2+1.zip\\jtreg\\lib\\guice-4.2.3.jar -XX:MaxRAMPercentage=4.16667 -Dtest.boot.jdk=c:\\ade\\mesos\\work_dir\\jib-master\\install\\jdk\\20\\36\\bundles\\windows-x64\\jdk-20_windows-x64_bin.zip\\jdk-20 -Djava.io.tmpdir=c:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\tmp -XX:+CreateCoredumpOnCrash -XX:+UseZGC -XX:+ZGenerational -XX:+UseZGC -Xmn50m -Xms100m -Xmx100m -XX:+UnlockDiagnosticVMOptions --add-opens=java.base/java.lang=ALL-UNNAMED -XX:+VerifyAfterGC -XX:+UseStringDeduplication -XX:StringDeduplicationAgeThreshold=3 gc.stringdedup.TestStringDeduplicationTools$DeduplicationTest 10 5 3 YoungGC ]&lt;br/&gt;
[2023-05-18T19:48:00.275380500Z] Gathering output for process 43868&lt;br/&gt;
Begin: DeduplicationTest&lt;br/&gt;
Creating strings: total=10, unique=5&lt;br/&gt;
Creating strings: total=10, unique=10&lt;br/&gt;
Begin: Young GC 1/6&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (c:\\sb\\prod\\1684436204\\workspace\\open\\src\\hotspot\\share\\gc\\z\\zRelocate.cpp:378), pid=43868, tid=38256&lt;br/&gt;
#  assert(_generation-&amp;gt;is_phase_relocate()) failed: Must be&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0+24) (fastdebug build 21-ea+24-LTS-2008)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-ea+24-LTS-2008, mixed mode, sharing, tiered, compressed class ptrs, z gc, windows-amd64)&lt;br/&gt;
# Core dump will be written. Default location: C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\scratch\\0\\hs_err_pid43868.mdmp&lt;br/&gt;
#&lt;br/&gt;
# An error report file with more information is saved as:&lt;br/&gt;
# C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\scratch\\0\\hs_err_pid43868.log&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
[2023-05-18T19:48:05.089860300Z] Waiting for completion for process 43868&lt;br/&gt;
[2023-05-18T19:48:05.150305Z] Waiting for completion finished for process 43868&lt;br/&gt;
[2023-05-18T19:48:05.150305Z] Waiting for completion for process 43868&lt;br/&gt;
[2023-05-18T19:48:05.150871100Z] Waiting for completion finished for process 43868&lt;br/&gt;
[2023-05-18T19:48:05.176122800Z] Waiting for completion for process 43868&lt;br/&gt;
[2023-05-18T19:48:05.176688700Z] Waiting for completion finished for process 43868&lt;br/&gt;
----------System.err:(37/1963)*----------&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;stdout: [Begin: DeduplicationTest&lt;br/&gt;
Creating strings: total=10, unique=5&lt;br/&gt;
Creating strings: total=10, unique=10&lt;br/&gt;
Begin: Young GC 1/6&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (c:\\sb\\prod\\1684436204\\workspace\\open\\src\\hotspot\\share\\gc\\z\\zRelocate.cpp:378), pid=43868, tid=38256&lt;br/&gt;
#  assert(_generation-&amp;gt;is_phase_relocate()) failed: Must be&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0+24) (fastdebug build 21-ea+24-LTS-2008)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-ea+24-LTS-2008, mixed mode, sharing, tiered, compressed class ptrs, z gc, windows-amd64)&lt;br/&gt;
# Core dump will be written. Default location: C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\scratch\\0\\hs_err_pid43868.mdmp&lt;br/&gt;
#&lt;br/&gt;
# An error report file with more information is saved as:&lt;br/&gt;
# C:\\sb\\prod\\1684439107\\testoutput\\test-support\\jtreg_open_test_hotspot_jtreg_hotspot_gc\\scratch\\0\\hs_err_pid43868.log&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
];&lt;br/&gt;
&amp;nbsp;stderr: []&lt;br/&gt;
&amp;nbsp;exitValue = 1&lt;br/&gt;
&lt;br/&gt;
java.lang.RuntimeException: Expected to get exit value of [0], exit value is: [1]&lt;br/&gt;
	at jdk.test.lib.process.OutputAnalyzer.shouldHaveExitValue(OutputAnalyzer.java:490)&lt;br/&gt;
	at gc.stringdedup.TestStringDeduplicationTools.testPrintOptions(TestStringDeduplicationTools.java:517)&lt;br/&gt;
	at gc.stringdedup.TestStringDeduplicationPrintOptions.main(TestStringDeduplicationPrintOptions.java:94)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainActionHelper$AgentVMRunnable.run(MainActionHelper.java:333)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1583)&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test threw exception: java.lang.RuntimeException&lt;br/&gt;
JavaTest Message: shutting down test&lt;br/&gt;
&lt;br/&gt;
result: Failed. Execution failed: `main&amp;#39; threw exception: java.lang.RuntimeException: Expected to get exit value of [0], exit value is: [1]</description>
                <environment></environment>
        <key id="5101254">JDK-8308387</key>
            <summary>CLD created and unloading list sharing _next node pointer leads to concurrent YC missing CLD roots</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aboldtch">Axel Boldt-Christmas</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>genzgc</label>
                            <label>tier2</label>
                    </labels>
                <created>Thu, 18 May 2023 12:58:57 -0700</created>
                <updated>Thu, 13 Jul 2023 03:32:02 -0700</updated>
                            <resolved>Thu, 1 Jun 2023 23:36:57 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14586522" author="dukebot" created="Thu, 1 Jun 2023 23:36:56 -0700"  >Changeset: 7b0a3360&lt;br/&gt;
Author:    Axel Boldt-Christmas &amp;lt;&lt;a href=&apos;mailto:aboldtch@openjdk.org&apos;&gt;aboldtch@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-02 06:35:24 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/7b0a33600e27507546d38c53bdbc482561e1154b&quot;&gt;https://git.openjdk.org/jdk/commit/7b0a33600e27507546d38c53bdbc482561e1154b&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14585916" author="roboduke" created="Wed, 31 May 2023 01:32:39 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14241&quot;&gt;https://git.openjdk.org/jdk/pull/14241&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-31 08:28:20 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5101839">JDK-8308881</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17005"><![CDATA[windows]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31kur:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17357"><![CDATA[b26]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>