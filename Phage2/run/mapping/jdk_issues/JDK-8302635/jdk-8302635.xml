<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 16:52:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8302635] Race condition in HttpBodySubscriberWrapper when cancelling request</title>
                <link>https://bugs.openjdk.org/browse/JDK-8302635</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The HttpBodySubscriberWrapper is a class that ensures that a subscriber will be subscribed to before it is completed. It also provides hooks to its two subclasses (one for HTTP/1, one for HTTP/2) that allows subclasses to register the susbscriber with the HttpClient at subscription time, and to unregister it when it is eventualy completed, or when the subscription is cancelled. &lt;br/&gt;
&lt;br/&gt;
There is however a race condition that can happen when a subscription is cancelled: it can happen that unregister is called before register. The CancelRequestTest has been observed failing once or twice on personal jobs. Though the particular mechanics of this race is hard to understand, the logs of the tests have brought sufficient evidence that this is what was happening.&lt;br/&gt;
&lt;br/&gt;
The symptom is finding one subscriber still registered after completion of the exchange:&lt;br/&gt;
&lt;br/&gt;
test CancelRequestTest.testGetSendAsync(&amp;quot;&lt;a href=&quot;https://localhost:42711/https1/x/same/interrupt&quot;&gt;https://localhost:42711/https1/x/same/interrupt&lt;/a&gt;&amp;quot;, true, true): failure&lt;br/&gt;
java.lang.AssertionError: WARNING: tracker for HttpClientImpl(13) has outstanding operations:&lt;br/&gt;
	Pending HTTP Requests: 0&lt;br/&gt;
	Pending HTTP/1.1 operations: 0&lt;br/&gt;
	Pending HTTP/2 streams: 0&lt;br/&gt;
	Pending WebSocket operations: 0&lt;br/&gt;
	Pending TCP connections: 0&lt;br/&gt;
	Pending Subscribers: 1&lt;br/&gt;
	Total pending operations: 0&lt;br/&gt;
	Facade referenced: true&lt;br/&gt;
	Selector alive: true&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5094323">JDK-8302635</key>
            <summary>Race condition in HttpBodySubscriberWrapper when cancelling request</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dfuchs">Daniel Fuchs</assignee>
                                    <reporter username="dfuchs">Daniel Fuchs</reporter>
                        <labels>
                            <label>httpclient</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                    </labels>
                <created>Thu, 16 Feb 2023 01:22:21 -0800</created>
                <updated>Thu, 3 Jul 2025 06:33:32 -0700</updated>
                            <resolved>Fri, 17 Feb 2023 06:45:29 -0800</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14794219" author="roboduke" created="Mon, 30 Jun 2025 07:44:25 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3690&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3690&lt;/a&gt;&lt;br/&gt;
Date: 2025-06-30 14:37:03 +0000</comment>
                            <comment id="14794218" author="goetz" created="Mon, 30 Jun 2025 07:36:39 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.17-oracle.&lt;br/&gt;
Medium risk, but part of the large http backport effort.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes. SAP nightly testing passed.</comment>
                            <comment id="14561037" author="dukebot" created="Fri, 17 Feb 2023 06:45:27 -0800"  >Changeset: edf238b6&lt;br/&gt;
Author:    Daniel Fuchs &amp;lt;&lt;a href=&apos;mailto:dfuchs@openjdk.org&apos;&gt;dfuchs@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-17 14:43:58 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/edf238b65e441a1d626f3a4ba06170badd05ca7c&quot;&gt;https://git.openjdk.org/jdk/commit/edf238b65e441a1d626f3a4ba06170badd05ca7c&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14560605" author="roboduke" created="Thu, 16 Feb 2023 01:57:00 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12587&quot;&gt;https://git.openjdk.org/jdk/pull/12587&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-16 09:51:27 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5159748">JDK-8357896</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5163593">JDK-8361359</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5063705">JDK-8277969</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30esz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="193"><![CDATA[java.net]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>