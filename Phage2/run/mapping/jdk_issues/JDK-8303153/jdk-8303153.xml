<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:11:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303153] Native interpreter frame missing mirror</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303153</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>While debugging &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302350&quot; title=&quot;JfrThreadSampler failed with &amp;quot;assert((is_native() &amp;amp;&amp;amp; bci == 0) || (!is_native() &amp;amp;&amp;amp; 0 &amp;lt;= bci &amp;amp;&amp;amp; bci &amp;lt; code_size())) failed: illegal bci: 0 for non-native method&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8302350&quot;&gt;&lt;strike&gt;JDK-8302350&lt;/strike&gt;&lt;/a&gt;, it was found that an interpreter frame had an InstanceKlass* in the mirror_oop slot, where there should have been an oop of type java/lang/Class. That is, there should have been the mirror oop for the method holder, not the direct InstanceKlass*. How it ended up there is not clear, but since there is actually two InstanceKlass*es in that frame, it suggests that there have been recent changes to the interpreter frame layout, where there is now something called &amp;quot;extended_sp&amp;quot; also being stored? The extended_sp slot also has an (the same) InstanceKlass*.</description>
                <environment></environment>
        <key id="5094946">JDK-8303153</key>
            <summary>Native interpreter frame missing mirror</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fbredberg">Fredrik Bredberg</assignee>
                                    <reporter username="mgronlun">Markus Gr&#246;nlund</reporter>
                        <labels>
                            <label>interpreter</label>
                            <label>noreg-hard</label>
                    </labels>
                <created>Fri, 24 Feb 2023 01:19:43 -0800</created>
                <updated>Tue, 16 May 2023 16:07:35 -0700</updated>
                            <resolved>Mon, 8 May 2023 07:46:42 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14579793" author="dukebot" created="Mon, 8 May 2023 07:46:41 -0700"  >Changeset: 5a259d87&lt;br/&gt;
Author:    Fredrik Bredberg &amp;lt;&lt;a href=&apos;mailto:fredrik.bredberg@oracle.com&apos;&gt;fredrik.bredberg@oracle.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Coleen Phillimore &amp;lt;&lt;a href=&apos;mailto:coleenp@openjdk.org&apos;&gt;coleenp@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-08 14:44:54 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/5a259d875ee6ebd93d3c0932d50784021bc97ea2&quot;&gt;https://git.openjdk.org/jdk/commit/5a259d875ee6ebd93d3c0932d50784021bc97ea2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14578980" author="roboduke" created="Thu, 4 May 2023 01:12:57 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13794&quot;&gt;https://git.openjdk.org/jdk/pull/13794&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-04 08:00:23 +0000</comment>
                            <comment id="14576639" author="coleenp" created="Tue, 25 Apr 2023 05:24:46 -0700"  >I took this bug thinking I can figure it what this is doing and why, but it looks a bit more complicated than I thought.   The mirror needs to be stored in the frame for native calls also as it is on other platforms.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// Get mirror&lt;br/&gt;
&amp;nbsp;&amp;nbsp;__ load_mirror(r10, rmethod, r5, rscratch2);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (! native_call) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ ldr(rscratch1, Address(rmethod, Method::const_offset()));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ ldrh(rscratch1, Address(rscratch1, ConstMethod::max_stack_offset()));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ add(rscratch1, rscratch1, MAX2(3, Method::extra_stack_entries()));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ sub(rscratch1, sp, rscratch1, ext::uxtw, 3);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ andr(rscratch1, rscratch1, -16);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Store extended SP and mirror&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ stp(r10, rscratch1, Address(sp, 4 * wordSize));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Move SP out of the way&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ mov(sp, rscratch1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;} else {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// Make sure there is room for the exception oop pushed in case method throws&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// an exception (see TemplateInterpreterGenerator::generate_throw_exception())&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ sub(rscratch1, sp, 2 * wordSize);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ stp(zr, rscratch1, Address(sp, 4 * wordSize));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;__ mov(sp, rscratch1);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Help!</comment>
                            <comment id="14566884" author="coleenp" created="Tue, 14 Mar 2023 14:07:27 -0700"  >ILW = H (crash) L (unlikely) M (no workaround if native method unloaded) = P3</comment>
                            <comment id="14566883" author="coleenp" created="Tue, 14 Mar 2023 14:06:39 -0700"  >Thanks [~aph].</comment>
                            <comment id="14565872" author="aph" created="Fri, 10 Mar 2023 07:55:58 -0800"  >OK, I&amp;#39;ll grab it.</comment>
                            <comment id="14565810" author="coleenp" created="Fri, 10 Mar 2023 04:40:43 -0800"  >[~aph]I think the stack that Markus posted is really the problem in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302350&quot; title=&quot;JfrThreadSampler failed with &amp;quot;assert((is_native() &amp;amp;&amp;amp; bci == 0) || (!is_native() &amp;amp;&amp;amp; 0 &amp;lt;= bci &amp;amp;&amp;amp; bci &amp;lt; code_size())) failed: illegal bci: 0 for non-native method&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8302350&quot;&gt;&lt;strike&gt;JDK-8302350&lt;/strike&gt;&lt;/a&gt;, but if you look at generate_fixed_frame, if the method is native, you don&amp;#39;t store the mirror in the mirror slot.&lt;br/&gt;
I don&amp;#39;t think you can do this. It would be hard to write a test case but you could unload the klass containing the native method, which the mirror is preventing you from doing.</comment>
                            <comment id="14565774" author="aph" created="Fri, 10 Mar 2023 01:58:17 -0800"  >I should perhaps have a look, but I can&amp;#39;t reproduce the problem at my end.</comment>
                            <comment id="14565767" author="aph" created="Fri, 10 Mar 2023 01:39:41 -0800"  >The additional extended_sp slot is a cleanup by me.</comment>
                            <comment id="14564122" author="coleenp" created="Thu, 2 Mar 2023 06:55:36 -0800"  >I was looking at generate_fixed_frame on aarch64 with Markus and noticed that the mirror oop isn&amp;#39;t stored for native functions, which seems wrong.  Is the additional extended_sp slot a result of Loom changes?</comment>
                            <comment id="14563560" author="mseledtsov" created="Tue, 28 Feb 2023 11:15:50 -0800"  >ILW = HLH = P2</comment>
                            <comment id="14562631" author="mgronlun" created="Fri, 24 Feb 2023 01:27:15 -0800"  >Maybe related to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8288971&quot; title=&quot;AArch64: Clean up stack and register handling in interpreter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8288971&quot;&gt;&lt;strike&gt;JDK-8288971&lt;/strike&gt;&lt;/a&gt;?</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5094000">JDK-8302350</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5077638">JDK-8288971</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4878119">JDK-8154580</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102783" name="InstanceKlass_in_Interpreter_frame.jpg" size="312803" author="mgronlun" created="Fri, 24 Feb 2023 01:23:21 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30inf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17415"><![CDATA[b22]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>