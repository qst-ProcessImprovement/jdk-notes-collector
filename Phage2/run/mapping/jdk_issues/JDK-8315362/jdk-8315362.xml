<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:12:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8315362] NMT: summary diff reports threads count incorrectly</title>
                <link>https://bugs.openjdk.org/browse/JDK-8315362</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Apparent regression after  &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8204552&quot; title=&quot;NMT: Separate thread stack tracking from virtual memory tracking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8204552&quot;&gt;&lt;strike&gt;JDK-8204552&lt;/strike&gt;&lt;/a&gt; fix.&lt;br/&gt;
Amount of threads reported incorrectly for summary and detail diff when used by jcmd. During comparison to baseline threads amount is always reported as 0 on non-AIX platforms:&lt;br/&gt;
$ jcmd &amp;lt;PID&amp;gt; VM.native_memory baseline&lt;br/&gt;
$ jcmd &amp;lt;PID&amp;gt; VM.native_memory summary.diff&lt;br/&gt;
...&lt;br/&gt;
Thread (reserved=23622KB +1027KB, committed=1358KB +107KB)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(thread #0)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(stack: reserved=23552KB +1024KB, committed=1288KB +104KB)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(malloc=45KB +2KB #142 +6)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(arena=25KB +1d #44 +2)&lt;br/&gt;
...&lt;br/&gt;
This is happening because ThreadStackTracker::track_as_vm() condition is ignored during MallocMemorySnapshot collection and thread count is always reported as malloc count of allocations for mtThreadStack:&lt;br/&gt;
inline size_t thread_count() const {&lt;br/&gt;
&amp;nbsp;MallocMemorySnapshot* s = const_cast&amp;lt;MallocMemorySnapshot*&amp;gt;(this);&lt;br/&gt;
&amp;nbsp;return s-&amp;gt;by_type(mtThreadStack)-&amp;gt;malloc_count();&lt;br/&gt;
}&lt;br/&gt;
MallocMemorySnapshot::thread_count() should consider ThreadStackTracker::track_as_vm().&lt;br/&gt;
Issue is not reproducible if ThreadStackTracker::track_as_vm() == false. </description>
                <environment></environment>
        <key id="5109278">JDK-8315362</key>
            <summary>NMT: summary diff reports threads count incorrectly</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eignatenko">Evgeny Ignatenko</assignee>
                                    <reporter username="yan">Yuri Nesterenko</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk17-fix-request</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-SQE-ok</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>nmt</label>
                    </labels>
                <created>Wed, 30 Aug 2023 04:03:52 -0700</created>
                <updated>Fri, 31 May 2024 02:33:15 -0700</updated>
                            <resolved>Mon, 16 Oct 2023 01:34:49 -0700</resolved>
                                    <version>13</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14676800" author="roboduke" created="Tue, 28 May 2024 05:40:00 -0700"  >[jdk17u-fix-request] Approval Request from Evgeny Ignatenko&lt;br/&gt;
</comment>
                            <comment id="14636488" author="roboduke" created="Wed, 27 Dec 2023 02:33:18 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2084&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2084&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-27 07:31:16 +0000</comment>
                            <comment id="14636483" author="JIRAUSER21103" created="Tue, 26 Dec 2023 23:04:22 -0800"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
jdk17 is also affected by this bug. Small adjustment in the test needed to apply the patch.</comment>
                            <comment id="14622425" author="yan" created="Tue, 31 Oct 2023 07:32:53 -0700"  >Fix request [21u]&lt;br/&gt;
On behalf of  Evgeny Ignatenko:&lt;br/&gt;
&lt;br/&gt;
jdk21 is also affected by this bug. Patch applies almost cleanly, only small adjustment in the test needed.</comment>
                            <comment id="14622420" author="roboduke" created="Tue, 31 Oct 2023 07:26:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/310&quot;&gt;https://git.openjdk.org/jdk21u/pull/310&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-31 14:20:32 +0000</comment>
                            <comment id="14619416" author="mbaesken" created="Thu, 19 Oct 2023 01:42:26 -0700"  >Thank&amp;#39;s [~jsjolen],  I put the PR for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8318474&quot; title=&quot;Fix memory reporter for thread_count&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8318474&quot;&gt;&lt;strike&gt;JDK-8318474&lt;/strike&gt;&lt;/a&gt;  that removes the assert into our build/test queue .</comment>
                            <comment id="14619334" author="JIRAUSER20009" created="Wed, 18 Oct 2023 14:03:16 -0700"  >Hi Matthias, the code that was changed was mentioned as &amp;quot;a workaround for AIX&amp;quot;, so it is not so strange that this doesn&amp;#39;t mess up on Linux or macOS. The assert is hit on a branch where ThreadStackTracker::track_as_vm() is false, and thread_count() would not be set in that case. This patch changes that. Luckily, it seems to me that the assert can simply be removed as it&amp;#39;s asserting an invariant which is no longer true.</comment>
                            <comment id="14619224" author="mbaesken" created="Wed, 18 Oct 2023 07:56:33 -0700"  >we get now asserts on AIX &lt;br/&gt;
#  Internal Error (/rs6000_64/jdk/src/hotspot/share/services/memReporter.cpp:239), pid=12124614, tid=6426&lt;br/&gt;
#  assert(ThreadStackTracker::thread_count() == 0) failed: Not used&lt;br/&gt;
in various NMT related  jtreg tests.&lt;br/&gt;
Could it be related to this change? But very strange that we do not see it e.g. on Linux or macOS.&lt;br/&gt;
For example those 2 (but also other) tests&lt;br/&gt;
runtime/NMT/HugeArenaTracking.java&lt;br/&gt;
runtime/NMT/BaselineWithParameter.java&lt;br/&gt;
show it .</comment>
                            <comment id="14618309" author="dukebot" created="Mon, 16 Oct 2023 01:34:48 -0700"  >Changeset: 37aed6f4&lt;br/&gt;
Author:    Evgeny Ignatenko &amp;lt;&lt;a href=&apos;mailto:ier7928@gmail.com&apos;&gt;ier7928@gmail.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Johan Sj&amp;#xF6;len &amp;lt;&lt;a href=&apos;mailto:jsjolen@openjdk.org&apos;&gt;jsjolen@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-10-16 08:19:21 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/37aed6f46d19a48b7bceffde61b529a69a6abf54&quot;&gt;https://git.openjdk.org/jdk/commit/37aed6f46d19a48b7bceffde61b529a69a6abf54&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14613010" author="roboduke" created="Thu, 21 Sep 2023 15:37:01 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15490&quot;&gt;https://git.openjdk.org/jdk/pull/15490&lt;/a&gt;&lt;br/&gt;
Date: 2023-08-30 11:11:12 +0000</comment>
                            <comment id="14607687" author="yan" created="Wed, 30 Aug 2023 04:33:18 -0700"  >&lt;a href=&quot;https://github.com/openjdk/jdk/pull/15490&quot;&gt;https://github.com/openjdk/jdk/pull/15490&lt;/a&gt; -- first PR in openjdk</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5114310">JDK-8319712</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118484">JDK-8323352</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130773">JDK-8333342</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5112790">JDK-8318474</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17424"><![CDATA[b14]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="23503">13.0.14</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32y2r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17351"><![CDATA[b20]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>