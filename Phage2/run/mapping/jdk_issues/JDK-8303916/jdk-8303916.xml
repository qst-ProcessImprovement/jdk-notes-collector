<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 08:53:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303916] ThreadLists.java inconsistent results</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303916</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The java/lang/management/ThreadMXBean/ThreadLists.java occasionally fails on GraalVM, most likely due to not accounting for JVMCI threads being Java threads.&lt;br/&gt;
&lt;br/&gt;
----------System.out:(23/635)----------&lt;br/&gt;
Starting Test&lt;br/&gt;
Initial set of enumerated threads:&lt;br/&gt;
&amp;nbsp;- Thread: main&lt;br/&gt;
&amp;nbsp;- Thread: Reference Handler&lt;br/&gt;
&amp;nbsp;- Thread: Finalizer&lt;br/&gt;
&amp;nbsp;- Thread: Signal Dispatcher&lt;br/&gt;
&amp;nbsp;- Thread: JVMCI-native CompilerThread0&lt;br/&gt;
&amp;nbsp;- Thread: Common-Cleaner&lt;br/&gt;
&amp;nbsp;- Thread: Notification Thread&lt;br/&gt;
&amp;nbsp;- Thread: MainThread&lt;br/&gt;
ThreadGroup: 8 active thread(s)&lt;br/&gt;
Thread: 8 stack trace(s) returned&lt;br/&gt;
ThreadMXBean: 11 live threads(s)&lt;br/&gt;
ThreadMXBean: 11 thread Id(s)&lt;br/&gt;
Set of stack-traced threads:&lt;br/&gt;
&amp;nbsp;- Thread: Signal Dispatcher&lt;br/&gt;
&amp;nbsp;- Thread: Notification Thread&lt;br/&gt;
&amp;nbsp;- Thread: MainThread&lt;br/&gt;
&amp;nbsp;- Thread: Finalizer&lt;br/&gt;
&amp;nbsp;- Thread: Reference Handler&lt;br/&gt;
&amp;nbsp;- Thread: Common-Cleaner&lt;br/&gt;
&amp;nbsp;- Thread: JVMCI-native CompilerThread0&lt;br/&gt;
&amp;nbsp;- Thread: main&lt;br/&gt;
----------System.err:(11/612)----------&lt;br/&gt;
java.lang.RuntimeException: inconsistent results&lt;br/&gt;
	at ThreadLists.main(ThreadLists.java:91)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainThread.run(MainWrapper.java:125)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1623)</description>
                <environment></environment>
        <key id="5095889">JDK-8303916</key>
            <summary>ThreadLists.java inconsistent results</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinw">Kevin Walls</assignee>
                                    <reporter username="dnsimon">Douglas Simon</reporter>
                        <labels>
                            <label>graal</label>
                            <label>noreg-self</label>
                    </labels>
                <created>Thu, 9 Mar 2023 10:51:58 -0800</created>
                <updated>Mon, 10 Jun 2024 01:35:26 -0700</updated>
                            <resolved>Wed, 28 Jun 2023 01:32:19 -0700</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>core-svc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14592459" author="dukebot" created="Wed, 28 Jun 2023 01:32:18 -0700"  >Changeset: 8d9ebb69&lt;br/&gt;
Author:    Kevin Walls &amp;lt;&lt;a href=&apos;mailto:kevinw@openjdk.org&apos;&gt;kevinw@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-28 08:30:13 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk21/commit/8d9ebb6981a163a7c223eff154eb5ad966e146f1&quot;&gt;https://git.openjdk.org/jdk21/commit/8d9ebb6981a163a7c223eff154eb5ad966e146f1&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14589853" author="roboduke" created="Fri, 16 Jun 2023 02:23:24 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/24&quot;&gt;https://git.openjdk.org/jdk21/pull/24&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-16 09:15:52 +0000</comment>
                            <comment id="14589268" author="roboduke" created="Wed, 14 Jun 2023 04:45:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14465&quot;&gt;https://git.openjdk.org/jdk/pull/14465&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-14 09:30:49 +0000</comment>
                            <comment id="14584980" author="kevinw" created="Fri, 26 May 2023 11:41:35 -0700"  >I can also now see a failure in this test with JTREG_TEST_THREAD_FACTORY=Virtual  &lt;br/&gt;
Trying some new test output to show the new thread:&lt;br/&gt;
e.g.&lt;br/&gt;
...&lt;br/&gt;
ThreadGroup: 8 active thread(s)&lt;br/&gt;
Thread: 8 stack trace(s) returned&lt;br/&gt;
ThreadMXBean: 9 live threads(s)&lt;br/&gt;
ThreadMXBean: 9 thread Id(s)&lt;br/&gt;
Set of Threads from Thread.getAllStackTraces():&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#1,main,5,main]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#9,Finalizer,8,system]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#10,Signal Dispatcher,9,system]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#32,ForkJoinPool-1-worker-1,5,CarrierThreads]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#28,Common-Cleaner,8,InnocuousThreadGroup]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#8,Reference Handler,10,system]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#29,Notification Thread,9,system]&lt;br/&gt;
&amp;nbsp;- Thread: Thread[#33,ForkJoinPool-1-worker-2,5,CarrierThreads]&lt;br/&gt;
Re-enumerate ThreadGroup, gets newCount=9&lt;br/&gt;
Set of Thread IDs from MXBean:&lt;br/&gt;
1 8 9 10 28 29 32 33 34   new!&lt;br/&gt;
Thread[#34,ForkJoinPool-1-worker-3,5,CarrierThreads]&lt;br/&gt;
</comment>
                            <comment id="14566818" author="mwthomps" created="Tue, 14 Mar 2023 10:17:11 -0700"  >ILW=LLM=P5</comment>
                            <comment id="14566048" author="dnsimon" created="Sat, 11 Mar 2023 08:03:38 -0800"  >Excluding all threads whose name starts with &amp;quot;JVMCI&amp;quot; would fix the problem.</comment>
                            <comment id="14566044" author="dnsimon" created="Sat, 11 Mar 2023 07:53:19 -0800"  >It reproduces fairly reliably on my M1 MacBook using the graalvm-ce-java20-darwin-aarch64-dev.tar.gz download from &lt;a href=&quot;https://github.com/graalvm/graalvm-ce-dev-builds/releases/tag/23.0.0-dev-20230303_0222&quot;&gt;https://github.com/graalvm/graalvm-ce-dev-builds/releases/tag/23.0.0-dev-20230303_0222&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I modified the test using the attached 8303916-reproducer.diff patch. This patch calls the ThreadMXBean logic in a loop as sometimes the inconsistency does not always reproduce the first time it&amp;#39;s called.&lt;br/&gt;
&lt;br/&gt;
I also increase the number of JVMCI compiler threads with -XX:JVMCIThreads=4.&lt;br/&gt;
&lt;br/&gt;
&amp;gt; ~/jib/install/jtreg/7.1.1/1/bundles/jtreg-7.1.1+1.zip/jtreg/bin/jtreg -nr -v:all -jdk:/Users/dnsimon/Downloads/graalvm-ce-java20-23.0.0-dev/Contents/Home -vmoption:-XX:JVMCIThreads=4 test/jdk/java/lang/management/ThreadMXBean/ThreadLists.java&lt;br/&gt;
...&lt;br/&gt;
STDOUT:&lt;br/&gt;
Starting Test&lt;br/&gt;
Initial set of enumerated threads:&lt;br/&gt;
&amp;nbsp;- Thread: main&lt;br/&gt;
&amp;nbsp;- Thread: Reference Handler&lt;br/&gt;
&amp;nbsp;- Thread: Finalizer&lt;br/&gt;
&amp;nbsp;- Thread: Signal Dispatcher&lt;br/&gt;
&amp;nbsp;- Thread: JVMCI-native CompilerThread0&lt;br/&gt;
&amp;nbsp;- Thread: Common-Cleaner&lt;br/&gt;
&amp;nbsp;- Thread: Notification Thread&lt;br/&gt;
&amp;nbsp;- Thread: MainThread&lt;br/&gt;
--- ITERATION 0 ---&lt;br/&gt;
ThreadGroup: 8 active thread(s)&lt;br/&gt;
Thread: 8 stack trace(s) returned&lt;br/&gt;
ThreadMXBean: 8 live threads(s)&lt;br/&gt;
ThreadMXBean: 8 thread Id(s)&lt;br/&gt;
--- ITERATION 1 ---&lt;br/&gt;
Thread: 8 stack trace(s) returned&lt;br/&gt;
ThreadMXBean: 9 live threads(s)&lt;br/&gt;
ThreadMXBean: 9 thread Id(s)&lt;br/&gt;
Set of stack-traced threads:&lt;br/&gt;
&amp;nbsp;- Thread: main&lt;br/&gt;
&amp;nbsp;- Thread: Common-Cleaner&lt;br/&gt;
&amp;nbsp;- Thread: Notification Thread&lt;br/&gt;
&amp;nbsp;- Thread: Reference Handler&lt;br/&gt;
&amp;nbsp;- Thread: Finalizer&lt;br/&gt;
&amp;nbsp;- Thread: MainThread&lt;br/&gt;
&amp;nbsp;- Thread: JVMCI-native CompilerThread0&lt;br/&gt;
&amp;nbsp;- Thread: Signal Dispatcher&lt;br/&gt;
Set of thread infos:&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=1, name=main&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=8, name=Reference Handler&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=9, name=Finalizer&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=10, name=Signal Dispatcher&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=13, name=JVMCI-native CompilerThread0&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=17, name=Common-Cleaner&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=18, name=Notification Thread&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=21, name=MainThread&lt;br/&gt;
&amp;nbsp;- ThreadInfo: id=22, name=JVMCI-native CompilerThread1&lt;br/&gt;
STDERR:&lt;br/&gt;
java.lang.RuntimeException: inconsistent results&lt;br/&gt;
	at ThreadLists.main(ThreadLists.java:99)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainThread.run(MainWrapper.java:125)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1623)</comment>
                            <comment id="14566004" author="kevinw" created="Fri, 10 Mar 2023 14:54:30 -0800"  >Thread MXBean found 11 but the top thread group had 8.&lt;br/&gt;
Test shows the 8 threads from the thread group, and then shows that Thread.getAllStackTraces() also found 8 threads.  Then the MXBean count was taken.&lt;br/&gt;
The test doesn&amp;#39;t show what extra Threads make up the 11 threads and 11 thread IDs that the MXBean found. &lt;br/&gt;
&lt;br/&gt;
(Test runs in othervm mode since 8132785.)&lt;br/&gt;
&lt;br/&gt;
Is there a log or particular VM arguments to try and reproduce this?</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5103370">JDK-8310193</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5104681">JDK-8311354</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                                        </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5098897">JDK-8306446</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102951" name="8303916-reproducer.diff" size="5024" author="dnsimon" created="Sat, 11 Mar 2023 07:57:02 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30ogr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17413"><![CDATA[b29]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="194"><![CDATA[java.lang.management]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>