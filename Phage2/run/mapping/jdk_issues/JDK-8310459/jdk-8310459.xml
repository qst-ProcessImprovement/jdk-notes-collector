<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:29:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8310459] [BACKOUT] 8304450: [vectorapi] Refactor VectorShuffle implementation</title>
                <link>https://bugs.openjdk.org/browse/JDK-8310459</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>VectorAPI JMH micros shows  performance drop in Vector.slice and unslice operations w.r.t  JDK-20  on AVX3 and legacy targets.&lt;br/&gt;
&lt;br/&gt;
Other dependent API like castShape with non-zero part number also show performance degradations.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5103682">JDK-8310459</key>
            <summary>[BACKOUT] 8304450: [vectorapi] Refactor VectorShuffle implementation</summary>
                <type id="5" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14716&amp;avatarType=issuetype">Sub-task</type>
                            <parent id="5103934">JDK-8310691</parent>
                                    <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbhateja">Jatin Bhateja</assignee>
                                    <reporter username="jbhateja">Jatin Bhateja</reporter>
                        <labels>
                            <label>hgupdate-sync</label>
                            <label>oracle-triage-22</label>
                            <label>performance</label>
                            <label>regression</label>
                            <label>vectorIntrinsics</label>
                            <label>vectorapi</label>
                    </labels>
                <created>Tue, 20 Jun 2023 11:08:43 -0700</created>
                <updated>Thu, 1 Aug 2024 01:59:34 -0700</updated>
                            <resolved>Mon, 26 Jun 2023 11:36:33 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14592206" author="roboduke" created="Tue, 27 Jun 2023 00:53:28 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/68&quot;&gt;https://git.openjdk.org/jdk21/pull/68&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-27 07:46:24 +0000</comment>
                            <comment id="14592067" author="dukebot" created="Mon, 26 Jun 2023 11:36:28 -0700"  >Changeset: ff9a7541&lt;br/&gt;
Author:    Jatin Bhateja &amp;lt;&lt;a href=&apos;mailto:jbhateja@openjdk.org&apos;&gt;jbhateja@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-26 18:35:03 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/ff9a7541097bd853306a8594c97774f36877a0f9&quot;&gt;https://git.openjdk.org/jdk/commit/ff9a7541097bd853306a8594c97774f36877a0f9&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14591815" author="jbhateja" created="Fri, 23 Jun 2023 22:45:37 -0700"  >I found another issue with existing implementation, attached testcase shuffle_compute.java results into an assertion failure with JDK-mainline code.&lt;br/&gt;
&lt;br/&gt;
IPROMPT&amp;gt;java -Xint --add-modules=jdk.incubator.vector -cp . shuffle_compute 10000 1000 0 1 false&lt;br/&gt;
WARNING: Using incubator modules: jdk.incubator.vector&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.IllegalArgumentException: Vector creation failed: value 136 cannot be represented in ETYPE byte; result of cast is -120&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.AbstractSpecies.badElementBits(AbstractSpecies.java:405)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.ByteVector$ByteSpecies.longToElementBits(ByteVector.java:4153)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.ByteVector$ByteSpecies.checkValue(ByteVector.java:4119)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.ByteVector.lanewise(ByteVector.java:967)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.ByteVector.lanewise(ByteVector.java:51)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.AbstractVector.iotaShuffle(AbstractVector.java:232)&lt;br/&gt;
	at jdk.incubator.vector/jdk.incubator.vector.AbstractSpecies.iotaShuffle(AbstractSpecies.java:369)&lt;br/&gt;
	at shuffle_compute$1.apply(shuffle_compute.java:41)&lt;br/&gt;
	at shuffle_compute.micro(shuffle_compute.java:18)&lt;br/&gt;
	at shuffle_compute.main(shuffle_compute.java:78)&lt;br/&gt;
</comment>
                            <comment id="14591719" author="roboduke" created="Fri, 23 Jun 2023 09:53:55 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14629&quot;&gt;https://git.openjdk.org/jdk/pull/14629&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-23 16:43:32 +0000</comment>
                            <comment id="14591558" author="thartmann" created="Thu, 22 Jun 2023 23:19:31 -0700"  >ILW = Significant performance regression, vector API slice operation, no workaround = MMH = P3</comment>
                            <comment id="14591554" author="thartmann" created="Thu, 22 Jun 2023 23:15:21 -0700"  >I created a REDO &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8310691&quot; title=&quot;[REDO] [vectorapi] Refactor VectorShuffle implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8310691&quot;&gt;&lt;strike&gt;JDK-8310691&lt;/strike&gt;&lt;/a&gt; and adjusted the issues according to &lt;a href=&quot;https://openjdk.org/guide/#backing-out-a-change&quot;&gt;https://openjdk.org/guide/#backing-out-a-change&lt;/a&gt;.</comment>
                            <comment id="14591224" author="thartmann" created="Wed, 21 Jun 2023 22:42:56 -0700"  >Thanks for the details, Jatin. Yes, I think a backout and redo of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8304450&quot; title=&quot;[vectorapi] Refactor VectorShuffle implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8304450&quot;&gt;&lt;strike&gt;JDK-8304450&lt;/strike&gt;&lt;/a&gt; would make sense.</comment>
                            <comment id="14590972" author="jbhateja" created="Wed, 21 Jun 2023 05:47:20 -0700"  >[~qamai] is already working on a patch to intrinsify Vector.slice which will regain slice related performance. &lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/pull/12909&quot;&gt;https://github.com/openjdk/jdk/pull/12909&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Given that we are already past RDP1 can we consider the possibility to revert this PR and then re-introduce it in JDK-22 followed by a backport to JDK-21u at a later point, WDYT ?</comment>
                            <comment id="14590971" author="jbhateja" created="Wed, 21 Jun 2023 05:41:41 -0700"  >Shuffle overhaul in JDK-21 done with following patch causes this performance regression.&lt;br/&gt;
commit e846a1d70043f7b57ae76847e85e5426c86539a5&lt;br/&gt;
&lt;br/&gt;
Author: Quan Anh Mai &amp;lt;&lt;a href=&apos;mailto:qamai@openjdk.org&apos;&gt;qamai@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:   Thu Apr 13 07:02:28 2023 +0000&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;8304450: [vectorapi] Refactor VectorShuffle implementation&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
There is another performance related issue &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8309373&quot;&gt;https://bugs.openjdk.org/browse/JDK-8309373&lt;/a&gt; which also link to this.&lt;br/&gt;
&lt;br/&gt;
</comment>
                            <comment id="14590943" author="thartmann" created="Wed, 21 Jun 2023 04:24:31 -0700"  >Thanks, do we know which change introduced that regression?</comment>
                            <comment id="14590931" author="jbhateja" created="Wed, 21 Jun 2023 03:53:27 -0700"  >Please find attached excel sheet with details performance number w.r.t to JDK-20.&lt;br/&gt;
</comment>
                            <comment id="14590837" author="thartmann" created="Tue, 20 Jun 2023 23:45:05 -0700"  >Jatin, could you please add more information to the description? Should this be in hotspot/compiler?</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5104296">JDK-8311019</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5104679">JDK-8311352</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5095699">JDK-8303762</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5096566">JDK-8304450</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5103348">JDK-8310173</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="104382" name="Slice-Unslice Performance JDK-20 vs JDK-mainline.xlsx" size="31981" author="jbhateja" created="Wed, 21 Jun 2023 03:52:41 -0700"/>
                            <attachment id="104413" name="shuffle_compute.java" size="3689" author="jbhateja" created="Sun, 25 Jun 2023 08:01:37 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17431"><![CDATA[b19]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31znf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>