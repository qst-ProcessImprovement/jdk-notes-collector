<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 08:47:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8297923] java.awt.ScrollPane broken after multiple scroll up/down</title>
                <link>https://bugs.openjdk.org/browse/JDK-8297923</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The java.awt.ScrollPane GUI component gets broken after multiple scrolling up and down repeatedly.&lt;br/&gt;
This issue can only be observed when scrolling up/down is done slowly and multiple times (over 30 times).&lt;br/&gt;
It is observed in JDK 20, 17.0.5, 11.0.18 and 8u361.</description>
                <environment></environment>
        <key id="5088673">JDK-8297923</key>
            <summary>java.awt.ScrollPane broken after multiple scroll up/down</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aivanov">Alexey Ivanov</assignee>
                                    <reporter username="shadowbug">Shadow Bug</reporter>
                        <labels>
                            <label>bugdb_34852266</label>
                            <label>cssn22_12_01</label>
                            <label>cssn22_12_02</label>
                            <label>cssn23_01_01</label>
                            <label>cssn23_01_02</label>
                            <label>cssn23_02_01</label>
                            <label>cssn23_02_02</label>
                            <label>cssn23_03_01</label>
                            <label>cssn23_03_02</label>
                            <label>cssn23_04_01</label>
                            <label>cssn23_04_02</label>
                            <label>cssn23_05_01</label>
                            <label>cssn23_05_02</label>
                            <label>cssn23_06_01</label>
                            <label>cssn23_06_02</label>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>licbug</label>
                            <label>sustaining</label>
                    </labels>
                <created>Wed, 30 Nov 2022 23:28:16 -0800</created>
                <updated>Tue, 23 Jan 2024 21:07:45 -0800</updated>
                            <resolved>Wed, 7 Jun 2023 14:21:24 -0700</resolved>
                                    <version>8</version>
                    <version>11</version>
                    <version>17</version>
                    <version>20</version>
                                    <fixVersion>21</fixVersion>
                                    <component>client-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14596849" author="roboduke" created="Tue, 18 Jul 2023 04:45:58 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2047&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2047&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-18 11:38:26 +0000</comment>
                            <comment id="14596843" author="goetz" created="Tue, 18 Jul 2023 04:37:14 -0700"  >Fix request [11u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 11.0.21-oracle.&lt;br/&gt;
Acceptable risk, probably limited to ScrollPane. But all new change.&lt;br/&gt;
Clean backport from 17 including follow-ups.&lt;br/&gt;
SAP nighlty testing passed.  Tests pass on win for combined change.</comment>
                            <comment id="14596043" author="roboduke" created="Thu, 13 Jul 2023 05:35:52 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1578&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1578&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-13 12:28:57 +0000</comment>
                            <comment id="14594810" author="goetz" created="Mon, 10 Jul 2023 09:38:13 -0700"  >[~aivanov], thanks for pointing out!</comment>
                            <comment id="14594795" author="roboduke" created="Mon, 10 Jul 2023 08:46:29 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1563&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1563&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-10 15:38:37 +0000</comment>
                            <comment id="14594792" author="aivanov" created="Mon, 10 Jul 2023 08:42:40 -0700"  >[~goetz] You may want to wait until &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8311689&quot; title=&quot;Wrong visible amount in Adjustable of ScrollPane&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8311689&quot;&gt;&lt;strike&gt;JDK-8311689&lt;/strike&gt;&lt;/a&gt; is resolved. It&amp;#39;s another regression found recently.</comment>
                            <comment id="14594790" author="goetz" created="Mon, 10 Jul 2023 08:39:47 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.9-oracle.&lt;br/&gt;
Acceptable risk, probably limited to ScrollPane. But all new change.&lt;br/&gt;
Clean backport. Requires follow-up.&lt;br/&gt;
SAP nightly testing passed. Test passes on Win.&lt;br/&gt;
In the end I included the two follow ups in this backport. One of &lt;br/&gt;
the follow-ups required Copyright resolve. Marked clean.</comment>
                            <comment id="14590718" author="aivanov" created="Tue, 20 Jun 2023 12:24:19 -0700"  >This fix introduced two regressions: &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8310054&quot; title=&quot;ScrollPane insets are incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8310054&quot;&gt;&lt;strike&gt;JDK-8310054&lt;/strike&gt;&lt;/a&gt; and &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8311689&quot; title=&quot;Wrong visible amount in Adjustable of ScrollPane&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8311689&quot;&gt;&lt;strike&gt;JDK-8311689&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
(The &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8310054&quot; title=&quot;ScrollPane insets are incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8310054&quot;&gt;&lt;strike&gt;JDK-8310054&lt;/strike&gt;&lt;/a&gt; backport depends on &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8306137&quot; title=&quot;Open source several AWT ScrollPane related tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8306137&quot;&gt;&lt;strike&gt;JDK-8306137&lt;/strike&gt;&lt;/a&gt; where the test was added.)</comment>
                            <comment id="14587781" author="dukebot" created="Wed, 7 Jun 2023 14:21:22 -0700"  >Changeset: ea419073&lt;br/&gt;
Author:    Alexey Ivanov &amp;lt;&lt;a href=&apos;mailto:aivanov@openjdk.org&apos;&gt;aivanov@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-07 21:18:50 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/ea41907396a70933c4f6e6b0f247f7ba589a3a23&quot;&gt;https://git.openjdk.org/jdk/commit/ea41907396a70933c4f6e6b0f247f7ba589a3a23&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14587466" author="prr" created="Tue, 6 Jun 2023 14:07:09 -0700"  >So it seems like the thread mis-usage has been there since, well, so long ago that it could be from JDK 1.2 (or even 1.1, but I haven&amp;#39;t gone to check), and it became a problem only the day that XP came on the scene and uxtheme.dll was used internally by GDI rendering of Windows controls.&lt;br/&gt;
I can see that tracking this down was not easy because the leak isn&amp;#39;t of anything directly allocated by JDK.&lt;br/&gt;
&lt;br/&gt;
I am told switching to Windows classic works around it because this will (I think) disable use of uxtheme and avoid using whatever leaks GDI objects so quickly.&lt;br/&gt;
&lt;br/&gt;
[NB this is all about AWT.&lt;br/&gt;
Swing uses uxtheme.dll directly for the Swing L&amp;amp;F but it has nothing to do with this case].</comment>
                            <comment id="14587380" author="roboduke" created="Tue, 6 Jun 2023 09:14:49 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14338&quot;&gt;https://git.openjdk.org/jdk/pull/14338&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-06 16:07:53 +0000</comment>
                            <comment id="14587374" author="aivanov" created="Tue, 6 Jun 2023 09:03:17 -0700"  >Root Cause:&lt;br/&gt;
&lt;br/&gt;
As the vertical scroll bar thumb is moved up and down, the horizontal scroll bar flickers even though its position remains unchanged. As soon as the horizontal scroll bar stops flickering, the rendering becomes unreliable, and the problem is reproduced.&lt;br/&gt;
&lt;br/&gt;
Later, one of my colleagues noticed the number of GDI objects grows while the scroll bar is moved. (Task Manager can display the number of GDI objects: click Details tab, right-click the header and click &amp;quot;Select columns&amp;quot;; select &amp;quot;GDI objects&amp;quot; and click OK to apply the changes.) When the test case runs, the number of GDI objects reaches 9,999, and it never decreases.&lt;br/&gt;
&lt;br/&gt;
I used Microsoft Performance HUD [1] to pinpoint the leaked. It showed the following stack trace leaks GDI objects:&lt;br/&gt;
&lt;br/&gt;
Java_sun_awt_windows_WScrollPanePeer_setScrollPosition (awt.dll)&lt;br/&gt;
AwtToolkit::SyncCall (awt.dll)&lt;br/&gt;
AwtScrollPane::_SetScrollPos (awt.dll)&lt;br/&gt;
SetScrollInfo (user32.dll)&lt;br/&gt;
ThemeSetScrollInfoProc (uxtheme.dll)&lt;br/&gt;
CCSetScrollInfo (comctl32.dll)&lt;br/&gt;
DrawThumb2 (comctl32.dll)&lt;br/&gt;
CCSoftFadeInitialize (comctl32.dll)&lt;br/&gt;
&#8230;&lt;br/&gt;
&lt;br/&gt;
Likely, setting the position of a scroll bar triggers animation in the scroll bar control. When the animation is initiated from a thread which didn&amp;#39;t create the window, the animation never finishes and thus GDI objects are leaked.&lt;br/&gt;
&lt;br/&gt;
When AWT processes WM_VSCROLL and WM_HSCROLL messages from the scroll bar, it gets the new position of the scroll bar and posts a corresponding Java ScrollEvent to the Java event queue (EDT), see WScrollPanePeer.postScrollEvent. When the Java side processes the event, it calls WScrollPanePeer.setScrollPosition to update the position of the scroll bars in Windows. As the result, ::SetScrollInfo is called on EDT rather than the toolkit thread where the ScrollPane peer window is created.&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;https://www.microsoft.com/en-us/download/100813&quot;&gt;https://www.microsoft.com/en-us/download/100813&lt;/a&gt;</comment>
                            <comment id="14587334" author="aivanov" created="Tue, 6 Jun 2023 07:11:30 -0700"  >Steps to reproduce:&lt;br/&gt;
&lt;br/&gt;
Run the attached ScrollPaneTest.java:&lt;br/&gt;
&lt;br/&gt;
java -Dsun.java2d.d3d=false ScrollPaneTest.java&lt;br/&gt;
&lt;br/&gt;
Note: if you use JDK 8, you have to compile the class explicitly.&lt;br/&gt;
&lt;br/&gt;
The test case is semi-automatic. The Robot grabs the vertical scroll bar thumb and drags it down and up 20 times. Then the frame is minimised and restored. After this, the vertical scroll bar is moved.&lt;br/&gt;
&lt;br/&gt;
You should see an image similar to the attached ScrollPaneTest.png. That is one half of the canvas inside the ScrollPane is light-green as expected and the other half is purple, the light-green color is painted on the left side of the frame.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5103690">JDK-8310466</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103692">JDK-8310468</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103909">JDK-8310671</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5105665">JDK-8312223</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5106078">JDK-8312587</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                                        </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5103210">JDK-8310056</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5109640">JDK-8315690</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5109641">JDK-8315691</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103208">JDK-8310054</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5109643">JDK-8315693</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5105034">JDK-8311689</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="103166" name="ScrollPaneTest.java" size="7561" author="aivanov" created="Wed, 29 Mar 2023 08:57:17 -0700"/>
                            <attachment id="104197" name="ScrollPaneTest.png" size="14058" author="aivanov" created="Tue, 6 Jun 2023 06:59:25 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zg8j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17357"><![CDATA[b26]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="196"><![CDATA[java.awt]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>