<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:21:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8073061] (fs) Files.copy(foo, bar, REPLACE_EXISTING) deletes bar even if foo is not readable</title>
                <link>https://bugs.openjdk.org/browse/JDK-8073061</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>FULL PRODUCT VERSION :&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
ADDITIONAL OS VERSION INFORMATION :&lt;br/&gt;
Ubuntu 14.10, x86_64&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
/tmp/x $ cat Test.java &lt;br/&gt;
import java.io.IOException;&lt;br/&gt;
import java.nio.file.Files;&lt;br/&gt;
import java.nio.file.Path;&lt;br/&gt;
import java.nio.file.Paths;&lt;br/&gt;
import java.nio.file.StandardCopyOption;&lt;br/&gt;
&lt;br/&gt;
public class Test&lt;br/&gt;
{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public static void main(final String... args)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throws IOException&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;{&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final Path a = Paths.get(&amp;quot;a&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final Path b = Paths.get(&amp;quot;b&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Files.copy(a, b, StandardCopyOption.REPLACE_EXISTING);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
/tmp/x $ ls&lt;br/&gt;
Test.java&lt;br/&gt;
/tmp/x $ touch a b&lt;br/&gt;
/tmp/x $ chmod 0 a&lt;br/&gt;
/tmp/x $ cp a b&lt;br/&gt;
cp: cannot open &#8216;a&#8217; for reading: Permission denied&lt;br/&gt;
/tmp/x $ javac Test.java&lt;br/&gt;
/tmp/x $ java Test&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.nio.file.AccessDeniedException: a&lt;br/&gt;
	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)&lt;br/&gt;
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)&lt;br/&gt;
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)&lt;br/&gt;
	at sun.nio.fs.UnixCopyFile.copyFile(UnixCopyFile.java:230)&lt;br/&gt;
	at sun.nio.fs.UnixCopyFile.copy(UnixCopyFile.java:581)&lt;br/&gt;
	at sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:253)&lt;br/&gt;
	at java.nio.file.Files.copy(Files.java:1274)&lt;br/&gt;
	at Test.main(Test.java:15)&lt;br/&gt;
/tmp/x $ ls&lt;br/&gt;
a  Test.class  Test.java&lt;br/&gt;
/tmp/x $ &lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
The rundown is pretty simple:&lt;br/&gt;
&lt;br/&gt;
* I purposefully set file &amp;quot;a&amp;quot; so that I cannot read from it;&lt;br/&gt;
* I invoke the cp command to copy the contents of &amp;quot;a&amp;quot; to &amp;quot;b&amp;quot;: it fails: however, &amp;quot;b&amp;quot; is left intact;&lt;br/&gt;
* I now try and invoke Files.copy(), specifying that I want to replace the destination;&lt;br/&gt;
* &amp;quot;a&amp;quot; fails to be read and the exception is correctly reported (AccessDeniedException);&lt;br/&gt;
* BUT... b is GONE.&lt;br/&gt;
&lt;br/&gt;
Now, thanks to Michael Rasmussen (&lt;a href=&apos;mailto:michael.rasmussen@zeroturnaround.com&apos;&gt;michael.rasmussen@zeroturnaround.com&lt;/a&gt;), I have two more pieces of information:&lt;br/&gt;
&lt;br/&gt;
* this bug DOES NOT happens on Windows;&lt;br/&gt;
* it seems to be isolated to a specific section of code in the UnixFileSystemProvider and not limited to Linux. Original link was:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;http://hg.openjdk.java.net/jdk9/jdk9/jdk/file/tip/src/java.base/unix/classes/sun/nio/fs/UnixCopyFile.java#l556&quot;&gt;http://hg.openjdk.java.net/jdk9/jdk9/jdk/file/tip/src/java.base/unix/classes/sun/nio/fs/UnixCopyFile.java#l556&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
This means that the provider only checks for the destination file&amp;#39;s existence; however, it fails to check _beforehand_ that the source path from which to copy is readable at all.&lt;br/&gt;
&lt;br/&gt;
Note that here both the source and destination (the &amp;quot;victim&amp;quot; as I like to call it) are regular files; I have not checked the behavior in the following cases:&lt;br/&gt;
&lt;br/&gt;
* the source is a directory;&lt;br/&gt;
* the destination is an empty directory (though, from the code, it seems obvious that it will be rmdir()ed; however I fail to see what exception would be thrown if the directory were not empty).&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
ADDITIONAL REGRESSION INFORMATION: &lt;br/&gt;
Unsure; I have only stumbled upon this bug a few hours ago; however it is pretty critical.&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Just adapt the bug text to your own Unix system&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
The destination file is not deleted; or, if it is an empty directory, it is not removed&lt;br/&gt;
ACTUAL -&lt;br/&gt;
the destination file is removed&lt;br/&gt;
&lt;br/&gt;
ERROR MESSAGES/STACK TRACES THAT OCCUR :&lt;br/&gt;
The expected one, see bug report&lt;br/&gt;
&lt;br/&gt;
REPRODUCIBILITY :&lt;br/&gt;
This bug can be reproduced always.&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
See test case.&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
None...&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="4767892">JDK-8073061</key>
            <summary>(fs) Files.copy(foo, bar, REPLACE_EXISTING) deletes bar even if foo is not readable</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bpb">Brian Burkhalter</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Wed, 11 Feb 2015 15:44:37 -0800</created>
                <updated>Wed, 14 Aug 2024 06:05:34 -0700</updated>
                            <resolved>Tue, 26 Sep 2023 08:30:06 -0700</resolved>
                                    <version>8u25</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14697726" author="roboduke" created="Mon, 12 Aug 2024 16:00:51 -0700"  >[jdk21u-fix-request] Approval Request from Todd V. Jonker&lt;br/&gt;
Backport of data-loss defect in Files.copy(); originally authored by @bplb and reviewed by @AlanBateman&lt;br/&gt;
Passes headless tests tiers 1-3</comment>
                            <comment id="14697297" author="roboduke" created="Fri, 9 Aug 2024 13:08:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/863&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/863&lt;/a&gt;&lt;br/&gt;
Date: 2024-07-22 20:25:34 +0000</comment>
                            <comment id="14614120" author="dukebot" created="Tue, 26 Sep 2023 08:30:05 -0700"  >Changeset: 36ac8390&lt;br/&gt;
Author:    Brian Burkhalter &amp;lt;&lt;a href=&apos;mailto:bpb@openjdk.org&apos;&gt;bpb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-09-26 15:27:44 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/36ac83904c9e81a01822b0e36ef677cae2808709&quot;&gt;https://git.openjdk.org/jdk/commit/36ac83904c9e81a01822b0e36ef677cae2808709&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14607884" author="roboduke" created="Wed, 30 Aug 2023 17:24:42 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15501&quot;&gt;https://git.openjdk.org/jdk/pull/15501&lt;/a&gt;&lt;br/&gt;
Date: 2023-08-31 00:18:22 +0000</comment>
                            <comment id="14536679" author="alanb" created="Fri, 11 Nov 2022 08:37:46 -0800"  >For the regular file case, the issue here is that it deletes the target file when it should instead attempt to open the target with O_TRUNC after it has opened the source file. There was some good discussion about this in 2015. One point about that discussion is that there are many scenarios to consider when REPLACE_EXISTING is specified.</comment>
                            <comment id="14534949" author="bpb" created="Fri, 4 Nov 2022 11:17:31 -0700"  >Anomalous behavior verified on macOS 12.6 Monterey and Ubuntu Linux 22.04 LTS.</comment>
                            <comment id="13610567" author="bpb" created="Tue, 17 Feb 2015 16:57:08 -0800"  >RFC thread: &lt;a href=&quot;http://mail.openjdk.java.net/pipermail/nio-dev/2015-February/003030.html&quot;&gt;http://mail.openjdk.java.net/pipermail/nio-dev/2015-February/003030.html&lt;/a&gt;</comment>
                            <comment id="13609536" author="bpb" created="Fri, 13 Feb 2015 12:22:26 -0800"  >Verified also on 32-bit Linux (Ubuntu 12.04 x86).&lt;br/&gt;
&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.nio.file.AccessDeniedException: a&lt;br/&gt;
	at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)&lt;br/&gt;
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)&lt;br/&gt;
	at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)&lt;br/&gt;
	at sun.nio.fs.UnixCopyFile.copyFile(UnixCopyFile.java:230)&lt;br/&gt;
	at sun.nio.fs.UnixCopyFile.copy(UnixCopyFile.java:581)&lt;br/&gt;
	at sun.nio.fs.UnixFileSystemProvider.copy(UnixFileSystemProvider.java:253)&lt;br/&gt;
	at java.nio.file.Files.copy(Files.java:1274)&lt;br/&gt;
	at Test.main(Test.java:15)&lt;br/&gt;
</comment>
                            <comment id="13608992" author="alanb" created="Thu, 12 Feb 2015 06:26:07 -0800"  >An oversight and corner case missed in the original implementation, it would of course be better to have it fail if the source is not readable.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5136799">JDK-8338391</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5111280">JDK-8317128</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    <customfieldvalue key="17048"><![CDATA[linux_ubuntu]]></customfieldvalue>
    <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ch93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17417"><![CDATA[b17]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="228"><![CDATA[java.nio]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>