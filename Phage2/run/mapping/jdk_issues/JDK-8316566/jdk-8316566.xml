<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:23:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8316566] RISC-V: Zero extended narrow oop passed to Atomic::cmpxchg</title>
                <link>https://bugs.openjdk.org/browse/JDK-8316566</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Rv64 ABI says all 32-bit types must be sign extended when in a integer registers.&lt;br/&gt;
When loading the to be exchanged narrow oop with load reserved word it automatically sign extends it.&lt;br/&gt;
The branch not equal instruction always compares the full register (64-bit), if the compare narrow oop is not sign extended it fails.&lt;br/&gt;
(even if the 4 byte narrow oops are identical)&lt;br/&gt;
&lt;br/&gt;
We have only seen this issue with Shenandoah and gcc 10/11.&lt;br/&gt;
Modified tests:&lt;br/&gt;
FAILED: gc/shenandoah/compiler/TestReferenceCAS.java#C1&lt;br/&gt;
FAILED: gc/shenandoah/compiler/TestReferenceCAS.java#C1-2&lt;br/&gt;
FAILED: gc/shenandoah/compiler/TestReferenceCAS.java#C2&lt;br/&gt;
FAILED: gc/shenandoah/compiler/TestReferenceCAS.java#FULL&lt;br/&gt;
FAILED: gc/shenandoah/compiler/TestReferenceCAS.java#Xint&lt;br/&gt;
Passed: gc/shenandoah/compiler/TestReferenceCAS.java#Xint-G1&lt;br/&gt;
&lt;br/&gt;
Since we fail with Xint only the issue seems to be with Unsafe_CompareAndExchangeReference.&lt;br/&gt;
&lt;br/&gt;
A bigger about this is that there may be more places where we don&amp;#39;t notice this, but can result in very unexpected behavior as any branch compare may fail.&lt;br/&gt;
&lt;br/&gt;
The issue is not reproduce with gcc 12/13.&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5110644">JDK-8316566</key>
            <summary>RISC-V: Zero extended narrow oop passed to Atomic::cmpxchg</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rehn">Robbin Ehn</assignee>
                                    <reporter username="rehn">Robbin Ehn</reporter>
                        <labels>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oraclejdk-na</label>
                    </labels>
                <created>Tue, 19 Sep 2023 23:27:28 -0700</created>
                <updated>Fri, 12 Jan 2024 07:57:59 -0800</updated>
                            <resolved>Wed, 27 Sep 2023 22:50:04 -0700</resolved>
                                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14616624" author="roboduke" created="Sun, 8 Oct 2023 21:50:45 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1858&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1858&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-09 04:42:27 +0000</comment>
                            <comment id="14616623" author="rehn" created="Sun, 8 Oct 2023 21:34:51 -0700"  >Yes, thanks, my bad!</comment>
                            <comment id="14616600" author="goetz" created="Sun, 8 Oct 2023 06:17:02 -0700"  >[~rehn], I backouted this, see &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8317700&quot; title=&quot;[17u] Undo backport 8317674 of 8316566 which was pushed to wrong repo.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8317700&quot;&gt;&lt;strike&gt;JDK-8317700&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
It was only approved for jdk17u-dev. If you want to push to jdk17u, you need to file a jdk17u-critical-request. But jdk17u was closed anyways, see also the timetable in &lt;a href=&quot;https://wiki.openjdk.org/display/JDKUpdates/JDK+17u&quot;&gt;https://wiki.openjdk.org/display/JDKUpdates/JDK+17u&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Please backport this to jdk17u-dev. I remove the labels in the meantime.&lt;br/&gt;
&lt;br/&gt;
Thanks for catching this, Fei and Andrew.</comment>
                            <comment id="14616590" author="andrew" created="Sat, 7 Oct 2023 14:14:59 -0700"  >It shouldn&amp;#39;t have been pushed to 17u at all. We are frozen for release.</comment>
                            <comment id="14616577" author="fyang" created="Sat, 7 Oct 2023 00:18:56 -0700"  >[~rehn] Since this is a P4 bug, I think this should be backported to repo jdk17u-dev instead of jdk17u?</comment>
                            <comment id="14615745" author="roboduke" created="Wed, 4 Oct 2023 01:33:57 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u/pull/381&quot;&gt;https://git.openjdk.org/jdk17u/pull/381&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-04 08:23:43 +0000</comment>
                            <comment id="14615736" author="rehn" created="Wed, 4 Oct 2023 01:15:39 -0700"  >AFAIK there is no requirement for a backport PR to be open before the request.&lt;br/&gt;
Where is that documented? (I did not have an PR for 21u before hand either)&lt;br/&gt;
&lt;br/&gt;
Requested again.</comment>
                            <comment id="14615598" author="goetz" created="Tue, 3 Oct 2023 12:37:17 -0700"  >[17u]&lt;br/&gt;
There is no PR with a backport for 17. Removing the fix-request tag for now.</comment>
                            <comment id="14614716" author="roboduke" created="Thu, 28 Sep 2023 07:25:34 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/210&quot;&gt;https://git.openjdk.org/jdk21u/pull/210&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-28 14:17:04 +0000</comment>
                            <comment id="14614632" author="rehn" created="Thu, 28 Sep 2023 03:19:52 -0700"  >gcc issue reported here: &lt;a href=&quot;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=111623&quot;&gt;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=111623&lt;/a&gt;</comment>
                            <comment id="14614570" author="rehn" created="Wed, 27 Sep 2023 23:03:49 -0700"  >Fix Request (21u/17u)&lt;br/&gt;
&lt;br/&gt;
This fix changes how we generate the full memory barrier to avoid the compiler bug.&lt;br/&gt;
Any code change could materialize this bug anywhere we use the full memory barrier.&lt;br/&gt;
Pro-actively backporting this to avoid future issues (and fix potentially not reported bugs).&lt;br/&gt;
Should apply clean (not tested yet, but it is a one-liner).&lt;br/&gt;
&lt;br/&gt;
</comment>
                            <comment id="14614568" author="dukebot" created="Wed, 27 Sep 2023 22:50:03 -0700"  >Changeset: 2d154fcd&lt;br/&gt;
Author:    Robbin Ehn &amp;lt;&lt;a href=&apos;mailto:rehn@openjdk.org&apos;&gt;rehn@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-09-28 05:47:33 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/2d154fcd0de0612f58abbc5027f409b9b2eb0dc2&quot;&gt;https://git.openjdk.org/jdk/commit/2d154fcd0de0612f58abbc5027f409b9b2eb0dc2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14614047" author="roboduke" created="Tue, 26 Sep 2023 04:39:27 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15917&quot;&gt;https://git.openjdk.org/jdk/pull/15917&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-26 11:31:58 +0000</comment>
                            <comment id="14614040" author="rehn" created="Tue, 26 Sep 2023 03:49:06 -0700"  >It&amp;#39;s __synch_synchronize() that is misbehaving.</comment>
                            <comment id="14613991" author="rehn" created="Tue, 26 Sep 2023 01:03:10 -0700"  >Most likely a compiler bug.</comment>
                            <comment id="14613989" author="rehn" created="Tue, 26 Sep 2023 01:01:26 -0700"  >gcc 12 ref:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f651c &amp;lt;+138&amp;gt;:   ld      a4,0(a6)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6520 &amp;lt;+142&amp;gt;:   lw      a3,8(a6)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6524 &amp;lt;+146&amp;gt;:   fence&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6528 &amp;lt;+150&amp;gt;:   sub     a4,s2,a4&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f652c &amp;lt;+154&amp;gt;:   srl     a4,a4,a3&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6530 &amp;lt;+158&amp;gt;:   sext.w  a4,a4&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6532 &amp;lt;+160&amp;gt;:   lr.w    a7,(s3)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6536 &amp;lt;+164&amp;gt;:   bne     a7,a4,0x40034f6540 &amp;lt;_ZN14AccessInternal19PostRuntimeDispatchIN20ShenandoahBarrierSet13AccessBarrierILm402470ES1_EELNS_11BarrierTypeE5ELm402470EE18oop_access_barrierEP7oopDesclS7_S7_+174&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f653a &amp;lt;+168&amp;gt;:   sc.w    a3,a5,(s3)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f653e &amp;lt;+172&amp;gt;:   bnez    a3,0x40034f6532 &amp;lt;_ZN14AccessInternal19PostRuntimeDispatchIN20ShenandoahBarrierSet13AccessBarrierILm402470ES1_EELNS_11BarrierTypeE5ELm402470EE18oop_access_barrierEP7oopDesclS7_S7_+160&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6540 &amp;lt;+174&amp;gt;:   sext.w  a5,a7&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f6544 &amp;lt;+178&amp;gt;:   fence&lt;br/&gt;
</comment>
                            <comment id="14613967" author="rehn" created="Tue, 26 Sep 2023 00:08:01 -0700"  >&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f089a &amp;lt;+94&amp;gt;:    ld      a4,0(a1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f089c &amp;lt;+96&amp;gt;:    lw      a2,8(a1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f089e &amp;lt;+98&amp;gt;:    fence   0x00000040034f089e &amp;lt;+98&amp;gt;:    fence&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08a2 &amp;lt;+102&amp;gt;:   sub     a5,s6,a4&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08a6 &amp;lt;+106&amp;gt;:   srl     a5,a5,a2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08aa &amp;lt;+110&amp;gt;:   sext.w  a5,a5&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08ac &amp;lt;+112&amp;gt;:   beqz    s1,0x40034f0a0c &amp;lt;_ZN14AccessInternal19PostRuntimeDispatchIN20ShenandoahBarrierSet13AccessBarrierILm402470ES1_EELNS_11BarrierTypeE5ELm402470EE18oop_access_barrierEP7oopDesclS7_S7_+464&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08b0 &amp;lt;+116&amp;gt;:   sub     a4,s1,a4&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08b4 &amp;lt;+120&amp;gt;:   srl     a4,a4,a2&lt;br/&gt;
=&amp;gt; 0x00000040034f08b8 &amp;lt;+124&amp;gt;:   lr.w    a2,(s2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08bc &amp;lt;+128&amp;gt;:   bne     a2,a4,0x40034f08c6 &amp;lt;_ZN14AccessInternal19PostRuntimeDispatchIN20ShenandoahBarrierSet13AccessBarrierILm402470ES1_EELNS_11BarrierTypeE5ELm402470EE18oop_access_barrierEP7oopDesclS7_S7_+138&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08c0 &amp;lt;+132&amp;gt;:   sc.w    a0,a5,(s2)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08c4 &amp;lt;+136&amp;gt;:   bnez    a0,0x40034f08b8 &amp;lt;_ZN14AccessInternal19PostRuntimeDispatchIN20ShenandoahBarrierSet13AccessBarrierILm402470ES1_EELNS_11BarrierTypeE5ELm402470EE18oop_access_barrierEP7oopDesclS7_S7_+124&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08c6 &amp;lt;+138&amp;gt;:   sext.w  a5,a2&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;0x00000040034f08ca &amp;lt;+142&amp;gt;:   fence&lt;br/&gt;
&lt;br/&gt;
a4 is 0xfff80425, zero extended. Very suspect with that branch moved into the critical section.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5111692">JDK-8317487</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5111899">JDK-8317674</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5111982">JDK-8317739</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="5110209">JDK-8316186</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="20300"><![CDATA[riscv]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i336i3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17354"><![CDATA[b18]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>