<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:46:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8325382] (fc) FileChannel.transferTo throws IOException when position equals size</title>
                <link>https://bugs.openjdk.org/browse/JDK-8325382</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ADDITIONAL SYSTEM INFORMATION :&lt;br/&gt;
JRE 21.0.2+13&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
The Javadoc states, &amp;quot;If the given position is greater than or equal to the file&amp;#39;s current size then no bytes are transferred.&amp;quot; The below exception happens when the position equals the current size.&lt;br/&gt;
&lt;br/&gt;
IOException: Channel not open for writing - cannot extend file to required size&lt;br/&gt;
	at java.base/sun.nio.ch.FileChannelImpl.mapInternal(FileChannelImpl.java:1282)&lt;br/&gt;
	at java.base/sun.nio.ch.FileChannelImpl.map(FileChannelImpl.java:1183)&lt;br/&gt;
	at java.base/sun.nio.ch.FileChannelImpl.transferToTrustedChannel(FileChannelImpl.java:676)&lt;br/&gt;
	at java.base/sun.nio.ch.FileChannelImpl.transferTo(FileChannelImpl.java:782)&lt;br/&gt;
&lt;br/&gt;
REGRESSION : Last worked in version 17.0.10&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
1. Create a file of any length&lt;br/&gt;
2. Attempt to copy bytes from that file to another file using FileChannel transferTo where:&lt;br/&gt;
* position is equal to the size of the original file&lt;br/&gt;
* count is greater than MAPPED_TRANSFER_SIZE of 16384&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
No exception. No bytes are transferred as stated in the Javadoc.&lt;br/&gt;
ACTUAL -&lt;br/&gt;
IOException: Channel not open for writing - cannot extend file to required size&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
@Test&lt;br/&gt;
public void test() throws Exception {&lt;br/&gt;
	final Path parent = tempFolder.toPath();&lt;br/&gt;
	final File original = parent.resolve(&amp;quot;original&amp;quot;).toFile();&lt;br/&gt;
	try (PrintWriter out = new PrintWriter(original)) {&lt;br/&gt;
		out.println(&amp;quot;test&amp;quot;);&lt;br/&gt;
	}&lt;br/&gt;
	final File copy = parent.resolve(&amp;quot;copy&amp;quot;).toFile();&lt;br/&gt;
	try (FileInputStream in = new FileInputStream(original);&lt;br/&gt;
			FileOutputStream out = new FileOutputStream(copy);&lt;br/&gt;
			FileChannel inChannel = in.getChannel();&lt;br/&gt;
			FileChannel outChannel = out.getChannel()) {&lt;br/&gt;
		inChannel.transferTo(original.length(), 16385, outChannel);&lt;br/&gt;
	}&lt;br/&gt;
}&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Avoid calling FileChannel transferTo with a position equal to the size of the channel. The call is unnecessary but breaks code that is implemented in accordance to the Javadoc.&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5120747">JDK-8325382</key>
            <summary>(fc) FileChannel.transferTo throws IOException when position equals size</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bpb">Brian Burkhalter</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>additional-information-received</label>
                            <label>amazon-interest</label>
                            <label>dcsaw</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>regression</label>
                            <label>webbug</label>
                    </labels>
                <created>Mon, 5 Feb 2024 11:20:45 -0800</created>
                <updated>Mon, 8 Jul 2024 10:25:44 -0700</updated>
                            <resolved>Tue, 13 Feb 2024 07:54:23 -0800</resolved>
                                    <version>20</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>23</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14677964" author="roboduke" created="Sat, 1 Jun 2024 02:01:11 -0700"  >[jdk21u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 21.0.5-oracle. Applies almost cleanly and tier 1-4 have passed.</comment>
                            <comment id="14677856" author="roboduke" created="Fri, 31 May 2024 08:37:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/631&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/631&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-31 15:31:28 +0000</comment>
                            <comment id="14648786" author="dukebot" created="Tue, 13 Feb 2024 07:54:22 -0800"  >Changeset: 6b7c9718&lt;br/&gt;
Author:    Brian Burkhalter &amp;lt;&lt;a href=&apos;mailto:bpb@openjdk.org&apos;&gt;bpb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-02-13 15:53:29 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/6b7c9718d68f30f47a163042d6e205945b9ff365&quot;&gt;https://git.openjdk.org/jdk/commit/6b7c9718d68f30f47a163042d6e205945b9ff365&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14648040" author="roboduke" created="Fri, 9 Feb 2024 11:58:56 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/17796&quot;&gt;https://git.openjdk.org/jdk/pull/17796&lt;/a&gt;&lt;br/&gt;
Date: 2024-02-09 19:55:15 +0000</comment>
                            <comment id="14647798" author="bpb" created="Thu, 8 Feb 2024 15:18:25 -0800"  >Reproducer fails on macOS and Windows but succeeds on Ubuntu 22.04.</comment>
                            <comment id="14647498" author="bpb" created="Wed, 7 Feb 2024 13:27:25 -0800"  >Incorrect clamping is being performed at line 866:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (remaining &amp;gt; 0 &amp;amp;&amp;amp; remaining &amp;lt; count)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;count = remaining;&lt;br/&gt;
&lt;br/&gt;
The greater than inequality should be greater than or equal to, i.e., remaining should be non-negative, not positive. This predates the changes made for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8293331&quot; title=&quot;Refactor FileDispatcherImpl into operating system-specific components&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8293331&quot;&gt;&lt;strike&gt;JDK-8293331&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14647467" author="bpb" created="Wed, 7 Feb 2024 11:16:27 -0800"  >Definitely does not occur for JDK 19 and older.</comment>
                            <comment id="14647224" author="alanb" created="Tue, 6 Feb 2024 23:04:16 -0800"  >I suspect this corner case crept in with the refactoring in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8293331&quot; title=&quot;Refactor FileDispatcherImpl into operating system-specific components&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8293331&quot;&gt;&lt;strike&gt;JDK-8293331&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14647217" author="tongwan" created="Tue, 6 Feb 2024 22:44:04 -0800"  >The observations on Ubuntu:&lt;br/&gt;
JDK 21: Passed.&lt;br/&gt;
On Windows 11:&lt;br/&gt;
JDK 20+16: Passed.&lt;br/&gt;
JDK 20+17: Failed, IOException thrown.&lt;br/&gt;
JDK 21: Failed.&lt;br/&gt;
JDK 22ea+16: Failed.&lt;br/&gt;
</comment>
                            <comment id="14647182" author="tongwan" created="Tue, 6 Feb 2024 19:42:58 -0800"  >Additional information from the submitter:&lt;br/&gt;
import java.io.File;&lt;br/&gt;
import java.io.FileInputStream;&lt;br/&gt;
import java.io.FileOutputStream;&lt;br/&gt;
import java.io.PrintWriter;&lt;br/&gt;
import java.nio.channels.FileChannel;&lt;br/&gt;
import java.nio.file.Path;&lt;br/&gt;
&lt;br/&gt;
public class Main {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;public static void main(String[] args) throws Exception {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final Path parent = Path.of(&amp;quot;.&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final File original = parent.resolve(&amp;quot;original&amp;quot;).toFile();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try (PrintWriter out = new PrintWriter(original)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;out.println(&amp;quot;test&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;final File copy = parent.resolve(&amp;quot;copy&amp;quot;).toFile();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try (&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FileInputStream in = new FileInputStream(original);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FileOutputStream out = new FileOutputStream(copy);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FileChannel inChannel = in.getChannel();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FileChannel outChannel = out.getChannel()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;inChannel.transferTo(original.length(), 16385, outChannel);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
</comment>
                            <comment id="14646902" author="tongwan" created="Mon, 5 Feb 2024 23:17:54 -0800"  >Requested a complete reproducer from the submitter.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5128206">JDK-8331294</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5128364">JDK-8331426</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130871">JDK-8333414</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="108180" name="Main.java" size="890" author="tongwan" created="Tue, 6 Feb 2024 22:48:06 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22023">20</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    <customfieldvalue key="17005"><![CDATA[windows]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34vg3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17338"><![CDATA[b10]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="228"><![CDATA[java.nio]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>