<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 16:21:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8301491] C2: java.lang.StringUTF16::indexOfChar intrinsic called with negative character argument</title>
                <link>https://bugs.openjdk.org/browse/JDK-8301491</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Please excuse for a messy fuzzing test.&lt;br/&gt;
&lt;br/&gt;
The test code is attached, along with escaped UTF-8 sample outputs.&lt;br/&gt;
The interpreted code was executed like this:&lt;br/&gt;
&lt;br/&gt;
${JAVA_HOME}/bin/java -XX:-PrintWarnings -Xint -Dstdout.encoding=UTF-8 Test_245&lt;br/&gt;
&lt;br/&gt;
...while for compiled I used the following:&lt;br/&gt;
&lt;br/&gt;
${JAVA_HOME}/bin/java -XX:-PrintWarnings -Xcomp -XX:+UnlockDiagnosticVMOptions -XX:+IgnoreUnrecognizedVMOptions -XX:StressSeed=2110910222 -XX:+StressIGVN -XX:+StressCCP -XX:+StressGCM -XX:+StressLCM -XX:-TieredCompilation -Xbatch -Dstdout.encoding=UTF-8 Test_245&lt;br/&gt;
&lt;br/&gt;
The bug was reproduced against the OpenJDK version from 2023-01-29, with the following git HEAD:&lt;br/&gt;
6475501a012</description>
                <environment></environment>
        <key id="5092964">JDK-8301491</key>
            <summary>C2: java.lang.StringUTF16::indexOfChar intrinsic called with negative character argument</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dfenacci">Damon Fenacci</assignee>
                                    <reporter username="enikitin">Evgeny Nikitin</reporter>
                        <labels>
                            <label>c2</label>
                            <label>fuzzgen</label>
                            <label>intrinsic</label>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk20u-fix-SQE-ok-next</label>
                            <label>jdk20u-fix-request</label>
                            <label>jdk20u-fix-yes</label>
                            <label>oracle-triage-21</label>
                    </labels>
                <created>Tue, 31 Jan 2023 03:07:54 -0800</created>
                <updated>Mon, 5 Jun 2023 09:37:29 -0700</updated>
                            <resolved>Fri, 17 Feb 2023 01:11:50 -0800</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>19</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14586696" author="roboduke" created="Fri, 2 Jun 2023 09:02:40 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/1927&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/1927&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-02 15:56:24 +0000</comment>
                            <comment id="14586695" author="goetz" created="Fri, 2 Jun 2023 08:58:56 -0700"  >&lt;br/&gt;
Fix request [11u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 11.0.20-oracle.&lt;br/&gt;
A rather simple change, but with the typical C2 risk. Clear repro-case. &lt;br/&gt;
I had to do simple resolves.&lt;br/&gt;
Test passes but also passes without the fix. SAP nightly testing passed.</comment>
                            <comment id="14577026" author="roboduke" created="Wed, 26 Apr 2023 07:04:42 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1299&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1299&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-26 13:59:30 +0000</comment>
                            <comment id="14577024" author="goetz" created="Wed, 26 Apr 2023 06:59:07 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.8-oracle.&lt;br/&gt;
A rather simple change, but with the typical C2 risk. Clear repro-case.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes and fails without the fix. SAP nightly testing passed.</comment>
                            <comment id="14570383" author="roboduke" created="Wed, 29 Mar 2023 04:55:06 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk20u/pull/42&quot;&gt;https://git.openjdk.org/jdk20u/pull/42&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-29 11:47:21 +0000</comment>
                            <comment id="14570374" author="thartmann" created="Wed, 29 Mar 2023 04:47:54 -0700"  >Fix Request (JDK 20u)&lt;br/&gt;
Resolves an issue with incorrect execution of C2 compiled code. The fix is low risk, was already backported to Oracle JDK 17u / 11u and tested in the JDK 21 and 17u / 11u CIs. The backport applies cleanly.</comment>
                            <comment id="14560915" author="dukebot" created="Fri, 17 Feb 2023 01:11:49 -0800"  >Changeset: 47ca5773&lt;br/&gt;
Author:    Damon Fenacci &amp;lt;&lt;a href=&apos;mailto:damon.fenacci@oracle.com&apos;&gt;damon.fenacci@oracle.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Tobias Hartmann &amp;lt;&lt;a href=&apos;mailto:thartmann@openjdk.org&apos;&gt;thartmann@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-17 09:10:20 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/47ca5773a54743244a9b28f877246d260b90a408&quot;&gt;https://git.openjdk.org/jdk/commit/47ca5773a54743244a9b28f877246d260b90a408&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14560569" author="roboduke" created="Thu, 16 Feb 2023 00:02:36 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12538&quot;&gt;https://git.openjdk.org/jdk/pull/12538&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-13 16:17:50 +0000</comment>
                            <comment id="14559419" author="JIRAUSER20518" created="Mon, 13 Feb 2023 01:14:00 -0800"  >The base issue seems to be the fact that java.lang.StringUTF16::indexOfChar is called for characters with int value &amp;lt; 0 but the intrinsified functions C2_MacroAssembler::string_indexof_char create code that expects the input character to be &amp;gt;= 0 (tested for x64/avx2 and aarch64).</comment>
                            <comment id="14556502" author="thartmann" created="Wed, 1 Feb 2023 03:05:51 -0800"  >This is most likely a regression from Compact Strings (&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8054307&quot; title=&quot;JEP 254: Compact Strings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8054307&quot;&gt;&lt;strike&gt;JDK-8054307&lt;/strike&gt;&lt;/a&gt;) in JDK 9.</comment>
                            <comment id="14556290" author="chagedorn" created="Tue, 31 Jan 2023 10:01:50 -0800"  >I&amp;#39;ve attached a reduced test case Reduced.java:&lt;br/&gt;
&lt;br/&gt;
$ java -Xint Reduced.java &amp;gt; int.log&lt;br/&gt;
$ java  -XX:CompileCommand=quiet -XX:CompileCommand=compileonly,java.lang.StringUTF*::* -Xcomp -XX:+StressIGVN -XX:-TieredCompilation -XX:StressSeed=2110910222 Reduced.java &amp;gt; c2.log&lt;br/&gt;
$ diff int.log c2.log&lt;br/&gt;
&lt;br/&gt;
Output of diff:&lt;br/&gt;
1c1&lt;br/&gt;
&amp;lt; int = -1&lt;br/&gt;
---&lt;br/&gt;
&amp;gt; int = 7&lt;br/&gt;
&lt;br/&gt;
It looks like there is a problem with the java.lang.StringUTF16::indexOfChar C2 intrinsic with negative numbers close to Integer.MIN_VALUE.</comment>
                            <comment id="14556260" author="chagedorn" created="Tue, 31 Jan 2023 08:24:24 -0800"  >ILW = Wrong execution of C2 compiled code, single fuzzgen test, -XX:DisableIntrinsic=_indexOfU_char = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5097345">JDK-8305126</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5097360">JDK-8305141</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5097859">JDK-8305554</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5099615">JDK-8306993</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5099657">JDK-8307033</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5102537">JDK-8309488</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102508" name="Reduced.java" size="378" author="chagedorn" created="Thu, 2 Feb 2023 01:47:14 -0800"/>
                            <attachment id="102467" name="Test_245.java" size="53725" author="enikitin" created="Tue, 31 Jan 2023 03:07:17 -0800"/>
                            <attachment id="102469" name="Test_245.xcomp.out" size="875583" author="enikitin" created="Tue, 31 Jan 2023 03:07:18 -0800"/>
                            <attachment id="102468" name="Test_245.xint.out" size="875582" author="enikitin" created="Tue, 31 Jan 2023 03:07:18 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i306f7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>