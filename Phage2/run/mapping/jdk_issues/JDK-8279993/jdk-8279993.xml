<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:50:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8279993] Assert that a shared class is not loaded more than once</title>
                <link>https://bugs.openjdk.org/browse/JDK-8279993</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Currently, a shared InstanceKlass can be loaded (from the CDS archive) at most once. Inside load_shared_class(), many internal states of the InstanceKlass are restored. We will run into problems if&lt;br/&gt;
&lt;br/&gt;
- two threads try to concurrently call load_shared_class on the same InstanceKlass. They will race in restoring the internal states&lt;br/&gt;
- We try to load the InstanceKlass and it fails due to OutOfMemoryError. If we try to load it again, the restoring code may fail because the class is in an inconsistent state.&lt;br/&gt;
&lt;br/&gt;
There&amp;#39;s already code in the SystemDictionary to avoid loading the same shared class twice. E.g.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/b062b1bd8126610d9288dc179d69e54a40b81015/src/hotspot/share/classfile/systemDictionary.cpp#L646-L652&quot;&gt;https://github.com/openjdk/jdk/blob/b062b1bd8126610d9288dc179d69e54a40b81015/src/hotspot/share/classfile/systemDictionary.cpp#L646-L652&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
- The boot loader uses the placeholder table to allow a single thread to load a class/classloader pair.&lt;br/&gt;
- The platform/app loaders are parallelCapable. They use a per-class lock to allow a single thread to come to here for each class_name&lt;br/&gt;
&lt;br/&gt;
This RFE adds asserts to make sure that the above logic indeed works.&lt;br/&gt;
&lt;br/&gt;
Proposed solution:&lt;br/&gt;
&lt;br/&gt;
- add a debug-only field InstanceKlass::_shared_class_load_count&lt;br/&gt;
- At the beginning of load_shared_class, increment this field by one&lt;br/&gt;
- Assert if the new value is not 1&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5066249">JDK-8279993</key>
            <summary>Assert that a shared class is not loaded more than once</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ccheung">Calvin Cheung</assignee>
                                    <reporter username="iklam">Ioi Lam</reporter>
                        <labels>
                            <label>cds</label>
                    </labels>
                <created>Thu, 13 Jan 2022 15:10:45 -0800</created>
                <updated>Wed, 24 May 2023 23:09:52 -0700</updated>
                            <resolved>Thu, 18 May 2023 09:05:21 -0700</resolved>
                                    <version>19</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14582649" author="dukebot" created="Thu, 18 May 2023 09:05:20 -0700"  >Changeset: bb24c367&lt;br/&gt;
Author:    Calvin Cheung &amp;lt;&lt;a href=&apos;mailto:ccheung@openjdk.org&apos;&gt;ccheung@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-18 16:02:55 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/bb24c36759f19448c8539f6b11017753f304bb56&quot;&gt;https://git.openjdk.org/jdk/commit/bb24c36759f19448c8539f6b11017753f304bb56&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14582038" author="roboduke" created="Tue, 16 May 2023 15:14:57 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14023&quot;&gt;https://git.openjdk.org/jdk/pull/14023&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-16 22:03:18 +0000</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vntn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17436"><![CDATA[b24]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>