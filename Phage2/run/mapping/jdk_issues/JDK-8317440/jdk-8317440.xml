<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 11:42:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8317440] Lock rank checking fails when code root set is modified with the Servicelock held after JDK-8315503</title>
                <link>https://bugs.openjdk.org/browse/JDK-8317440</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>I ran tier7 testing with JDK 22 and hit this issue on Windows-x64:&lt;br/&gt;
&lt;br/&gt;
#  Internal Error (\\workspace\\open\\src\\hotspot\\share\\runtime\\mutex.cpp:448), pid=7148, tid=38704&lt;br/&gt;
#  assert(false) failed: Attempting to acquire lock ConcurrentHashTableResize_lock/nosafepoint-3 out of order with lock Service_lock/service -- possible deadlock&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (22.0) (fastdebug build 22-internal-2023-10-02-1945520.vladimir.kozlov.jdkgit)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 22-internal-2023-10-02-1945520.vladimir.kozlov.jdkgit, compiled mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, windows-amd64)&lt;br/&gt;
&lt;br/&gt;
It could be caused by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8315503&quot; title=&quot;G1: Code root scan causes long GC pauses due to imbalanced iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8315503&quot;&gt;&lt;strike&gt;JDK-8315503&lt;/strike&gt;&lt;/a&gt;.</description>
                <environment></environment>
        <key id="5111641">JDK-8317440</key>
            <summary>Lock rank checking fails when code root set is modified with the Servicelock held after JDK-8315503</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tschatzl">Thomas Schatzl</assignee>
                                    <reporter username="kvn">Vladimir Kozlov</reporter>
                        <labels>
                            <label>gc-g1</label>
                            <label>gc-pending-review</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>noreg-hard</label>
                            <label>tier5</label>
                            <label>tier6</label>
                            <label>tier7</label>
                            <label>tier8</label>
                    </labels>
                <created>Tue, 3 Oct 2023 09:24:49 -0700</created>
                <updated>Fri, 19 Apr 2024 03:21:21 -0700</updated>
                            <resolved>Mon, 9 Oct 2023 01:30:12 -0700</resolved>
                                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14664243" author="roboduke" created="Tue, 9 Apr 2024 23:13:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/476&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/476&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-08 20:00:14 +0000</comment>
                            <comment id="14663725" author="goetz" created="Mon, 8 Apr 2024 13:40:40 -0700"  >Fix request [21u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 21.0.4-oracle.&lt;br/&gt;
Required follow-up of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8315503&quot; title=&quot;G1: Code root scan causes long GC pauses due to imbalanced iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8315503&quot;&gt;&lt;strike&gt;JDK-8315503&lt;/strike&gt;&lt;/a&gt; and included in that backport.&lt;br/&gt;
Clean backport. </comment>
                            <comment id="14640794" author="coleenp" created="Tue, 16 Jan 2024 13:20:50 -0800"  >[~tschatzl] Is there a command line with options that can reproduce this problem?</comment>
                            <comment id="14616745" author="dcubed" created="Mon, 9 Oct 2023 08:18:05 -0700"  >The fix for this bug is integrated in jdk-22+19-1444.</comment>
                            <comment id="14616658" author="dukebot" created="Mon, 9 Oct 2023 01:30:11 -0700"  >Changeset: 0cf1a558&lt;br/&gt;
Author:    Thomas Schatzl &amp;lt;&lt;a href=&apos;mailto:tschatzl@openjdk.org&apos;&gt;tschatzl@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-10-09 08:27:56 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/0cf1a558bacf18d9fc41e43fb5e9eba39dc51f2e&quot;&gt;https://git.openjdk.org/jdk/commit/0cf1a558bacf18d9fc41e43fb5e9eba39dc51f2e&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14616410" author="roboduke" created="Fri, 6 Oct 2023 00:50:59 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/16062&quot;&gt;https://git.openjdk.org/jdk/pull/16062&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-05 17:19:35 +0000</comment>
                            <comment id="14615729" author="tschatzl" created="Wed, 4 Oct 2023 00:53:35 -0700"  >The reason is that registering an nmethod can take the CHT specific lock; this one is fixed to ConcurrentHashTableResize_lock/nosafepoint-3 which is larger (in numeric value) than Service_lock/service.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8315503&quot; title=&quot;G1: Code root scan causes long GC pauses due to imbalanced iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8315503&quot;&gt;&lt;strike&gt;JDK-8315503&lt;/strike&gt;&lt;/a&gt; changed the priorities of the CHT lock already due to similar problems with CodeCache_lock, but that proved insuffficient.&lt;br/&gt;
&lt;br/&gt;
There is no deadlock in product because the CHTs G1 uses are not locking anything themselves in any of the CHT supplied code.&lt;br/&gt;
&lt;br/&gt;
Edit: they can do that because the global synchronization can lock the ThreadSMR_lock. So the previous fix to just make the CHT locks a very low rank does not work (without also changing ThreadSMR_lock).</comment>
                            <comment id="14615543" author="kvn" created="Tue, 3 Oct 2023 09:28:15 -0700"  >Both test failed when run with -Xcomp:&lt;br/&gt;
&lt;br/&gt;
KitchenSink failed with additional flags: -Xcomp -ea -esa -XX:CompileThreshold=100 -XX:+UnlockExperimentalVMOptions -server -XX:+TieredCompilation -XX:+VerifyOops&lt;br/&gt;
&lt;br/&gt;
RunThese30M failed with additional flags: -Xcomp -ea -esa -XX:CompileThreshold=100 -XX:+UnlockExperimentalVMOptions -server -XX:-TieredCompilation -XX:-DoEscapeAnalysis</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5127365">JDK-8330653</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5126005">JDK-8329517</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                            <outwardlinks description="blocks">
                                                        </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5118871">JDK-8323685</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5112384">JDK-8318109</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5121005">JDK-8326092</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5109442">JDK-8315503</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="106661" name="hs_err_pid7148.log" size="156257" author="kvn" created="Tue, 3 Oct 2023 09:31:16 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33cnf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17414"><![CDATA[b19]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>