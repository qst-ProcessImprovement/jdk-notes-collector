<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:11:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303136] MemoryPoolMBean/isCollectionUsageThresholdExceeded/isexceeded005 failed with &quot;isCollectionUsageThresholdExceeded() returned true, while threshold = 1 and used = 0&quot;</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303136</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK21 CI:&lt;br/&gt;
&lt;br/&gt;
vmTestbase/nsk/monitoring/MemoryPoolMBean/isCollectionUsageThresholdExceeded/isexceeded005/TestDescription.java&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
#section:main&lt;br/&gt;
----------messages:(6/444)----------&lt;br/&gt;
command: main nsk.monitoring.MemoryPoolMBean.isCollectionUsageThresholdExceeded.isexceeded001 -testMode=proxy -MBeanServer=custom&lt;br/&gt;
reason: User specified action: run main/othervm nsk.monitoring.MemoryPoolMBean.isCollectionUsageThresholdExceeded.isexceeded001 -testMode=proxy -MBeanServer=custom &lt;br/&gt;
started: Thu Feb 23 14:54:03 UTC 2023&lt;br/&gt;
Mode: othervm [/othervm specified]&lt;br/&gt;
finished: Thu Feb 23 14:55:04 UTC 2023&lt;br/&gt;
elapsed time (seconds): 61.421&lt;br/&gt;
----------configuration:(0/0)----------&lt;br/&gt;
----------System.out:(55/2978)----------&lt;br/&gt;
MemoryMonitor   &amp;gt; Test mode:	access to MBean through proxy&lt;br/&gt;
MemoryMonitor   &amp;gt; MBeanServer:	CUSTOM&lt;br/&gt;
MemoryMonitor   &amp;gt; Memory:	heap	(This setting is used in lowmem* tests only)&lt;br/&gt;
MemoryMonitor   &amp;gt; Monitoring:	notification	(This setting is used in lowmem* tests only)&lt;br/&gt;
MemoryMonitor   &amp;gt; Threshold:	usage	(This setting is used in lowmem* tests only)&lt;br/&gt;
MemoryMonitor   &amp;gt; Timeout:	30	(This setting is used in lowmem* tests only)&lt;br/&gt;
0 pool CodeHeap &amp;#39;non-nmethods&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;does not support collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;UnsupportedOperationException is thrown&lt;br/&gt;
1 pool Metaspace&lt;br/&gt;
&amp;nbsp;&amp;nbsp;does not support collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;UnsupportedOperationException is thrown&lt;br/&gt;
2 pool CodeHeap &amp;#39;profiled nmethods&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;does not support collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;UnsupportedOperationException is thrown&lt;br/&gt;
3 pool PS Old Gen&lt;br/&gt;
&amp;nbsp;&amp;nbsp;supports collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;setting threshold 1 init = 268435456(262144K) used = 0(0K) committed = 0(0K) max = 716177408(699392K)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;threshold 1 is set, (used = 0, isExceeded = false)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;used value (0) did not cross the threshold value (1)&lt;br/&gt;
# ERROR: isCollectionUsageThresholdExceeded() returned true, while threshold = 1 and used = 0&lt;br/&gt;
The following stacktrace is for failure analysis.&lt;br/&gt;
nsk.share.TestFailure: isCollectionUsageThresholdExceeded() returned true, while threshold = 1 and used = 0&lt;br/&gt;
	at nsk.share.Log.logExceptionForFailureAnalysis(Log.java:432)&lt;br/&gt;
	at nsk.share.Log.complain(Log.java:403)&lt;br/&gt;
	at nsk.monitoring.MemoryPoolMBean.isCollectionUsageThresholdExceeded.isexceeded001.run(isexceeded001.java:144)&lt;br/&gt;
	at nsk.monitoring.MemoryPoolMBean.isCollectionUsageThresholdExceeded.isexceeded001.main(isexceeded001.java:37)&lt;br/&gt;
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
	at java.base/java.lang.reflect.Method.invoke(Method.java:578)&lt;br/&gt;
	at com.sun.javatest.regtest.agent.MainWrapper$MainThread.run(MainWrapper.java:125)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:1623)&lt;br/&gt;
4 pool Compressed Class Space&lt;br/&gt;
&amp;nbsp;&amp;nbsp;does not support collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;UnsupportedOperationException is thrown&lt;br/&gt;
5 pool PS Survivor Space&lt;br/&gt;
&amp;nbsp;&amp;nbsp;supports collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;setting threshold 1 init = 16777216(16384K) used = 0(0K) committed = 16777216(16384K) max = 16777216(16384K)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;threshold 1 is set, (used = 0, isExceeded = false)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;used value (0) did not cross the threshold value (1)&lt;br/&gt;
6 pool PS Eden Space&lt;br/&gt;
&amp;nbsp;&amp;nbsp;supports collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;setting threshold 1 init = 100663296(98304K) used = 0(0K) committed = 100663296(98304K) max = 324009984(316416K)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;threshold 1 is set, (used = 0, isExceeded = false)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;used value (0) did not cross the threshold value (1)&lt;br/&gt;
7 pool CodeHeap &amp;#39;non-profiled nmethods&amp;#39;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;does not support collection usage thresholds&lt;br/&gt;
&amp;nbsp;&amp;nbsp;UnsupportedOperationException is thrown&lt;br/&gt;
TEST FAILED&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
#&amp;gt;  &lt;br/&gt;
#&amp;gt;  SUMMARY: Following errors occured&lt;br/&gt;
#&amp;gt;      during test execution:&lt;br/&gt;
#&amp;gt;  &lt;br/&gt;
# ERROR: isCollectionUsageThresholdExceeded() returned true, while threshold = 1 and used = 0&lt;br/&gt;
----------System.err:(0/0)----------&lt;br/&gt;
----------rerun:(41/7238)*----------</description>
                <environment></environment>
        <key id="5094926">JDK-8303136</key>
            <summary>MemoryPoolMBean/isCollectionUsageThresholdExceeded/isexceeded005 failed with &quot;isCollectionUsageThresholdExceeded() returned true, while threshold = 1 and used = 0&quot;</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinw">Kevin Walls</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>intermittent</label>
                            <label>jdk17u-todo</label>
                            <label>noreg-self</label>
                            <label>tier8</label>
                    </labels>
                <created>Thu, 23 Feb 2023 14:16:29 -0800</created>
                <updated>Wed, 10 Sep 2025 11:51:04 -0700</updated>
                            <resolved>Wed, 8 Mar 2023 00:21:21 -0800</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-svc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                                                            <comments>
                            <comment id="14565241" author="dukebot" created="Wed, 8 Mar 2023 00:21:20 -0800"  >Changeset: afda8fbf&lt;br/&gt;
Author:    Kevin Walls &amp;lt;&lt;a href=&apos;mailto:kevinw@openjdk.org&apos;&gt;kevinw@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-08 08:20:27 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/afda8fbf0bcea18cbe741e9c693789ebe0c6c4c5&quot;&gt;https://git.openjdk.org/jdk/commit/afda8fbf0bcea18cbe741e9c693789ebe0c6c4c5&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14564051" author="roboduke" created="Thu, 2 Mar 2023 02:17:47 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12823&quot;&gt;https://git.openjdk.org/jdk/pull/12823&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-02 09:20:23 +0000</comment>
                            <comment id="14563802" author="kevinw" created="Wed, 1 Mar 2023 04:28:43 -0800"  >After the allocation, and testing isExceeded, we refresh &amp;quot;usage&amp;quot;, but don&amp;#39;t refresh &amp;quot;used&amp;quot;.&lt;br/&gt;
&lt;br/&gt;
In this failure, used &amp;lt; threshold because our allocation did not affect the PS Old Gen, but &lt;br/&gt;
then it immediately checks isCollectionThresholdExceeded and sees &amp;quot;true&amp;quot;.  &lt;br/&gt;
We previously logged: (used = 0, isExceeded = false)&lt;br/&gt;
..so this isExceeded=true must be a change.  But then we compare the old &amp;quot;used&amp;quot; value against threshold.&lt;br/&gt;
We see used &amp;lt; threshold and complain/fail.&lt;br/&gt;
We should refresh &amp;quot;used&amp;quot; before this check, if there has been a GC to promote objects into the old gen, &lt;br/&gt;
the used value should now be above the threshold and validate that the isExceeded value does not show a problem.&lt;br/&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5170045">JDK-8366964</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5170066">JDK-8366981</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5170167">JDK-8367074</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                                                <inwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5089129">JDK-8298302</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                                              <subtask id="5129044">JDK-8331950</subtask>
                                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17005"><![CDATA[windows]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30iiz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17339"><![CDATA[b13]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="194"><![CDATA[java.lang.management]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>