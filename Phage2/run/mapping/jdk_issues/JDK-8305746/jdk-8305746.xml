<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:25:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8305746] InitializeEncoding should cache Charset object instead of charset name</title>
                <link>https://bugs.openjdk.org/browse/JDK-8305746</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>In jni_util.c, InitializeEncoding takes the sun_jnu_encoding string, typically containing the system locale&amp;#39;s encoding, and uses NewStringUTF and NewGlobalRef to create a Java String object with the encoding&amp;#39;s name and assign a handle to it to the global variable jnuEncoding. The variable is then used in functions such as JNU_NewStringPlatform and JNU_GetStringPlatformChars for Java calls.&lt;br/&gt;
&lt;br/&gt;
Instead of storing a String object, it should look up the appropriate Charset object right away and store a handle to that, which would avoid a Charset lookup by name on each invocation, although there are fast fully-native code paths for common encodings. InitializeEncoding already calls Charset.isSupported which does such a lookup.&lt;br/&gt;
&lt;br/&gt;
Besides an optimization, this would be an important change for GraalVM Native Image. We support multiple VM instances (&amp;quot;isolates&amp;quot;) in one process at the same time (e.g. through calling JNI_CreateJavaVM several times) which share the data section, but not the Java object heap. Therefore, the handle in jnuEncoding refers to a String object in the first created VM instance which cannot be accessed by other VM instances. Charset objects, however, are preexisting objects in the native image, and if InitializeEncoding looked up and stored a handle to the Charset object, that handle could be used across VM instances. It is not our goal to support different encodings for different VM instances, only to be able to safely use the system locale&amp;#39;s encoding in multiple VM instances.&lt;br/&gt;
&lt;br/&gt;
I am happy to come up with and test a patch.</description>
                <environment></environment>
        <key id="5098094">JDK-8305746</key>
            <summary>InitializeEncoding should cache Charset object instead of charset name</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phofer">Peter Hofer</assignee>
                                    <reporter username="phofer">Peter Hofer</reporter>
                        <labels>
                            <label>noreg-cleanup</label>
                    </labels>
                <created>Fri, 7 Apr 2023 08:12:45 -0700</created>
                <updated>Fri, 13 Sep 2024 10:00:53 -0700</updated>
                            <resolved>Thu, 20 Apr 2023 09:13:17 -0700</resolved>
                                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14575450" author="dukebot" created="Thu, 20 Apr 2023 09:13:16 -0700"  >Changeset: 20b1d19d&lt;br/&gt;
Author:    Peter Hofer &amp;lt;&lt;a href=&apos;mailto:phofer@openjdk.org&apos;&gt;phofer@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Naoto Sato &amp;lt;&lt;a href=&apos;mailto:naoto@openjdk.org&apos;&gt;naoto@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-04-20 16:11:29 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/20b1d19d26a039b963590ca6f806f78a4a94c25f&quot;&gt;https://git.openjdk.org/jdk/commit/20b1d19d26a039b963590ca6f806f78a4a94c25f&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14574613" author="roboduke" created="Tue, 18 Apr 2023 04:10:16 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13499&quot;&gt;https://git.openjdk.org/jdk/pull/13499&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-17 17:47:04 +0000</comment>
                            <comment id="14573779" author="JIRAUSER20511" created="Fri, 14 Apr 2023 01:25:20 -0700"  >Thanks Ulf, but this seems to have a significantly larger scope. I already have a fairly small patch that I&amp;#39;m testing and will open a PR soon. Greetings from a neighboring country.</comment>
                            <comment id="14573635" author="ulfzibis" created="Thu, 13 Apr 2023 10:37:48 -0700"  >Another approach in the same direction: &lt;a href=&quot;https://bugs.java.com/bugdatabase/view_bug?bug_id=6862158&quot;&gt;https://bugs.java.com/bugdatabase/view_bug?bug_id=6862158&lt;/a&gt;&lt;br/&gt;
(unfortunately, the patch is lost)&lt;br/&gt;
Yes, we Germans have an eye on recyclability.</comment>
                            <comment id="14572530" author="naoto" created="Fri, 7 Apr 2023 13:40:03 -0700"  >Assign this issue to the submitter. I am happy to review the fix once a PR is submitted.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5138682">JDK-8339769</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i311sb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17351"><![CDATA[b20]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="294"><![CDATA[java.nio.charsets]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>