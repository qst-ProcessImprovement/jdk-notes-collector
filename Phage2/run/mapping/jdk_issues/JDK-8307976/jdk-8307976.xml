<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:24:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8307976] (fs) Files.createDirectories(dir) returns dir::toAbsolutePath instead of dir</title>
                <link>https://bugs.openjdk.org/browse/JDK-8307976</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ADDITIONAL SYSTEM INFORMATION :&lt;br/&gt;
Tested on OpenJDK20 Windows and Linux, and OpenJDK14 - similar results for all&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
When calling Files.createDirectories(path) for a relative path, the result returned is sometimes absolute version of the created path, but on other occasions the same original relative path is returned. Midway through Files.createDirectories(path) there is a line &amp;quot;dir = dir.toAbsolutePath()&amp;quot; but there is &amp;quot;return dir;&amp;quot;  before and after that conversion - therefore giving inconsistent return value to caller.  This inconsistent behaviour is undocumented. I would expect all calls to Files.createDirectories(path) to return the same value for all calls with same input path. Always toAbsolutePath, or always the original path, never a mix of the two outcomes.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
See test case, this repeats the call to create a temporary directory with relative path Path.of(&amp;quot;.temp/temp.abc/temp.def&amp;quot;)&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; .temp/temp.abc/temp.def&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; .temp/temp.abc/temp.def&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; .temp/temp.abc/temp.def&lt;br/&gt;
ACTUAL -&lt;br/&gt;
On the first call the path returned has been converted to absolute path, but in 2nd+ calls the path returned is relative path equal to the input path.&lt;br/&gt;
Windows:&lt;br/&gt;
Files.createDirectories(.temp\temp.abc\temp.def) =&amp;gt; C:\Temp\.temp\temp.abc\temp.def&lt;br/&gt;
Files.createDirectories(.temp\temp.abc\temp.def) =&amp;gt; .temp\temp.abc\temp.def&lt;br/&gt;
Files.createDirectories(.temp\temp.abc\temp.def) =&amp;gt; .temp\temp.abc\temp.def&lt;br/&gt;
Linux:&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; /tmp/.temp/temp.abc/temp.def&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; .temp/temp.abc/temp.def&lt;br/&gt;
Files.createDirectories(.temp/temp.abc/temp.def) =&amp;gt; .temp/temp.abc/temp.def&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
class FilesCreateDirectories {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public static void main(String ... args) throws IOException {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path temp  = Path.of(&amp;quot;.temp/temp.abc/temp.def&amp;quot;);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Files.deleteIfExists(temp);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Files.deleteIfExists(temp.getParent());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path a = Files.createDirectories(temp);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path b = Files.createDirectories(temp);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Path c = Files.createDirectories(temp);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.format(&amp;quot;Files.createDirectories(%s) =&amp;gt; %s%n&amp;quot;, temp, a);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.format(&amp;quot;Files.createDirectories(%s) =&amp;gt; %s%n&amp;quot;, temp, b);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.format(&amp;quot;Files.createDirectories(%s) =&amp;gt; %s%n&amp;quot;, temp, c);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Never assign the returned path from Files.createDirectories(temp) to another variable, and just use the parameter passed for subsequent calls.&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5100697">JDK-8307976</key>
            <summary>(fs) Files.createDirectories(dir) returns dir::toAbsolutePath instead of dir</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bpb">Brian Burkhalter</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>dcsaw</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Thu, 11 May 2023 03:05:14 -0700</created>
                <updated>Fri, 21 Jul 2023 07:36:26 -0700</updated>
                            <resolved>Wed, 17 May 2023 09:05:56 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14582374" author="dukebot" created="Wed, 17 May 2023 09:05:54 -0700"  >Changeset: 6d4782bc&lt;br/&gt;
Author:    Brian Burkhalter &amp;lt;&lt;a href=&apos;mailto:bpb@openjdk.org&apos;&gt;bpb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-17 16:04:08 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/6d4782bc737d5933b9476cadb5e87ceee94c4f68&quot;&gt;https://git.openjdk.org/jdk/commit/6d4782bc737d5933b9476cadb5e87ceee94c4f68&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14581274" author="roboduke" created="Fri, 12 May 2023 10:07:08 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13959&quot;&gt;https://git.openjdk.org/jdk/pull/13959&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-12 17:00:48 +0000</comment>
                            <comment id="14581266" author="bpb" created="Fri, 12 May 2023 09:39:50 -0700"  >Reproduces also on macOS.</comment>
                            <comment id="14581128" author="tongwan" created="Fri, 12 May 2023 00:26:00 -0700"  >The observations on Windows 10:&lt;br/&gt;
JDK 11: Failed, second and third calls returned different results from the first one&lt;br/&gt;
JDK 17: Failed.&lt;br/&gt;
JDK 20: Failed.&lt;br/&gt;
JDK 21ea+5: Failed.</comment>
                            <comment id="14581119" author="alanb" created="Fri, 12 May 2023 00:11:48 -0700"  >The method should return dir, not dir.toAbsolutePath, seems this bug has existed for a long time but has not been noticed.</comment>
                    </comments>
                    <attachments>
                            <attachment id="103817" name="FilesCreateDirectories.java" size="698" author="tongwan" created="Fri, 12 May 2023 00:26:18 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    <customfieldvalue key="17005"><![CDATA[windows]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31hez:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17433"><![CDATA[b23]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="228"><![CDATA[java.nio]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>