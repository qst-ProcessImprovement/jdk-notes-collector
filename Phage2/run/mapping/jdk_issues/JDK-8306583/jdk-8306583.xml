<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:45:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8306583] Add JVM crash check in CDSTestUtils.executeAndLog</title>
                <link>https://bugs.openjdk.org/browse/JDK-8306583</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8306476&quot; title=&quot;CDS ArchiveHeapTestClass.java test asserts when vm_exit is called on VM thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8306476&quot;&gt;&lt;strike&gt;JDK-8306476&lt;/strike&gt;&lt;/a&gt; caused ArchiveHeapTestClass.java to reliably crash when running &amp;quot;java -Xshare:dump&amp;quot; for the following test case&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/20b1d19d26a039b963590ca6f806f78a4a94c25f/test/hotspot/jtreg/runtime/cds/appcds/cacheObject/ArchiveHeapTestClass.java#L160&quot;&gt;https://github.com/openjdk/jdk/blob/20b1d19d26a039b963590ca6f806f78a4a94c25f/test/hotspot/jtreg/runtime/cds/appcds/cacheObject/ArchiveHeapTestClass.java#L160&lt;/a&gt;&lt;br/&gt;
mustFail(output, &amp;quot;Class pkg.ClassInPackage not allowed in archive heap&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
However, the test case only checks for a non-zero exit code and the require error message. It missed the fact that the JVM has crashed. As a result, &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8306476&quot; title=&quot;CDS ArchiveHeapTestClass.java test asserts when vm_exit is called on VM thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8306476&quot;&gt;&lt;strike&gt;JDK-8306476&lt;/strike&gt;&lt;/a&gt; was discovered only intermittently when the test itself timed out.&lt;br/&gt;
&lt;br/&gt;
It will be cumbersome to test for JVM crashing in every test case. Since most of CDS tests launch subprocesses using CDSTestUtils.executeAndLog, we can add the following check there:&lt;br/&gt;
&lt;br/&gt;
if (output.getStdout().contains(&amp;quot;&lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&amp;quot;)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;throw new RuntimeException(&amp;quot;Hotspot crashed&amp;quot;);&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5099061">JDK-8306583</key>
            <summary>Add JVM crash check in CDSTestUtils.executeAndLog</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matsaave">Matias Saavedra Silva</assignee>
                                    <reporter username="iklam">Ioi Lam</reporter>
                        <labels>
                            <label>cds</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>noreg-self</label>
                    </labels>
                <created>Thu, 20 Apr 2023 10:03:50 -0700</created>
                <updated>Fri, 9 Aug 2024 12:59:25 -0700</updated>
                            <resolved>Fri, 5 May 2023 11:09:49 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14696856" author="roboduke" created="Thu, 8 Aug 2024 01:42:35 -0700"  >[jdk17u-fix-request] Approval Request from Amos&lt;br/&gt;
&amp;quot;Backporting as &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8321933&quot; title=&quot;TestCDSVMCrash.java spawns two processes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8321933&quot;&gt;&lt;strike&gt;JDK-8321933&lt;/strike&gt;&lt;/a&gt; dependency. No risk, test fix. Clean backport. Test passes and SAP nightlies pass on 2024-08-07&#8221;</comment>
                            <comment id="14695261" author="roboduke" created="Thu, 1 Aug 2024 16:40:10 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2771&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2771&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-01 23:35:59 +0000</comment>
                            <comment id="14632493" author="stefank" created="Thu, 7 Dec 2023 14:56:54 -0800"  >Something looks odd with this test. It looks like it spawns two processes:&lt;br/&gt;
```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;OutputAnalyzer output = new OutputAnalyzer(pb.start());&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// executeAndLog should throw an exception in the VM crashed&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CDSTestUtils.executeAndLog(pb, &amp;quot;cds_vm_crash&amp;quot;);&lt;br/&gt;
&lt;br/&gt;
once in the pb.start() call and then again in executeAndLog.</comment>
                            <comment id="14584604" author="iklam" created="Thu, 25 May 2023 10:42:25 -0700"  >Thanks [~mbaesken] for spotting the &amp;quot;@requires vm.cds&amp;quot; problem. I have filed &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8308891&quot; title=&quot;TestCDSVMCrash.java needs @requires vm.cds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8308891&quot;&gt;&lt;strike&gt;JDK-8308891&lt;/strike&gt;&lt;/a&gt;</comment>
                            <comment id="14582852" author="mbaesken" created="Fri, 19 May 2023 03:25:40 -0700"  >This change  added a cds related test  TestCDSVMCrash.  But the new test misses &amp;#39;* @requires vm.cds&amp;#39;  , is this intentional ?&lt;br/&gt;
A cds related test should normally have this in its comments.</comment>
                            <comment id="14579456" author="dukebot" created="Fri, 5 May 2023 11:09:47 -0700"  >Changeset: 27764e60&lt;br/&gt;
Author:    Matias Saavedra Silva &amp;lt;&lt;a href=&apos;mailto:matsaave@openjdk.org&apos;&gt;matsaave@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-05 18:06:19 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/27764e60357b018b4f403d63cb54f95604b0cb8c&quot;&gt;https://git.openjdk.org/jdk/commit/27764e60357b018b4f403d63cb54f95604b0cb8c&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14579269" author="roboduke" created="Thu, 4 May 2023 20:13:59 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13817&quot;&gt;https://git.openjdk.org/jdk/pull/13817&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-04 21:19:08 +0000</comment>
                            <comment id="14575586" author="dholmes" created="Thu, 20 Apr 2023 15:39:48 -0700"  >Can you check for a specific non-zero exit code for the expected case and thus detect crashes that way?&lt;br/&gt;
&lt;br/&gt;
The Bug report URL is overridable in a build for other OpenJDK providers to customize, so I would suggest finding something else in the hs_err output to check.</comment>
                            <comment id="14575471" author="iklam" created="Thu, 20 Apr 2023 10:09:47 -0700"  >I am not sure if we have any tests that call CDSTestUtils.executeAndLog with the expectation that the subprocess will (or might) crash. If we indeed have such a case, we can update the test case to pass something like this in the subprocess&amp;#39;s command line&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;-Dcds.test.allow.jvm.crash=true&lt;br/&gt;
&lt;br/&gt;
in that case, CDSTestUtils.executeAndLog will not perform the JVM crash checking. It will be up to the caller of CDSTestUtils.executeAndLog to check the OutputAnalyzer to determine if a crash has happened or not.&lt;br/&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5136497">JDK-8338131</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5098937">JDK-8306476</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5116847">JDK-8321933</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i317qz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17415"><![CDATA[b22]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>