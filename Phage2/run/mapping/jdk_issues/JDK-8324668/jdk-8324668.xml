<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:44:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8324668] JDWP process management needs more efficient file descriptor handling</title>
                <link>https://bugs.openjdk.org/browse/JDK-8324668</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>After the fix for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8300088&quot; title=&quot;[IMPROVE] OPEN_MAX is no longer the max limit on macOS &amp;gt;= 10.6 for RLIMIT_NOFILE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8300088&quot;&gt;&lt;strike&gt;JDK-8300088&lt;/strike&gt;&lt;/a&gt; some JDI/JDWP tests started exhibiting timeouts.&lt;br/&gt;
&lt;br/&gt;
[~jpai] reports:&lt;br/&gt;
&lt;br/&gt;
The root cause is this code in  jdwp which does the work of launching a process (passed as a command to launch=cmdline option) &lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/src/jdk.jdwp.agent/unix/native/libjdwp/exec_md.c#L103&quot;&gt;https://github.com/openjdk/jdk/blob/master/src/jdk.jdwp.agent/unix/native/libjdwp/exec_md.c#L103&lt;/a&gt;. &lt;br/&gt;
&lt;br/&gt;
it forks the child process and then goes ahead to close all possible file descriptor copies (from its parent) of this newly created child process. to do that it fetches the max number of allowed open descriptors (sysconf) and then iterates over it one by one (starting fd=3) to close them all. before the change in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8300088&quot; title=&quot;[IMPROVE] OPEN_MAX is no longer the max limit on macOS &amp;gt;= 10.6 for RLIMIT_NOFILE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8300088&quot;&gt;&lt;strike&gt;JDK-8300088&lt;/strike&gt;&lt;/a&gt;, the max_fd value in that loop used to be relatively smaller 10240 and it appears that it was able to close them all in a reasonable amount of time. however, now the value returned there for max_fd is 2147483647 and by the time the test times out, that loop has only been able to close around 26839415 odd file descriptors and is still continuing to close the rest &lt;br/&gt;
&lt;br/&gt;
I had a quick look at how we handle forking in other APIs in the JDK and turns out there is a more optimal way we do it in the Process impl native code &lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/src/java.base/unix/native/libjava/childproc.c#L74&quot;&gt;https://github.com/openjdk/jdk/blob/master/src/java.base/unix/native/libjava/childproc.c#L74&lt;/a&gt;</description>
                <environment></environment>
        <key id="5119990">JDK-8324668</key>
            <summary>JDWP process management needs more efficient file descriptor handling</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpai">Jaikiran Pai</assignee>
                                    <reporter username="dholmes">David Holmes</reporter>
                        <labels>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>noreg-hard</label>
                    </labels>
                <created>Wed, 24 Jan 2024 17:04:57 -0800</created>
                <updated>Wed, 12 Jun 2024 04:13:29 -0700</updated>
                            <resolved>Wed, 31 Jan 2024 21:57:13 -0800</resolved>
                                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>core-svc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14680776" author="roboduke" created="Tue, 11 Jun 2024 23:41:59 -0700"  >[jdk17u-fix-request] Approval Request from Dmitry Cherepanov&lt;br/&gt;
This is a prerequisite change for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8324577&quot; title=&quot;[REDO] - [IMPROVE] OPEN_MAX is no longer the max limit on macOS &amp;gt;= 10.6 for RLIMIT_NOFILE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8324577&quot;&gt;&lt;strike&gt;JDK-8324577&lt;/strike&gt;&lt;/a&gt; (already backported to JDK 21). Applies cleanly except for copyright years. Passes local tier1-4 testing on macos-aarch64.</comment>
                            <comment id="14680079" author="roboduke" created="Mon, 10 Jun 2024 00:51:00 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2557&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2557&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-10 07:46:31 +0000</comment>
                            <comment id="14677557" author="roboduke" created="Thu, 30 May 2024 09:23:24 -0700"  >[jdk21u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 21.0.5-oracle. Applies cleanly and tier1-4 have passed.</comment>
                            <comment id="14677274" author="roboduke" created="Wed, 29 May 2024 09:35:15 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/619&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/619&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-29 16:29:00 +0000</comment>
                            <comment id="14645875" author="dukebot" created="Wed, 31 Jan 2024 21:57:12 -0800"  >Changeset: a6632487&lt;br/&gt;
Author:    Jaikiran Pai &amp;lt;&lt;a href=&apos;mailto:jpai@openjdk.org&apos;&gt;jpai@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-02-01 05:55:58 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/a6632487863db5ff3136cdcc76b7440c15ce6be9&quot;&gt;https://git.openjdk.org/jdk/commit/a6632487863db5ff3136cdcc76b7440c15ce6be9&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14644030" author="roboduke" created="Fri, 26 Jan 2024 06:58:38 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/17588&quot;&gt;https://git.openjdk.org/jdk/pull/17588&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-26 14:52:49 +0000</comment>
                            <comment id="14643616" author="dholmes" created="Wed, 24 Jan 2024 17:09:10 -0800"  >[~jpai] provided the attached patch with the note:&lt;br/&gt;
&lt;br/&gt;
Attempted this extremely crude patch in the jdwp exec code to mimic what we do in the process impl&amp;#39;s fork implementation. this gets all those 3 failing tests to pass locally, both with and without the changes that were done in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8300088&quot; title=&quot;[IMPROVE] OPEN_MAX is no longer the max limit on macOS &amp;gt;= 10.6 for RLIMIT_NOFILE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8300088&quot;&gt;&lt;strike&gt;JDK-8300088&lt;/strike&gt;&lt;/a&gt;. of course, this patch will need more cleanup (i even didn&amp;#39;t consider AIX in this attempt, so that code too needs to be borrowed over). plus the cast to int for the max_fd probably needs a rethought, perhaps</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5130120">JDK-8332766</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130766">JDK-8333339</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5131690">JDK-8334120</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="5119879">JDK-8324577</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5120380">JDK-8324979</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5122134">JDK-8326433</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5091324">JDK-8300088</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="108014" name="8324668.patch" size="2776" author="dholmes" created="Wed, 24 Jan 2024 17:07:52 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34qv7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17336"><![CDATA[b09]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="370"><![CDATA[debugger]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>