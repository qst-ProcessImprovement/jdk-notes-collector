<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 15:54:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8300658] memory_and_swap_limit() reporting wrong values on systems with swapaccount=0</title>
                <link>https://bugs.openjdk.org/browse/JDK-8300658</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8250984&quot; title=&quot;Memory Docker tests fail on some Linux kernels w/o cgroupv1 swap limit capabilities&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8250984&quot;&gt;&lt;strike&gt;JDK-8250984&lt;/strike&gt;&lt;/a&gt; and &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8253797&quot; title=&quot;[cgroups v2] Account for the fact that swap accounting is disabled on some systems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8253797&quot;&gt;&lt;strike&gt;JDK-8253797&lt;/strike&gt;&lt;/a&gt; fixed this on the Java side of container support code. If reading file memory.memsw.limit_in_bytes returns an error Metrics.getMemoryAndSwapLimit() returns the memory limit (i.e. no swap). Same for cg2&amp;#39;s memory.swap.max. Yet, on the hotspot side this isn&amp;#39;t being treated the same way. Swap reporting is off, which yields to confusing trace output:&lt;br/&gt;
&lt;br/&gt;
# podman run --rm -ti [...] --memory=200M --memory-swap=250M fedora:37&lt;br/&gt;
Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.&lt;br/&gt;
[&lt;a href=&apos;mailto:root@dc3a44d5100a&apos;&gt;root@dc3a44d5100a&lt;/a&gt; /]# cd /testclasses/&lt;br/&gt;
[&lt;a href=&apos;mailto:root@dc3a44d5100a&apos;&gt;root@dc3a44d5100a&lt;/a&gt; testclasses]# /opt/jdk/bin/java -Xlog:os+container=trace -Xbootclasspath/a:whitebox.jar -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI PrintContainerInfo | grep os,container | grep -A1 memsw.limit_in_bytes&lt;br/&gt;
[0.099s][trace][os,container] Path to /memory.memsw.limit_in_bytes is /sys/fs/cgroup/memory/memory.memsw.limit_in_bytes&lt;br/&gt;
[0.099s][debug][os,container] Open of file /sys/fs/cgroup/memory/memory.memsw.limit_in_bytes failed, No such file or directory&lt;br/&gt;
[0.099s][trace][os,container] Memory and Swap Limit is: 18446744073709551614&lt;br/&gt;
&lt;br/&gt;
It also shows up via VM.info or hs_err files like so:&lt;br/&gt;
&lt;br/&gt;
[&lt;a href=&apos;mailto:root@dc3a44d5100a&apos;&gt;root@dc3a44d5100a&lt;/a&gt; testclasses]# /opt/jdk/bin/java -Xbootclasspath/a:whitebox.jar -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI PrintContainerInfo | grep -A20 cgroup&lt;br/&gt;
container (cgroup) information:&lt;br/&gt;
container_type: cgroupv1&lt;br/&gt;
cpu_cpuset_cpus: 0-3&lt;br/&gt;
cpu_memory_nodes: 0&lt;br/&gt;
active_processor_count: 4&lt;br/&gt;
cpu_quota: no quota&lt;br/&gt;
cpu_period: 100000&lt;br/&gt;
cpu_shares: no shares&lt;br/&gt;
memory_limit_in_bytes: 204800 k&lt;br/&gt;
memory_and_swap_limit_in_bytes: not supported&lt;br/&gt;
memory_soft_limit_in_bytes: unlimited&lt;br/&gt;
memory_usage_in_bytes: 28504 k&lt;br/&gt;
memory_max_usage_in_bytes: 28908 k&lt;br/&gt;
kernel_memory_usage_in_bytes: 1196 k&lt;br/&gt;
kernel_memory_max_usage_in_bytes: unlimited&lt;br/&gt;
kernel_memory_limit_in_bytes: 1324 k&lt;br/&gt;
maximum number of tasks: 2048&lt;br/&gt;
current number of tasks: 15&lt;br/&gt;
&lt;br/&gt;
KVM virtualization detected&lt;br/&gt;
Steal ticks since vm start: 0&lt;br/&gt;
Steal ticks percentage since vm start:  0.000&lt;br/&gt;
&lt;br/&gt;
These:&lt;br/&gt;
memory_limit_in_bytes: 204800 k&lt;br/&gt;
memory_and_swap_limit_in_bytes: not supported&lt;br/&gt;
&lt;br/&gt;
Should be:&lt;br/&gt;
memory_limit_in_bytes: 204800 k&lt;br/&gt;
memory_and_swap_limit_in_bytes: 204800 k&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
# cat /proc/cmdline | grep swapaccount&lt;br/&gt;
BOOT_IMAGE=(hd0,gpt2)/vmlinuz-5.19.7-300.fc37.x86_64 root=UUID=fcdabdd6-70cf-4a94-905d-86c966fed17d ro rootflags=subvol=root rhgb quiet systemd.unified_cgroup_hierarchy=0 swapaccount=0&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Comparing this to the java level which we can see with -XshowSettings:system we see:&lt;br/&gt;
&lt;br/&gt;
# /opt/jdk/bin/java -XshowSettings:system -version&lt;br/&gt;
Operating System Metrics:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Provider: cgroupv1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Effective CPU Count: 4&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CPU Period: 100000us&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CPU Quota: -1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CPU Shares: -1&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List of Processors, 4 total: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;0 1 2 3 &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List of Effective Processors, 4 total: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;0 1 2 3 &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List of Memory Nodes, 1 total: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;0 &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;List of Available Memory Nodes, 1 total: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;0 &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Memory Limit: 200.00M&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Memory Soft Limit: Unlimited&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Memory &amp;amp; Swap Limit: 200.00M&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Maximum Processes Limit: 2048&lt;br/&gt;
&lt;br/&gt;
openjdk version &amp;quot;21-internal&amp;quot; 2023-09-19&lt;br/&gt;
OpenJDK Runtime Environment (fastdebug build 21-internal-adhoc.sgehwolf.jdk-jdk)&lt;br/&gt;
OpenJDK 64-Bit Server VM (fastdebug build 21-internal-adhoc.sgehwolf.jdk-jdk, mixed mode, sharing)&lt;br/&gt;
&lt;br/&gt;
I.e. memory and swap limit match. Both are 200.00M. I.e. no swap.</description>
                <environment></environment>
        <key id="5091957">JDK-8300658</key>
            <summary>memory_and_swap_limit() reporting wrong values on systems with swapaccount=0</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sgehwolf">Severin Gehwolf</assignee>
                                    <reporter username="sgehwolf">Severin Gehwolf</reporter>
                        <labels>
                            <label>containers</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                    </labels>
                <created>Thu, 19 Jan 2023 05:20:00 -0800</created>
                <updated>Mon, 9 Jun 2025 07:39:03 -0700</updated>
                            <resolved>Mon, 20 Feb 2023 09:09:31 -0800</resolved>
                                    <version>8</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14770344" author="roboduke" created="Tue, 15 Apr 2025 08:32:48 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3500&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3500&lt;/a&gt;&lt;br/&gt;
Date: 2025-04-15 15:23:41 +0000</comment>
                            <comment id="14770339" author="goetz" created="Tue, 15 Apr 2025 08:22:20 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.16-oracle.&lt;br/&gt;
Low risk, fix to tracing / printing.&lt;br/&gt;
Clean backport.&lt;br/&gt;
</comment>
                            <comment id="14561475" author="dukebot" created="Mon, 20 Feb 2023 09:09:29 -0800"  >Changeset: e47e9ec0&lt;br/&gt;
Author:    Severin Gehwolf &amp;lt;&lt;a href=&apos;mailto:sgehwolf@openjdk.org&apos;&gt;sgehwolf@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-20 17:07:04 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/e47e9ec05b630c82182c7843365dfd90fdaa18a0&quot;&gt;https://git.openjdk.org/jdk/commit/e47e9ec05b630c82182c7843365dfd90fdaa18a0&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14560462" author="sgehwolf" created="Wed, 15 Feb 2023 10:24:17 -0800"  >Note that &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8300645&quot; title=&quot;Handle julong values in logging of GET_CONTAINER_INFO macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8300645&quot;&gt;&lt;strike&gt;JDK-8300645&lt;/strike&gt;&lt;/a&gt; fixed the trace logging for &amp;#39;Memory and Swap Limit is: &amp;#39; that the test change in TestMemoryWithCgroupV1.java depends on. Linking the issue.</comment>
                            <comment id="14555084" author="roboduke" created="Fri, 27 Jan 2023 09:18:10 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12262&quot;&gt;https://git.openjdk.org/jdk/pull/12262&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-27 17:09:35 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5155900">JDK-8354652</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5156293">JDK-8354950</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5156757">JDK-8355373</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5157680">JDK-8356151</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5030832">JDK-8253797</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5091941">JDK-8300645</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5026589">JDK-8250984</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                                        </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3007f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>