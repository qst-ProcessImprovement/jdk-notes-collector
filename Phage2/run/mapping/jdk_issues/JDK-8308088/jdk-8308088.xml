<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:28:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8308088] Improve class check in CollectedHeap::is_oop</title>
                <link>https://bugs.openjdk.org/browse/JDK-8308088</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>(Found this during Lilliput review)&lt;br/&gt;
&lt;br/&gt;
Current CollectedHeap::is_oop is weird:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
bool CollectedHeap::is_oop(oop object) const {&lt;br/&gt;
...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (is_in(object-&amp;gt;klass_raw())) {  // &amp;lt;--- if klass is in the Java heap, it is not an oop?!&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
...&lt;br/&gt;
}&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
The history shows it goes all the way back to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-6964458&quot; title=&quot;Reimplement class meta-data storage to use native memory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-6964458&quot;&gt;&lt;strike&gt;JDK-6964458&lt;/strike&gt;&lt;/a&gt;, which rewrote the previous checking code to:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
@@ -589,21 +609,7 @@ inline bool oopDesc::is_oop(bool ignore_mark_word) const {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;if (!check_obj_alignment(obj)) return false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;if (!Universe::heap()-&amp;gt;is_in_reserved(obj)) return false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// obj is aligned and accessible in heap&lt;br/&gt;
-  // try to find metaclass cycle safely without seg faulting on bad input&lt;br/&gt;
-  // we should reach klassKlassObj by following klass link at most 3 times&lt;br/&gt;
-  for (int i = 0; i &amp;lt; 3; i++) {&lt;br/&gt;
-    obj = obj-&amp;gt;klass_or_null();&lt;br/&gt;
-    // klass should be aligned and in permspace&lt;br/&gt;
-    if (!check_obj_alignment(obj)) return false;&lt;br/&gt;
-    if (!Universe::heap()-&amp;gt;is_in_permanent(obj)) return false;&lt;br/&gt;
-  }&lt;br/&gt;
-  if (obj != Universe::klassKlassObj()) {&lt;br/&gt;
-    // During a dump, the _klassKlassObj moved to a shared space.&lt;br/&gt;
-    if (DumpSharedSpaces &amp;amp;&amp;amp; Universe::klassKlassObj()-&amp;gt;is_shared()) {&lt;br/&gt;
-      return true;&lt;br/&gt;
-    }&lt;br/&gt;
-    return false;&lt;br/&gt;
-  }&lt;br/&gt;
+  if (Universe::heap()-&amp;gt;is_in_reserved(obj-&amp;gt;klass_or_null())) return false;&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
I think the check should be a more direct: assert the klass ptr is in the Metaspace, at very least.</description>
                <environment></environment>
        <key id="5100925">JDK-8308088</key>
            <summary>Improve class check in CollectedHeap::is_oop</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shade">Aleksey Shipilev</assignee>
                                    <reporter username="shade">Aleksey Shipilev</reporter>
                        <labels>
                            <label>amazon-interest</label>
                    </labels>
                <created>Mon, 15 May 2023 03:18:50 -0700</created>
                <updated>Mon, 22 May 2023 00:54:39 -0700</updated>
                            <resolved>Wed, 17 May 2023 02:22:30 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14582275" author="dukebot" created="Wed, 17 May 2023 02:22:29 -0700"  >Changeset: b300e73a&lt;br/&gt;
Author:    Aleksey Shipilev &amp;lt;&lt;a href=&apos;mailto:shade@openjdk.org&apos;&gt;shade@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-17 09:19:08 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/b300e73a4acb5c64f68a355e0ad70d3862084ff4&quot;&gt;https://git.openjdk.org/jdk/commit/b300e73a4acb5c64f68a355e0ad70d3862084ff4&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14581651" author="roboduke" created="Mon, 15 May 2023 11:36:52 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13982&quot;&gt;https://git.openjdk.org/jdk/pull/13982&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-15 10:25:15 +0000</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31itn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17433"><![CDATA[b23]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>