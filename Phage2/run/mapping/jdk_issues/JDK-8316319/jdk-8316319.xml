<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:57:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8316319] Generational ZGC: The SoftMaxHeapSize might be wrong when CDS decreases the MaxHeapSize</title>
                <link>https://bugs.openjdk.org/browse/JDK-8316319</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The bug is found by the next test if executed on the systems with some particular amount of memory:&lt;br/&gt;
&amp;nbsp;&amp;quot;runtime/cds/appcds/TestZGCWithCDS.java$ZGenerational&amp;quot;&lt;br/&gt;
&lt;br/&gt;
To reproduce run the test under the docker and set the memory limit, the test passed if limit=3000m and fail if limit=30000m&lt;br/&gt;
&lt;br/&gt;
docker run -m 30000m -v /home/ec2-user/path/:/path amazonlinux /bin/sh -c &amp;#39;cd /path/ws/openjdk/jdk &amp;amp;&amp;amp; /path/soft/jtreg/bin/jtreg -jdk:/path/ws/openjdk/jdk/build/linux-x86_64-server-release/images/jdk/ /path/ws/openjdk/jdk/test/hotspot/jtreg/runtime/cds/appcds/TestZGCWithCDS.java&amp;#39;&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;stdout: [[0.098s][info][cds] Core region alignment: 4096&lt;br/&gt;
];&lt;br/&gt;
&amp;nbsp;stderr: [SoftMaxHeapSize must be less than or equal to the maximum heap size&lt;br/&gt;
Error: Could not create the Java Virtual Machine.&lt;br/&gt;
Error: A fatal exception has occurred. Program will exit.&lt;br/&gt;
]&lt;br/&gt;
&amp;nbsp;exitValue = 1&lt;br/&gt;
&lt;br/&gt;
java.lang.RuntimeException: &amp;#39;Dumping shared data to file:&amp;#39; missing from stdout/stderr&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at jdk.test.lib.process.OutputAnalyzer.shouldContain(OutputAnalyzer.java:221)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at TestZGCWithCDS.main(TestZGCWithCDS.java:67)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at java.base/java.lang.reflect.Method.invoke(Method.java:580)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;at com.sun.javatest.regtest.agent.MainWrapper$MainTa</description>
                <environment></environment>
        <key id="5110365">JDK-8316319</key>
            <summary>Generational ZGC: The SoftMaxHeapSize might be wrong when CDS decreases the MaxHeapSize</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefank">Stefan Karlsson</assignee>
                                    <reporter username="serb">Sergey Bylokhov</reporter>
                        <labels>
                            <label>21-bp</label>
                            <label>amazon-interest</label>
                            <label>genzgc</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                    </labels>
                <created>Thu, 14 Sep 2023 13:08:09 -0700</created>
                <updated>Tue, 23 Jan 2024 00:29:16 -0800</updated>
                            <resolved>Thu, 21 Sep 2023 23:41:52 -0700</resolved>
                                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14640555" author="JIRAUSER21000" created="Tue, 16 Jan 2024 04:34:09 -0800"  >Fix Request (jdk21u)&lt;br/&gt;
&lt;br/&gt;
runtime/cds/appcds/TestZGCWithCDS.java#ZGenerational failed in jdk21u, we want to make the test pass to improve the test stability.&lt;br/&gt;
This bug can be reproduced by jtreg tests:&lt;br/&gt;
```&lt;br/&gt;
runtime/cds/appcds/TestZGCWithCDS.java#ZGenerational&lt;br/&gt;
```&lt;br/&gt;
Patch can be applied cleanly.&lt;br/&gt;
Low risk.&lt;br/&gt;
And test have been locally verified to pass.&lt;br/&gt;
Thanks.</comment>
                            <comment id="14638392" author="roboduke" created="Mon, 8 Jan 2024 18:31:38 -0800"  >[jdk21u-fix-request] Approval Request from yaqsun&lt;br/&gt;
</comment>
                            <comment id="14637390" author="roboduke" created="Thu, 4 Jan 2024 03:10:38 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/126&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/126&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-04 11:06:14 +0000</comment>
                            <comment id="14613061" author="dukebot" created="Thu, 21 Sep 2023 23:41:51 -0700"  >Changeset: fe862639&lt;br/&gt;
Author:    Stefan Karlsson &amp;lt;&lt;a href=&apos;mailto:stefank@openjdk.org&apos;&gt;stefank@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-09-22 06:38:45 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/fe862639e7ce40f5adef0e482b1fb9c718e061a3&quot;&gt;https://git.openjdk.org/jdk/commit/fe862639e7ce40f5adef0e482b1fb9c718e061a3&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14612553" author="roboduke" created="Wed, 20 Sep 2023 05:46:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15841&quot;&gt;https://git.openjdk.org/jdk/pull/15841&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-20 12:40:22 +0000</comment>
                            <comment id="14612540" author="stefank" created="Wed, 20 Sep 2023 05:07:44 -0700"  >This can be reproduced with:&lt;br/&gt;
java -XX:+UseZGC -XX:+ZGenerational -Xshare:dump -version&lt;br/&gt;
&lt;br/&gt;
It doesn&amp;#39;t reproduce if you set either of -Xmx, MaxHeapSize, MaxRAMFraction, or MaxRamPrecentage.</comment>
                            <comment id="14612534" author="stefank" created="Wed, 20 Sep 2023 04:54:58 -0700"  >This is the scenario that causes this bug:&lt;br/&gt;
1) Generational ZGC sets SoftMaxHeapSize early in the VM initialization&lt;br/&gt;
2) CDS runs after (1) and decreases the MaxHeapSize with:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (MaxHeapSize &amp;gt; max_heap_size) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log_debug(cds)(&amp;quot;Setting MaxHeapSize to 4G for CDS dumping, original size = &amp;quot; SIZE_FORMAT &amp;quot;M&amp;quot;, MaxHeapSize/M);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FLAG_SET_ERGO(MaxHeapSize, max_heap_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
I think this can be fixed by moving (1) to a later stage.</comment>
                            <comment id="14612317" author="mseledtsov" created="Tue, 19 Sep 2023 11:26:57 -0700"  >Runtime Triage: the option SoftMaxHeapSize is managed by GC code, changing sub-component to GC.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5119763">JDK-8324473</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i334s3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17417"><![CDATA[b17]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>