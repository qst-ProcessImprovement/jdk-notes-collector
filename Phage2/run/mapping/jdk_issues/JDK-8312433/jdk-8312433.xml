<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 10:03:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8312433] HttpClient request fails due to connection being considered idle and closed</title>
                <link>https://bugs.openjdk.org/browse/JDK-8312433</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>As reported in net-dev mailing list &lt;a href=&quot;https://mail.openjdk.org/pipermail/net-dev/2023-July/021689.html&quot;&gt;https://mail.openjdk.org/pipermail/net-dev/2023-July/021689.html&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Hi all,&lt;br/&gt;
&lt;br/&gt;
Since I updated Java from 19.0.2 to 20.0.1, I got some errors with connection idle shutdown or closed stream usage when trying to send HTTP requests with java.net.http.HttpClient.&lt;br/&gt;
&lt;br/&gt;
The two following errors are happening. I suspect those are linked even if they don&amp;#39;t trigger together.&lt;br/&gt;
1. java.net.http.HttpConnectTimeoutException: HTTP connection idle, no active streams. Shutting down.&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:890) ~[java.net.http:?]&lt;br/&gt;
2.  java.io.IOException: Stream 9 cancelled&lt;br/&gt;
at jdk.internal.net.http.Stream.cancel(Stream.java:1229) ~[java.net.http:?]&lt;br/&gt;
The detailed stacks are copied below.&lt;br/&gt;
&lt;br/&gt;
Error 1. is caused by an idle connection trying to be used to send the request from what I understood from the code. Error 2. despite saying it is a cancelled streamed is actually happening when the stream is closed if I haven&amp;#39;t missed something in the code.&lt;br/&gt;
I suspect either the idle connections are not always properly discarded to create a new one or there is a race condition when discarding the idle connections. &lt;br/&gt;
&lt;br/&gt;
I was not able so far to find where this could happen and I hope you could help me to find where the problem lies.&lt;br/&gt;
&lt;br/&gt;
Thank you in advance for your help,&lt;br/&gt;
&lt;br/&gt;
Best regards,&lt;br/&gt;
&lt;br/&gt;
Nicolas Henneaux&lt;br/&gt;
&lt;br/&gt;
Detailed stacks&lt;br/&gt;
1. Caused by: java.net.http.HttpConnectTimeoutException: HTTP connection idle, no active streams. Shutting down.&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:890) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133) ~[java.net.http:?]&lt;br/&gt;
(...)&lt;br/&gt;
Caused by: java.net.http.HttpConnectTimeoutException: HTTP connection idle, no active streams. Shutting down.&lt;br/&gt;
at jdk.internal.net.http.Http2Connection$IdleConnectionTimeoutEvent.handle(Http2Connection.java:204) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.purgeTimeoutsAndReturnNextDeadline(HttpClientImpl.java:1689) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl$SelectorManager.run(HttpClientImpl.java:1299) ~[java.net.http:?]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
2. Caused by: java.io.IOException: Stream 9 cancelled&lt;br/&gt;
at jdk.internal.net.http.Stream.cancel(Stream.java:1229) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Http2Connection.putStream(Http2Connection.java:1237) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Stream.registerStream(Stream.java:851) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Http2Connection.registerNewStream(Http2Connection.java:1337) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Http2Connection.sendFrame(Http2Connection.java:1361) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Stream.sendHeadersAsync(Stream.java:823) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.lambda$responseAsyncImpl0$8(Exchange.java:550) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.checkFor407(Exchange.java:430) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.lambda$responseAsyncImpl0$9(Exchange.java:554) ~[java.net.http:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:934) ~[?:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture.uniHandleStage(CompletableFuture.java:950) ~[?:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture.handle(CompletableFuture.java:2372) ~[?:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.responseAsyncImpl0(Exchange.java:554) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.responseAsyncImpl(Exchange.java:406) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.Exchange.responseAsync(Exchange.java:398) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.MultiExchange.responseAsyncImpl(MultiExchange.java:409) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.MultiExchange.lambda$responseAsync0$2(MultiExchange.java:342) ~[java.net.http:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150) ~[?:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1773) ~[?:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl$DelegatingExecutor.execute(HttpClientImpl.java:177) ~[java.net.http:?]&lt;br/&gt;
at java.util.concurrent.CompletableFuture.completeAsync(CompletableFuture.java:2719) ~[?:?]&lt;br/&gt;
at jdk.internal.net.http.MultiExchange.responseAsync(MultiExchange.java:295) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.sendAsync(HttpClientImpl.java:983) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.send(HttpClientImpl.java:875) ~[java.net.http:?]&lt;br/&gt;
at jdk.internal.net.http.HttpClientFacade.send(HttpClientFacade.java:133) ~[java.net.http:?]&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5105901">JDK-8312433</key>
            <summary>HttpClient request fails due to connection being considered idle and closed</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jpai">Jaikiran Pai</assignee>
                                    <reporter username="jpai">Jaikiran Pai</reporter>
                        <labels>
                            <label>jdk21u-fix-SQE-ok-next</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>regression</label>
                    </labels>
                <created>Wed, 19 Jul 2023 23:05:10 -0700</created>
                <updated>Wed, 14 Feb 2024 09:29:21 -0800</updated>
                            <resolved>Thu, 27 Jul 2023 05:17:00 -0700</resolved>
                                    <version>20</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14608762" author="jpai" created="Mon, 4 Sep 2023 22:52:42 -0700"  >Fix request&lt;br/&gt;
&lt;br/&gt;
This was a regression in JDK 20, which has been fixed in mainline (JDK 22). Requesting a backport to JDK 21u, to prevent HTTP requests from failing intermittently when HttpClient is used in applications.</comment>
                            <comment id="14608761" author="roboduke" created="Mon, 4 Sep 2023 22:44:57 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/134&quot;&gt;https://git.openjdk.org/jdk21u/pull/134&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-05 05:38:35 +0000</comment>
                            <comment id="14599603" author="dukebot" created="Thu, 27 Jul 2023 05:16:59 -0700"  >Changeset: 486c7844&lt;br/&gt;
Author:    Jaikiran Pai &amp;lt;&lt;a href=&apos;mailto:jpai@openjdk.org&apos;&gt;jpai@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-07-27 12:14:14 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/486c7844f902728ce580c3994f58e3e497834952&quot;&gt;https://git.openjdk.org/jdk/commit/486c7844f902728ce580c3994f58e3e497834952&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14598653" author="roboduke" created="Tue, 25 Jul 2023 01:56:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/15012&quot;&gt;https://git.openjdk.org/jdk/pull/15012&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-25 08:50:58 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5114707">JDK-8320072</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5118511">JDK-8323379</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5077362">JDK-8288717</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32dcj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17336"><![CDATA[b09]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="193"><![CDATA[java.net]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>