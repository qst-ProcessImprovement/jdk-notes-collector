<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:58:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8331142] Add test for number of loader threads in BasicDirectoryModel</title>
                <link>https://bugs.openjdk.org/browse/JDK-8331142</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Add a test for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8325179&quot; title=&quot;Race in BasicDirectoryModel.validateFileCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8325179&quot;&gt;&lt;strike&gt;JDK-8325179&lt;/strike&gt;&lt;/a&gt; which verifies the number of BasicDirectoryModel.FilesLoader background threads.&lt;br/&gt;
&lt;br/&gt;
The test is heavily inspired by the test for BasicDirectoryModel, see &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8327137&quot; title=&quot;Add test for ConcurrentModificationException in BasicDirectoryModel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8327137&quot;&gt;&lt;strike&gt;JDK-8327137&lt;/strike&gt;&lt;/a&gt;, and its code is based on the ConcurrentModification.java code.&lt;br/&gt;
&lt;br/&gt;
The test captures snapshots of live threads and then counts the number of BasicDirectoryModel.FilesLoader threads in each snapshot.&lt;br/&gt;
&lt;br/&gt;
There should be no more than two threads. There could be two BasicDirectoryModel.FilesLoader threads after the existing thread is interrupted but hasn&amp;#39;t exited yet, and a new thread is already created.</description>
                <environment></environment>
        <key id="5127951">JDK-8331142</key>
            <summary>Add test for number of loader threads in BasicDirectoryModel</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aivanov">Alexey Ivanov</assignee>
                                    <reporter username="aivanov">Alexey Ivanov</reporter>
                        <labels>
                            <label>cssn24_04_01</label>
                            <label>cssn24_04_02</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk22u-fix-SQE-ok</label>
                            <label>jdk22u-fix-request</label>
                            <label>jdk22u-fix-yes</label>
                            <label>noreg-self</label>
                            <label>sustaining</label>
                    </labels>
                <created>Thu, 25 Apr 2024 08:53:02 -0700</created>
                <updated>Mon, 11 Nov 2024 18:10:30 -0800</updated>
                            <resolved>Wed, 1 May 2024 04:54:33 -0700</resolved>
                                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>client-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14719736" author="aivanov" created="Wed, 6 Nov 2024 07:31:00 -0800"  >[~andrewlu] The test is problem-listed by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8337810&quot; title=&quot;ProblemList BasicDirectoryModel/LoaderThreadCount.java on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8337810&quot;&gt;&lt;strike&gt;JDK-8337810&lt;/strike&gt;&lt;/a&gt;, so you may want to include it into your backport.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8337810&quot; title=&quot;ProblemList BasicDirectoryModel/LoaderThreadCount.java on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8337810&quot;&gt;&lt;strike&gt;JDK-8337810&lt;/strike&gt;&lt;/a&gt; isn&amp;#39;t backported to Oracle releases, I didn&amp;#39;t see failures in Oracle CI, nor do I see them now.</comment>
                            <comment id="14719395" author="JIRAUSER20917" created="Tue, 5 Nov 2024 18:29:17 -0800"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.13-oracle.&lt;br/&gt;
No risk, only tests change.&lt;br/&gt;
The test is limit to Windows, so backport with &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331495&quot; title=&quot;Limit BasicDirectoryModel/LoaderThreadCount.java to Windows only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331495&quot;&gt;&lt;strike&gt;JDK-8331495&lt;/strike&gt;&lt;/a&gt; together, also backport with the new issue &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331999&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java frequently fails on Windows in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331999&quot;&gt;&lt;strike&gt;JDK-8331999&lt;/strike&gt;&lt;/a&gt;&lt;br/&gt;
As &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8333880&quot;&gt;https://bugs.openjdk.org/browse/JDK-8333880&lt;/a&gt; not fixed, so this test may still fail.&lt;br/&gt;
SAP nightly testing passed.</comment>
                            <comment id="14682499" author="roboduke" created="Tue, 18 Jun 2024 01:12:52 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2789&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2789&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-18 08:03:47 +0000</comment>
                            <comment id="14682497" author="roboduke" created="Tue, 18 Jun 2024 01:11:49 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2605&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2605&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-18 08:02:55 +0000</comment>
                            <comment id="14682078" author="aivanov" created="Mon, 17 Jun 2024 05:52:18 -0700"  >[~andrewlu] You may take into account that there&amp;#39;s another bug &#8212; &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8333880&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java still fails frequently on Windows in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8333880&quot;&gt;JDK-8333880&lt;/a&gt; &#8212; against this test which reports failures on Windows in 50% of cases. It was reported in comments of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331999&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java frequently fails on Windows in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331999&quot;&gt;&lt;strike&gt;JDK-8331999&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
There have been no failures of BasicDirectoryModel/LoaderThreadCount.java in Oracle CI since I integrated &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331999&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java frequently fails on Windows in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331999&quot;&gt;&lt;strike&gt;JDK-8331999&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14681925" author="JIRAUSER20917" created="Sun, 16 Jun 2024 18:57:46 -0700"  >Fix request [21u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 21.0.5-oracle.&lt;br/&gt;
No risk, only a test change.&lt;br/&gt;
The test is limit to Windows, so backport with &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331495&quot; title=&quot;Limit BasicDirectoryModel/LoaderThreadCount.java to Windows only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331495&quot;&gt;&lt;strike&gt;JDK-8331495&lt;/strike&gt;&lt;/a&gt; together.&lt;br/&gt;
SAP nightly testing passed.</comment>
                            <comment id="14681682" author="roboduke" created="Fri, 14 Jun 2024 02:52:11 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2778&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2778&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-14 09:44:36 +0000</comment>
                            <comment id="14681679" author="roboduke" created="Fri, 14 Jun 2024 02:47:54 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2590&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2590&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-14 09:41:11 +0000</comment>
                            <comment id="14681674" author="roboduke" created="Fri, 14 Jun 2024 02:42:16 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/725&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/725&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-14 09:36:27 +0000</comment>
                            <comment id="14676083" author="aivanov" created="Fri, 24 May 2024 11:16:28 -0700"  >There are two follow-up fixes:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&#8226; &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331495&quot; title=&quot;Limit BasicDirectoryModel/LoaderThreadCount.java to Windows only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331495&quot;&gt;&lt;strike&gt;JDK-8331495&lt;/strike&gt;&lt;/a&gt;: Limit BasicDirectoryModel/LoaderThreadCount.java to Windows only&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&#8226; &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331999&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java frequently fails on Windows in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331999&quot;&gt;&lt;strike&gt;JDK-8331999&lt;/strike&gt;&lt;/a&gt;: BasicDirectoryModel/LoaderThreadCount.java frequently fails on Windows in CI&lt;br/&gt;
&lt;br/&gt;
The former makes the test run on Windows only, the latter improves its stability on Windows.&lt;br/&gt;
&lt;br/&gt;
There&amp;#39;s a bug &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331494&quot; title=&quot;BasicDirectoryModel/LoaderThreadCount.java fails in CI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331494&quot;&gt;JDK-8331494&lt;/a&gt; to make the test stable on Linux and macOS if possible.</comment>
                            <comment id="14669542" author="roboduke" created="Wed, 1 May 2024 05:04:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22u/pull/175&quot;&gt;https://git.openjdk.org/jdk22u/pull/175&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-01 12:00:44 +0000</comment>
                            <comment id="14669541" author="aivanov" created="Wed, 1 May 2024 05:01:03 -0700"  >Fix request: 22u&lt;br/&gt;
&lt;br/&gt;
Provides a regression test for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8325179&quot; title=&quot;Race in BasicDirectoryModel.validateFileCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8325179&quot;&gt;&lt;strike&gt;JDK-8325179&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
The backport is clean. Low risk.&lt;br/&gt;
&lt;br/&gt;
Pull request: &lt;a href=&quot;https://github.com/openjdk/jdk22u/pull/175&quot;&gt;https://github.com/openjdk/jdk22u/pull/175&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Edit:&lt;br/&gt;
If this is approved for 22u, &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8331495&quot; title=&quot;Limit BasicDirectoryModel/LoaderThreadCount.java to Windows only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8331495&quot;&gt;&lt;strike&gt;JDK-8331495&lt;/strike&gt;&lt;/a&gt; needs to be approved too.&lt;br/&gt;
The test proved to be unstable in CI on Linux and macOS. Thus, it&amp;#39;s limited to Windows only.</comment>
                            <comment id="14669540" author="dukebot" created="Wed, 1 May 2024 04:54:32 -0700"  >Changeset: b2fb5ea1&lt;br/&gt;
Author:    Alexey Ivanov &amp;lt;&lt;a href=&apos;mailto:aivanov@openjdk.org&apos;&gt;aivanov@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-05-01 11:53:28 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/b2fb5ea13ba5087411410519213fc953ecc44618&quot;&gt;https://git.openjdk.org/jdk/commit/b2fb5ea13ba5087411410519213fc953ecc44618&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14668040" author="roboduke" created="Thu, 25 Apr 2024 09:46:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/18957&quot;&gt;https://git.openjdk.org/jdk/pull/18957&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-25 16:37:39 +0000</comment>
                            <comment id="14668033" author="aivanov" created="Thu, 25 Apr 2024 09:37:36 -0700"  >Just like ConcurrentModification.java in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8327137&quot; title=&quot;Add test for ConcurrentModificationException in BasicDirectoryModel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8327137&quot;&gt;&lt;strike&gt;JDK-8327137&lt;/strike&gt;&lt;/a&gt;, the test creates a temporary directory in the current directory and creates a number of files in it. (The number of files is controlled by NUMBER_OF_THREADS constant). Then the test creates `JFileChooser` in the temporary directory.&lt;br/&gt;
&lt;br/&gt;
The test starts several scanner threads, the number is controlled by NUMBER_OF_THREADS, which repeatedly call `fileChooser.rescanCurrentDirectory()`. This results in calling `BasicDirectoryModel.validateFileCache` which starts a background thread &#8212; &amp;quot;Basic L&amp;amp;F File Loading Thread&amp;quot; &#8212; to enumerate the files.&lt;br/&gt;
&lt;br/&gt;
The test runner thread and scanner threads are synchronised with `CyclicBarrier`, this ensures all the scanner threads start at the same time. After a short delay, the runner thread takes a snapshot of live threads. After a longer delay, the operation is repeated. See the `getThreadSnapshot` method. (The number of snapshots is controlled by SNAPSHOTS constant.)&lt;br/&gt;
&lt;br/&gt;
The number of File Loading Threads in each snapshot is counted. There should be no more than two threads. It is possible that thread two such threads after &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8325179&quot; title=&quot;Race in BasicDirectoryModel.validateFileCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8325179&quot;&gt;&lt;strike&gt;JDK-8325179&lt;/strike&gt;&lt;/a&gt; is fixed: the existing thread is interrupted but hasn&amp;#39;t exited yet, and a new thread is already created.&lt;br/&gt;
&lt;br/&gt;
The test fails consistently without the fix for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8325179&quot; title=&quot;Race in BasicDirectoryModel.validateFileCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8325179&quot;&gt;&lt;strike&gt;JDK-8325179&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
With the fix, the test always passes.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5130631">JDK-8333216</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130672">JDK-8333255</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5130705">JDK-8333287</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5131006">JDK-8333536</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5132000">JDK-8334383</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5143584">JDK-8343959</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5128440">JDK-8331495</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5128439">JDK-8331494</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5129135">JDK-8331999</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5120642">JDK-8325179</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3636z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17412"><![CDATA[b21]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="206"><![CDATA[javax.swing]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>