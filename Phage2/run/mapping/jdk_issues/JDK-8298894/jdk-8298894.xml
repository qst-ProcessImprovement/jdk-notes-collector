<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 14:58:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8298894] java/lang/Thread/virtual/stress/Skynet.java timed out and threw OutOfMemoryError</title>
                <link>https://bugs.openjdk.org/browse/JDK-8298894</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK20 CI:&lt;br/&gt;
&lt;br/&gt;
java/lang/Thread/virtual/stress/Skynet.java#id1&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
#section:main&lt;br/&gt;
----------messages:(8/440)----------&lt;br/&gt;
command: main -XX:+UnlockDiagnosticVMOptions -XX:+ZVerifyViews -XX:ZCollectionInterval=0.01 Skynet&lt;br/&gt;
reason: User specified action: run main/othervm/timeout=300 -XX:+UnlockDiagnosticVMOptions -XX:+ZVerifyViews -XX:ZCollectionInterval=0.01 Skynet &lt;br/&gt;
started: Thu Dec 15 22:08:55 GMT 2022&lt;br/&gt;
Mode: othervm [/othervm specified]&lt;br/&gt;
Timeout information:&lt;br/&gt;
--- Timeout information end.&lt;br/&gt;
finished: Thu Dec 15 23:02:39 GMT 2022&lt;br/&gt;
elapsed time (seconds): 3223.784&lt;br/&gt;
----------configuration:(0/0)----------&lt;br/&gt;
----------System.out:(1362/89123)----------&lt;br/&gt;
Result: 499999500000 in 35984 ms&lt;br/&gt;
Timeout refired 3000 times&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in VM (AttachListener::init) : &lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
2022-12-15 23:00:15&lt;br/&gt;
Full thread dump Java HotSpot(TM) 64-Bit Server VM (20-ea+28-2221 compiled mode, sharing):&lt;br/&gt;
&lt;br/&gt;
Threads class SMR info:&lt;br/&gt;
_java_thread_list=0x00007fec2cd32370, length=13, elements={&lt;br/&gt;
0x00007fec2d809610, 0x00007fec2d010210, 0x00007fec2f00a410, 0x00007fec2d82b610,&lt;br/&gt;
0x00007fec2f00b010, 0x00007fec2d81fe10, 0x00007fec2d82c610, 0x00007fec2d196410,&lt;br/&gt;
0x00007fec2e8a5610, 0x00007fec2d01c410, 0x00007fec2d828810, 0x00007fec2d829010,&lt;br/&gt;
0x00007fec2e812410&lt;br/&gt;
}&lt;br/&gt;
_to_delete_list=0x00007fec2ccd9610, length=14, elements={&lt;br/&gt;
0x00007fec2d809610, 0x00007fec2d010210, 0x00007fec2f00a410, 0x00007fec2d82b610,&lt;br/&gt;
0x00007fec2f00b010, 0x00007fec2d81fe10, 0x00007fec2d82c610, 0x00007fec2d196410,&lt;br/&gt;
0x00007fec2e8a5610, 0x00007fec2d01c410, 0x00007fec2d828810, 0x00007fec2d829010,&lt;br/&gt;
0x00007fec2e812410, 0x00007fec3200fa10&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
&lt;br/&gt;
&amp;quot;VM Periodic Task Thread&amp;quot; os_prio=31 cpu=529.46ms elapsed=3073.43s tid=0x00007fec2ff33210 nid=39943 waiting on condition  &lt;br/&gt;
&lt;br/&gt;
JNI global refs: 9, weak refs: 0&lt;br/&gt;
&lt;br/&gt;
Heap&lt;br/&gt;
&amp;nbsp;ZHeap           used 768M, capacity 768M, max capacity 768M&lt;br/&gt;
&amp;nbsp;Metaspace       used 2951K, committed 3136K, reserved 1114112K&lt;br/&gt;
&amp;nbsp;&amp;nbsp;class space    used 94K, committed 192K, reserved 1048576K&lt;br/&gt;
&lt;br/&gt;
----------System.err:(23/2079)----------&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; java.lang.AssertionError&lt;br/&gt;
	at java.base/java.lang.VirtualThread.park(VirtualThread.java:571)&lt;br/&gt;
	at java.base/java.lang.System$2.parkVirtualThread(System.java:2630)&lt;br/&gt;
	at java.base/jdk.internal.misc.VirtualThreads.park(VirtualThreads.java:54)&lt;br/&gt;
	at java.base/java.util.concurrent.locks.LockSupport.park(LockSupport.java:369)&lt;br/&gt;
	at java.base/java.util.concurrent.SynchronousQueue$TransferStack$SNode.block(SynchronousQueue.java:288)&lt;br/&gt;
	at java.base/java.util.concurrent.ForkJoinPool.unmanagedBlock(ForkJoinPool.java:3780)&lt;br/&gt;
	at java.base/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3725)&lt;br/&gt;
	at java.base/java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:397)&lt;br/&gt;
	at java.base/java.util.concurrent.SynchronousQueue.put(SynchronousQueue.java:839)&lt;br/&gt;
	at Skynet$Channel.send(Skynet.java:94)&lt;br/&gt;
	at Skynet.skynet(Skynet.java:68)&lt;br/&gt;
	at Skynet.lambda$skynet$1(Skynet.java:73)&lt;br/&gt;
	at java.base/java.lang.VirtualThread.run(VirtualThread.java:305)&lt;br/&gt;
	at java.base/java.lang.VirtualThread$VThreadContinuation.lambda$new$0(VirtualThread.java:177)&lt;br/&gt;
	at java.base/jdk.internal.vm.Continuation.enter0(Continuation.java:327)&lt;br/&gt;
	at java.base/jdk.internal.vm.Continuation.enter(Continuation.java:320)&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; java.lang.AssertionError&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; java.lang.AssertionError&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; java.lang.AssertionError&lt;br/&gt;
Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; Exception in thread &amp;quot;&amp;quot; &lt;br/&gt;
----------rerun:(45/6511)*----------&lt;br/&gt;
&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
&lt;br/&gt;
result: Error. Program `/System/Volumes/Data/mesos/work_dir/jib-master/install/jdk-20+28-2221/macosx-x64-debug.jdk/jdk-20/fastdebug/bin/java&amp;#39; timed out (timeout set to 3000000ms, elapsed time including timeout handling was 3223773ms).&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5089834">JDK-8298894</key>
            <summary>java/lang/Thread/virtual/stress/Skynet.java timed out and threw OutOfMemoryError</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alanb">Alan Bateman</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>noreg-self</label>
                            <label>problemlist</label>
                            <label>tier8</label>
                            <label>zgc</label>
                    </labels>
                <created>Thu, 15 Dec 2022 16:05:15 -0800</created>
                <updated>Sun, 5 Mar 2023 21:41:58 -0800</updated>
                            <resolved>Mon, 19 Dec 2022 10:07:10 -0800</resolved>
                                    <version>20</version>
                                    <fixVersion>20</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                                                            <comments>
                            <comment id="14547541" author="dcubed" created="Thu, 22 Dec 2022 15:21:04 -0800"  >The fix for this bug is integrated in jdk-21+3-111.</comment>
                            <comment id="14546477" author="dukebot" created="Mon, 19 Dec 2022 10:07:09 -0800"  >Changeset: 2c69c41d&lt;br/&gt;
Author:    Alan Bateman &amp;lt;&lt;a href=&apos;mailto:alanb@openjdk.org&apos;&gt;alanb@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2022-12-19 18:06:19 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk20/commit/2c69c41d48fddcbeb40a374f691b7e5faba3c99a&quot;&gt;https://git.openjdk.org/jdk20/commit/2c69c41d48fddcbeb40a374f691b7e5faba3c99a&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14546447" author="roboduke" created="Mon, 19 Dec 2022 07:57:27 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk20/pull/54&quot;&gt;https://git.openjdk.org/jdk20/pull/54&lt;/a&gt;&lt;br/&gt;
Date: 2022-12-19 14:24:28 +0000</comment>
                            <comment id="14546377" author="eosterlund" created="Mon, 19 Dec 2022 02:04:27 -0800"  >Looking at the GC log when running this locally, it seems like the heap is indeed too tight. There is some garbage showing up, but very little worth reclaiming with the default ZFragmentationLimit. Sometimes it simply doesn&amp;#39;t have enough memory, and FJ pool workers end up being hit by OOM, which inevitably can be problematic. I think you are right [~alanb], the test just needs a bit more memory.</comment>
                            <comment id="14546305" author="alanb" created="Sun, 18 Dec 2022 12:55:09 -0800"  >The Skynet test uses a SynchronousQueue as a channel, and SQ uses Thread.yield to avoid parking. The SQ implementation does need to be re-examined but I think the issue is that the change to use externalSubmit (&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296896&quot; title=&quot;Change virtual Thread.yield to use external submit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296896&quot;&gt;&lt;strike&gt;JDK-8296896&lt;/strike&gt;&lt;/a&gt;) means the test requires a bit more heap than it did previously. The test passes consistently with -Xmx1g but fails intermittently on a macOS debug build and -Xmx768m (the current default).&lt;br/&gt;
&lt;br/&gt;
In passing, the assert triggered in park appears to be Continuation.yield failing with OOME, leading to an attempt to park on the carrier thread and an attempt to emit a JFR event. If the allocation of the event object fails then it will unwind without resetting the thread state. As it happens, Robbin spotted this issue very recently too.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5090107">JDK-8299102</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5089461">JDK-8298594</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5089461">JDK-8298594</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5095552">JDK-8303635</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                                              <subtask id="5089985">JDK-8298990</subtask>
                                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zner:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17413"><![CDATA[b29]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="190"><![CDATA[java.lang]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>