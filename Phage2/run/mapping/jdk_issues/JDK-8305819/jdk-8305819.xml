<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:28:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8305819] LogConfigurationTest intermittently fails on AArch64</title>
                <link>https://bugs.openjdk.org/browse/JDK-8305819</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Create on behalf of gaodan&amp;lt;&lt;a href=&apos;mailto:gaodan.gao@alibaba-inc.com&apos;&gt;gaodan.gao@alibaba-inc.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
---&lt;br/&gt;
&lt;br/&gt;
The following tests intermittently fail on AArch64:&lt;br/&gt;
&lt;br/&gt;
TEST_VM_F(LogConfigurationTest, reconfigure_decorators)&lt;br/&gt;
TEST_VM_F(LogConfigurationTest, reconfigure_decorators_MT)&lt;br/&gt;
&lt;br/&gt;
---&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  SIGBUS (0x7) at pc=0x0000000000000021, pid=1762387, tid=1762473&lt;br/&gt;
#&lt;br/&gt;
# JRE version: OpenJDK Runtime Environment (21.0) (build 21-internal-adhoc.yansendao.jdk)&lt;br/&gt;
# Java VM: OpenJDK 64-Bit Server VM (21-internal-adhoc.yansendao.jdk, mixed mode, tiered, compressed oops, compressed class ptrs, g1 gc, linux-aarch64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0xcbf050]  LogTagSet::vwrite(LogLevel::type, char const*, std::__va_list)+0x300&lt;br/&gt;
#&lt;br/&gt;
# Core dump will be written. Default location: /cloud/data/corefile/core-%e-1762387-%t-%h&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
---------------  S U M M A R Y ------------&lt;br/&gt;
&lt;br/&gt;
Command Line: -XX:+ExecutingUnitTests &lt;br/&gt;
&lt;br/&gt;
Host: AArch64, 96 cores, 755G, Anolis OS release 8.8&lt;br/&gt;
Time: Mon Apr 10 12:08:22 2023 CST elapsed time: 0.474275 seconds (0d 0h 0m 0s)&lt;br/&gt;
&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&lt;br/&gt;
Current thread (0x0000aaaadbf6b310):  JavaThread &amp;quot;JavaTestThread&amp;quot; daemon [_thread_in_vm, id=1762473, stack(0x0000ffff44cde000,0x0000ffff44ede000)]&lt;br/&gt;
&lt;br/&gt;
Stack: [0x0000ffff44cde000,0x0000ffff44ede000],  sp=0x0000ffff44edc380,  free space=2040k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0xcbf050]  LogTagSet::vwrite(LogLevel::type, char const*, std::__va_list)+0x300  (logTagSet.cpp:83)&lt;br/&gt;
V  [libjvm.so+0x3be264]  void LogImpl&amp;lt;(LogTag::type)69, (LogTag::type)0, (LogTag::type)0, (LogTag::type)0, (LogTag::type)0, (LogTag::type)0&amp;gt;::write&amp;lt;(LogLevel::type)2&amp;gt;(char const*, ...)+0x84  (log.hpp:148)&lt;br/&gt;
V  [libjvm.so+0x4a2a94]  UnitTestThread::main_run()+0x6c  (test_logConfiguration.cpp:238)&lt;br/&gt;
V  [libjvm.so+0x418c6c]  JavaTestThread::test_thread_entry(JavaThread*, JavaThread*)+0x1c  (threadHelper.inline.hpp:118)&lt;br/&gt;
V  [libjvm.so+0xabc738]  JavaThread::thread_main_inner()+0x178  (javaThread.cpp:717)&lt;br/&gt;
V  [libjvm.so+0x1002e4c]  Thread::call_run()+0xa4  (thread.cpp:224)&lt;br/&gt;
V  [libjvm.so+0xdf6e24]  thread_native_entry(Thread*)+0xdc  (os_linux.cpp:740)&lt;br/&gt;
C  [libpthread.so.0+0x78b8]  start_thread+0x188&lt;br/&gt;
&lt;br/&gt;
siginfo: si_signo: 7 (SIGBUS), si_code: 1 (BUS_ADRALN), si_addr: 0x0000000000000021&lt;br/&gt;
&lt;br/&gt;
Registers:&lt;br/&gt;
R0=0x0000aaaadbc33cd0&lt;br/&gt;
R1=0x0000ffff44edc438&lt;br/&gt;
R2=0x0000ffff44edc468&lt;br/&gt;
R3=0x0000000000000021&lt;br/&gt;
R4=0x00000000000000c0&lt;br/&gt;
R5=0x0000fffef4000ce0&lt;br/&gt;
R6=0x000000000000000a&lt;br/&gt;
R7=0x000000000000000a&lt;br/&gt;
R8=0x0000000000000040&lt;br/&gt;
R9=0xffffff80ffffffd0&lt;br/&gt;
R10=0x0000000000000001&lt;br/&gt;
R11=0x0000ffff44edc088&lt;br/&gt;
R12=0x696d652030206574&lt;br/&gt;
R13=0x676f6c2061207374&lt;br/&gt;
R14=0x0000000000000000&lt;br/&gt;
R15=0x00003017fe000000&lt;br/&gt;
R16=0x0000000000000001&lt;br/&gt;
R17=0x0000ffff9a520b70&lt;br/&gt;
R18=0x00000000000007e9&lt;br/&gt;
R19=0x0000ffff44edc438&lt;br/&gt;
R20=0x0000ffff9be80ca8&lt;br/&gt;
R21=0x0000aaaadbf6b080&lt;br/&gt;
R22=0x0000ffff44edc468&lt;br/&gt;
R23=0x0000ffff9be4e000&lt;br/&gt;
R24=0x0000ffff9be80cd0&lt;br/&gt;
R25=0x0000000000000002&lt;br/&gt;
R26=0x0000ffff44edc3f0&lt;br/&gt;
R27=0x0000ffff9be80d08&lt;br/&gt;
R28=0x00000000000003d8&lt;br/&gt;
R29=0x0000ffff44edc380&lt;br/&gt;
R30=0x0000ffff9b48f054&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Register to memory mapping:&lt;br/&gt;
&lt;br/&gt;
R0 =0x0000aaaadbc33cd0 points into unknown readable memory: 0x0000aaaadbc33d10 | 10 3d c3 db aa aa 00 00&lt;br/&gt;
R1 =0x0000ffff44edc438 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R2 =0x0000ffff44edc468 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R3 =0x0000000000000021 is an unknown value&lt;br/&gt;
R4 =0x00000000000000c0 is an unknown value&lt;br/&gt;
R5 =0x0000fffef4000ce0 points into unknown readable memory: 0x6e65727275636e6f | 6f 6e 63 75 72 72 65 6e&lt;br/&gt;
R6 =0x000000000000000a is an unknown value&lt;br/&gt;
R7 =0x000000000000000a is an unknown value&lt;br/&gt;
R8 =0x0000000000000040 is an unknown value&lt;br/&gt;
R9 =0xffffff80ffffffd0 is an unknown value&lt;br/&gt;
R10=0x0000000000000001 is an unknown value&lt;br/&gt;
R11=0x0000ffff44edc088 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R12=0x696d652030206574 is an unknown value&lt;br/&gt;
R13=0x676f6c2061207374 is an unknown value&lt;br/&gt;
R14=0x0 is nullptr&lt;br/&gt;
R15=0x00003017fe000000 is an unknown value&lt;br/&gt;
R16=0x0000000000000001 is an unknown value&lt;br/&gt;
R17=0x0000ffff9a520b70: sem_post+0x0000000000000000 in /lib64/libpthread.so.0 at 0x0000ffff9a510000&lt;br/&gt;
R18=0x00000000000007e9 is an unknown value&lt;br/&gt;
R19=0x0000ffff44edc438 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R20=0x0000ffff9be80ca8: &amp;lt;offset 0x00000000016b0ca8&amp;gt; in /home/yansendao/git/jdk/build/linux-aarch64-server-release/images/test/hotspot/gtest/server/libjvm.so at 0x0000ffff9a7d0000&lt;br/&gt;
R21=0x0000aaaadbf6b080 points into unknown readable memory: 0x0000aaaadbf6b0c0 | c0 b0 f6 db aa aa 00 00&lt;br/&gt;
R22=0x0000ffff44edc468 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R23=0x0000ffff9be4e000: &amp;lt;offset 0x000000000167e000&amp;gt; in /home/yansendao/git/jdk/build/linux-aarch64-server-release/images/test/hotspot/gtest/server/libjvm.so at 0x0000ffff9a7d0000&lt;br/&gt;
R24=0x0000ffff9be80cd0: &amp;lt;offset 0x00000000016b0cd0&amp;gt; in /home/yansendao/git/jdk/build/linux-aarch64-server-release/images/test/hotspot/gtest/server/libjvm.so at 0x0000ffff9a7d0000&lt;br/&gt;
R25=0x0000000000000002 is an unknown value&lt;br/&gt;
R26=0x0000ffff44edc3f0 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R27=0x0000ffff9be80d08: &amp;lt;offset 0x00000000016b0d08&amp;gt; in /home/yansendao/git/jdk/build/linux-aarch64-server-release/images/test/hotspot/gtest/server/libjvm.so at 0x0000ffff9a7d0000&lt;br/&gt;
R28=0x00000000000003d8 is an unknown value&lt;br/&gt;
R29=0x0000ffff44edc380 is pointing into the stack for thread: 0x0000aaaadbf6b310&lt;br/&gt;
R30=0x0000ffff9b48f054: &amp;lt;offset 0x0000000000cbf054&amp;gt; in /home/yansendao/git/jdk/build/linux-aarch64-server-release/images/test/hotspot/gtest/server/libjvm.so at 0x0000ffff9a7d0000&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5098193">JDK-8305819</key>
            <summary>LogConfigurationTest intermittently fails on AArch64</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yyang">Yi Yang</assignee>
                                    <reporter username="yyang">Yi Yang</reporter>
                        <labels>
                            <label>intermittent</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>logging</label>
                    </labels>
                <created>Mon, 10 Apr 2023 19:12:07 -0700</created>
                <updated>Thu, 16 May 2024 01:33:24 -0700</updated>
                            <resolved>Mon, 15 May 2023 02:18:10 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14673067" author="roboduke" created="Mon, 13 May 2024 19:29:30 -0700"  >[jdk17u-fix-request] Approval Request from Liang Mao&lt;br/&gt;
backport of fixing crash due to weak memory model. Conflicts come from  the difference of &amp;quot;NULL&amp;quot; and &amp;quot;nullptr&amp;quot;. Risk is very low.</comment>
                            <comment id="14672866" author="roboduke" created="Mon, 13 May 2024 03:25:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2460&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2460&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-13 10:20:31 +0000</comment>
                            <comment id="14581509" author="dukebot" created="Mon, 15 May 2023 02:18:09 -0700"  >Changeset: 911cc7cb&lt;br/&gt;
Author:    gaogao-mem &amp;lt;&lt;a href=&apos;mailto:gaodan.gao@alibaba-inc.com&apos;&gt;gaodan.gao@alibaba-inc.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Yi Yang &amp;lt;&lt;a href=&apos;mailto:yyang@openjdk.org&apos;&gt;yyang@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-15 09:16:32 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/911cc7cb07ed44b24b4c20977d7d6e475bd1b234&quot;&gt;https://git.openjdk.org/jdk/commit/911cc7cb07ed44b24b4c20977d7d6e475bd1b234&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14577785" author="xliu" created="Fri, 28 Apr 2023 17:56:07 -0700"  >I ran 5000 times on an EC2 m6g instance.  no luck. &lt;br/&gt;
This is the command and I use the trunk. &lt;br/&gt;
&lt;br/&gt;
$./build/linux-aarch64-server-release/images/test/hotspot/gtest/server/gtestLauncher -jdk /home/ubuntu/Devel/jdk/build/linux-aarch64-server-release/images/jdk --gtest_filter=&amp;#39;LogConfigurationTest.reconfigure*_MT*&amp;#39;&lt;br/&gt;
&lt;br/&gt;
can you only trigger it on your 96-core instance? what about more common aarch64 processor such as apple m1? </comment>
                            <comment id="14577782" author="xliu" created="Fri, 28 Apr 2023 17:18:34 -0700"  >Thank you for investigating this issue. &lt;br/&gt;
&lt;br/&gt;
I suspect something is wrong in this function.  &lt;br/&gt;
```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;1 void LogOutputList::add_output(LogOutput* output, LogLevelType level) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;2   LogOutputNode* node = new LogOutputNode();&lt;br/&gt;
&amp;nbsp;&amp;nbsp;3   node-&amp;gt;_value = output;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;4   node-&amp;gt;_level = level;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;5&lt;br/&gt;
&amp;nbsp;&amp;nbsp;6   // Set the next pointer to the first node of a lower level&lt;br/&gt;
&amp;nbsp;&amp;nbsp;7   for (node-&amp;gt;_next = _level_start[level];&lt;br/&gt;
&amp;nbsp;&amp;nbsp;8        node-&amp;gt;_next != nullptr &amp;amp;&amp;amp; node-&amp;gt;_next-&amp;gt;_level == level;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;9        node-&amp;gt;_next = node-&amp;gt;_next-&amp;gt;_next) {&lt;br/&gt;
&amp;nbsp;10   }&lt;br/&gt;
&amp;nbsp;11&lt;br/&gt;
&amp;nbsp;12   // Update the _level_start index&lt;br/&gt;
&amp;nbsp;13   for (int l = LogLevel::Last; l &amp;gt;= level; l--) {&lt;br/&gt;
&amp;nbsp;14     if (_level_start[l] == nullptr || _level_start[l]-&amp;gt;_level &amp;lt; level) {&lt;br/&gt;
&amp;nbsp;15       _level_start[l] = node;&lt;br/&gt;
&amp;nbsp;16     }&lt;br/&gt;
&amp;nbsp;17   }&lt;br/&gt;
&amp;nbsp;18&lt;br/&gt;
&amp;nbsp;19   // Add the node the list&lt;br/&gt;
&amp;nbsp;20   for (LogOutputNode* cur = _level_start[LogLevel::Last]; cur != nullptr; cur = cur-&amp;gt;_next) {&lt;br/&gt;
&amp;nbsp;21     if (cur != node &amp;amp;&amp;amp; cur-&amp;gt;_next == node-&amp;gt;_next) {&lt;br/&gt;
&amp;nbsp;22       cur-&amp;gt;_next = node;&lt;br/&gt;
&amp;nbsp;23       break;&lt;br/&gt;
&amp;nbsp;24     }&lt;br/&gt;
&amp;nbsp;25   }&lt;br/&gt;
&amp;nbsp;26 }&lt;br/&gt;
```&lt;br/&gt;
we can dive it into 2 logical parts.  [2-10] constructs a node: value := output, level := level; [12-25] publishes the node.  We put it in the linked_list.&lt;br/&gt;
&lt;br/&gt;
Because of weak memory order, aarch64 may reorder stores. &lt;br/&gt;
Readers(other threads) may see the value at 15 before the store at line 3 is seen. &lt;br/&gt;
if a reader attempts to output logs via the node with uninitialized &amp;#39;output&amp;#39;, it&amp;#39;s very likely to crash. &lt;br/&gt;
&lt;br/&gt;
I think we need a storestore barrier between those 2 parts. As long as we publish a well initialized node, it&amp;#39;s fine. &lt;br/&gt;
// StoreStore: Store1(s); StoreStore; Store2&lt;br/&gt;
//&lt;br/&gt;
// Ensures that Store1 completes (the effect on memory of Store1 is made&lt;br/&gt;
// visible to other processors) before Store2 and any subsequent store&lt;br/&gt;
// operations.  Stores before Store1 may *not* float below Store2 and any&lt;br/&gt;
// subsequent store operations.&lt;br/&gt;
&lt;br/&gt;
I don&amp;#39;t think it&amp;#39;s necessary to deploy a release-acquire because we don&amp;#39;t mandate readers to pick up the new node. it&amp;#39;s totally fine to use the older node.  &lt;br/&gt;
In this case,  old and new node are identical. &lt;br/&gt;
&lt;br/&gt;
</comment>
                            <comment id="14577190" author="dholmes" created="Wed, 26 Apr 2023 19:45:43 -0700"  >Is the solution as simple as the test needing to use the ConfigurationLock?&lt;br/&gt;
&lt;br/&gt;
Edit: no that is already used by the configuration code. The issue is more subtle but needs more indepth investigation - see comments in PR.</comment>
                            <comment id="14576618" author="roboduke" created="Tue, 25 Apr 2023 03:57:25 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13421&quot;&gt;https://git.openjdk.org/jdk/pull/13421&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-11 08:45:56 +0000</comment>
                            <comment id="14575026" author="yyang" created="Wed, 19 Apr 2023 04:27:26 -0700"  >Hi [~jsjolen], thanks for paying attention to this, but it has been taking over in PR#13421. Thanks.</comment>
                            <comment id="14574784" author="mseledtsov" created="Tue, 18 Apr 2023 11:19:14 -0700"  >ILW = HLL = P4</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5129590">JDK-8332366</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="103385" name="hs_err_pid1762387.log" size="92756" author="yyang" created="Mon, 10 Apr 2023 19:13:07 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i312eb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17433"><![CDATA[b23]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>