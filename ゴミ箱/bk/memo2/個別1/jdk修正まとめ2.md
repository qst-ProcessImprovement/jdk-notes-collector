OpenJDK 21.0.7+6 リリースノート

1.0 はじめに (Introduction)

このドキュメントは、OpenJDKバージョン21.0.7+6リリースに含まれる重要な変更、バグ修正、および機能強化に関する詳細かつ包括的な概要を提供します。このアップデートは、Javaプラットフォームの安定性、セキュリティ、およびパフォーマンスを向上させることを目的とした、開発チームによる継続的な取り組みを反映したものです。変更点はHotSpot VM、コアライブラリ、セキュリティコンポーネント、クライアントライブラリなど、JDKの様々なコンポーネントに及んでいます。本リリースノートは、開発者、システム管理者、およびエンドユーザーがこれらの変更点を理解し、自身のアプリケーションや環境への影響を評価するための一助となるよう構成されています。

以下では、本リリースに含まれる修正と機能強化について、まず重要なセキュリティアップデートから詳述します。

2.0 セキュリティ (Security)

Javaプラットフォームにおけるセキュリティアップデートは、エコシステム全体の整合性と安全性を維持するための戦略的な最優先事項です。本リリースでは、トラストストアの更新、脆弱性の修正、およびセキュリティ関連APIの改善によってJDKのセキュリティ体制を大幅に強化しています。これらの変更は、潜在的な脅威からアプリケーションを保護し、最新の業界標準との整合性を確保することを目的としています。

このリリースにおける主要なセキュリティ強化点は以下の通りです。

* JDK-8337664, JDK-8349870, JDK-8356530: 特定のEntrustおよびCamerfirmaルート認証局（CA）によって発行されたTLSサーバー証明書について、信頼ポリシーが更新されました。この変更は、主要なブラウザベンダーが主導する業界全体のセキュリティイニシアチブとJDKを整合させるものです。具体的には、EntrustのルートCAから発行された証明書は2024年10月31日以降は信頼されなくなり、CamerfirmaのルートCAは信頼リストから削除されます。これにより、ユーザーは将来の潜在的な侵害から保護されます。必要に応じて、jdk.security.caDistrustPoliciesセキュリティプロパティから該当するポリシー名を削除することで、この制限を一時的に回避することが可能です。
* JDK-8351960: 2025年5月に有効期限が切れるBaltimoreルート証明書が削除されました。これは、期限切れまたは信頼性の低い証明書を定期的に削除する、証明書のライフサイクル管理における標準的な手続きの一環です。
* JDK-8348065: 先頭にピリオドを含むホスト名（例：.example.com）に対する証明書の名前制約の検証が不適切であった問題が修正されました。この修正により、証明書パスの検証がより厳格かつ正確になり、セキュリティが向上します。
* JDK-8355101: DistributionPointFetcherの動作が改善され、証明書失効リスト（CRL）の配布ポイントが複数存在する状況で、最初の配布ポイントへのアクセスに失敗した場合でも後続の配布ポイントへのフォールバックが試行されるようになりました。これにより、ネットワークの問題など一時的な障害が発生した場合でも証明書の失効状態を正しく確認できる可能性が高まり、失効チェックの信頼性が向上します。
* JDK-8346421: PKCS#11暗号トークンインターフェースのサポートがバージョン3.1に更新されました。これにより、最新のハードウェアセキュリティモジュール（HSM）との相互運用性が向上し、より新しいセキュリティ標準や機能を活用できるようになります。
* JDK-8355713, JDK-8355099: KeyStore.getEntryおよびPKCS12KeyStore.engineGetEntryメソッドにおけるスレッドセーフティの問題が修正されました。マルチスレッド環境下、特にTLSハンドシェイク中にこれらのメソッドが同時に呼び出されると、ConcurrentModificationExceptionが発生する可能性がありましたが、この修正により問題が解決され、アプリケーションの安定性が向上します。
* JDK-8343046: 暗号操作において、提供されたSecureRandomオブジェクトからのみ乱数が読み取られるように修正されました。これにより、乱数生成のソースが一貫し、暗号操作の予測不能性とセキュリティが向上します。

これらのセキュリティ強化は、Javaプラットフォームの堅牢性を維持するために不可欠です。次に、Javaアプリケーションの実行基盤であるJava仮想マシンの内部動作に関する改善点を見ていきましょう。

3.0 HotSpot仮想マシン (HotSpot Virtual Machine)

HotSpot VMに加えられた改善は、Javaランタイムのパフォーマンス、安定性、および観測性の向上に焦点を当てています。これらの変更は、ガベージコレクション（GC）、JIT（Just-In-Time）コンパイル、ランタイムの内部動作、および診断機能といった多岐にわたる領域をカバーしています。開発者は、これらの改善によって、より効率的で信頼性の高いアプリケーション実行環境の恩恵を受けることができます。

3.1 安定性と信頼性の向上 (Stability and Reliability)

このリリースには、JVMのクラッシュを防止し、不正な動作を解決する多数の修正が含まれています。

* JDK-8284620, JDK-8346413: CodeBuffer内で_overflow_arenaがリークする可能性があったメモリリークが修正されました。これにより、特にコンパイラが多用される状況でのC-Heapにおける段階的なメモリ消費が防止され、長期的な安定性が向上します。
* JDK-8341192: コンカレントガベージコレクタの実行中にGetMethodDeclaringClassが原因で発生する可能性があったクラッシュが解決されました。
* JDK-8343538, JDK-8346332, JDK-8355551, JDK-8356676: C2 JITコンパイラにおける一連のクラッシュやアサーション失敗が修正されました。これには、解放済みメモリの使用（use-after-free）エラー、ループ最適化における不正な処理、および特定のコンパイルシナリオにおけるスタックオーバーフローが含まれます。
* JDK-8346900: C1コンパイラによるネイティブメソッド（nmethod）のパッチ適用後、無効なオブジェクトポインタ（oop）へのアクセスが原因で発生していたクラッシュが修正されました。
* JDK-8353102: G1 GCのNUMA（Non-Uniform Memory Access）メモリマイグレーション機能に関連するクラッシュが修正され、NUMAハードウェア上での安定性が向上しました。
* JDK-8350948, JDK-8350949, JDK-8350950, JDK-8354711, JDK-8354712, JDK-8354713: FFM（Foreign Function & Memory）APIのダウンコールで使用されるUpcallLinker内の競合状態と不正なスレッドフィールドアクセスに関する問題が修正されました。これにより、ネイティブコードを呼び出す際の安定性が大幅に向上します。
* JDK-8341054: Windowsプラットフォームにおいて、HotSpotが64を超える論理プロセッサを認識し、利用できるようになりました。これにより、多コアを搭載したハイエンドなサーバーマシンでのパフォーマンスとスケーラビリティが向上します。
* JDK-8353675: 呼び出し元と呼び出し先のフレーム間でパラメータサイズが一致しない場合に、デ最適化中に発生していたクラッシュが修正されました。

3.2 ガベージコレクション (Garbage Collection)

特定のガベージコレクタに関する改善と修正が行われ、パフォーマンスと信頼性が向上しました。

* JDK-8279016, JDK-8351030: Shenandoah GCとJFRリークプロファイラを併用した際に、オブジェクトのマークワードの競合利用が原因で発生していたデータ破損とクラッシュの問題が修正されました。
* JDK-8332717, JDK-8341823, JDK-8344408, JDK-8354271: ZGCのヒューリスティクス内で、特定の条件下で「ゼロ除算」ランタイムエラーが発生する可能性があった複数の問題が解決されました。これにより、潜在的なクラッシュが防止され、ZGCの堅牢性が向上します。
* JDK-8343591: Shenandoah GCにおいても同様のゼロ除算エラーが修正され、その堅牢性が向上しました。
* JDK-8343028: G1 GCにおいて、ネイティブメソッド（nmethod）の数が過小評価されていた問題が修正されました。これにより、GCの統計情報やヒューリスティクスがより正確になりました。

3.3 サービスビリティと観測性 (Serviceability and Observability)

診断および監視ツールの機能が強化され、問題解決能力が向上しました。

* JDK-8294160, JDK-8345914: JVMクラッシュ時に生成されるダンプファイル（hs_errファイル）が改善され、不正なアドレスへの呼び出しや、メモリがコミットされていない領域へのアクセスといった特定の状況で、より有益な情報を提供するようになりました。
* JDK-8322475, JDK-8354579: System.mapおよびSystem.dump_map診断コマンドが大幅に拡張され、各メモリマッピングの常駐セットサイズ（RSS）、ページサイズ、透過的ヒュージページ（THP）の状態、スワップ状態などの詳細なメモリ情報を含むようになりました。これにより、メモリ使用状況の分析が格段に強力になります。
* JDK-8326586, JDK-8351920: System.mapコマンド自体のパフォーマンスが最適化され、大規模なメモリ空間を持つプロセスでも迅速に情報を取得できるようになりました。
* JDK-8346000, JDK-8346108: JFRにおけるネイティブメモリリークの修正（JDK-8346000）が導入されましたが、その後のテストで新たな失敗が発見されたため、このリリースではバックアウト（取り消し）されました（JDK-8346108）。この問題については、「7.3 既知の問題点」セクションで再度言及します。

VMの低レベルな変更は、アプリケーションの実行基盤を強化しますが、次に、開発者が日常的に直接利用する高レベルなコアライブラリの改善点について見ていきましょう。

4.0 コアライブラリ (Core Libraries)

このセクションでは、ほとんどのJavaアプリケーションの基盤を形成する基本的なAPIに加えられた改善点をカバーします。これらの変更は、並行処理、ネットワーキング、ファイルI/Oといった領域における堅牢性、パフォーマンス、および正確性の向上に焦点を当てています。

* JDK-8325203: Windows上でRuntime.exec経由で起動された子プロセスを、親プロセスがSystem.exit(0)で終了する際に道連れにしてしまうという重大なリグレッションが修正されました。この修正により、親プロセスのみが終了するという期待される動作が復元され、自己再起動ロジックを持つアプリケーションなどが正常に動作するようになります。
* JDK-8327501, JDK-8328366, JDK-8344993, JDK-8345417: 共通のForkJoinPoolに関連する一連の複雑な問題とその修正が行われました。最初の修正（JDK-8327501）は、ワーカー・スレッドが特定のクラスローダーへの参照を保持し続けることでクラスのアンロードを妨げる問題を解決しました。しかし、この修正はThread.currentThread().setContextClassLoader(...)の呼び出し時にSecurityExceptionを引き起こすという互換性の問題（JDK-8328366）を発生させました。本リリースでは、この互換性の問題を解決するための追加パッチと共に、元のクラスアンロード問題の修正が再導入されています。
* JDK-8337966: statx syscallがホワイトリストに登録されていない古いバージョンのDocker環境で、Files.readAttributesが「Operation not permitted」エラーで失敗する問題が修正されました。この修正により、statxが失敗した場合に従来のsyscallへフォールバックするようになり、コンテナ環境での互換性が向上しました。
* JDK-8344678, JDK-8348843, JDK-8352097, JDK-8353921: タイムゾーンデータがTZDATAの最新リリースに更新されました。これには、バージョン2024b (JDK-8344678)、2025a (JDK-8348843)、2025b (JDK-8353921)への更新、および2025aリリースで欠落していたzone.tabファイルの修正(JDK-8352097)が含まれます。これにより、JDKは世界各国のタイムゾーン変更に追随し、正確な時刻計算を保証します。
* JDK-8353096: jar:file:およびfile: URLに対するURLConnection.getLastModified()の呼び出し時にファイルハンドルがリークしていた問題が修正されました。タイムスタンプを頻繁にチェックするアプリケーション（例：動的なリソースリロードを行うフレームワーク）でのリソース枯渇を防ぎます。
* JDK-8347876, JDK-8352513: HttpClientに2つの重要な修正が行われました。1つ目（JDK-8347876）は、タイムアウト付きのリクエストが同じHTTP/1.1接続上の後続リクエストを意図せず中止させてしまう可能性があった問題を解決します。2つ目（JDK-8352513）は、HTTP/2のGOAWAYフレームを不正確に処理していた問題を修正します。これらの修正はいずれもHTTPクライアントの堅牢性を向上させます。
* JDK-8343520: サロゲートペアなどの2バイト文字を含む文字列に対してStringBuffer.reverseを繰り返し呼び出すと、誤った結果が返される問題が修正されました。

これらのコアライブラリの改善は、アプリケーションの基本的な動作を安定させます。次に、開発者がコードをビルドし、パッケージ化する際に使用するツールへの変更点を見ていきましょう。

5.0 ツール (Tools)

このセクションでは、Javaコンパイラ（javac）やJARユーティリティ（jar）など、JDKに同梱されている開発ツールの主要な改善点を強調します。これらの変更は、開発ワークフローの信頼性と機能性を向上させることを目的としています。

* JDK-8225377, JDK-8320001, JDK-8341779, JDK-8354893: javacが、コンパイル境界を越えてクラスファイルからロードされた型に対して型アノテーションを正しく関連付けられず、アノテーションプロセッサから可視でなくなるというリグレッションに対処した一連の修正が行われました。この問題は、コンストラクタの戻り値の型（VOID）にアノテーションを追加しようとする際に二次的なクラッシュ（JDK-8320001）を引き起こしていました。
* JDK-8360406: 上記の修正（JDK-8341779由来）に関連する別のクラッシュが発見されたため、このリリースではクラスファイルに型アノテーションを付加するロジックが一時的に無効化されました。この問題の詳細については、「7.3 既知の問題点」セクションを参照してください。
* JDK-8345437: jarコマンドに、アーカイブを展開する際に既存のファイルを上書きしないようにする新しいオプションが追加されました。これにより、ユーザーは展開操作をより詳細に制御できるようになります。
* JDK-8351512, JDK-8354709: jarsignerツールが強化され、署名プロセス中にJARエントリが（例えばマルウェア対策ソフトによって）削除された場合に警告を出力するようになりました。これにより、署名プロセスの透明性が向上し、潜在的な問題を早期に検出できます。

コマンドラインツールから、次はグラフィカルユーザーインターフェース（GUI）を構築するためのライブラリへの改善点に焦点を当てます。

6.0 クライアントライブラリ (Client Libraries)

このセクションでは、AWTおよびSwingフレームワークに加えられた変更の概要を説明します。これらのアップデートは、プラットフォーム固有のバグ修正、現代的なオペレーティングシステムでの動作改善、および過去のバージョンで発生したリグレッションの解決に焦点を当てています。

* JDK-8348625: JDK-8185862による変更が差し戻されました。以前の変更は、Windowsでのヘッドレスモードの検出方法を、仮想ディスプレイのみが存在する場合にヘッドレスと判断するように変更しましたが、これが多くの自動テストフレームワークで予期せぬ問題を引き起こしました。この差し戻しにより、システムプロパティ java.awt.headless が true に設定されている場合にのみシステムがヘッドレスと見なされる、という以前の動作が復元されます。
* JDK-8340023: macOS 13以降で、Frame.setFullScreenWindow()メソッドを使用すると画面が黒一色になるバグが修正されました。これにより、macOSの最新バージョンでフルスクリーンアプリケーションが正しく表示されるようになります。
* JDK-8343255: macOSにおいて、キーボードレイアウトを変更するとKeyEventが異なるキーコードを生成するというリグレッションが修正されました。この修正により、どのようなキーボードレイアウトを使用していても一貫したキーボードイベント処理が復元されます。
* JDK-8353140: Windows上で、他のコンポーネントによってCoInitializeがCOINIT_MULTITHREADEDモードで事前に呼び出されていた場合でも、Desktop.browse()が正しく動作するようになりました。これにより、他のネイティブコンポーネントとの相互運用性が向上します。

ここまでで主要なコンポーネントの更新を見てきました。最後に、その他の雑多な変更点や、ユーザーが認識しておくべき既知の問題点を要約します。

7.0 その他の変更点と既知の問題点 (Other Changes and Known Issues)

この最終セクションでは、手続き的な更新、広範な内部改善の要約、そしてユーザーがこのリリースを利用する際に認識しておくべき重要な既知の問題点やバックアウトされた修正点を強調します。これにより、リリース内容の全体像を透明性をもって提供します。

7.1 バージョン番号の更新 (Version Number Updates)

リリースサイクルの一環として、バージョン文字列に対して以下の手続き的な更新が行われました。

* JDK-8345370: 開発サイクルの開始にあたり、アップデートバージョン番号が7に更新されました。
* JDK-8353904: GA（General Availability）リリースに向けて、バージョン文字列から-ea（早期アクセス）指定子が削除されました。

7.2 ビルドとテストインフラストラクチャ (Build and Test Infrastructure)

このリリースには、JDKのビルドシステムとテストスイートに対する数百もの修正と改善が含まれています。これらの変更は、テストハーネス（jtreg）、テストライブラリ（例：PassFailJFrame）、およびビルド構成（例：GitHub Actionsワークフロー、ccacheのサポート改善）に及びます。これらの内部向けの変更は、JDKの品質と安定性を継続的に確保するために不可欠ですが、エンドユーザーが利用するランタイムの動作には直接影響しません。

7.3 既知の問題点 (Known Issues)

このリリースには、以下の重要な既知の問題や、意図的にバックアウト（取り消し）された修正が含まれています。

* JDK-8346108: JFR（Java Flight Recorder）におけるネイティブメモリリークを修正するために導入されたパッチ（JDK-8346000）が、新たなテスト失敗を引き起こすことが発見されたため、このリリースからバックアウトされました。これは、元のメモリリークがこのバージョンではまだ存在する可能性があることを意味します。今後のアップデートで、より安定した修正が提供される予定です。
* JDK-8360406: javacにおいて、クラスファイルへの型アノテーション付加ロジック（JDK-8341779で導入）が、稀なケースでクラッシュを引き起こす可能性があるため、一時的に無効化されています。この影響として、アノテーションプロセッサがクラスファイルからアノテーションを読み込む際に、一部の型アノテーションが正しく処理されない可能性があります。この問題も将来のリリースで対処される予定です。
