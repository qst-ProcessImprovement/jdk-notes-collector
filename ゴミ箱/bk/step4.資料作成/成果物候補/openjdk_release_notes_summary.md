# OpenJDK 21.0.6, 21.0.7, 21.0.8 リリースノートサマリー

本ドキュメントは、OpenJDK 21の3つの連続したメンテナンスリリース（21.0.6, 21.0.7, 21.0.8）における主要な変更点を要約し、技術的な分析を提供するものです。案件の技術調査段階ではOpenJDK 21.0.5を基準としていましたが、開発開始時点での最新版は21.0.8となっています。このサマリーは、バージョン21.0.5から21.0.8までのギャップを網羅的に理解し、CI/CDパイプラインにおけるビルド安定性、本番環境でのランタイム挙動、そして全体的なセキュリティ体制への潜在的な影響を事前に特定することを目的としています。

## 1. 3バージョンを通じた主要変更点のハイレベルサマリー

このセクションでは、3つのリリース（21.0.6, 21.0.7, 21.0.8）全体を俯瞰し、プロジェクトに最も影響を与える可能性のある重要な変更点を戦略的に特定します。目的は、システムの安定性、セキュリティポリシー、そして後方互換性に関わる修正やリグレッションのロールバックをハイライトし、アップデートに伴うリスクとメリットの全体像を把握することにあります。

以下に、3つのリリースを通じて確認された最も重要な変更点をカテゴリ別に要約します。

### 安定性と信頼性に関する重要な修正:
- **C1コンパイラのクラッシュ修正 (JDK-8346900)**: C1のコードパッチングにおける競合状態がVMクラッシュを引き起こす可能性があった、優先度の高い安定性の問題が解決されました。JITコンパイル負荷が高いアプリケーションの信頼性が直接的に向上します (21.0.7)。
- **ZGCの安定性向上 (JDK-8349657)**: ZGCのバリア除去解析における型チェックの漏れが原因で発生していたセグメンテーションフォールトが修正されました。ZGCを利用する環境での信頼性が向上します (21.0.7)。
- **JFRとShenandoah GCの競合修正 (JDK-8351030)**: JFRのリークプロファイラとShenandoah GCがオブジェクトヘッダを競合して使用することで発生していた不具合が修正されました。Shenandoah環境でのJFR利用時の安定性が確保されます (21.0.8)。
- **G1 GCとNUMAの競合によるクラッシュ修正 (JDK-8353102)**: NUMA環境でOSによるメモリページのマイグレーションがG1 GCのリージョン割り当てと衝突し、JVMがクラッシュする問題が修正されました (21.0.8)。
- **Windowsでの64論理プロセッサ超のサポート (JDK-8341054)**: WindowsプラットフォームでHotspot VMが64を超える論理プロセッサを認識・利用できなかった制限が解消され、大規模サーバーでのスケーラビリティが向上しました (21.0.6)。

### 注目すべき後方互換性への影響:
- **Windowsのヘッドレス挙動の復元 (JDK-8348625)**: 以前の変更で意図せずjava.awt.headlessがtrueに設定されてしまうリグレッションが元に戻されました。これにより、CI/CDパイプラインなど、ヘッドレス環境に依存するGUIアプリケーションのテストの挙動が以前の状態に復元されます (21.0.7)。
- **javacの型アノテーションロジックの一時的無効化 (JDK-8360406)**: これは、この特定の機能に依存するアノテーションプロセッサやビルドツールを破壊する可能性のある、重要かつ一時的な変更です。コンストラクタの型アノテーションを活用するすべてのビルドプロセスの検証が必須となります (21.0.8)。

### セキュリティに関する重要な更新:
- **Sectigoルート証明書の追加 (JDK-8359349)**: デフォルトのトラストストアにSectigoの新しいルート証明書（TLS用2つ、コード署名用2つ）が追加されました (21.0.8)。
- **Camerfirmaルート証明書の段階的廃止**: セキュリティポリシーの更新に伴い、Camerfirmaのルート証明書が段階的に廃止されました。まず21.0.7でTLS証明書が信頼されなくなり (JDK-8349870)、その後21.0.8でcacertsトラストストアから完全に削除されました (JDK-8356530)。
- **有効期限切れに近いBaltimoreルート証明書の削除 (JDK-8351960)**: 2025年5月に有効期限が切れるBaltimore CyberTrustのルート証明書が予防的に削除されました (21.0.8)。

### パフォーマンスに関する改善:
- **二次スーパークラスキャッシュのスケーラビリティ改善 (JDK-8351340)**: 高並行環境下でのパフォーマンスボトルネックとなっていたsecondary_super_cacheのロック戦略などが改善され、スケーラビリティが向上しました (21.0.8)。

これらのハイレベルな変更点を踏まえ、次のセクションからは各バージョンの修正内容をコンポーネント別に詳しく解説していきます。

## 2. OpenJDK 21.0.6 の変更点詳細

OpenJDK 21.0.6は、プラットフォームの安定性、パフォーマンス、セキュリティを継続的に向上させることを目的とした四半期ごとのメンテナンスリリースです。このアップデートには、HotSpot VMの低レベルな修正から、コアライブラリ、クライアントライブラリ、セキュリティに至るまで、広範な領域にわたるバグ修正と改善が含まれています。

### 2.1. Hotspot VMの改善

21.0.6におけるHotSpot VMの改善は、安定性と堅牢性の強化に重点が置かれました。C1/C2 JITコンパイラにおけるアサーションエラーやエッジケースに対処する多数の修正が行われると同時に、G1、ZGC、Shenandoahの各ガベージコレクタにわたる統計情報、競合状態、エラーハンドリングに関するバグが解決されました。

- **コンパイラの堅牢性**: C1およびC2コンパイラにおけるアサーションエラーや不正なコード生成に繋がる複数のバグが修正され、コンパイルプロセスの安定性が高まりました。
- **GCの安定性**: G1, ZGC, Shenandoahといった主要なGCにおいて、統計情報の不整合 (JDK-8343028)、ゼロ除算エラー (JDK-8341823)、並行処理中のクラッシュ (JDK-8341192) などが修正されました。
- **Windowsサポートの強化**: WindowsプラットフォームでHotspot VMが64を超える論理プロセッサを認識・利用できない制限が解消されました (JDK-8341054)。これにより、大規模サーバー環境でのスケーラビリティが向上しています。

### 2.2. コアライブラリの修正

このリリースにおけるコアライブラリの修正は、APIの正確性と信頼性の向上に焦点を当てています。NIOチャネルの競合状態、リフレクションにおける型情報の欠落、タイムゾーンデータの更新といった、アプリケーションの基盤となる部分の堅牢性を高める改善が行われました。

- **タイムゾーンデータの更新**: IANAタイムゾーンデータベースがバージョン2024bに更新され、最新の夏時間ルールが反映されました (JDK-8344678)。
- **NIOの競合状態修正**: SelectableChannelの遅延クローズ処理において、I/O操作と競合してデータ損失を引き起こす可能性があった問題が修正されました (JDK-8341941)。
- **レコードの型情報**: レコードのコンパクトコンストラクタにおいて、ジェネリック型情報がリフレクションAPIから取得できない問題が修正され、リフレクションの正確性が向上しました (JDK-8343828)。

### 2.3. クライアントライブラリの更新

クライアントライブラリの更新は、主にプラットフォーム固有の互換性問題とUIコンポーネントのエッジケースの修正が中心でした。特にmacOSでのフルスクリーン表示のリグレッション修正は、デスクトップアプリケーションのユーザー体験を直接改善する重要な変更です。

- **macOSのフルスクリーン表示**: macOS 13以降でフルスクリーン表示にすると画面が真っ黒になるリグレッションが修正されました (JDK-8340023)。
- **Swingの安定性**: ダイアログが閉じる直前にJComboBoxをクリックするとIllegalComponentStateExceptionが発生する競合状態などが修正されました (JDK-8343043)。

### 2.4. セキュリティライブラリの強化

このリリースでのセキュリティライブラリの強化は、基盤となるコンポーネントの更新と、暗号アルゴリズム実装の正確性確保に重点が置かれました。NSSライブラリやPublic Suffix Listといった外部依存コンポーネントを最新化することで、セキュリティ体制の維持が図られています。

- **NSSライブラリの更新**: JDKに同梱されているNetwork Security Services (NSS) ライブラリがバージョン3.96に更新されました (JDK-8342049)。
- **Public Suffix Listの更新**: HTTPクライアントがクッキーのスコープを正しく制限するために使用するPublic Suffix Listが最新版に更新されました (JDK-8339817)。
- **SHAKE256のバグ修正**: SHAKE256ハッシュ関数の実装で、特定の出力長の場合に不正な結果を生成するバグが修正されました (JDK-8340333)。

### 2.5. サービス性（Serviceability）の向上

サービス性に関する改善は、監視および診断ツールの信頼性向上に焦点を当てています。JMXやJDIに関連するテストの安定化は、アプリケーションの運用管理やデバッグ作業をより円滑に行うための基盤強化に繋がります。

- JMXのリモート起動・停止テストが、より一意なプロセスID（PID）で対象を照合するように改善され、テストの信頼性が向上しました (JDK-8344392)。
- JDI（Java Debug Interface）関連のテストで発生していたタイムアウト問題が修正され、デバッグツールの安定性が向上しました (JDK-8340152)。

### 2.6. ツールとインフラストラクチャ

このリリースでは、JDK自体のビルドプロセスとテスト基盤の安定性を高めるための内部的な改善が行われました。これらの変更は、テストハーネスとの互換性向上や、様々なプラットフォームでのビルドの一貫性を確保することに貢献します。

21.0.6におけるこれらの基盤的な修正はプラットフォームの安定性を高め、21.0.7リリースでの的を絞ったリグレッション修正と重要なバグ解決への道筋をつけました。

## 3. OpenJDK 21.0.7 の変更点詳細

OpenJDK 21.0.7は、既存機能の品質向上を目的としたメンテナンスリリースです。新機能の追加はなく、主にユーザーから報告されたバグの修正とプラットフォーム全体の安定性向上に焦点が当てられています。特に、以前のリリースで発生したリグレッションを修正し、後方互換性を回復させる重要な変更が含まれています。

このリリースで最も注目すべき変更点は、**Windows環境におけるヘッドレスモードの挙動を以前の状態に戻したリグレッション修正（JDK-8348625）**です。これにより、特にCI/CDパイプラインなどの自動化環境でGUI関連のテストを実行する際の安定性が回復します。

### 3.1. HotSpot VMの改善

このリリースにおけるHotSpot VMの改善は、システムの安定性を大幅に向上させる重大なバグ修正が中心でした。特にC1コンパイラとZGCで確認された、直接的なVMクラッシュに繋がる深刻な問題が解決されています。

- **C1コンパイラのクラッシュ修正**: C1コンパイラがコードをパッチングする際に、無効なオブジェクトポインタ（oop）を参照してJVMがクラッシュする可能性があった重大な問題が修正されました (JDK-8346900)。
- **ZGCのセグメンテーションフォールト修正**: ZGCのバリア除去解析において、特定のノードタイプのチェックが漏れていたことに起因して発生していたセグメンテーションフォールトが修正されました (JDK-8349657)。

### 3.2. コアライブラリの修正

コアライブラリの修正は、APIの信頼性と正確性の向上に重点が置かれました。HTTPクライアントの堅牢性向上やFFM APIの競合状態の修正など、特定の条件下で発生していた問題が解決されています。

- **タイムゾーンデータの更新**: IANAタイムゾーンデータベースがバージョン2025aに更新されました (JDK-8348843)。
- **HTTP/1.1クライアントの堅牢性向上**: HTTP/1.1接続上で、タイムアウトしたリクエストが後続の正常なリクエストを誤って中断させてしまう問題が修正されました (JDK-8347876)。
- **FFM APIの競合修正**: Foreign Function & Memory (FFM) APIのアップコール処理において、ガベージコレクションとの競合状態によりデータ破損の可能性があった問題が修正されました (JDK-8354711)。

### 3.3. セキュリティライブラリの強化

このリリースにおけるセキュリティ関連の変更は、証明書の信頼性に関する重要なポリシー更新が中心でした。特定のルートCAの失効は、外部サービスとのTLS接続に影響を与える可能性があるため注意が必要です。

- **CamerfirmaルートCAの失効**: セキュリティポリシーが更新され、Camerfirma社のルートCAによって署名されたTLSサーバー証明書が信頼されなくなりました (JDK-8349870)。
- **PKCS#11プロバイダの安定性向上**: SunPKCS11プロバイダがHSMデバイスとの互換性を向上させるため、暗号メカニズムのチェックロジックが改善されました (JDK-8345884, JDK-8346813)。

### 3.4. クライアントライブラリの更新

クライアントライブラリでは、Windows環境の挙動を以前のバージョンに戻す、後方互換性の観点から非常に重要なリグレッション修正が行われました。また、テストスイートの近代化も継続されています。

- **Windowsヘッドレス挙動の復元**: Windows環境において、意図せずヘッドレスモードが有効化されていたリグレッションが元に戻され、以前の挙動が復元されました (JDK-8348625)。
- **テストのAppletからの脱却**: テストスイートの近代化の一環として、多くのテストが非推奨のAppletからスタンドアロンのmainプログラムへと変換されました。

21.0.7での安定性向上、特に主要領域での予測可能な挙動の回復は、21.0.8リリースが、より複雑な環境固有の問題解決と予防的なセキュリティ管理に集中することを可能にしました。

## 4. OpenJDK 21.0.8 の変更点詳細

OpenJDK 21.0.8は、本調査対象期間の最終版となるリリースです。これまでのアップデートで積み重ねられた改善に加え、さらなる安定性の向上と的を絞ったバグ修正が提供されています。

このリリースで特筆すべきは、**javacの型アノテーションに関するロジックが、深刻なクラッシュを回避するために一時的に無効化された（JDK-8360406）**という予防的な措置です。これは、根本的な修正が完了するまでの間、プラットフォームの安定性を最優先する判断によるものです。

### 4.1. HotSpot VMの改善

このリリースでのHotSpot VMの改善は、特定のGC、CPUアーキテクチャ、またはOS機能の組み合わせで発生していた、再現性の低い複雑な問題の解決に焦点が当てられました。これにより、多様な本番環境におけるVMの堅牢性が向上しています。

- **JFRとShenandoah GCの競合修正**: JFRのリークプロファイラとShenandoah GCがオブジェクトヘッダを競合して使用することで発生していたクラッシュや不具合が修正されました (JDK-8351030)。
- **G1 GCとNUMAのクラッシュ修正**: NUMAアーキテクチャのシステムで、OSによるメモリページのマイグレーションがG1 GCのリージョン割り当てと衝突し、VMがクラッシュする問題が修正されました (JDK-8353102)。
- **AArch64でのVectorizedHashCodeのバグ修正**: AArch64アーキテクチャの特定のプロセッサで、VectorizedHashCodeの組み込み関数が不正な結果を返していたバグが修正されました (JDK-8357820)。

### 4.2. セキュリティライブラリの強化

このリリースでのセキュリティ強化は、トラストストアの継続的なメンテナンスに重点が置かれました。新しいルート証明書の追加と、有効期限が近い証明書の削除は、TLS通信の信頼性を維持するための重要なプロアクティブな管理です。

- **Sectigoルート証明書の追加**: JDKのデフォルトトラストストア（cacerts）に、Sectigo認証局の新しいルート証明書（TLS用2つ、コード署名用2つ）が追加されました (JDK-8359349)。
- **Baltimoreルート証明書の削除**: 2025年5月に有効期限が切れるBaltimore CyberTrustのルート証明書が、将来的な検証エラーを防ぐために予防的に削除されました (JDK-8351960)。

### 4.3. コアライブラリの修正

コアライブラリの修正は、APIの堅牢性とプロトコル準拠性の向上に焦点を当てています。HTTP/2のコネクション管理や、リソースリークの可能性があるエッジケースの修正など、ライブラリの信頼性を高める改善が行われました。

- **タイムゾーンデータの更新**: IANAタイムゾーンデータベースがバージョン2025bに更新されました (JDK-8353921)。
- **HTTP/2クライアントの改善**: HttpClientがHTTP/2のGOAWAYフレームを不適切に処理していたバグが修正され、コネクション管理の信頼性が向上しました (JDK-8352513)。
- **GZIPInputStreamのリソースリーク修正**: GZIPInputStreamのコンストラクタで例外が発生した場合に、内部リソースがリークする可能性があった問題が修正されました (JDK-8356707)。

### 4.4. ツールの修正

このリリースにおけるツールの修正は、javacコンパイラの安定性確保が中心でした。深刻なクラッシュを回避するための予防的措置は、ビルド環境の信頼性を最優先する姿勢を示しています。

- **javacの安定性向上**: コンストラクタの型アノテーション処理でjavacがクラッシュする問題に対し、バックポートによる修正 (JDK-8354893、JDK-8320001の再修正) が行われました。しかし、関連する安定性への懸念（将来的にJDK-8359336で対応予定）から、安定性を優先し、この機能全体を一時的に無効化する予防的措置が取られました (JDK-8360406)。
- **jshellのシグナルハンドリング修正**: JLineライブラリのアップグレード後、jshellでCtrl+Cを押してもシャットダウンフックが呼ばれなくなったリグレッションが修正されました (JDK-8357116)。

これら3つのバージョンにわたる修正内容を総合的に評価し、アップデートに伴う最終的な結論を導き出す必要があります。

## 5. 結論：21.0.5から21.0.8へのアップデートに関する総括

これまでの分析を踏まえ、案件開始にあたりOpenJDK 21.0.5から21.0.8へアップデートする際の全体的な影響を評価し、開発チームが注意すべき点を以下にまとめます。

### 全体的な評価

これらのリリース（21.0.6, 21.0.7, 21.0.8）は、新機能の追加ではなく、プラットフォームの安定性、セキュリティ、パフォーマンスの向上に焦点を当てたメンテナンスリリースです。JVMのクラッシュやリソースリーク、セキュリティ脆弱性など、多数のバグが修正されています。したがって、大規模なアプリケーションの非互換性を引き起こすリスクは低いと評価できます。

### 特に注意すべき変更点

アップデートに伴い、特定の環境やユースケースで挙動に影響を与える可能性のある、以下の変更点には特に注意が必要です。

- **Windowsのヘッドレス挙動の復元 (JDK-8348625)**: CI/CDパイプラインなどでWindows上のGUIテストを実行している場合、この修正によりテストの挙動が以前のバージョンに戻る可能性があります。意図した動作と一致しているか確認を推奨します。
- **javacの型アノテーションロジックの一時的無効化 (JDK-8360406)**: コンストラクタの型アノテーションを利用するアノテーションプロセッサやビルドツールを使用している場合、この機能が無効化された影響を受ける可能性があります。関連するビルドプロセスが正常に動作するか確認が必要です。
- **ルート証明書の更新**: トラストストアの変更（Sectigoの追加、CamerfirmaやBaltimoreの削除）により、外部サービスとのTLS接続に影響が出る可能性があります。接続先の証明書チェーンが新しいトラストストアで引き続き有効か確認することが望ましいです。

### 推奨事項

結論として、OpenJDK 21.0.8へのアップデートは強く推奨されます。多数のバグ修正、特に深刻なJVMクラッシュやセキュリティ脆弱性への対応は、アプリケーションの安定性と安全性を大幅に向上させます。

ただし、上記の注意点を踏まえ、本格的な統合前に的を絞った検証計画を実行することが賢明です。具体的には以下の3つの主要領域に焦点を当てることを推奨します。

1. **CI/CDパイプラインの健全性**: 高度なアノテーション処理に依存するすべてのビルドジョブを実行し、javacの型アノテーションロジックの一時的無効化 (JDK-8360406) によるリグレッションがないことを確認します。

2. **自動GUIテスト**: Windowsエージェント上でGUIテストのフルスイートを再実行し、レガシーなヘッドレス挙動の復元 (JDK-8348625) が期待通りであることを検証します。

3. **外部TLS接続性**: 重要な外部サービスへのTLS接続をテストし、更新されたトラストストアに対して証明書チェーンが引き続き有効であることを保証します。
