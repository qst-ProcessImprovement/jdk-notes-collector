<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:06:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303045] Remove RegionNode::LoopStatus::NeverIrreducibleEntry assert with wrong assumption</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303045</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Happened once in a personal job.&lt;br/&gt;
&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (c:\\sb\\prod\\1676563492\\workspace\\open\\src\\hotspot\\share\\opto\\cfgnode.cpp:439), pid=20508, tid=18308&lt;br/&gt;
#  assert(status != RegionNode::LoopStatus::NeverIrreducibleEntry) failed: do not set this&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0) (fastdebug build 21-internal-LTS-2023-02-16-1602470.daniel.jelinski.jdk)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-internal-LTS-2023-02-16-1602470.daniel.jelinski.jdk, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, windows-amd64)&lt;br/&gt;
&lt;br/&gt;
From hs_err*.log:&lt;br/&gt;
&lt;br/&gt;
---------------  T H R E A D  ---------------&lt;br/&gt;
&lt;br/&gt;
Current thread (0x000001ebe8093700):  JavaThread &amp;quot;C2 CompilerThread0&amp;quot; daemon [_thread_in_native, id=18308, stack(0x00000079d3100000,0x00000079d3200000)]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:  17281 4480 % !   4       DigestEchoServer$HttpsProxyTunnel$1::run @ 2 (164 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00000079d3100000,0x00000079d3200000]&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [jvm.dll+0xbf8011]  os::win32::platform_print_native_stack+0xf1  (os_windows_x86.cpp:236)&lt;br/&gt;
V  [jvm.dll+0xe701b0]  VMError::report+0x10c0  (vmError.cpp:813)&lt;br/&gt;
V  [jvm.dll+0xe71dee]  VMError::report_and_die+0x6ce  (vmError.cpp:1593)&lt;br/&gt;
V  [jvm.dll+0xe72534]  VMError::report_and_die+0x64  (vmError.cpp:1352)&lt;br/&gt;
V  [jvm.dll+0x577307]  report_vm_error+0xb7  (debug.cpp:286)&lt;br/&gt;
V  [jvm.dll+0x457efb]  RegionNode::set_loop_status+0x3b  (cfgnode.cpp:439)&lt;br/&gt;
V  [jvm.dll+0xaa56c6]  IdealLoopTree::split_fall_in+0x156  (loopnode.cpp:3148)&lt;br/&gt;
V  [jvm.dll+0xa8cec6]  IdealLoopTree::beautify_loops+0xf6  (loopnode.cpp:3441)&lt;br/&gt;
V  [jvm.dll+0xa8d6b2]  IdealLoopTree::beautify_loops+0x8e2  (loopnode.cpp:3505)&lt;br/&gt;
V  [jvm.dll+0xa8dbbb]  PhaseIdealLoop::build_and_optimize+0x4db  (loopnode.cpp:4335)&lt;br/&gt;
V  [jvm.dll+0x519018]  PhaseIdealLoop::optimize+0xd8  (loopnode.hpp:1192)&lt;br/&gt;
V  [jvm.dll+0x50c0a2]  Compile::Optimize+0x972  (compile.cpp:2292)&lt;br/&gt;
V  [jvm.dll+0x50969b]  Compile::Compile+0x16bb  (compile.cpp:834)&lt;br/&gt;
V  [jvm.dll+0x427665]  C2Compiler::compile_method+0x145  (c2compiler.cpp:116)&lt;br/&gt;
V  [jvm.dll+0x523b99]  CompileBroker::invoke_compiler_on_method+0x849  (compileBroker.cpp:2240)&lt;br/&gt;
V  [jvm.dll+0x52130d]  CompileBroker::compiler_thread_loop+0x23d  (compileBroker.cpp:1917)&lt;br/&gt;
V  [jvm.dll+0x7ef322]  JavaThread::thread_main_inner+0x282  (javaThread.cpp:711)&lt;br/&gt;
V  [jvm.dll+0xde5833]  Thread::call_run+0x253  (thread.cpp:229)&lt;br/&gt;
V  [jvm.dll+0xbf6948]  os::win32::thread_native_entry+0xb8  (os_windows.cpp:550)&lt;br/&gt;
C  [ucrtbase.dll+0x21bb2]&lt;br/&gt;
C  [KERNEL32.DLL+0x174b4]&lt;br/&gt;
C  [ntdll.dll+0x526a1]&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5094812">JDK-8303045</key>
            <summary>Remove RegionNode::LoopStatus::NeverIrreducibleEntry assert with wrong assumption</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="djelinski">Daniel Jelinski</reporter>
                        <labels>
                            <label>c2</label>
                            <label>intermittent</label>
                            <label>irreducibility</label>
                            <label>oracle-triage-11</label>
                            <label>oracle-triage-17</label>
                            <label>oracle-triage-21</label>
                            <label>regression</label>
                    </labels>
                <created>Tue, 21 Feb 2023 23:27:33 -0800</created>
                <updated>Tue, 28 Mar 2023 01:11:51 -0700</updated>
                            <resolved>Sun, 26 Feb 2023 23:17:36 -0800</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14562966" author="dukebot" created="Sun, 26 Feb 2023 23:17:34 -0800"  >Changeset: d2660a69&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-27 07:15:27 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d2660a6915582d059d456f1ae8c78831b15f0ef2&quot;&gt;https://git.openjdk.org/jdk/commit/d2660a6915582d059d456f1ae8c78831b15f0ef2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14562046" author="roboduke" created="Wed, 22 Feb 2023 06:59:37 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12713&quot;&gt;https://git.openjdk.org/jdk/pull/12713&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-22 13:35:35 +0000</comment>
                            <comment id="14562009" author="JIRAUSER19821" created="Wed, 22 Feb 2023 04:45:57 -0800"  >Update: I was able to construct a reproducer for the assert from other tests, basically as outlined above.&lt;br/&gt;
&lt;br/&gt;
java -jar ~/Documents/asmtools-7.0-build/release/lib/asmtools.jar jasm Test.jasm&lt;br/&gt;
javac TestMain.java&lt;br/&gt;
./java -Xbatch -XX:CompileCommand=compileonly,Test*::test* -XX:CompileCommand=printcompilation,Test*::test* -XX:+PrintInlining -XX:PerMethodTrapLimit=0 TestMain&lt;br/&gt;
&lt;br/&gt;
I get this (for debugging, I print the _head and landing_pad before we call set_loop_status):&lt;br/&gt;
&lt;br/&gt;
CompileCommand: compileonly Test*.test* bool compileonly = true&lt;br/&gt;
CompileCommand: PrintCompilation Test*.test* bool PrintCompilation = true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;782   27    b  3       TestMain::test_outer (7 bytes)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@ 3   Test::test_inner (45 bytes)   callee is too large&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;784   28    b  3       Test::test_inner (45 bytes)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;786   29    b  4       Test::test_inner (45 bytes)&lt;br/&gt;
split_fall_in&lt;br/&gt;
&amp;nbsp;&amp;nbsp;69  Region  === 69 58 98 54  [[ 69 76 80 ]] #reducible  !jvms: Test::test_inner @ bci:23&lt;br/&gt;
&amp;nbsp;118  Region  === 118 _ _  [[ 118 ]] &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;788   30    b  4       TestMain::test_outer (7 bytes)&lt;br/&gt;
split_fall_in&lt;br/&gt;
&amp;nbsp;&amp;nbsp;78  Region  === 78 67 107 63  [[ 78 85 89 ]]  !jvms: Test::test_inner @ bci:23 TestMain::test_outer @ bci:3 (line 32)&lt;br/&gt;
&amp;nbsp;128  Region  === 128 _ _  [[ 128 ]] &lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/home/emanuel/Documents/fork2-jdk/open/src/hotspot/share/opto/cfgnode.cpp:439), pid=691014, tid=691029&lt;br/&gt;
#  assert(status != RegionNode::LoopStatus::NeverIrreducibleEntry) failed: do not set this&lt;br/&gt;
#&lt;br/&gt;
.....</comment>
                            <comment id="14562001" author="JIRAUSER19821" created="Wed, 22 Feb 2023 03:57:02 -0800"  >Quick analysis:&lt;br/&gt;
&lt;br/&gt;
This is part of the stacktrace:&lt;br/&gt;
V  [jvm.dll+0x577307]  report_vm_error+0xb7  (debug.cpp:286)&lt;br/&gt;
V  [jvm.dll+0x457efb]  RegionNode::set_loop_status+0x3b  (cfgnode.cpp:439)&lt;br/&gt;
V  [jvm.dll+0xaa56c6]  IdealLoopTree::split_fall_in+0x156  (loopnode.cpp:3148)&lt;br/&gt;
&lt;br/&gt;
In IdealLoopTree::split_fall_in we call RegionNode::set_loop_status. We want to transfer the loop-status of the old loop header to the new landing_pad. But set_loop_status has an assert that we do not set the default value NeverIrreducibleEntry.&lt;br/&gt;
&lt;br/&gt;
I think I should be able to create an example that triggers this, maybe in this way:&lt;br/&gt;
Loop must be in a inlined method. Then, by default the regions are tagged with NeverIrreducibleEntry (we cannot know if the inlined method sits inside only reducible loops or also inside an irreducible loop). Then, we must make sure that in the inlined method we have a loop that triggers split_fall_in. So we need a loop with multiple fall-in (entry) edges to the same loop-head.&lt;br/&gt;
&lt;br/&gt;
If that is correct, I think we can just remove or at least somehow weaken the assert.</comment>
                            <comment id="14561987" author="JIRAUSER19821" created="Wed, 22 Feb 2023 02:41:32 -0800"  >Ok, I can have a look.</comment>
                            <comment id="14561986" author="thartmann" created="Wed, 22 Feb 2023 02:39:37 -0800"  >Emanuel, please have a look.</comment>
                            <comment id="14561985" author="thartmann" created="Wed, 22 Feb 2023 02:39:16 -0800"  >Initial ILW = (Potentially harmless) assert during C2 compilation, only showed up once with single test, no known workaround but disable compilation of affected method = MLH = P4</comment>
                            <comment id="14561981" author="thartmann" created="Wed, 22 Feb 2023 02:33:33 -0800"  >The assert and corresponding logic was added by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8280126&quot; title=&quot;C2: detect and remove dead irreducible loops&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8280126&quot;&gt;&lt;strike&gt;JDK-8280126&lt;/strike&gt;&lt;/a&gt; in JDK 21.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5066201">JDK-8280126</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102753" name="Test.jasm" size="1988" author="epeter" created="Wed, 22 Feb 2023 04:44:24 -0800"/>
                            <attachment id="102754" name="TestMain.java" size="1448" author="epeter" created="Wed, 22 Feb 2023 04:44:24 -0800"/>
                            <attachment id="102746" name="test-support_jtreg_open_test_jdk_jdk_net_java_net_httpclient_HttpRedirectTest_replay_pid20508.log" size="425868" author="djelinski" created="Tue, 21 Feb 2023 23:30:42 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30htn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17349"><![CDATA[b12]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>