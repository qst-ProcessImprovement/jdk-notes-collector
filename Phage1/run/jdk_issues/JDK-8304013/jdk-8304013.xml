<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:37:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8304013] Add a fast, non-manual alternative to test/jdk/java/util/zip/ZipFile/TestTooManyEntries</title>
                <link>https://bugs.openjdk.org/browse/JDK-8304013</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The TestTooManyEntries test was originally added in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8272746&quot; title=&quot;ZipFile can&amp;#39;t open big file (NegativeArraySizeException)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8272746&quot;&gt;&lt;strike&gt;JDK-8272746&lt;/strike&gt;&lt;/a&gt; to validate that ZIP64 files with a total CEN size exceeding what ZipFile supports are rejected with a ZipException. The test does this by creating a large ZIP file (several gigabytes) with many enties. Because this is resource intensive, the test is currently tagged as manual. (See #6927)&lt;br/&gt;
&lt;br/&gt;
It would be useful to have a test which asserts the CEN size enforcement, but without the CPU, disk, memory and run time requirements of TestTooManyEntries. </description>
                <environment></environment>
        <key id="5096014">JDK-8304013</key>
            <summary>Add a fast, non-manual alternative to test/jdk/java/util/zip/ZipFile/TestTooManyEntries</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eirbjo">Eirik Bj&#248;rsn&#248;s</assignee>
                                    <reporter username="eirbjo">Eirik Bj&#248;rsn&#248;s</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Mar 2023 23:40:32 -0800</created>
                <updated>Wed, 29 Mar 2023 23:17:23 -0700</updated>
                            <resolved>Sun, 26 Mar 2023 16:02:08 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14569536" author="dukebot" created="Sun, 26 Mar 2023 16:02:07 -0700"  >Changeset: 65e01da9&lt;br/&gt;
Author:    Eirik Bjorsnos &amp;lt;&lt;a href=&apos;mailto:eirbjo@gmail.com&apos;&gt;eirbjo@gmail.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Lance Andersen &amp;lt;&lt;a href=&apos;mailto:lancea@openjdk.org&apos;&gt;lancea@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-26 23:00:15 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/65e01da925d49b77341551e38ffb7f0ea7141650&quot;&gt;https://git.openjdk.org/jdk/commit/65e01da925d49b77341551e38ffb7f0ea7141650&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14569283" author="roboduke" created="Fri, 24 Mar 2023 01:11:53 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12231&quot;&gt;https://git.openjdk.org/jdk/pull/12231&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-26 18:49:47 +0000</comment>
                            <comment id="14566090" author="JIRAUSER20720" created="Sun, 12 Mar 2023 10:13:05 -0700"  >&amp;gt; JDK implementers did the right thing to replace NegativeArraySizeException with a better exception&lt;br/&gt;
&lt;br/&gt;
Absolutely!</comment>
                            <comment id="14566089" author="martin" created="Sun, 12 Mar 2023 10:10:26 -0700"  >JDK implementers did the right thing to replace NegativeArraySizeException with a better exception.</comment>
                            <comment id="14566088" author="JIRAUSER20720" created="Sun, 12 Mar 2023 09:44:29 -0700"  >I don&amp;#39;t think anyone actually suggested we fix that. At some point someone complained that the integer overflowed and they got a NegativeArraySizeException trying to create the byte array. Then validation logic was added to ZipFile, which is what this test is actually aiming to exercise.</comment>
                            <comment id="14566086" author="martin" created="Sun, 12 Mar 2023 09:06:43 -0700"  >&amp;gt; The constraint actually tested here is that the ZipFile implementation needs to load the CEN (plus the 22-byte END header) into a byte array. So this needs to fit within Integer.MAX_VALUE.&lt;br/&gt;
&lt;br/&gt;
Wow!  I have fixed many 2GB (and 4GB) limit bugs in zip implementations but this CEN size limit never made it into my perceptual radar.  I had always assumed that zip file metadata would cleanly fit into a byte[].  I don&amp;#39;t know how to fix this (very rare) limitation without introducing a performance penalty for non-pathological zip files.</comment>
                            <comment id="14566074" author="JIRAUSER20720" created="Sun, 12 Mar 2023 00:44:43 -0800"  >@martin I filed this PR: (&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8304020&quot; title=&quot;Speed up test/jdk/java/util/zip/ZipFile/TestTooManyEntries.java and clarify its purpose&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8304020&quot;&gt;&lt;strike&gt;JDK-8304020&lt;/strike&gt;&lt;/a&gt;)&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/pull/12991&quot;&gt;https://github.com/openjdk/jdk/pull/12991&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
which suggests speed up the test and also clarify its purpose (by renaming it but also improving code and comments)&lt;br/&gt;
&lt;br/&gt;
Happy to get a review!</comment>
                            <comment id="14566072" author="JIRAUSER20720" created="Sat, 11 Mar 2023 22:53:36 -0800"  >Naming is hard! &lt;br/&gt;
&lt;br/&gt;
I remember being confused when trying to understand the purpose of this test and had to dig into the issue and also the code change to grok what is going on. The summary was not super helpful.&lt;br/&gt;
&lt;br/&gt;
The naming seems to follow a pattern I&amp;#39;ve seen in some other tests which is to name the test after &amp;#39;how the boundary condition is reached&amp;#39;, rather than *what condition is verified&amp;#39;.&lt;br/&gt;
&lt;br/&gt;
The constraint actually tested here is that the ZipFile implementation needs to load the CEN (plus the 22-byte END header) into a byte array. So this needs to fit within Integer.MAX_VALUE. This is purely an implementation limit, not a specification limit found in APPNOTE.TXT&lt;br/&gt;
&lt;br/&gt;
Here is my proposed, alternative test:&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/pull/12231&quot;&gt;https://github.com/openjdk/jdk/pull/12231&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
I have named this alternative test &amp;#39;EndOfCenValidation&amp;#39;, because it exercises ZipFile&amp;#39;s validation of the END header in various ways (not just the CEN size, but also the internal consistency of the CEN size and CEN offset with respect to the file size).</comment>
                            <comment id="14566067" author="martin" created="Sat, 11 Mar 2023 18:19:52 -0800"  >TestTooManyEntries is a terrible name.&lt;br/&gt;
&lt;br/&gt;
I wrote EntryCount64k which clearly states what limit it&amp;#39;s testing.&lt;br/&gt;
OTOH TestTooManyEntries seems to be creating a BIG file, not just one with (too) many entries.&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;* Create a zip file and add entries that exceed the CEN limit.&lt;br/&gt;
&lt;br/&gt;
what CEN limit is this ?  Be more specific!&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://infozip.sourceforge.net/FAQ.html#limits&quot;&gt;https://infozip.sourceforge.net/FAQ.html#limits&lt;/a&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5096021">JDK-8304020</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30p8j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17312"><![CDATA[b16]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="231"><![CDATA[java.util.jar]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>