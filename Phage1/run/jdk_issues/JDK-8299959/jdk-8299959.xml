<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 15:32:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8299959] C2: CmpU::Value must filter overflow computation against local sub computation</title>
                <link>https://bugs.openjdk.org/browse/JDK-8299959</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The attached Java Fuzzer test fails with the following assertion:&lt;br/&gt;
&lt;br/&gt;
To reproduce:&lt;br/&gt;
$ java -XX:StressSeed=2032591506 -XX:-TieredCompilation -XX:+StressCCP -Xcomp -XX:CompileOnly=Test Test.java&lt;br/&gt;
$ java -XX:StressSeed=2032591506 -XX:-TieredCompilation -XX:+StressCCP -Xcomp -XX:CompileOnly=Reduced Reduced.java&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/opt/mach5/mesos/work_dir/slaves/0c72054a-24ab-4dbb-944f-97f9341a1b96-S8385/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/c9470b35-e681-4289-98ed-c4298f665e5e/runs/b20e7e28-c065-4eb3-98f7-754e547baa60/workspace/open/src/hotspot/share/opto/phaseX.cpp:1763), pid=27138, tid=27151&lt;br/&gt;
#  assert(t-&amp;gt;meet(t0) == t-&amp;gt;remove_speculative()) failed: Not monotonic&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0) (fastdebug build 21-internal-LTS-2023-01-11-0103419.ekaterina.pavlova.jdk.jdk.master)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-internal-LTS-2023-01-11-0103419.ekaterina.pavlova.jdk.jdk.master, compiled mode, sharing, compressed oops, compressed class ptrs, g1 gc, linux-amd64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# V  [libjvm.so+0x17b6e34]  PhaseCCP::analyze()+0x324&lt;br/&gt;
............&lt;br/&gt;
Command Line: -XX:-TieredCompilation -XX:+IgnoreUnrecognizedVMOptions -XX:+UnlockDiagnosticVMOptions -XX:+StressLCM -XX:+StressGCM -XX:+StressIGVN -XX:+StressCCP -XX:StressSeed=1639636996 -Xmx1G -Xcomp -Xbatch -XX:CompileOnly=Test -XX:CompileCommand=quiet --add-modules=jdk.incubator.vector -XX:MaxRAMPercentage=4.16667 -Dtest.boot.jdk=/opt/mach5/mesos/work_dir/jib-master/install/jdk/19/36/bundles/linux-x64/jdk-19_linux-x64_bin.tar.gz/jdk-19 -Djava.io.tmpdir=/opt/mach5/mesos/work_dir/slaves/91e16c40-06d4-468a-9fc3-7198a5bb7d5a-S63303/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/2c025aa3-738b-4d52-9ba7-2d2924a7de06/runs/53df2e53-125b-4e7c-918d-e0ed7e4a7784/testoutput/test-support/jtreg_closed_test_hotspot_jtreg_applications_javafuzzer_MediumTest_java/tmp Test&lt;br/&gt;
............&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:    813   35   !b        Test::lMeth (216 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x00007fb16bdfe000,0x00007fb16beff000],  sp=0x00007fb16befa0e0,  free space=1008k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.so+0x17b6e34]  PhaseCCP::analyze()+0x324  (phaseX.cpp:1763)&lt;br/&gt;
V  [libjvm.so+0xb04f51]  Compile::Optimize()+0x701  (compile.cpp:2360)&lt;br/&gt;
V  [libjvm.so+0xb097de]  Compile::Compile(ciEnv*, ciMethod*, int, Options, DirectiveSet*)+0x18ce  (compile.cpp:830)&lt;br/&gt;
V  [libjvm.so+0x91a7e7]  C2Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*)+0x4e7  (c2compiler.cpp:113)&lt;br/&gt;
V  [libjvm.so+0xb16acc]  CompileBroker::invoke_compiler_on_method(CompileTask*)+0xa7c  (compileBroker.cpp:2237)&lt;br/&gt;
V  [libjvm.so+0xb178b8]  CompileBroker::compiler_thread_loop()+0x608  (compileBroker.cpp:1916)&lt;br/&gt;
V  [libjvm.so+0x1087316]  JavaThread::thread_main_inner()+0x206  (javaThread.cpp:710)&lt;br/&gt;
V  [libjvm.so+0x1a86740]  Thread::call_run()+0x100  (thread.cpp:224)&lt;br/&gt;
V  [libjvm.so+0x17235b3]  thread_native_entry(Thread*)+0x103  (os_linux.cpp:739)</description>
                <environment></environment>
        <key id="5091117">JDK-8299959</key>
            <summary>C2: CmpU::Value must filter overflow computation against local sub computation</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="chagedorn">Christian Hagedorn</reporter>
                        <labels>
                            <label>c2</label>
                            <label>javafuzzer</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk20u-fix-SQE-ok-next</label>
                            <label>jdk20u-fix-request</label>
                            <label>jdk20u-fix-yes</label>
                            <label>oracle-triage-11</label>
                            <label>oracle-triage-21</label>
                    </labels>
                <created>Wed, 11 Jan 2023 03:49:30 -0800</created>
                <updated>Thu, 27 Apr 2023 07:03:11 -0700</updated>
                            <resolved>Wed, 18 Jan 2023 23:44:51 -0800</resolved>
                                    <version>17</version>
                    <version>19</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14574159" author="roboduke" created="Mon, 17 Apr 2023 06:18:11 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1252&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1252&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-17 13:12:09 +0000</comment>
                            <comment id="14574158" author="goetz" created="Mon, 17 Apr 2023 06:11:51 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.8-oracle.&lt;br/&gt;
Small risk, simple change and well reproducible.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes and fails without the fix</comment>
                            <comment id="14570354" author="roboduke" created="Wed, 29 Mar 2023 04:20:47 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk20u/pull/35&quot;&gt;https://git.openjdk.org/jdk20u/pull/35&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-29 11:11:55 +0000</comment>
                            <comment id="14570342" author="thartmann" created="Wed, 29 Mar 2023 04:12:42 -0700"  >Fix Request (JDK 20u)&lt;br/&gt;
Resolves an assert during C2 compilation. The fix is low risk, was already backported to Oracle JDK 17u and tested in the JDK 21 and 17u CIs. The backport applies cleanly.</comment>
                            <comment id="14552625" author="dukebot" created="Wed, 18 Jan 2023 23:44:48 -0800"  >Changeset: 5f66024e&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-19 07:37:50 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/5f66024e957e5e40ce8d5a65717ea7f82c9f0b8f&quot;&gt;https://git.openjdk.org/jdk/commit/5f66024e957e5e40ce8d5a65717ea7f82c9f0b8f&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14551703" author="roboduke" created="Tue, 17 Jan 2023 08:43:26 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12036&quot;&gt;https://git.openjdk.org/jdk/pull/12036&lt;/a&gt;&lt;br/&gt;
Date: 2023-01-17 11:40:50 +0000</comment>
                            <comment id="14551605" author="JIRAUSER19821" created="Tue, 17 Jan 2023 02:45:41 -0800"  >&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8286638&quot; title=&quot;C2: CmpU needs to do more precise over/underflow analysis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8286638&quot;&gt;&lt;strike&gt;JDK-8286638&lt;/strike&gt;&lt;/a&gt;&lt;br/&gt;
That change already improved the overflow calculus, but now also needs to be filtered against the local sub computation.</comment>
                            <comment id="14551462" author="JIRAUSER19821" created="Mon, 16 Jan 2023 08:42:20 -0800"  >Example:&lt;br/&gt;
CmpI(AddI(in11 ,in12), in2)&lt;br/&gt;
in1 = AddI&lt;br/&gt;
&lt;br/&gt;
(rr) p t1-&amp;gt;dump()&lt;br/&gt;
int:-17..-5:www&lt;br/&gt;
(rr) p t11-&amp;gt;dump()&lt;br/&gt;
int:&amp;lt;=-4:www&lt;br/&gt;
(rr) p t12-&amp;gt;dump()&lt;br/&gt;
int:-1&lt;br/&gt;
(rr) p t2-&amp;gt;dump()&lt;br/&gt;
int:&amp;gt;=0&lt;br/&gt;
&lt;br/&gt;
This leads to underflow, with the cmp result being an GE == bool == 0..1&lt;br/&gt;
If t11 now widens during CCP to a &amp;quot;int&amp;quot;, then we don&amp;#39;t take the overflow path but directly compute the sub.&lt;br/&gt;
There we have t1 &amp;gt; t2 (unsigned comparison, so negative values become very large positive values), so we get a GT, which is narrower.</comment>
                            <comment id="14551456" author="JIRAUSER19821" created="Mon, 16 Jan 2023 08:31:30 -0800"  >CmpUNode::Value&lt;br/&gt;
&lt;br/&gt;
In some cases the &amp;quot;sub&amp;quot; computation is narrower than the overflow computation.&lt;br/&gt;
&lt;br/&gt;
This means that we may start out with type TOP, then do an overflow computation leading to type &amp;quot;bool&amp;quot;, then a sub computation leading to &amp;quot;int:1&amp;quot;. CCP then detects that this breaks monotonicity.</comment>
                            <comment id="14550299" author="chagedorn" created="Wed, 11 Jan 2023 03:50:08 -0800"  >ILW = C2 assertion during CCP, single Java Fuzzer test, disable compilation of affected method = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5097353">JDK-8305134</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5097855">JDK-8305550</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5098737">JDK-8306299</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5099653">JDK-8307029</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5091127">JDK-8299966</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5074774">JDK-8286638</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102276" name="FuzzerUtils.java" size="13240" author="chagedorn" created="Wed, 11 Jan 2023 03:46:04 -0800"/>
                            <attachment id="102328" name="Reduced.java" size="727" author="chagedorn" created="Mon, 16 Jan 2023 06:58:25 -0800"/>
                            <attachment id="102277" name="Test.java" size="7120" author="chagedorn" created="Wed, 11 Jan 2023 03:45:43 -0800"/>
                            <attachment id="102275" name="hs_err_pid27138.log" size="106803" author="chagedorn" created="Wed, 11 Jan 2023 03:47:02 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zv0r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17335"><![CDATA[b07]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>