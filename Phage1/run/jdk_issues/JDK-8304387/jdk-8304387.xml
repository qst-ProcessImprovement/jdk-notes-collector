<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:47:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8304387] Fix positions of shared static stubs / trampolines</title>
                <link>https://bugs.openjdk.org/browse/JDK-8304387</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The positions of static stubs / trampolines should be like:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
[Verified Entry Point]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
[Stub Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;static stubs and trampolines&amp;gt;&lt;br/&gt;
[Exception Handler]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
[Deopt Handler Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
Currently after we have the shared static stubs/trampolines in &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8280481&quot; title=&quot;Duplicated stubs to interpreter for static calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8280481&quot;&gt;&lt;strike&gt;JDK-8280481&lt;/strike&gt;&lt;/a&gt; and &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8280152&quot; title=&quot;AArch64: Reuse runtime call trampolines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8280152&quot;&gt;&lt;strike&gt;JDK-8280152&lt;/strike&gt;&lt;/a&gt; :&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
[Verified Entry Point]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
[Stub Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;static stubs and trampolines&amp;gt;&lt;br/&gt;
[Exception Handler]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
[Deopt Handler Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;shared static stubs and trampolines&amp;gt; // they are presented in the Deopt range, though do not have correctness issues.&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
For example on x86:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
[Verified Entry Point]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
[Stub Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4908:   nopl   0x0(%rax,%rax,1)             ;   {no_reloc}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef490d:   mov    $0x0,%rbx                    ;   {static_stub}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4917:   jmpq   0x00007fac68ef4917           ;   {runtime_call}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef491c:   nop&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef491d:   mov    $0x0,%rbx                    ;   {static_stub}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4927:   jmpq   0x00007fac68ef4927           ;   {runtime_call}&lt;br/&gt;
[Exception Handler]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef492c:   callq  0x00007fac703da280           ;   {runtime_call handle_exception_from_callee Runtime1 stub}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4931:   mov    $0x7fac885d8067,%rdi         ;   {external_word}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef493b:   and    $0xfffffffffffffff0,%rsp&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef493f:   callq  0x00007fac881e9900           ;   {runtime_call MacroAssembler::debug64(char*, long, long*)}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4944:   hlt&lt;br/&gt;
[Deopt Handler Code]&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4945:   mov    $0x7fac68ef4945,%r10         ;   {section_word}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef494f:   push   %r10&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4951:   jmpq   0x00007fac70326520           ;   {runtime_call DeoptimizationBlob}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4956:   mov    $0x0,%rbx                    ;   {static_stub}       //  &amp;lt;----------  here&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4960:   jmpq   0x00007fac68ef4960           ;   {runtime_call}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4965:   mov    $0x0,%rbx                    ;   {static_stub}       //  &amp;lt;----------  here&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef496f:   jmpq   0x00007fac68ef496f           ;   {runtime_call}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4974:   mov    $0x0,%rbx                    ;   {static_stub}       //  &amp;lt;----------  here&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef497e:   jmpq   0x00007fac68ef497e           ;   {runtime_call}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4983:   hlt&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4984:   hlt&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4985:   hlt&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4986:   hlt&lt;br/&gt;
&amp;nbsp;&amp;nbsp;0x00007fac68ef4987:   hlt&lt;br/&gt;
--------------------------------------------------------------------------------&lt;br/&gt;
[/Disassembly]&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
It can be simply reproduced and dumped by `-XX:+PrintAssembly`.&lt;br/&gt;
&lt;br/&gt;
Though the correctness doesn&amp;#39;t get affected in the current case, we may need to move them to a better place, back into the `[Stub Code]`, which might be more reasonable. Also for the performance&amp;#39;s sake, `ciEnv::register_method()`, where `code_buffer-&amp;gt;finalize_stubs()` locates currently, has two locks `Compile_lock` and `MethodCompileQueue_lock`. So I think it may be better to move `code_buffer-&amp;gt;finalize_stubs()` out to C1 and C2 code generation phases, separately.&lt;br/&gt;
&lt;br/&gt;
BTW, this is the &amp;quot;direct cause&amp;quot; of [&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302384&quot; title=&quot;Handle hsdis out-of-bound logic for RISC-V&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8302384&quot;&gt;&lt;strike&gt;JDK-8302384&lt;/strike&gt;&lt;/a&gt;](&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302384&quot;&gt;https://bugs.openjdk.org/browse/JDK-8302384&lt;/a&gt;) because shared trampolines and there data are at the end of compiled code. Though for that issue, the root cause is still from the Binutils. Please see [&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302384&quot; title=&quot;Handle hsdis out-of-bound logic for RISC-V&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8302384&quot;&gt;&lt;strike&gt;JDK-8302384&lt;/strike&gt;&lt;/a&gt;](&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8302384&quot;&gt;https://bugs.openjdk.org/browse/JDK-8302384&lt;/a&gt;) for more details.</description>
                <environment></environment>
        <key id="5096481">JDK-8304387</key>
            <summary>Fix positions of shared static stubs / trampolines</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xlinzheng">Xiaolin Zheng</assignee>
                                    <reporter username="xlinzheng">Xiaolin Zheng</reporter>
                        <labels>
                            <label>cleanup</label>
                    </labels>
                <created>Fri, 17 Mar 2023 00:12:47 -0700</created>
                <updated>Mon, 27 Mar 2023 14:09:13 -0700</updated>
                            <resolved>Tue, 21 Mar 2023 04:28:36 -0700</resolved>
                                    <version>19</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14568479" author="dukebot" created="Tue, 21 Mar 2023 04:28:35 -0700"  >Changeset: 1c04686c&lt;br/&gt;
Author:    Xiaolin Zheng &amp;lt;&lt;a href=&apos;mailto:xlinzheng@openjdk.org&apos;&gt;xlinzheng@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Andrew Dinn &amp;lt;&lt;a href=&apos;mailto:adinn@openjdk.org&apos;&gt;adinn@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-21 11:27:54 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/1c04686cd68a78f926f09707ac723aa762945527&quot;&gt;https://git.openjdk.org/jdk/commit/1c04686cd68a78f926f09707ac723aa762945527&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14568044" author="roboduke" created="Mon, 20 Mar 2023 02:53:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13071&quot;&gt;https://git.openjdk.org/jdk/pull/13071&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-17 07:30:19 +0000</comment>
                            <comment id="14568024" author="JIRAUSER19809" created="Mon, 20 Mar 2023 01:30:18 -0700"  >Thanks [~chagedorn]. It sounds reasonable!</comment>
                            <comment id="14568015" author="chagedorn" created="Mon, 20 Mar 2023 00:19:46 -0700"  >I suggest to treat this as an RFE as it is not a correctness issue but rather an unfortunate placement which can be improved. </comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5096832">JDK-8304681</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    <customfieldvalue key="20300"><![CDATA[riscv]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30s4b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17352"><![CDATA[b15]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>