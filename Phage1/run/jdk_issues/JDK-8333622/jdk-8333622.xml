<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:09:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8333622] ubsan: relocInfo_x86.cpp:101:56: runtime error: pointer index expression with base (-1) overflowed</title>
                <link>https://bugs.openjdk.org/browse/JDK-8333622</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When configuring ubsan (--enable-ubsan) I run in the build (on Linux x86_64 fastdebug) into this issue :&lt;br/&gt;
&lt;br/&gt;
src/hotspot/cpu/x86/relocInfo_x86.cpp:101:56: runtime error: pointer index expression with base 0xffffffffffffffff overflowed to 0x0000074d946f&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#0 0x14b28fa94ac2 in Relocation::pd_call_destination(unsigned char*) src/hotspot/cpu/x86/relocInfo_x86.cpp:101&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#1 0x14b28fa8408a in CallRelocation::fix_relocation_after_move(CodeBuffer const*, CodeBuffer*) src/hotspot/share/code/relocInfo.cpp:370&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#2 0x14b28dcec671 in CodeBuffer::relocate_code_to(CodeBuffer*) const src/hotspot/share/asm/codeBuffer.cpp:799&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#3 0x14b28dcf0737 in CodeBuffer::copy_code_to(CodeBlob*) src/hotspot/share/asm/codeBuffer.cpp:736&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#4 0x14b28f6c38a0 in CodeBuffer::copy_code_and_locs_to(CodeBlob*) src/hotspot/share/asm/codeBuffer.hpp:707&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#5 0x14b28f6c38a0 in nmethod::nmethod(Method*, CompilerType, int, int, int, int, unsigned char*, CodeOffsets*, int, DebugInformationRecorder*, Dependencies*, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, CompLevel, char*, int, JVMCINMethodData*) src/hotspot/share/code/nmethod.cpp:1529&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#6 0x14b28f6c4de4 in nmethod::new_nmethod(methodHandle const&amp;amp;, int, int, CodeOffsets*, int, DebugInformationRecorder*, Dependencies*, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, CompLevel, char*, int, JVMCINMethodData*) src/hotspot/share/code/nmethod.cpp:1187&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#7 0x14b28db0770b in ciEnv::register_method(ciMethod*, int, CodeOffsets*, int, CodeBuffer*, int, OopMapSet*, ExceptionHandlerTable*, ImplicitExceptionTable*, AbstractCompiler*, bool, bool, bool, int, RTMState) src/hotspot/share/ci/ciEnv.cpp:1119&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#8 0x14b28d6d4df1 in Compilation::install_code(int) src/hotspot/share/c1/c1_Compilation.cpp:426&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#9 0x14b28d6dac94 in Compilation::compile_method() src/hotspot/share/c1/c1_Compilation.cpp:488&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#10 0x14b28d6db61a in Compilation::Compilation(AbstractCompiler*, ciEnv*, ciMethod*, int, BufferBlob*, bool, DirectiveSet*) src/hotspot/share/c1/c1_Compilation.cpp:609&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#11 0x14b28d6deb08 in Compiler::compile_method(ciEnv*, ciMethod*, int, bool, DirectiveSet*) src/hotspot/share/c1/c1_Compiler.cpp:260&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#12 0x14b28ddcc024 in CompileBroker::invoke_compiler_on_method(CompileTask*) src/hotspot/share/compiler/compileBroker.cpp:2303&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;#13 0x14b28ddce5d6 in CompileBroker::compiler_thread_loop() src/hotspot/share/compiler/compileBroker.cpp:1961&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;... (rest of output omitted)&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5131101">JDK-8333622</key>
            <summary>ubsan: relocInfo_x86.cpp:101:56: runtime error: pointer index expression with base (-1) overflowed</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kvn">Vladimir Kozlov</assignee>
                                    <reporter username="mbaesken">Matthias Baesken</reporter>
                        <labels>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-23</label>
                            <label>ubsan</label>
                    </labels>
                <created>Wed, 5 Jun 2024 01:08:49 -0700</created>
                <updated>Tue, 6 Aug 2024 00:14:21 -0700</updated>
                            <resolved>Thu, 6 Jun 2024 06:44:20 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14695714" author="mbaesken" created="Mon, 5 Aug 2024 00:17:42 -0700"  >jdk21u-dev backport request&lt;br/&gt;
I would like to have the patch in jdk21u-dev as well, because the issue is present there too.  The backport is clean and low risk.</comment>
                            <comment id="14695708" author="roboduke" created="Mon, 5 Aug 2024 00:08:06 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/894&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/894&lt;/a&gt;&lt;br/&gt;
Date: 2024-08-05 06:37:48 +0000</comment>
                            <comment id="14679503" author="dukebot" created="Thu, 6 Jun 2024 06:44:19 -0700"  >Changeset: 33fd6ae9&lt;br/&gt;
Author:    Vladimir Kozlov &amp;lt;&lt;a href=&apos;mailto:kvn@openjdk.org&apos;&gt;kvn@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-06-06 13:41:51 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/33fd6ae98638d2a4b33d18cc4acee4f0daaa9b35&quot;&gt;https://git.openjdk.org/jdk/commit/33fd6ae98638d2a4b33d18cc4acee4f0daaa9b35&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14679360" author="thartmann" created="Wed, 5 Jun 2024 22:25:41 -0700"  >ILW = Undefined behavior due to integer overflow, warning with ubsan; never observed, no workaround but disable compilation of affected method = MLH = P4</comment>
                            <comment id="14679332" author="roboduke" created="Wed, 5 Jun 2024 15:34:34 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/19568&quot;&gt;https://git.openjdk.org/jdk/pull/19568&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-05 22:28:39 +0000</comment>
                            <comment id="14679291" author="kvn" created="Wed, 5 Jun 2024 11:57:05 -0700"  >something like this:&lt;br/&gt;
diff --git a/src/hotspot/cpu/x86/relocInfo_x86.cpp b/src/hotspot/cpu/x86/relocInfo_x86.cpp&lt;br/&gt;
index db806419b51..badf98f92ef 100644&lt;br/&gt;
--- a/src/hotspot/cpu/x86/relocInfo_x86.cpp&lt;br/&gt;
+++ b/src/hotspot/cpu/x86/relocInfo_x86.cpp&lt;br/&gt;
@@ -99,7 +99,11 @@ address Relocation::pd_call_destination(address orig_addr) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;if (ni-&amp;gt;is_call()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return nativeCall_at(addr())-&amp;gt;destination() + adj;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;} else if (ni-&amp;gt;is_jump()) {&lt;br/&gt;
-    return nativeJump_at(addr())-&amp;gt;jump_destination() + adj;&lt;br/&gt;
+    address dest = nativeJump_at(addr())-&amp;gt;jump_destination();&lt;br/&gt;
+    if (dest == (address) -1) {&lt;br/&gt;
+      return addr(); // jump to self&lt;br/&gt;
+    }&lt;br/&gt;
+    return dest + adj;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;} else if (ni-&amp;gt;is_cond_jump()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return nativeGeneralJump_at(addr())-&amp;gt;jump_destination() + adj;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;} else if (ni-&amp;gt;is_mov_literal64()) {&lt;br/&gt;
</comment>
                            <comment id="14679289" author="kvn" created="Wed, 5 Jun 2024 11:44:39 -0700"  >The code works because pd_set_call_destination() ignores result of pd_call_destination() when destination is -1. See link in previous comment. So the fix is simply add check to pd_call_destination() and return some reasonable value if jump destination is -1.</comment>
                            <comment id="14679285" author="kvn" created="Wed, 5 Jun 2024 11:32:29 -0700"  >Seems missing check for jump_destination == -1:&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/src/hotspot/cpu/x86/relocInfo_x86.cpp#L120&quot;&gt;https://github.com/openjdk/jdk/blob/master/src/hotspot/cpu/x86/relocInfo_x86.cpp#L120&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
</comment>
                            <comment id="14679277" author="dcubed" created="Wed, 5 Jun 2024 10:49:38 -0700"  >Moving from hotspot/runtime -&amp;gt; hotspot/compiler.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5136191">JDK-8337877</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36m2j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17357"><![CDATA[b26]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>