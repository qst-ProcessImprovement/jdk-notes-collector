<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:57:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8301489] C1: ShortLoopOptimizer might lift instructions before their inputs</title>
                <link>https://bugs.openjdk.org/browse/JDK-8301489</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
The attached code, which is just standard Java code, causes a JVM crash.&lt;br/&gt;
It can be reproduced with the code below.&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
Run the attached code in &amp;quot;TestBug&amp;quot; class.&lt;br/&gt;
This code loops 10000 times, calling the doSomething() method each time.&lt;br/&gt;
The JVM will normally crash after less than 5000 iterations.&lt;br/&gt;
Most of the code needed in the doSomething() method needs to be present in order to reproduce the bug. If the if or try-catch or while is removed, the bug will not occur.&lt;br/&gt;
I retained the code inside the loop in order that the loop is not empty, to avoid unnecessary optimisations.&lt;br/&gt;
&lt;br/&gt;
ACTUAL -&lt;br/&gt;
JVM crashes after less than 5000 iterations.&lt;br/&gt;
If I increase the value of the requiredLength argument (e.g. to 4000), then the crash occurs after less iterations.&lt;br/&gt;
&lt;br/&gt;
The content of hs_err_pid16440.log is pasted into the &amp;quot;Confidential Field (hs_err file)&amp;quot; field.&lt;br/&gt;
&lt;br/&gt;
The following was reported:&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (c1_LIRAssembler.cpp:867), pid=16440, tid=0x000011dc&lt;br/&gt;
#  Error: ShouldNotReachHere()&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (8.0) (build 1.8.0_361-b09)&lt;br/&gt;
# Java VM: Java HotSpot(TM) Client VM (25.361-b09 mixed mode, sharing windows-x86 )&lt;br/&gt;
# Failed to write core dump. Minidumps are not enabled by default on client versions of Windows&lt;br/&gt;
#&lt;br/&gt;
# An error report file with more information is saved as:&lt;br/&gt;
# C:\&amp;lt;filepath&amp;gt;\hs_err_pid16440.log&lt;br/&gt;
#&lt;br/&gt;
# Compiler replay data is saved as:&lt;br/&gt;
# C:\&amp;lt;filepath&amp;gt;\replay_pid16440.log&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
# &lt;a href=&quot;http://bugreport.java.com/bugreport/crash.jsp&quot;&gt;http://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
public class TestBug {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private static int index = 0;&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;public static void main(String[] args) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for (int i = 0; i &amp;lt; 10000; i++) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;doSomething(new byte[] { }, 4);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;private static void doSomething(byte[] source, int requiredLength) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;System.out.println(index++);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (requiredLength &amp;lt; 0) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;requiredLength = 0;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;boolean [] returnArray = new boolean[requiredLength];&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;int index = 0;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;try {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;for (byte b : source) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (index == returnArray.length) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;break;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;catch (ArrayIndexOutOfBoundsException e) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;// ignore&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;while (index &amp;lt; returnArray.length) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;returnArray[index++] = false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
If I replace the for-each loop with a standard indexed for loop, the issue does not occur.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5092439">JDK-8301489</key>
            <summary>C1: ShortLoopOptimizer might lift instructions before their inputs</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dskantz">Daniel Skantz</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>additional-information-received</label>
                            <label>amazon-interest</label>
                            <label>c1</label>
                            <label>dcs-bv-crash-conf</label>
                            <label>dcsswa</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21-defer-request</label>
                            <label>jdk21-defer-yes</label>
                            <label>jdk21u-fix-SQE-ok-next</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-21</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Wed, 25 Jan 2023 02:17:24 -0800</created>
                <updated>Fri, 6 Oct 2023 00:16:31 -0700</updated>
                            <resolved>Tue, 27 Jun 2023 00:08:14 -0700</resolved>
                                    <version>8u361</version>
                    <version>11</version>
                    <version>17</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14615728" author="roboduke" created="Wed, 4 Oct 2023 00:44:30 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1826&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1826&lt;/a&gt;&lt;br/&gt;
Date: 2023-10-04 07:37:23 +0000</comment>
                            <comment id="14615724" author="goetz" created="Wed, 4 Oct 2023 00:34:33 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.10-oracle.&lt;br/&gt;
Smallish compiler change, acceptable risk. &lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes.  SAP nightly testing passed.</comment>
                            <comment id="14613446" author="thartmann" created="Sun, 24 Sep 2023 22:30:18 -0700"  >&amp;gt; I assume the deferral was meant for 21&lt;br/&gt;
&lt;br/&gt;
Correct.</comment>
                            <comment id="14613357" author="goetz" created="Sat, 23 Sep 2023 06:23:16 -0700"  >Fix request [21u]&lt;br/&gt;
&lt;br/&gt;
I backport this for parity with 17.0.10-oracle. I assume the deferral was meant for 21, not 21u.&lt;br/&gt;
Smallish compiler change, acceptable risk. Also, it is backported to 17.0.10-oracle, where it will have much more exposure than in 21.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Test passes. SAP nightly testing passed.</comment>
                            <comment id="14613191" author="roboduke" created="Fri, 22 Sep 2023 06:28:53 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u/pull/193&quot;&gt;https://git.openjdk.org/jdk21u/pull/193&lt;/a&gt;&lt;br/&gt;
Date: 2023-09-22 13:21:18 +0000</comment>
                            <comment id="14594443" author="thartmann" created="Fri, 7 Jul 2023 05:56:46 -0700"  >Deferral Request (JDK 21):&lt;br/&gt;
This is a very old issue with a non-trivial fix. We should give it some more bake time in JDK 22 before backporting.</comment>
                            <comment id="14592198" author="dukebot" created="Tue, 27 Jun 2023 00:08:13 -0700"  >Changeset: 73d7aa1d&lt;br/&gt;
Author:    Daniel Skantz &amp;lt;&lt;a href=&apos;mailto:daniel.skantz@oracle.com&apos;&gt;daniel.skantz@oracle.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Tobias Hartmann &amp;lt;&lt;a href=&apos;mailto:thartmann@openjdk.org&apos;&gt;thartmann@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-27 07:05:48 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/73d7aa1d2cb037fed69263a1990258866333664d&quot;&gt;https://git.openjdk.org/jdk/commit/73d7aa1d2cb037fed69263a1990258866333664d&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14589592" author="roboduke" created="Thu, 15 Jun 2023 04:18:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14492&quot;&gt;https://git.openjdk.org/jdk/pull/14492&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-15 11:13:02 +0000</comment>
                            <comment id="14569555" author="thartmann" created="Sun, 26 Mar 2023 22:43:00 -0700"  >I don&amp;#39;t recall any other differences between client and server VM, assuming you already looked at &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8166002&quot; title=&quot;Emulate client build on platforms with reduced virtual address space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8166002&quot;&gt;&lt;strike&gt;JDK-8166002&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
Maybe [~iveresov] remembers more.</comment>
                            <comment id="14556828" author="sswsharm" created="Thu, 2 Feb 2023 00:53:15 -0800"  >&lt;br/&gt;
ILW = issue in GA build, reproducible with single test , no workaround available =  MLM = P4&lt;br/&gt;
</comment>
                            <comment id="14556766" author="pnarayanaswa" created="Wed, 1 Feb 2023 19:45:47 -0800"  >Additional Information from submitter:&lt;br/&gt;
=============================&lt;br/&gt;
Yes, I&amp;#39;m using 32-bit JDK on 64-bit Windows.&lt;br/&gt;
I understand that it is fully valid to run 32-bit JDK on 64-bit Windows - e.g. this is described at &lt;a href=&quot;https://www.java.com/en/download/help/java_win64bit.html#Java%20for%2032-bit&quot;&gt;https://www.java.com/en/download/help/java_win64bit.html#Java%20for%2032-bit&lt;/a&gt;.&lt;br/&gt;
So it seems to me that this is *an* issue, which would ideally be fixed.</comment>
                            <comment id="14556033" author="sswsharm" created="Tue, 31 Jan 2023 02:56:33 -0800"  >&lt;br/&gt;
No crash is observed on JDK 8u361( 64 bit) on Windows OS( 64 bit)&lt;br/&gt;
&lt;br/&gt;
Crash occurred when 32 bit JDK is being used with 64 bit OS:&lt;br/&gt;
&lt;br/&gt;
---------------  S Y S T E M  ---------------&lt;br/&gt;
&lt;br/&gt;
OS: Windows 10 , 64 bit Build 19041 (10.0.19041.2364)&lt;br/&gt;
&lt;br/&gt;
CPU:total 12 (initial active 12) (6 cores per cpu, 2 threads per core) family 6 model 165 stepping 2, cmov, cx8, fxsr, mmx, sse, sse2, sse3, ssse3, sse4.1, sse4.2, popcnt, avx, avx2, aes, clmul, erms, 3dnowpref, lzcnt, ht, tsc, tscinvbit, bmi1, bmi2, adx&lt;br/&gt;
&lt;br/&gt;
Memory: 4k page, physical 33267032k(14208972k free), swap 66821464k(40224928k free)&lt;br/&gt;
&lt;br/&gt;
vm_info: Java HotSpot(TM) Client VM (25.361-b09) for windows-x86 JRE (1.8.0_361-b09), built on Jan  9 2023 08:42:19 by &amp;quot;java_re&amp;quot; with MS VC++ 15.9 (VS2017)&lt;br/&gt;
-----------------------------------------------------------------------------------------------------&lt;br/&gt;
&lt;br/&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5110468">JDK-8316407</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5111681">JDK-8317476</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5111872">JDK-8317650</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="103514" name="CFGAfterGenerationOfHIR.PNG" size="51433" author="dskantz" created="Fri, 21 Apr 2023 08:30:43 -0700"/>
                            <attachment id="103515" name="CFGBeforeRangeCheckElimination.PNG" size="60888" author="dskantz" created="Fri, 21 Apr 2023 08:30:43 -0700"/>
                            <attachment id="102458" name="TestBug.java" size="872" author="sswsharm" created="Tue, 31 Jan 2023 00:13:36 -0800"/>
                            <attachment id="102506" name="replay_pid3832.log" size="75916" author="sswsharm" created="Thu, 2 Feb 2023 00:51:43 -0800"/>
                            <attachment id="103095" name="x64.cfg" size="42688" author="dskantz" created="Wed, 22 Mar 2023 12:56:59 -0700"/>
                            <attachment id="103096" name="x86.cfg" size="22035" author="dskantz" created="Wed, 22 Mar 2023 12:56:59 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17004"><![CDATA[x86]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3036j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>