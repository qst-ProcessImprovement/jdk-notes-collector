<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 16:26:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8301627] System.exit and Runtime.exit debug logging</title>
                <link>https://bugs.openjdk.org/browse/JDK-8301627</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>It can be difficult to find the cause of calls to java.lang.System.exit(status) and Runtime.exit(status) because the Java runtime exits immediately.&lt;br/&gt;
Logging or printing a message and stack trace would make it easier to locate the caller and cause.</description>
                <environment></environment>
        <key id="5093157">JDK-8301627</key>
            <summary>System.exit and Runtime.exit debug logging</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rriggs">Roger Riggs</assignee>
                                    <reporter username="rriggs">Roger Riggs</reporter>
                        <labels>
                            <label>release-note=yes</label>
                    </labels>
                <created>Wed, 1 Feb 2023 08:02:08 -0800</created>
                <updated>Fri, 12 Sep 2025 23:51:56 -0700</updated>
                            <resolved>Tue, 21 Feb 2023 07:39:26 -0800</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                                                            <comments>
                            <comment id="14571215" author="coffeys" created="Mon, 3 Apr 2023 04:56:07 -0700"  >the jdk.Shutdown JFR event is an alternative for those using the JFR harness. &lt;br/&gt;
&lt;br/&gt;
e.g.&lt;br/&gt;
$  /jdk/bin/jfr print --events jdk.Shutdown /tmp/exit.jfr&lt;br/&gt;
jdk.Shutdown {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;startTime = 11:50:43.838 (2023-04-03)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;reason = &amp;quot;Shutdown requested from Java&amp;quot;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;eventThread = &amp;quot;main&amp;quot; (javaThreadId = 1)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;stackTrace = [&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Shutdown.beforeHalt()&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Shutdown.exit(int) line: 172&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.Runtime.exit(int) line: 115&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.System.exit(int) line: 1860&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Hello.main(String[]) line: 23&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...&lt;br/&gt;
&amp;nbsp;&amp;nbsp;]&lt;br/&gt;
}&lt;br/&gt;
</comment>
                            <comment id="14562607" author="alanb" created="Thu, 23 Feb 2023 22:54:47 -0800"  >System.exit has always had the potential to fail, e.g. the SM permission check means arbitrary code can execute, SO could potentially happen before starting the shutdown hooks. The new logging is welcome but it does mean more scenarios where errors or exceptions can be thrown, e.g. if System.getLogger fails with OOME then it is possible that the fallback to print to System.err could fail with OOME too. Tests for OOME can be very fragile but ignoring such tests, I suppose the question is whether there needs to be a round to harden this code as much as possible to ensure that the VM does exit.</comment>
                            <comment id="14562548" author="dholmes" created="Thu, 23 Feb 2023 14:11:21 -0800"  >Even ignoring this test failure, the additional logging, if it fails, should not stop the exit process. We did not document that logging can cause the exit process to be aborted! I&amp;#39;m quite concerned about this change in that regard.</comment>
                            <comment id="14562545" author="rriggs" created="Thu, 23 Feb 2023 14:02:20 -0800"  >I added -Xlog:exceptions to the debugee and observed the expected OOME followed by OOME&amp;#39;s from a separate thread doing object deserialization called from `nsk/share/jpda/SocketConnection`.  The communication channel with the test is also needing memory.&lt;br/&gt;
And the test disabling collection of the memory it is allocating prevents recovering any memory that is needed to finish the test.&lt;br/&gt;
The addition of logging may have tipped the scales on available memory but this was always fragile.</comment>
                            <comment id="14562538" author="dholmes" created="Thu, 23 Feb 2023 13:31:55 -0800"  >I am also concerned if the logging code can execute user-defined code? In that case the exit process can again be disrupted - contrary to the detailed shutdown sequence we only just documented fully.</comment>
                            <comment id="14562533" author="dholmes" created="Thu, 23 Feb 2023 13:07:57 -0800"  >[~rriggs] I don&amp;#39;t think an exception from logging should prevent the exit from proceeding.</comment>
                            <comment id="14562454" author="rriggs" created="Thu, 23 Feb 2023 06:50:55 -0800"  >When there&amp;#39;s no memory to allocate, invoking anything is unpredictable.&lt;br/&gt;
Any of the other shutdown hooks can also run into problems before the exit occurs.&lt;br/&gt;
There are many other tests that also exhaust memory.&lt;br/&gt;
Catching OOME during the getLogger() might mitigate the effects in this test and others.</comment>
                            <comment id="14562430" author="dfuchs" created="Thu, 23 Feb 2023 04:25:52 -0800"  >I wonder if having the test pre-create the logger (and stash it in a static field) before starting to allocate the array would help?</comment>
                            <comment id="14562427" author="mbaesken" created="Thu, 23 Feb 2023 03:40:19 -0800"  >What do you think about disabling the new System.exit logger for the test ? A system property would be nice.&lt;br/&gt;
Not sure if setting some of the arrays  (I think you meant  List&amp;lt;ArrayReference&amp;gt; objects ) to null  would be a good approach in this case.</comment>
                            <comment id="14562097" author="mbaesken" created="Wed, 22 Feb 2023 09:47:11 -0800"  >I am not very familiar with this test, just noticed the issue in our nightlies.&lt;br/&gt;
[~iignatev]  you did some changes to  jdk/test/hotspot/jtreg/vmTestbase/nsk/jdi/VMOutOfMemoryException/VMOutOfMemoryException001 a while ago, can you maybe comment on this ?&lt;br/&gt;
</comment>
                            <comment id="14562081" author="rriggs" created="Wed, 22 Feb 2023 08:52:36 -0800"  >The test runs (the debuggee) until it gets an OOME. &lt;br/&gt;
The subsequent (new) call in System.exit() to check if a logger is configured might need memory.&lt;br/&gt;
If that also threw OOME, it would be reported to the uncaught exception handler.&lt;br/&gt;
&lt;br/&gt;
A similar OOME might be expected from the test&amp;#39;s logging of &amp;quot;Got expected exception&amp;quot;.&lt;br/&gt;
Can the object array be set to null as soon as the OOME is caught? Freeing memory for subsequent use.</comment>
                            <comment id="14562069" author="mbaesken" created="Wed, 22 Feb 2023 08:04:33 -0800"  >Today we started to see  &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8303057&quot;&gt;https://bugs.openjdk.org/browse/JDK-8303057&lt;/a&gt; in the nightly tests , could this be related ?</comment>
                            <comment id="14561706" author="dukebot" created="Tue, 21 Feb 2023 07:39:25 -0800"  >Changeset: 10b4cc9e&lt;br/&gt;
Author:    Roger Riggs &amp;lt;&lt;a href=&apos;mailto:rriggs@openjdk.org&apos;&gt;rriggs@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-21 15:37:08 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/10b4cc9eb49c14a6be03b3f53e97037529169ed1&quot;&gt;https://git.openjdk.org/jdk/commit/10b4cc9eb49c14a6be03b3f53e97037529169ed1&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14559238" author="roboduke" created="Fri, 10 Feb 2023 12:41:07 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12517&quot;&gt;https://git.openjdk.org/jdk/pull/12517&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-10 20:33:39 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10400">
                    <name>CSR</name>
                                            <outwardlinks description="csr for">
                                        <issuelink>
            <issuekey id="5094401">JDK-8302691</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5095004">JDK-8303198</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5170742">JDK-8367597</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5094825">JDK-8303057</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                                              <subtask id="5095078">JDK-8303257</subtask>
                                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i307m3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="190"><![CDATA[java.lang]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>