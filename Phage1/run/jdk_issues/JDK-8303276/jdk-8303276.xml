<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:16:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303276] Secondary assertion failure in AdapterHandlerLibrary::contains during crash reporting</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303276</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>We have the following call chain:&lt;br/&gt;
&lt;br/&gt;
VMError::report&lt;br/&gt;
&amp;nbsp;&amp;nbsp;os::print_register_info&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CodeBlob::dump_for_addr&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;AdapterHandlerLibrary::contains&lt;br/&gt;
&lt;br/&gt;
where:&lt;br/&gt;
&lt;br/&gt;
bool AdapterHandlerLibrary::contains(const CodeBlob* b) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;bool found = false;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;auto findblob = [&amp;amp;] (AdapterFingerPrint* key, AdapterHandlerEntry* a) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return (found = (b == CodeCache::find_blob(a-&amp;gt;get_i2c_entry())));&lt;br/&gt;
&amp;nbsp;&amp;nbsp;};&lt;br/&gt;
&amp;nbsp;&amp;nbsp;assert_locked_or_safepoint(AdapterHandlerLibrary_lock);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;_adapter_handler_table.iterate(findblob);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;return found;&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
but we don&amp;#39;t hold the lock, nor are we at a safepoint.&lt;br/&gt;
&lt;br/&gt;
This was spotted in one of the tests that deliberately crashes the VM. The hs_err file shows:&lt;br/&gt;
&lt;br/&gt;
Register to memory mapping:&lt;br/&gt;
&lt;br/&gt;
RIP=0x00007ffaf5ab1000 LingeredApp.dll&lt;br/&gt;
RAX=0x00007ffaf5ab1000 LingeredApp.dll&lt;br/&gt;
RBX={method} {0x0000023fd4401dc0} &amp;#39;crash&amp;#39; &amp;#39;()I&amp;#39; in &amp;#39;jdk/test/lib/apps/LingeredApp&amp;#39;&lt;br/&gt;
RCX=0x0000023fb77581e0 points into unknown readable memory: 0x00007ffaeaeede60 | 60 de ee ea fa 7f 00 00&lt;br/&gt;
RDX=0x000000f29a5ff1b8 is pointing into the stack for thread: 0x0000023fb7757ec0&lt;br/&gt;
RSP=0x000000f29a5ff138 is pointing into the stack for thread: 0x0000023fb7757ec0&lt;br/&gt;
RBP=0x000000f29a5ff1a8 is pointing into the stack for thread: 0x0000023fb7757ec0&lt;br/&gt;
RSI=0x000000000000000c is an unknown value&lt;br/&gt;
RDI=0x0000023fd4017ac0 is pointing into metadata&lt;br/&gt;
R8 ={method} {0x0000023fd4401dc0} &amp;#39;crash&amp;#39; &amp;#39;()I&amp;#39; in &amp;#39;jdk/test/lib/apps/LingeredApp&amp;#39;&lt;br/&gt;
R9 =&lt;br/&gt;
[error occurred during error reporting (printing register info), id 0xe0000000, Internal Error (c:\sb\prod\1677455098\workspace\open\src\hotspot\share\runtime\mutexLocker.cpp:179)]&lt;br/&gt;
&lt;br/&gt;
and the Windows debugger stack dump showed the problematic call chain.</description>
                <environment></environment>
        <key id="5095105">JDK-8303276</key>
            <summary>Secondary assertion failure in AdapterHandlerLibrary::contains during crash reporting</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coleenp">Coleen Phillimore</assignee>
                                    <reporter username="dholmes">David Holmes</reporter>
                        <labels>
                            <label>diagnostics</label>
                            <label>intermittent</label>
                            <label>oracle-triage-21</label>
                    </labels>
                <created>Mon, 27 Feb 2023 17:03:47 -0800</created>
                <updated>Mon, 1 May 2023 10:07:56 -0700</updated>
                            <resolved>Mon, 24 Apr 2023 14:25:29 -0700</resolved>
                                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14576356" author="dukebot" created="Mon, 24 Apr 2023 14:25:28 -0700"  >Changeset: 2ea62c13&lt;br/&gt;
Author:    Coleen Phillimore &amp;lt;&lt;a href=&apos;mailto:coleenp@openjdk.org&apos;&gt;coleenp@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-04-24 21:23:56 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/2ea62c136925299d4b767a0149419e7e9de3629a&quot;&gt;https://git.openjdk.org/jdk/commit/2ea62c136925299d4b767a0149419e7e9de3629a&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14574349" author="roboduke" created="Mon, 17 Apr 2023 12:06:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13500&quot;&gt;https://git.openjdk.org/jdk/pull/13500&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-17 18:57:50 +0000</comment>
                            <comment id="14565852" author="coleenp" created="Fri, 10 Mar 2023 06:52:28 -0800"  >I think assert_locked_or_safepoint code should be disabled if:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (DebuggingContext::is_enabled() || VMError::is_error_reported()) {&lt;br/&gt;
&lt;br/&gt;
We shouldn&amp;#39;t take a lock for the adapter handler hash table in the unlikely event that another thread is accessing it during class linking during error reporting.</comment>
                            <comment id="14563616" author="dholmes" created="Tue, 28 Feb 2023 14:11:45 -0800"  >Yes exactly - while the error reporting thread is calling contains, some other thread could be updating the table. Perhaps this was just as unsafe before the change.</comment>
                            <comment id="14563391" author="thartmann" created="Tue, 28 Feb 2023 04:29:37 -0800"  >I think that depends on what exactly can happen during that stage of error reporting. Can new classes/methods be linked? If so, the table could be updated concurrently and I think it would be unsafe to access without holding the lock.</comment>
                            <comment id="14563348" author="dholmes" created="Tue, 28 Feb 2023 00:54:39 -0800"  >I think the assertion may need to accommodate being called during error reporting, rather than just disabling it, as we should really have the lock or be at a safepoint, to access the table. Though I guess without the lock we could easily crash when accessing the table. So maybe this just isn&amp;#39;t safe to use during error reporting?</comment>
                            <comment id="14563317" author="thartmann" created="Mon, 27 Feb 2023 23:25:14 -0800"  >The assert in AdapterHandlerLibrary::contains was added by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8292384&quot; title=&quot;Convert AdapterHandlerTable to ResourceHashtable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8292384&quot;&gt;&lt;strike&gt;JDK-8292384&lt;/strike&gt;&lt;/a&gt; in JDK 20. [~coleenp], do you think we can simply remove it?&lt;br/&gt;
&lt;br/&gt;
Ideally, we would have a test that uses -XX:CICrashAt and other means to crash the VM at random points and then checks that there was no additional error during error reporting. </comment>
                            <comment id="14563315" author="thartmann" created="Mon, 27 Feb 2023 23:23:40 -0800"  >ILW = Assert during error reporting when printing the contents of registers, intermittent during error reporting, no workaround = MMH = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Blocks</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="5095753">JDK-8303805</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5081616">JDK-8292384</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30jmr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17351"><![CDATA[b20]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>