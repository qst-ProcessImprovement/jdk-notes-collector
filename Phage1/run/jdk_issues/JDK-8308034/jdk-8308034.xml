<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:26:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8308034] Some CDS tests need to use @requires vm.flagless</title>
                <link>https://bugs.openjdk.org/browse/JDK-8308034</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>CDS requires certain flags (e.g., ObjectAlignmentInBytes) to be the same between dump time and run time, or else the CDS archive will fail to load.&lt;br/&gt;
&lt;br/&gt;
Almost all CDS tests generate their own archive files. Therefore, any flags specified via JTREG (e.g., with -vmoptions) will apply to both the dump time and run time. Therefore, even if -vmoptions includes flags like ObjectAlignmentInBytes, the tests will continue to work.&lt;br/&gt;
&lt;br/&gt;
However, some tests fail with -vmoptions:-XX:ObjectAlignmentInBytes=16. We need to investigate why. They probably have a more strict requirement on the command-line options and might need to be tagged with  &amp;quot;@requires vm.flagless&amp;quot;&lt;br/&gt;
&lt;br/&gt;
- runtime/cds/appcds/cacheObject/DifferentHeapSizes.java&lt;br/&gt;
- runtime/cds/appcds/DumpingWithNoCoops.java&lt;br/&gt;
- runtime/cds/appcds/sharedStrings/IncompatibleOptions.java&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5100850">JDK-8308034</key>
            <summary>Some CDS tests need to use @requires vm.flagless</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ccheung">Calvin Cheung</assignee>
                                    <reporter username="iklam">Ioi Lam</reporter>
                        <labels>
                            <label>cds</label>
                            <label>noreg-self</label>
                    </labels>
                <created>Fri, 12 May 2023 16:07:19 -0700</created>
                <updated>Sun, 28 May 2023 20:47:25 -0700</updated>
                            <resolved>Mon, 22 May 2023 08:55:36 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14583399" author="dukebot" created="Mon, 22 May 2023 08:55:35 -0700"  >Changeset: b58980b7&lt;br/&gt;
Author:    Calvin Cheung &amp;lt;&lt;a href=&apos;mailto:ccheung@openjdk.org&apos;&gt;ccheung@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-22 15:53:04 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/b58980b73d5fdbbfd2c8395ceca61fd1cbf613c8&quot;&gt;https://git.openjdk.org/jdk/commit/b58980b73d5fdbbfd2c8395ceca61fd1cbf613c8&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14582970" author="roboduke" created="Fri, 19 May 2023 11:15:23 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14062&quot;&gt;https://git.openjdk.org/jdk/pull/14062&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-19 18:07:18 +0000</comment>
                            <comment id="14582518" author="ccheung" created="Wed, 17 May 2023 21:09:45 -0700"  >With the -XX:ObjectAlignmentInBytes=16 vm option, the DumpingWithNoCoops.java test failed as follows:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;java.lang.RuntimeException: &amp;#39;Setting MaxHeapSize to 4G for CDS dumping&amp;#39; missing from stdout/stderr&lt;br/&gt;
&lt;br/&gt;
It is due to the UseCompressOops is set to true in the following:&lt;br/&gt;
void Arguments::set_use_compressed_oops() {&lt;br/&gt;
#ifdef _LP64&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// MaxHeapSize is not set up properly at this point, but&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// the only value that can override MaxHeapSize if we are&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// to use UseCompressedOops are InitialHeapSize and MinHeapSize.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;size_t max_heap_size = MAX3(MaxHeapSize, InitialHeapSize, MinHeapSize);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (max_heap_size &amp;lt;= max_heap_for_compressed_oops()) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (FLAG_IS_DEFAULT(UseCompressedOops)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FLAG_SET_ERGO(UseCompressedOops, true);     &amp;lt;&amp;lt;&amp;lt;&amp;lt; UseCompressedOops set to true&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&lt;br/&gt;
Since UseCompressedOops is set to true, it returns immediately from:&lt;br/&gt;
void MetaspaceShared::adjust_heap_sizes_for_dumping() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (!DumpSharedSpaces || UseCompressedOops) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// CDS heap dumping requires all string oops to have an offset&lt;br/&gt;
&amp;nbsp;&amp;nbsp;// from the heap bottom that can be encoded in 32-bit.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;julong max_heap_size = (julong)(4 * G);&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (MinHeapSize &amp;gt; max_heap_size) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log_debug(cds)(&amp;quot;Setting MinHeapSize to 4G for CDS dumping, original size = &amp;quot; SIZE_FORMAT &amp;quot;M&amp;quot;, MinHeapSize/M);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FLAG_SET_ERGO(MinHeapSize, max_heap_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (InitialHeapSize &amp;gt; max_heap_size) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log_debug(cds)(&amp;quot;Setting InitialHeapSize to 4G for CDS dumping, original size = &amp;quot; SIZE_FORMAT &amp;quot;M&amp;quot;, InitialHeapSize/M);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FLAG_SET_ERGO(InitialHeapSize, max_heap_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;if (MaxHeapSize &amp;gt; max_heap_size) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log_debug(cds)(&amp;quot;Setting MaxHeapSize to 4G for CDS dumping, original size = &amp;quot; SIZE_FORMAT &amp;quot;M&amp;quot;, MaxHeapSize/M);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FLAG_SET_ERGO(MaxHeapSize, max_heap_size);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
and skipping all those CDS debug log messages.</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31icz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17436"><![CDATA[b24]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>