<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:54:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8304725] AsyncGetCallTrace can cause SIGBUS on M1</title>
                <link>https://bugs.openjdk.org/browse/JDK-8304725</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Calling AsyncGetCallTrace can trigger writing into the PcDescCache. This causes a SIGBUS error when the current thread is not WXWrite mode.&lt;br/&gt;
This is due a missing `MACOS_AARCH64_ONLY(ThreadWXEnable wx(WXWrite, Thread::current());)` to ensure that the thread is in this mode during the walking of the thread stack.&lt;br/&gt;
&lt;br/&gt;
This error occurs sporadically but can be easily reproduced using &lt;a href=&quot;https://github.com/parttimenerd/asgct_bottom&quot;&gt;https://github.com/parttimenerd/asgct_bottom&lt;/a&gt; with the renaissance dotty benchmark.&lt;br/&gt;
&lt;br/&gt;
I could not reproduce this issue with JFR or async-profiler, but fixing it is simple.&lt;br/&gt;
&lt;br/&gt;
Thanks to Martin and Matthias from my team for helping to debug this bug.&lt;br/&gt;
&lt;br/&gt;
Excerpt from the hs_err file:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
Stack: [0x000000016d554000,0x000000016d757000],  sp=0x000000016d750900,  free space=2034k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.dylib+0xdd5a08]  PcDescCache::add_pc_desc(PcDesc*)+0x60&lt;br/&gt;
V  [libjvm.dylib+0xdde49c]  PcDescContainer::find_pc_desc_internal(unsigned char*, bool, PcDescSearch const&amp;amp;)+0x564&lt;br/&gt;
V  [libjvm.dylib+0xf4271c]  PcDescContainer::find_pc_desc(unsigned char*, bool, PcDescSearch const&amp;amp;)+0x9c&lt;br/&gt;
V  [libjvm.dylib+0xa740c0]  CompiledMethod::find_pc_desc(unsigned char*, bool)+0xa0&lt;br/&gt;
V  [libjvm.dylib+0xde1eb0]  CompiledMethod::pc_desc_near(unsigned char*)+0x28&lt;br/&gt;
V  [libjvm.dylib+0x70d96c]  is_decipherable_compiled_frame(JavaThread*, frame*, CompiledMethod*)+0x104&lt;br/&gt;
V  [libjvm.dylib+0x70d574]  find_initial_Java_frame(JavaThread*, frame*, frame*, Method**, int*)+0x304&lt;br/&gt;
V  [libjvm.dylib+0x70d038]  forte_fill_call_trace_given_top(JavaThread*, ASGCT_CallTrace*, int, frame)+0x98&lt;br/&gt;
V  [libjvm.dylib+0x70cf48]  AsyncGetCallTrace+0x2dc&lt;br/&gt;
C  [libbottom.so+0x43c4]  asgctGSTHandler(__darwin_ucontext*)+0xbc&lt;br/&gt;
C  [libbottom.so+0x528c]  signalHandler(int, __siginfo*, void*)+0x20&lt;br/&gt;
C  [libsystem_platform.dylib+0x42a4]  _sigtramp+0x38&lt;br/&gt;
C  0x110180011a9e15f0&lt;br/&gt;
j  jdk.internal.jimage.ImageReader$SharedImageReader$$Lambda+0x00000008011cef68.visit(Ljdk/internal/jimage/ImageLocation;)V+9 &lt;a href=&apos;mailto:java.base@21-internal&apos;&gt;java.base@21-internal&lt;/a&gt;&lt;br/&gt;
j  jdk.internal.jimage.ImageReader$SharedImageReader.visitLocation(Ljdk/internal/jimage/ImageLocation;Ljdk/internal/jimage/ImageReader$SharedImageReader$LocationVisitor;)V+61 &lt;a href=&apos;mailto:java.base@21-internal&apos;&gt;java.base@21-internal&lt;/a&gt;&lt;br/&gt;
j  jdk.internal.jimage.ImageReader$SharedImageReader.handleModulesSubTree(Ljava/lang/String;Ljdk/internal/jimage/ImageLocation;)Ljdk/internal/jimage/ImageReader$Node;+42 &lt;a href=&apos;mailto:java.base@21-internal&apos;&gt;java.base@21-internal&lt;/a&gt;&lt;br/&gt;
j  jdk.internal.jimage.ImageReader$SharedImageReader.buildNode(Ljava/lang/String;)Ljdk/internal/jimage/ImageReader$Node;+69 &lt;a href=&apos;mailto:java.base@21-internal&apos;&gt;java.base@21-internal&lt;/a&gt;&lt;br/&gt;
```</description>
                <environment></environment>
        <key id="5096891">JDK-8304725</key>
            <summary>AsyncGetCallTrace can cause SIGBUS on M1</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbechberger">Johannes Bechberger</assignee>
                                    <reporter username="jbechberger">Johannes Bechberger</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>azul-interest</label>
                            <label>datadog-interest</label>
                            <label>jdk11-fix-request</label>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                    </labels>
                <created>Wed, 22 Mar 2023 08:49:46 -0700</created>
                <updated>Wed, 2 Apr 2025 00:39:46 -0700</updated>
                            <resolved>Tue, 11 Apr 2023 23:51:14 -0700</resolved>
                                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14766137" author="goetz" created="Wed, 2 Apr 2025 00:39:09 -0700"  >I think at least part of this was caused by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8297864&quot; title=&quot;Dead code elimination&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8297864&quot;&gt;&lt;strike&gt;JDK-8297864&lt;/strike&gt;&lt;/a&gt; which came in jdk20.</comment>
                            <comment id="14670656" author="JIRAUSER20001" created="Fri, 3 May 2024 02:12:04 -0700"  >Just for the record: The fix for this issue prevents ASGCT from modifying the PcDescCache.</comment>
                            <comment id="14648684" author="roboduke" created="Tue, 13 Feb 2024 02:40:58 -0800"  >[jdk11u-fix-request] Approval Request from Johannes Bechberger&lt;br/&gt;
Fixes SIGBUS caused by AsyncGetCallTrace on M1&lt;br/&gt;
Clean besides a compilation issue. Tested locally.</comment>
                            <comment id="14639109" author="roboduke" created="Wed, 10 Jan 2024 07:25:18 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2452&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2452&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-10 13:51:29 +0000</comment>
                            <comment id="14639077" author="JIRAUSER20001" created="Wed, 10 Jan 2024 05:55:01 -0800"  >Fix request (11u-dev):&lt;br/&gt;
&lt;br/&gt;
I like to backport it, as the bug is also present in JDK 11.</comment>
                            <comment id="14594216" author="roboduke" created="Thu, 6 Jul 2023 03:40:31 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1554&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1554&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-06 10:34:22 +0000</comment>
                            <comment id="14594214" author="snazarki" created="Thu, 6 Jul 2023 03:35:20 -0700"  >Fix request (17u):&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;d like to backport this to fix the crash when custom profiler is used on mac m1.  </comment>
                            <comment id="14594203" author="snazarki" created="Thu, 6 Jul 2023 02:35:24 -0700"  >Note for future investigator:&lt;br/&gt;
AsyncProfiler bypasses this issue by enforcing WX mode prior to call of AsyncGetCallTrace (&lt;a href=&quot;https://github.com/async-profiler/async-profiler/blob/117594bb4d1ce61b073c8a9cea438b33f3f09c81/src/profiler.cpp#L390&quot;&gt;https://github.com/async-profiler/async-profiler/blob/117594bb4d1ce61b073c8a9cea438b33f3f09c81/src/profiler.cpp#L390&lt;/a&gt;)</comment>
                            <comment id="14573233" author="dukebot" created="Tue, 11 Apr 2023 23:51:13 -0700"  >Changeset: d8af7a60&lt;br/&gt;
Author:    Johannes Bechberger &amp;lt;&lt;a href=&apos;mailto:jbechberger@openjdk.org&apos;&gt;jbechberger@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Matthias Baesken &amp;lt;&lt;a href=&apos;mailto:mbaesken@openjdk.org&apos;&gt;mbaesken@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-04-12 06:49:10 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/d8af7a6014055295355a1242db6c2872299c6398&quot;&gt;https://git.openjdk.org/jdk/commit/d8af7a6014055295355a1242db6c2872299c6398&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14568825" author="roboduke" created="Wed, 22 Mar 2023 09:18:53 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13144&quot;&gt;https://git.openjdk.org/jdk/pull/13144&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-22 15:57:40 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5104974">JDK-8311636</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5121610">JDK-8325985</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                                                <inwardlinks description="caused by">
                                        <issuelink>
            <issuekey id="5088606">JDK-8297864</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5095682">JDK-8303746</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5125291">JDK-8329103</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5153696">JDK-8352649</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5095682">JDK-8303746</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5127771">JDK-8331012</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5100231">JDK-8307549</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5126779">JDK-8330171</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30unf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17414"><![CDATA[b19]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="369"><![CDATA[svc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>