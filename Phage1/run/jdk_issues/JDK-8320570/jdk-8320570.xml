<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 11:52:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8320570] NegativeArraySizeException decoding &gt;1G UTF8 bytes with non-ascii characters</title>
                <link>https://bugs.openjdk.org/browse/JDK-8320570</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>ADDITIONAL SYSTEM INFORMATION :&lt;br/&gt;
Generic. reproduced in both Linux and MacOS (M1)&lt;br/&gt;
&lt;br/&gt;
A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
A regression is found in Java9+ creating String instance from UTF8 bytes, a side effect of string compactation &lt;a href=&quot;https://openjdk.org/jeps/254&quot;&gt;https://openjdk.org/jeps/254&lt;/a&gt; that changed the decoding logic. Specifically, when constructing a string from bytes:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
String str = new String(largeBytes, StandardCharsets.UTF_8);&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
if the size of largeBytes is greater than 2^30 (&amp;gt;1 GB) but smaller than INT_MAX (2 GB), it fails on Java9+ (including 11, 17, 21, though the stack trace is slightly different, see below), regardless of jvm heap size. In Java8, it succeeded when jvm heap size is set to be sufficient.&lt;br/&gt;
&lt;br/&gt;
REGRESSION : Last worked in version 8u391&lt;br/&gt;
&lt;br/&gt;
STEPS TO FOLLOW TO REPRODUCE THE PROBLEM :&lt;br/&gt;
// largeBytes is a byte array of size ~1.2 GB and contains encoded non-ascii character&lt;br/&gt;
String str = new String(largeBytes, StandardCharsets.UTF_8);&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
EXPECTED VERSUS ACTUAL BEHAVIOR :&lt;br/&gt;
EXPECTED -&lt;br/&gt;
The string successfully constructed, if run with sufficient jvm heap size (java -Xms5G -Xmx8G)&lt;br/&gt;
ACTUAL -&lt;br/&gt;
&lt;br/&gt;
Java8:&lt;br/&gt;
```&lt;br/&gt;
$ java -Xms5G -Xmx8G org/example/Main&lt;br/&gt;
(succeeded)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
Java11 (regardless of heap size):&lt;br/&gt;
```&lt;br/&gt;
$ java org/example/Main&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.NegativeArraySizeException: -1894967266&lt;br/&gt;
	at java.base/java.lang.StringCoding.decodeUTF8_0(StringCoding.java:777)&lt;br/&gt;
	at java.base/java.lang.StringCoding.decodeUTF8(StringCoding.java:734)&lt;br/&gt;
	at java.base/java.lang.StringCoding.decode(StringCoding.java:257)&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:507)&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:561)&lt;br/&gt;
	at org.example.Main.main(Main.java:28)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
Java17 (regardless of heap size):&lt;br/&gt;
```&lt;br/&gt;
$ java org/example/Main&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.NegativeArraySizeException: -1894967266&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:568)&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:1387)&lt;br/&gt;
	at org.example.Main.main(Main.java:28)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
Java21 (regardless of heap size):&lt;br/&gt;
```&lt;br/&gt;
$ java org/example/Main&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.NegativeArraySizeException: -1894967266&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:577)&lt;br/&gt;
	at java.base/java.lang.String.&amp;lt;init&amp;gt;(String.java:1425)&lt;br/&gt;
	at org.example.Main.main(Main.java:28)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
Java8, default heap size:&lt;br/&gt;
```&lt;br/&gt;
$ java org/example/Main&lt;br/&gt;
Exception in thread &amp;quot;main&amp;quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
	at java.lang.StringCoding.decode(StringCoding.java:215)&lt;br/&gt;
	at java.lang.String.&amp;lt;init&amp;gt;(String.java:463)&lt;br/&gt;
	at java.lang.String.&amp;lt;init&amp;gt;(String.java:515)&lt;br/&gt;
	at org.example.Main.main(Main.java:28)&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
---------- BEGIN SOURCE ----------&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/Abacn/e8fda767f53e723db6d71f21f4db2187&quot;&gt;https://gist.github.com/Abacn/e8fda767f53e723db6d71f21f4db2187&lt;/a&gt;&lt;br/&gt;
---------- END SOURCE ----------&lt;br/&gt;
&lt;br/&gt;
CUSTOMER SUBMITTED WORKAROUND :&lt;br/&gt;
Probably work: split the byte array and construct two string, then add them up&lt;br/&gt;
&lt;br/&gt;
FREQUENCY : always&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5115241">JDK-8320570</key>
            <summary>NegativeArraySizeException decoding &gt;1G UTF8 bytes with non-ascii characters</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jlaskey">Jim Laskey</assignee>
                                    <reporter username="webbuggrp">Webbug Group</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>dcsaw</label>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>regression</label>
                            <label>reproducer-yes</label>
                            <label>webbug</label>
                    </labels>
                <created>Tue, 21 Nov 2023 13:29:10 -0800</created>
                <updated>Tue, 18 Jun 2024 02:16:01 -0700</updated>
                            <resolved>Wed, 6 Dec 2023 13:57:32 -0800</resolved>
                                    <version>9</version>
                    <version>11</version>
                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>core-libs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14682183" author="roboduke" created="Mon, 17 Jun 2024 12:28:16 -0700"  >[jdk11u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 11.0.25-oracle. The backport has been reviewed and tier 1-4 have passed.</comment>
                            <comment id="14682113" author="roboduke" created="Mon, 17 Jun 2024 07:43:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/2783&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/2783&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-17 14:39:19 +0000</comment>
                            <comment id="14657625" author="roboduke" created="Fri, 15 Mar 2024 00:08:55 -0700"  >[jdk17u-fix-request] Approval Request from Amos&lt;br/&gt;
&amp;quot;Backporting for parity with 17.0.12-oracle. Un-Clean backport. SAP nightlies passed on 2024-03-15&#8221;</comment>
                            <comment id="14655966" author="roboduke" created="Fri, 8 Mar 2024 15:06:22 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2279&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2279&lt;/a&gt;&lt;br/&gt;
Date: 2024-03-08 23:02:11 +0000</comment>
                            <comment id="14655941" author="roboduke" created="Fri, 8 Mar 2024 13:43:37 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/344&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/344&lt;/a&gt;&lt;br/&gt;
Date: 2024-03-08 21:39:07 +0000</comment>
                            <comment id="14655234" author="roboduke" created="Wed, 6 Mar 2024 11:36:35 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/332&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/332&lt;/a&gt;&lt;br/&gt;
Date: 2024-03-05 19:02:47 +0000</comment>
                            <comment id="14655233" author="JIRAUSER20703" created="Wed, 6 Mar 2024 11:34:13 -0800"  >Fix request [21u]&lt;br/&gt;
I backport this for parity with 21.0.4-oracle. &lt;br/&gt;
Patch is not clean. More details on conflicts added on the PR. &lt;br/&gt;
Testing: I was able to verify the fix with the reproducer and added test case passes. &lt;br/&gt;
</comment>
                            <comment id="14632215" author="dukebot" created="Wed, 6 Dec 2023 13:57:31 -0800"  >Changeset: 82796bde&lt;br/&gt;
Author:    Jim Laskey &amp;lt;&lt;a href=&apos;mailto:jlaskey@openjdk.org&apos;&gt;jlaskey@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-12-06 21:55:05 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/82796bdebbf56b98ec97a6d572ed68c2842f60c6&quot;&gt;https://git.openjdk.org/jdk/commit/82796bdebbf56b98ec97a6d572ed68c2842f60c6&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14631697" author="roboduke" created="Tue, 5 Dec 2023 07:03:39 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/16974&quot;&gt;https://git.openjdk.org/jdk/pull/16974&lt;/a&gt;&lt;br/&gt;
Date: 2023-12-05 14:57:09 +0000</comment>
                            <comment id="14628438" author="tongwan" created="Wed, 22 Nov 2023 05:40:20 -0800"  >The observations on Windows 11:&lt;br/&gt;
JDK 8: Passed.&lt;br/&gt;
JDK 11: Failed, NegativeArraySizeException thrown.&lt;br/&gt;
JDK 17: Failed.&lt;br/&gt;
JDK 21: Failed.&lt;br/&gt;
JDK 22ea+16: Failed.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5120023">JDK-8324698</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5120024">JDK-8324699</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5120025">JDK-8324700</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5123844">JDK-8327855</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5126537">JDK-8329977</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5132084">JDK-8334451</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="107298" name="Main.java" size="975" author="tongwan" created="Wed, 22 Nov 2023 05:37:58 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17008"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17010"><![CDATA[generic]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33yfv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17419"><![CDATA[b27]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="190"><![CDATA[java.lang]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>