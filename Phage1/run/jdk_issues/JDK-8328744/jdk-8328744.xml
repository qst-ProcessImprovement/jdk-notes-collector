<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:13:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8328744] Parallel: Parallel GC throws OOM before heap is fully expanded</title>
                <link>https://bugs.openjdk.org/browse/JDK-8328744</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Run attached test case with following command line:&lt;br/&gt;
-Xmx2G  -XX:+UseParallelGC -XX:NativeMemoryTracking=summary -XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics gc&lt;br/&gt;
&lt;br/&gt;
After test is terminated with OOM, NMT statistics shows:&lt;br/&gt;
&lt;br/&gt;
-                 Java Heap (reserved=2147483648, committed=1541406720)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(mmap: reserved=2147483648, committed=1541406720, peak=2147483648) &lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
&lt;br/&gt;
The heap has not yet fully expanded.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5124893">JDK-8328744</key>
            <summary>Parallel: Parallel GC throws OOM before heap is fully expanded</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zgu">Zhengyu Gu</assignee>
                                    <reporter username="zgu">Zhengyu Gu</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>gc-parallel</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>jdk22u-fix-SQE-ok</label>
                            <label>jdk22u-fix-request</label>
                            <label>jdk22u-fix-yes</label>
                            <label>release-note=yes</label>
                    </labels>
                <created>Thu, 21 Mar 2024 13:15:09 -0700</created>
                <updated>Fri, 25 Jul 2025 10:10:20 -0700</updated>
                            <resolved>Fri, 25 Jul 2025 10:10:05 -0700</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                    <version>23</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                                                            <comments>
                            <comment id="14803495" author="rsunderbabu" created="Fri, 25 Jul 2025 10:09:39 -0700"  >Reopening the bug to fix the Verification status</comment>
                            <comment id="14802763" author="ayang" created="Wed, 23 Jul 2025 07:02:51 -0700"  >To prevent potential confusion, I&#8217;d like to clarify the following:&lt;br/&gt;
&lt;br/&gt;
This **premature OOM** can occur *only if* `UseGCOverheadLimit` is enabled (which is the default). The corresponding patch modifies the heuristic that decides whether a young GC should be proactively upgraded to a full GC, based on the **predicted promotion size** and **available space** in the old generation.&lt;br/&gt;
&lt;br/&gt;
Before this fix, the heuristic could be overly conservative, especially in scenarios where the heap is nearly full. In such cases, multiple back-to-back full GCs could occur, quickly triggering the **GC overhead limit** and resulting in an **OOM** -- even though the heap had not yet been fully expanded. However, this premature OOM is considered *working as expected*, since the GC overhead limit was indeed exceeded.&lt;br/&gt;
&lt;br/&gt;
The patch adjusts the heuristic to be less conservative. As a result, it favors continuing with **young GC** and avoids the previously common overly aggressive back-to-back **full GCs**. (Of course, if the heap is truly too full, back-to-back full GCs may still occur.)&lt;br/&gt;
&lt;br/&gt;
If `UseGCOverheadLimit` is **disabled**, we should not see such premature OOMs, because the allocation path will always attempt to **expand the old generation** before giving up. For example, in JDK 21:&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/jdk-21-ga/src/hotspot/share/gc/parallel/parallelScavengeHeap.cpp&quot;&gt;https://github.com/openjdk/jdk/blob/jdk-21-ga/src/hotspot/share/gc/parallel/parallelScavengeHeap.cpp&lt;/a&gt;&lt;br/&gt;
`ParallelScavengeHeap::failed_mem_allocate` attempts to expand the old generation before returning `null`.</comment>
                            <comment id="14677927" author="roboduke" created="Fri, 31 May 2024 13:10:44 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/2515&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/2515&lt;/a&gt;&lt;br/&gt;
Date: 2024-05-31 20:07:03 +0000</comment>
                            <comment id="14674833" author="ayang" created="Tue, 21 May 2024 01:39:59 -0700"  >[~zgu] Some perf regression on mac-aarch64: &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8332485&quot;&gt;https://bugs.openjdk.org/browse/JDK-8332485&lt;/a&gt; Can you reproduce locally?</comment>
                            <comment id="14674186" author="ayang" created="Fri, 17 May 2024 04:12:19 -0700"  >[~zgu] just fyi: &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8332225&quot;&gt;https://bugs.openjdk.org/browse/JDK-8332225&lt;/a&gt;</comment>
                            <comment id="14669403" author="zgu" created="Tue, 30 Apr 2024 10:20:32 -0700"  >Fix request (21u)&lt;br/&gt;
&lt;br/&gt;
I would to backport this patch to jdk21u, as it is a p2 bug. It is a clean backport after &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8319713&quot; title=&quot;Parallel: Remove PSAdaptiveSizePolicy::should_full_GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8319713&quot;&gt;&lt;strike&gt;JDK-8319713&lt;/strike&gt;&lt;/a&gt; backport.&lt;br/&gt;
</comment>
                            <comment id="14669362" author="roboduke" created="Tue, 30 Apr 2024 07:43:40 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/546&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/546&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-30 14:39:47 +0000</comment>
                            <comment id="14665240" author="zgu" created="Mon, 15 Apr 2024 07:37:26 -0700"  >Fix request (22u)&lt;br/&gt;
&lt;br/&gt;
I would like to backport this patch to jdk22u, as it is a p2 bug and it is a clean backport.</comment>
                            <comment id="14665239" author="roboduke" created="Mon, 15 Apr 2024 07:37:18 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22u/pull/143&quot;&gt;https://git.openjdk.org/jdk22u/pull/143&lt;/a&gt;&lt;br/&gt;
Date: 2024-04-15 14:33:04 +0000</comment>
                            <comment id="14660058" author="dukebot" created="Mon, 25 Mar 2024 06:07:02 -0700"  >Changeset: 142c311e&lt;br/&gt;
Author:    Zhengyu Gu &amp;lt;&lt;a href=&apos;mailto:zgu@openjdk.org&apos;&gt;zgu@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-03-25 13:04:07 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/142c311e3b9bd3f00edaa6ba7bcbc9fc285ee9b9&quot;&gt;https://git.openjdk.org/jdk/commit/142c311e3b9bd3f00edaa6ba7bcbc9fc285ee9b9&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14659840" author="roboduke" created="Sat, 23 Mar 2024 07:15:31 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/18463&quot;&gt;https://git.openjdk.org/jdk/pull/18463&lt;/a&gt;&lt;br/&gt;
Date: 2024-03-23 14:10:45 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5128537">JDK-8331574</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5127585">JDK-8330841</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5142360">JDK-8342956</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5129426">JDK-8332225</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5129719">JDK-8332485</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5114311">JDK-8319713</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="108709" name="gc.java" size="380" author="zgu" created="Thu, 21 Mar 2024 13:11:02 -0700"/>
                    </attachments>
                <subtasks>
                                              <subtask id="5137416">JDK-8338920</subtask>
                                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35kdf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17312"><![CDATA[b16]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="209"><![CDATA[gc]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>