<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 13:44:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8257197] Add additional verification code to PhaseCCP</title>
                <link>https://bugs.openjdk.org/browse/JDK-8257197</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>We should catch problems like &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8257166&quot; title=&quot;[lworld] CCP fails to optimize FlatArrayCheckNode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8257166&quot;&gt;&lt;strike&gt;JDK-8257166&lt;/strike&gt;&lt;/a&gt; during CCP by adding some verification code:&lt;br/&gt;
&lt;br/&gt;
@@ -1717,11 +1717,13 @@ void PhaseCCP::analyze() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// Push root onto worklist&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;Unique_Node_List worklist;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;worklist.push(C-&amp;gt;root());&lt;br/&gt;
+  DEBUG_ONLY(Unique_Node_List worklist_verify;)&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// Pull from worklist; compute new value; push changes out.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// This loop is the meat of CCP.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;while( worklist.size() ) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Node *n = worklist.pop();&lt;br/&gt;
+    DEBUG_ONLY(worklist_verify.push(n);)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;const Type *t = n-&amp;gt;Value(this);&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if (t != type(n)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assert(ccp_type_widens(t, type(n)), &amp;quot;ccp type must widen&amp;quot;);&lt;br/&gt;
@@ -1813,6 +1815,21 @@ void PhaseCCP::analyze() {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br/&gt;
+#ifdef ASSERT&lt;br/&gt;
+  while (worklist_verify.size()) {&lt;br/&gt;
+    Node* n = worklist_verify.pop();&lt;br/&gt;
+    const Type* told = type(n);&lt;br/&gt;
+    const Type* tnew = n-&amp;gt;Value(this);&lt;br/&gt;
+    if (told != tnew) {&lt;br/&gt;
+      told-&amp;gt;dump_on(tty);&lt;br/&gt;
+      tty-&amp;gt;print_cr(&amp;quot;&amp;quot;);&lt;br/&gt;
+      tnew-&amp;gt;dump_on(tty);&lt;br/&gt;
+      tty-&amp;gt;print_cr(&amp;quot;&amp;quot;);&lt;br/&gt;
+      n-&amp;gt;dump(1);&lt;br/&gt;
+      fatal(&amp;quot;missed optimization opportunity&amp;quot;);&lt;br/&gt;
+    }&lt;br/&gt;
+  }&lt;br/&gt;
+#endif&lt;br/&gt;
&amp;nbsp;}</description>
                <environment></environment>
        <key id="5035767">JDK-8257197</key>
            <summary>Add additional verification code to PhaseCCP</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epeter">Emanuel Peter</assignee>
                                    <reporter username="thartmann">Tobias Hartmann</reporter>
                        <labels>
                            <label>c2</label>
                    </labels>
                <created>Thu, 26 Nov 2020 23:53:19 -0800</created>
                <updated>Thu, 3 Aug 2023 02:20:39 -0700</updated>
                            <resolved>Thu, 8 Dec 2022 23:14:43 -0800</resolved>
                                    <version>16</version>
                    <version>17</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14544120" author="dukebot" created="Thu, 8 Dec 2022 23:14:42 -0800"  >Changeset: 11aece21&lt;br/&gt;
Author:    Emanuel Peter &amp;lt;&lt;a href=&apos;mailto:epeter@openjdk.org&apos;&gt;epeter@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2022-12-09 07:11:57 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/11aece21f4eb5b18af357b265bc27b80bcdbfbcb&quot;&gt;https://git.openjdk.org/jdk/commit/11aece21f4eb5b18af357b265bc27b80bcdbfbcb&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14543046" author="roboduke" created="Tue, 6 Dec 2022 00:12:51 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/11529&quot;&gt;https://git.openjdk.org/jdk/pull/11529&lt;/a&gt;&lt;br/&gt;
Date: 2022-12-06 08:02:12 +0000</comment>
                            <comment id="14527168" author="JIRAUSER19821" created="Fri, 30 Sep 2022 05:59:43 -0700"  >A few observations:&lt;br/&gt;
The main reason that optimizations that could have happened did not happen: some (recursive) input node had a modification but did not notify down the outputs enough.&lt;br/&gt;
The problem: the further the optimization looks recursively at the inputs, the more we would have to notify down modifications. Currently, we do 1 hop by default, in some cases 2 hops, and in special occasions 3 hops.&lt;br/&gt;
Further: during IGVN and CCP we have different notification implementations that do not agree.&lt;br/&gt;
PhaseCCP::push_child_nodes_to_worklist&lt;br/&gt;
PhaseIterGVN::add_users_to_worklist&lt;br/&gt;
The differences may be in part explained by the difference in optimizatzions of IGVN and CCP, but who really checks that it is correct? It is very easy to forget notification all together, or in one of the two locations.&lt;br/&gt;
&lt;br/&gt;
So that I can make progress, I will exclude LoadNodes from the verification for now.</comment>
                            <comment id="14525435" author="JIRAUSER19821" created="Thu, 22 Sep 2022 01:37:17 -0700"  >We can do a similar thing in IGVN.&lt;br/&gt;
I have noticed that for example AddINode checks input of input to do constant folding. But when an input of an input is changed during IGVN, only that changed node&amp;#39;s outputs get notified and put on the igvn worklist, and not the AddINode which is an output of an output. We do that &amp;quot;grandchildren&amp;quot; notification in some cases though - just not in all.</comment>
                            <comment id="14384514" author="thartmann" created="Mon, 30 Nov 2020 01:37:20 -0800"  >Also seeing this which is not as straight forward to fix:&lt;br/&gt;
&lt;br/&gt;
char&lt;br/&gt;
char:w&lt;br/&gt;
&amp;nbsp;2051  Phi  ===  2045  2036  275  [[ 2118  2152  2087  2118  2110  3474  2170  2132  2135  2141  2152 ]]  #int:-257..65535 !jvms: DataInputStream::readUTF @ bci:-1 (line 595)&lt;br/&gt;
&amp;nbsp;2166  Proj  ===  2165  [[ 2183  2169  2170 ]] #0 !jvms: DataInputStream::readUTF @ bci:70 (line 607)&lt;br/&gt;
&amp;nbsp;2170  CastII  ===  2166  2051  [[ 2178  2183  2183 ]]  #char !jvms: DataInputStream::readUTF @ bci:70 (line 607)</comment>
                            <comment id="14384513" author="thartmann" created="Mon, 30 Nov 2020 01:36:38 -0800"  >Adding this verification code triggers failures right away. One issue:&lt;br/&gt;
&lt;br/&gt;
int&lt;br/&gt;
bool&lt;br/&gt;
&amp;nbsp;73  Conv2B  === _  186  [[ 77 ]]  !jvms: Assert::assertEquals @ bci:27 (line 115)&lt;br/&gt;
&amp;nbsp;59  Conv2B  === _  57  [[ 77 ]]  !jvms: Assert::assertEquals @ bci:18 (line 115)&lt;br/&gt;
&amp;nbsp;77  XorI  === _  59  73  [[ 78 ]]  !orig=74 !jvms: Assert::assertEquals @ bci:27 (line 115)&lt;br/&gt;
&lt;br/&gt;
XorINode::add_ring should be fixed like this:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// Complementing a boolean?&lt;br/&gt;
-  if( r0 == TypeInt::BOOL &amp;amp;&amp;amp; ( r1 == TypeInt::ONE&lt;br/&gt;
-                               || r1 == TypeInt::BOOL))&lt;br/&gt;
+  if ((r0 == TypeInt::BOOL &amp;amp;&amp;amp; r1 == TypeInt::ONE) ||&lt;br/&gt;
+      (r0 == TypeInt::ONE  &amp;amp;&amp;amp; r1 == TypeInt::BOOL)) {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return TypeInt::BOOL;&lt;br/&gt;
+  }</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5107298">JDK-8313672</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5089329">JDK-8298484</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5058193">JDK-8273496</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5088890">JDK-8298094</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5089937">JDK-8298951</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5035722">JDK-8257166</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5087872">JDK-8297264</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5090619">JDK-8299546</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5098467">JDK-8306042</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5077325">JDK-8288683</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qiar:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17317"><![CDATA[b02]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>