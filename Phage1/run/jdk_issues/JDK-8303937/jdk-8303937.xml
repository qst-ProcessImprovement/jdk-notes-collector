<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:36:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303937] Corrupted heap dumps due to missing retries for os::write()</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303937</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>After &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8237354&quot; title=&quot;Add option to jcmd to write a gzipped heap dump&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8237354&quot;&gt;&lt;strike&gt;JDK-8237354&lt;/strike&gt;&lt;/a&gt;, we noticed heap dumps could become corrupted.&lt;br/&gt;
&lt;br/&gt;
The root cause is in FileWriter::write_buf() in heapDumperCompression.cpp, for n = os::write(_fd, buf, (uint) size); n could be &amp;gt; 0 but smaller than size. In this case, there should be a loop to retry os::write() for the remaining bytes in buf. There was such a loop in DumpWriter::write_internal() before &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8237354&quot; title=&quot;Add option to jcmd to write a gzipped heap dump&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8237354&quot;&gt;&lt;strike&gt;JDK-8237354&lt;/strike&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
This problem is well documented in the man page for write(): &lt;a href=&quot;https://man7.org/linux/man-pages/man2/write.2.html#RETURN_VALUE&quot;&gt;https://man7.org/linux/man-pages/man2/write.2.html#RETURN_VALUE&lt;/a&gt;.&lt;br/&gt;
&lt;br/&gt;
In our case, we see the corruption frequently because we support dumping heap to a socket or pipe.</description>
                <environment></environment>
        <key id="5095927">JDK-8303937</key>
            <summary>Corrupted heap dumps due to missing retries for os::write()</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="manc">Man Cao</assignee>
                                    <reporter username="manc">Man Cao</reporter>
                        <labels>
                            <label>google-interest</label>
                            <label>heapdump</label>
                            <label>jdk11u-fix-request</label>
                            <label>jdk11u-fix-yes</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>jdk20u-fix-SQE-ok-next</label>
                            <label>jdk20u-fix-request</label>
                            <label>jdk20u-fix-yes</label>
                    </labels>
                <created>Thu, 9 Mar 2023 17:44:00 -0800</created>
                <updated>Mon, 18 Sep 2023 18:42:37 -0700</updated>
                            <resolved>Fri, 10 Mar 2023 10:16:33 -0800</resolved>
                                    <version>11.0.14</version>
                    <version>15</version>
                    <version>16</version>
                    <version>17</version>
                    <version>18</version>
                    <version>19</version>
                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>core-svc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14565995" author="roboduke" created="Fri, 10 Mar 2023 14:09:46 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk11u-dev/pull/1801&quot;&gt;https://git.openjdk.org/jdk11u-dev/pull/1801&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-10 21:57:34 +0000</comment>
                            <comment id="14565994" author="manc" created="Fri, 10 Mar 2023 14:00:41 -0800"  >Fix request [11u]&lt;br/&gt;
&lt;br/&gt;
Resolved trivial merge conflict in &lt;a href=&quot;https://github.com/openjdk/jdk11u-dev/pull/1801&quot;&gt;https://github.com/openjdk/jdk11u-dev/pull/1801&lt;/a&gt;.&lt;br/&gt;
Fixes a real bug that causes heap dump corruption. The bug was introduced into 11.0.14u in &lt;a href=&quot;https://github.com/openjdk/jdk11u-dev/commit/1868c15d4e5d03895a4a07edacd864021dfbac57&quot;&gt;https://github.com/openjdk/jdk11u-dev/commit/1868c15d4e5d03895a4a07edacd864021dfbac57&lt;/a&gt;.&lt;br/&gt;
Low risk. All tier1 tests passed in Github pre-submit checks. In addition, manually ran:&lt;br/&gt;
- test/jdk/com/sun/management/HotSpotDiagnosticMXBean/DumpHeap.java&lt;br/&gt;
- test/jdk/sun/tools/jmap/BasicJMapTest.java&lt;br/&gt;
and both passed.</comment>
                            <comment id="14565989" author="manc" created="Fri, 10 Mar 2023 13:41:29 -0800"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
Resolved trivial merge conflict in &lt;a href=&quot;https://github.com/openjdk/jdk17u-dev/pull/1201&quot;&gt;https://github.com/openjdk/jdk17u-dev/pull/1201&lt;/a&gt;.&lt;br/&gt;
Fixes a real bug that causes heap dump corruption.&lt;br/&gt;
Low risk. All tier1 tests passed in Github pre-submit checks. In addition, manually ran:&lt;br/&gt;
- test/jdk/com/sun/management/HotSpotDiagnosticMXBean/DumpHeap.java&lt;br/&gt;
- test/jdk/sun/tools/jmap/BasicJMapTest.java&lt;br/&gt;
and both passed.</comment>
                            <comment id="14565988" author="roboduke" created="Fri, 10 Mar 2023 13:36:28 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1201&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1201&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-10 21:06:18 +0000</comment>
                            <comment id="14565980" author="roboduke" created="Fri, 10 Mar 2023 12:45:48 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk20u/pull/18&quot;&gt;https://git.openjdk.org/jdk20u/pull/18&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-10 20:36:56 +0000</comment>
                            <comment id="14565979" author="manc" created="Fri, 10 Mar 2023 12:44:29 -0800"  >Fix request [20u]&lt;br/&gt;
&lt;br/&gt;
Clean backport and no conflict. Fixes a real bug that causes heap dump corruption.&lt;br/&gt;
Low risk. All tier1 tests passed in Github pre-submit checks. In addition, manually ran:&lt;br/&gt;
- test/jdk/com/sun/management/HotSpotDiagnosticMXBean/DumpHeap.java&lt;br/&gt;
- test/jdk/sun/tools/jmap/BasicJMapTest.java&lt;br/&gt;
and both passed.&lt;br/&gt;
</comment>
                            <comment id="14565948" author="dukebot" created="Fri, 10 Mar 2023 10:16:31 -0800"  >Changeset: bf16b5b9&lt;br/&gt;
Author:    Man Cao &amp;lt;&lt;a href=&apos;mailto:manc@openjdk.org&apos;&gt;manc@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-10 18:14:09 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/bf16b5b9880eb89b283006db090dce4346aa877b&quot;&gt;https://git.openjdk.org/jdk/commit/bf16b5b9880eb89b283006db090dce4346aa877b&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14565708" author="roboduke" created="Thu, 9 Mar 2023 18:19:43 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12966&quot;&gt;https://git.openjdk.org/jdk/pull/12966&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-10 02:13:22 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5096273">JDK-8304227</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5096280">JDK-8304233</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5096281">JDK-8304234</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5099636">JDK-8307012</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103847">JDK-8310612</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5095933">JDK-8303942</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5110535">JDK-8316468</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5095934">JDK-8303943</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5008546">JDK-8237354</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="20306">15</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30op7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17407"><![CDATA[b14]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="368"><![CDATA[tools]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>