<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 14:09:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8293841] RISC-V: Implementation of Foreign Function &amp; Memory API (Preview)</title>
                <link>https://bugs.openjdk.org/browse/JDK-8293841</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Add experimental  Foreign Function &amp;amp; Memory API support for riscv.&lt;br/&gt;
&lt;br/&gt;
Code is mainly adapted from AArch64 port, and with some riscv ABI specific changes:&lt;br/&gt;
1.  According to the riscv spec [1], when multiple floating-point precisions are supported,&lt;br/&gt;
then valid values of narrower n-bit types, n &amp;lt; FLEN, are represented in the lower n&lt;br/&gt;
bits of a FLEN-bit NaN value, in a process termed NaN-boxing. The upper bits of a&lt;br/&gt;
valid NaN-boxed value must be all 1s. We initialize all bits of the return buffer with&lt;br/&gt;
1s so that we could always transfer returned floating-point value from the return buffer&lt;br/&gt;
into register with a single fld without knowing the current type of the value.&lt;br/&gt;
2. When the type class is aggregate type, the ABI of riscv is more complicated [1][2]: &lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Aggregates larger than 2 * XLEN bits are passed by reference &lt;br/&gt;
&amp;nbsp;&amp;nbsp;- A struct containing just one floating-point real is passed in a floating-point &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;argument register if it is no more than ABI_FLEN bits wide and at least one &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;floating-point argument register is available. A struct containing two floating-point &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;reals is passed in two floating-point registers, if neither real is more than ABI_FLEN &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;bits wide and at least two floating-point argument registers are available.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;- A struct containing one floating-point real and one integer (or bitfield), in either order,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;is passed in a floating-point register and an integer register, provided the floating-point &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;real is no more than ABI_FLEN bits wide and the integer is no more than XLEN bits wide, &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;and at least one floating-point argument register and at least one integer argument &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;register is available. &lt;br/&gt;
&amp;nbsp;&amp;nbsp;- Aggregates whose total size is no more than XLEN bits are passed in a register,&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;with the fields laid out as though they were passed in memory. If no register is available, &lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;the aggregate is passed on the stack.&lt;br/&gt;
3. The va_list type is defined as void* on riscv [3]. In the base integer calling convention, &lt;br/&gt;
variadic arguments are passed in the same manner as named arguments, with one exception.&lt;br/&gt;
Variadic arguments with 2&amp;#xD7;XLEN-bit alignment and size at most 2&amp;#xD7;XLEN bits are passed in&lt;br/&gt;
an aligned register pair (i.e., the first register in the pair is even-numbered), or on the stack &lt;br/&gt;
by value if none is available. After a variadic argument has been passed on the stack, all future&lt;br/&gt;
arguments will also be passed on the stack (i.e. the last argument register may be left unused&lt;br/&gt;
due to the aligned register pair rule).&lt;br/&gt;
4. The frame layout of riscv is a bit different from AArch64. sender_sp_offset on riscv is 0 [4],&lt;br/&gt;
so the FP_BIAS is set to 0 on riscv.&lt;br/&gt;
&lt;br/&gt;
[1]: &lt;a href=&quot;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#hardware-floating-point-calling-convention&quot;&gt;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#hardware-floating-point-calling-convention&lt;/a&gt;&lt;br/&gt;
[2]: &lt;a href=&quot;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#integer-calling-convention&quot;&gt;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#integer-calling-convention&lt;/a&gt;&lt;br/&gt;
[3]: &lt;a href=&quot;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#va_list-va_start-and-va_arg&quot;&gt;https://github.com/riscv-non-isa/riscv-elf-psabi-doc/blob/master/riscv-cc.adoc#va_list-va_start-and-va_arg&lt;/a&gt;&lt;br/&gt;
[4]: &lt;a href=&quot;https://github.com/openjdk/jdk/blob/0532045edb709a995a42c07d95cb1cbabe886bed/src/hotspot/cpu/riscv/frame_riscv.hpp#L111&quot;&gt;https://github.com/openjdk/jdk/blob/0532045edb709a995a42c07d95cb1cbabe886bed/src/hotspot/cpu/riscv/frame_riscv.hpp#L111&lt;/a&gt;</description>
                <environment></environment>
        <key id="5083451">JDK-8293841</key>
            <summary>RISC-V: Implementation of Foreign Function &amp; Memory API (Preview)</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fjiang">Feilong Jiang</assignee>
                                    <reporter username="fjiang">Feilong Jiang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Sep 2022 23:24:48 -0700</created>
                <updated>Tue, 28 Mar 2023 10:40:49 -0700</updated>
                            <resolved>Wed, 18 Jan 2023 17:34:36 -0800</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14552586" author="dukebot" created="Wed, 18 Jan 2023 17:34:35 -0800"  >Changeset: 24cdcd4c&lt;br/&gt;
Author:    Feilong Jiang &amp;lt;&lt;a href=&apos;mailto:fjiang@openjdk.org&apos;&gt;fjiang@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Fei Yang &amp;lt;&lt;a href=&apos;mailto:fyang@openjdk.org&apos;&gt;fyang@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-01-19 01:33:35 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/24cdcd4c70dd538fd6c6c9f05da480ea65463209&quot;&gt;https://git.openjdk.org/jdk/commit/24cdcd4c70dd538fd6c6c9f05da480ea65463209&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14548641" author="roboduke" created="Wed, 4 Jan 2023 03:19:14 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/11004&quot;&gt;https://git.openjdk.org/jdk/pull/11004&lt;/a&gt;&lt;br/&gt;
Date: 2022-11-05 03:48:01 +0000</comment>
                            <comment id="14525980" author="JIRAUSER19808" created="Mon, 26 Sep 2022 00:02:29 -0700"  >Porting Foreign Function &amp;amp; Memory API (Preview) to RISC-V is carried out here &lt;a href=&quot;https://github.com/feilongjiang/jdk/tree/JDK-8293841-foreign-api-riscv&quot;&gt;https://github.com/feilongjiang/jdk/tree/JDK-8293841-foreign-api-riscv&lt;/a&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5097312">JDK-8305097</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5084990">JDK-8295044</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5086911">JDK-8296477</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5092770">JDK-8301313</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5095379">JDK-8303512</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5069030">JDK-8282191</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="20300"><![CDATA[riscv]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yklf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17335"><![CDATA[b07]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>