<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 17:19:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303431] [JVMCI] libgraal annotation API</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303431</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Like C1 and C2, the Graal compiler implements compilation pragmas expressed as Java annotations. For example, Graal supports the jdk.internal.vm.annotation.ForceInline and jdk.internal.vm.annotation.DontInline annotations. It does so by reading the method flags these annotations are converted to by HotSpot&#8217;s class file parser[1].&lt;br/&gt;
&lt;br/&gt;
Truffle also defines similar pragmas as annotations (e.g. TruffleBoundary[2]). Ideally, the Truffle compiler extensions within libgraal would simply use the existing ResolvedJavaMethod.getAnnotations() and ResolvedJavaMethod.getAnnotation(Class&amp;lt;T&amp;gt; annotationClass) methods to read such annotations. However, that would involve reifying arbitrary Annotation objects in libgraal which is not possible for a number of reasons:&lt;br/&gt;
&lt;br/&gt;
- The way annotation parsing is implemented in the JDK, all annotations on a method are instantiated as soon as one annotation is requested. This is not possible for libgraal as it does not know all possible annotation types used by Truffle guest languages ahead of time.&lt;br/&gt;
- Even if all types were known, it would mean including sun.reflect.annotation.AnnotationParser and friends in libgraal, bloating its size.&lt;br/&gt;
&lt;br/&gt;
The current solution is for libgraal to call (via JNI) back into Truffle runtime support code running in Java which invokes ResolvedJavaMethod.getAnnotations() and serializes the result back across the JNI boundary. This necessitates loading and execution of JVMCI code in the HotSpot heap which is contrary to the goal of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8298099&quot; title=&quot;[JVMCI] decouple libgraal from JVMCI module at runtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8298099&quot;&gt;&lt;strike&gt;JDK-8298099&lt;/strike&gt;&lt;/a&gt;. It also means *all* annotations of a method are instantiated, not just those of interest to libgraal. This, in turn, means potentially executing class initializers for enum types used in the annotations.&lt;br/&gt;
&lt;br/&gt;
The proposed remedy for this is to add support in java.base for loading select annotations and encoding them in a format usable by libgraal.&lt;br/&gt;
&lt;br/&gt;
[1] &lt;a href=&quot;https://github.com/openjdk/jdk/blob/2fb1e3b7e72cf7836a9ffd9c6a5b09a6eef3c01b/src/hotspot/share/classfile/classFileParser.cpp#L2069-L2092&quot;&gt;https://github.com/openjdk/jdk/blob/2fb1e3b7e72cf7836a9ffd9c6a5b09a6eef3c01b/src/hotspot/share/classfile/classFileParser.cpp#L2069-L2092&lt;/a&gt;&lt;br/&gt;
[2] &lt;a href=&quot;https://github.com/oracle/graal/blob/c2e5c2c9d28ea4a26b439545e048fbb9ff9ef5ef/truffle/src/com.oracle.truffle.api/src/com/oracle/truffle/api/CompilerDirectives.java#L282&quot;&gt;https://github.com/oracle/graal/blob/c2e5c2c9d28ea4a26b439545e048fbb9ff9ef5ef/truffle/src/com.oracle.truffle.api/src/com/oracle/truffle/api/CompilerDirectives.java#L282&lt;/a&gt;</description>
                <environment></environment>
        <key id="5095275">JDK-8303431</key>
            <summary>[JVMCI] libgraal annotation API</summary>
                <type id="7" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14707&amp;avatarType=issuetype">Enhancement</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dnsimon">Douglas Simon</assignee>
                                    <reporter username="dnsimon">Douglas Simon</reporter>
                        <labels>
                            <label>graal</label>
                            <label>jvmci</label>
                    </labels>
                <created>Wed, 1 Mar 2023 00:59:43 -0800</created>
                <updated>Thu, 3 Jul 2025 05:35:27 -0700</updated>
                            <resolved>Wed, 19 Apr 2023 09:04:43 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14575128" author="dukebot" created="Wed, 19 Apr 2023 09:04:42 -0700"  >Changeset: 48fd4f2b&lt;br/&gt;
Author:    Doug Simon &amp;lt;&lt;a href=&apos;mailto:dnsimon@openjdk.org&apos;&gt;dnsimon@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-04-19 16:01:57 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/48fd4f2bd37562a159e4089b15aa108e0b1bebeb&quot;&gt;https://git.openjdk.org/jdk/commit/48fd4f2bd37562a159e4089b15aa108e0b1bebeb&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14563899" author="roboduke" created="Wed, 1 Mar 2023 10:41:40 -0800"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12810&quot;&gt;https://git.openjdk.org/jdk/pull/12810&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-01 18:07:34 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="5163589">JDK-8361355</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5099058">JDK-8306581</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30koj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17414"><![CDATA[b19]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>