<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 12:34:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8316756] C2 EA fails with &quot;missing memory path&quot; when encountering unsafe_arraycopy stub call</title>
                <link>https://bugs.openjdk.org/browse/JDK-8316756</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>When running the benchmark from the subject line (attached), I&amp;#39;m seeing the following crash:&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (h:\openjdk\git-jdk2\src\hotspot\share\opto\escape.cpp:4029), pid=12256, tid=8644&lt;br/&gt;
#  assert(false) failed: EA: missing memory path&lt;br/&gt;
#&lt;br/&gt;
# JRE version: OpenJDK Runtime Environment (22.0) (fastdebug build 22-internal-adhoc.jorn.git-jdk2)&lt;br/&gt;
# Java VM: OpenJDK 64-Bit Server VM (fastdebug 22-internal-adhoc.jorn.git-jdk2, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, windows-amd64)&lt;br/&gt;
# Core dump will be written. Default location: H:\openjdk\git-jdk2\make\hs_err_pid12256.mdmp&lt;br/&gt;
#&lt;br/&gt;
# If you would like to submit a bug report, please visit:&lt;br/&gt;
#   &lt;a href=&quot;https://bugreport.java.com/bugreport/crash.jsp&quot;&gt;https://bugreport.java.com/bugreport/crash.jsp&lt;/a&gt;&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
With the latest master branch from the openjdk/jdk repo. It has the following stack trace:&lt;br/&gt;
&lt;br/&gt;
Current thread (0x00000271b0168ca0):  JavaThread &amp;quot;C2 CompilerThread4&amp;quot; daemon [_thread_in_native, id=8644, stack(0x0000007f41700000,0x0000007f41800000) (1024K)]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Current CompileTask:&lt;br/&gt;
C2:    585  776 %     4       org.openjdk.bench.java.lang.foreign.jmh_generated.MemorySegmentCopyUnsafe_panama_jmhTest::panama_avgt_jmhStub @ 13 (52 bytes)&lt;br/&gt;
&lt;br/&gt;
Stack: [0x0000007f41700000,0x0000007f41800000]&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [jvm.dll+0xc81a01]  os::win32::platform_print_native_stack+0x101  (os_windows_x86.cpp:236)&lt;br/&gt;
V  [jvm.dll+0xfcef7d]  VMError::report+0x147d  (vmError.cpp:1000)&lt;br/&gt;
V  [jvm.dll+0xfd13c5]  VMError::report_and_die+0x645  (vmError.cpp:1814)&lt;br/&gt;
V  [jvm.dll+0xfd1ae4]  VMError::report_and_die+0x64  (vmError.cpp:1579)&lt;br/&gt;
V  [jvm.dll+0x553dbb]  report_vm_error+0x5b  (debug.cpp:191)&lt;br/&gt;
V  [jvm.dll+0x624cbc]  ConnectionGraph::split_unique_types+0x2a1c  (escape.cpp:4029)&lt;br/&gt;
V  [jvm.dll+0x617060]  ConnectionGraph::compute_escape+0x13a0  (escape.cpp:381)&lt;br/&gt;
V  [jvm.dll+0x61819e]  ConnectionGraph::do_analysis+0xae  (escape.cpp:116)&lt;br/&gt;
V  [jvm.dll+0x4dd63f]  Compile::Optimize+0x67f  (compile.cpp:2315)&lt;br/&gt;
V  [jvm.dll+0x4db1c5]  Compile::Compile+0x11d5  (compile.cpp:855)&lt;br/&gt;
V  [jvm.dll+0x3eff8b]  C2Compiler::compile_method+0x13b  (c2compiler.cpp:122)&lt;br/&gt;
V  [jvm.dll+0x4f6da6]  CompileBroker::invoke_compiler_on_method+0x846  (compileBroker.cpp:2284)&lt;br/&gt;
V  [jvm.dll+0x4f417c]  CompileBroker::compiler_thread_loop+0x31c  (compileBroker.cpp:1943)&lt;br/&gt;
V  [jvm.dll+0x801f79]  JavaThread::thread_main_inner+0x279  (javaThread.cpp:721)&lt;br/&gt;
V  [jvm.dll+0xf33a17]  Thread::call_run+0x1b7  (thread.cpp:225)&lt;br/&gt;
V  [jvm.dll+0xc7f462]  os::win32::thread_native_entry+0xa2  (os_windows.cpp:547)&lt;br/&gt;
C  [ucrtbase.dll+0x29363]  (no source info available)&lt;br/&gt;
C  [KERNEL32.DLL+0x1257d]  (no source info available)&lt;br/&gt;
C  [ntdll.dll+0x5aa68]  (no source info available)&lt;br/&gt;
&lt;br/&gt;
I&amp;#39;ve tried creating a standalone reproducer without success This code does not use any novel compiler intrinsics. It is largely plain Java code but it contains a call to Unsafe::copyMemory and accesses to off-heap memory. I&amp;#39;ve also tried disabling inlining of the benchmark method and that makes the crash go away, there may be a bad interaction between the JMH wrapper and the benchmark code. FWIW, running with &amp;#39;-Djmh.blackhole.autoDetect=false&amp;#39; does not fix the crash. JHM version is the latest 1.38 (built from source, but I&amp;#39;ve reproduced with 1.34 as well)&lt;br/&gt;
&lt;br/&gt;
I can reliably reproduce the crash.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Additional output before the crash:&lt;br/&gt;
225  StoreB  === 360 752 234 327  [[ 118 ]]  @rawptr:BotPTR, idx=Raw;  Memory: @rawptr:BotPTR, idx=Raw; !jvms: Unsafe::copyMemory @ bci:29 (line 806) ScopedMemoryAccess::copyMemoryInternal @ bci:28 (line 147) ScopedMemoryAccess::copyMemory @ bci:12 (line 129) AbstractMemorySegmentImpl::copy @ bci:197 (line 619) MemorySegment::copy @ bci:33 (line 1341) MemorySegment::copy @ bci:13 (line 1288) MemorySegment::copyFrom @ bci:10 (line 812) MemorySegmentCopyUnsafe::panama @ bci:44 (line 66)&lt;br/&gt;
&amp;nbsp;118  CallLeafNoFP  === 360 1 225 31 1 (226 227 134 1 ) [[ 62 233 ]] # unsafe_arraycopy void ( NotNull *+bot, NotNull *+bot, long, half ) !jvms: Unsafe::copyMemory @ bci:29 (line 806) ScopedMemoryAccess::copyMemoryInternal @ bci:28 (line 147) ScopedMemoryAccess::copyMemory @ bci:12 (line 129) AbstractMemorySegmentImpl::copy @ bci:197 (line 619) MemorySegment::copy @ bci:33 (line 1341) MemorySegment::copy @ bci:13 (line 1288) MemorySegment::copyFrom @ bci:10 (line 812) MemorySegmentCopyUnsafe::panama @ bci:44 (line 66)&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5110864">JDK-8316756</key>
            <summary>C2 EA fails with &quot;missing memory path&quot; when encountering unsafe_arraycopy stub call</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tholenstein">Tobias Holenstein</assignee>
                                    <reporter username="jvernee">Jorn Vernee</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>c2</label>
                            <label>c2-ea</label>
                            <label>hgupdate-sync</label>
                            <label>jdk21u-fix-request</label>
                            <label>jdk21u-fix-yes</label>
                            <label>oracle-triage-22</label>
                            <label>starter</label>
                    </labels>
                <created>Fri, 22 Sep 2023 10:14:33 -0700</created>
                <updated>Thu, 13 Jun 2024 02:54:37 -0700</updated>
                            <resolved>Wed, 17 Jan 2024 00:10:06 -0800</resolved>
                                    <version>18</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>23</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14681288" author="roboduke" created="Thu, 13 Jun 2024 00:56:16 -0700"  >[jdk21u-fix-request] Approval Request from Martin&lt;br/&gt;
Should get backported for parity with 21.0.25-oracle. Applies cleanly and tier 1-4 have passed.</comment>
                            <comment id="14680849" author="roboduke" created="Wed, 12 Jun 2024 02:32:38 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21u-dev/pull/697&quot;&gt;https://git.openjdk.org/jdk21u-dev/pull/697&lt;/a&gt;&lt;br/&gt;
Date: 2024-06-12 09:27:16 +0000</comment>
                            <comment id="14641061" author="roboduke" created="Wed, 17 Jan 2024 00:40:36 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk22/pull/86&quot;&gt;https://git.openjdk.org/jdk22/pull/86&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-17 08:33:53 +0000</comment>
                            <comment id="14641047" author="dukebot" created="Wed, 17 Jan 2024 00:10:05 -0800"  >Changeset: b8917214&lt;br/&gt;
Author:    Tobias Holenstein &amp;lt;&lt;a href=&apos;mailto:tholenstein@openjdk.org&apos;&gt;tholenstein@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2024-01-17 08:07:04 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/b89172149d6a900d11630a95be7278870421b435&quot;&gt;https://git.openjdk.org/jdk/commit/b89172149d6a900d11630a95be7278870421b435&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14639982" author="kvn" created="Fri, 12 Jan 2024 14:08:35 -0800"  >I added EA fix patch.&lt;br/&gt;
</comment>
                            <comment id="14639524" author="roboduke" created="Thu, 11 Jan 2024 08:13:28 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/17347&quot;&gt;https://git.openjdk.org/jdk/pull/17347&lt;/a&gt;&lt;br/&gt;
Date: 2024-01-10 13:35:17 +0000</comment>
                            <comment id="14615570" author="thartmann" created="Tue, 3 Oct 2023 10:55:42 -0700"  >Might be similar to &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8311023&quot; title=&quot;assert(false) failed: EA: missing memory path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8311023&quot;&gt;&lt;strike&gt;JDK-8311023&lt;/strike&gt;&lt;/a&gt; in that we just need to handle the LeafCall in EA code but I&amp;#39;m leaving this for someone else to investigate in more detail. Might be a good starter task for someone interested in looking into C2 EA.</comment>
                            <comment id="14615550" author="thartmann" created="Tue, 3 Oct 2023 09:40:07 -0700"  >I attached a simple reproducer (Test.java). The issue is reproducible since &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8269119&quot; title=&quot;C2: Avoid redundant memory barriers in Unsafe.copyMemory0 intrinsic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8269119&quot;&gt;&lt;strike&gt;JDK-8269119&lt;/strike&gt;&lt;/a&gt; in JDK 18 b14 (paging [~vlivanov]):&lt;br/&gt;
&lt;br/&gt;
java -XX:-TieredCompilation -Xbatch -XX:CompileCommand=quiet -XX:CompileCommand=compileonly,Test::test Test.java</comment>
                            <comment id="14613463" author="chagedorn" created="Sun, 24 Sep 2023 23:46:02 -0700"  >ILW = Crash in EA, only observable with JMH and Unsafe, use -XX:-EscapeAnalysis or disable compilation of affected method = HLM = P3</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5116903">JDK-8321988</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5119693">JDK-8324409</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5131631">JDK-8334065</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5131790">JDK-8334213</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5119012">JDK-8323813</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5052369">JDK-8269119</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="107880" name="8316756.patch" size="1177" author="kvn" created="Fri, 12 Jan 2024 14:08:08 -0800"/>
                            <attachment id="106521" name="MemorySegmentCopyUnsafe.java" size="2592" author="jvernee" created="Fri, 22 Sep 2023 10:19:06 -0700"/>
                            <attachment id="106662" name="Test.java" size="1944" author="thartmann" created="Tue, 3 Oct 2023 09:39:38 -0700"/>
                            <attachment id="106534" name="hs_err_pid53358.log" size="84928" author="chagedorn" created="Sun, 24 Sep 2023 23:44:15 -0700"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10003" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Introduced In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17424"><![CDATA[b14]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="21802">18</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i337uz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17334"><![CDATA[b06]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>