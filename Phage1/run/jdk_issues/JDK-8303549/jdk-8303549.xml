<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 08:53:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8303549] [AIX] TestNativeStack.java is failing with exit value 1</title>
                <link>https://bugs.openjdk.org/browse/JDK-8303549</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Stackoverflow exception has caused an exit value 1 when native thread is attaching as daemon. &lt;br/&gt;
&lt;br/&gt;
On AIX the default stack size of POSIX thread is 192 KB [&lt;a href=&quot;https://www.ibm.com/docs/en/aix/7.1?topic=p-pthread-attr-getstacksize-subroutine&quot;&gt;https://www.ibm.com/docs/en/aix/7.1?topic=p-pthread-attr-getstacksize-subroutine&lt;/a&gt; ]. But in VM&amp;#39;s thread creation logic, we set the default thread stack size to 2 MB [ &lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/src/hotspot/os_cpu/aix_ppc/globals_aix_ppc.hpp#LL33C64-L33C64&quot;&gt;https://github.com/openjdk/jdk/blob/master/src/hotspot/os_cpu/aix_ppc/globals_aix_ppc.hpp#LL33C64-L33C64&lt;/a&gt; ] . So, in the absence of an explicit -Xss value the Java threads have 2M as the default stack size. &lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
This stack size is used by the function CallJavaMainInNewThread() to explicitly set the pthread attribute for stack size: &lt;a href=&quot;https://github.com/openjdk/jdk/blob/master/src/java.base/unix/native/libjli/java_md.c#L671&quot;&gt;https://github.com/openjdk/jdk/blob/master/src/java.base/unix/native/libjli/java_md.c#L671&lt;/a&gt;&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
But on this particular test we are not going through any particular JVM thread creation routines instead we are using a pthread_create() function which is defined in pthread library, hence we are getting 192 KB as default stack size which is default stack size of posix thread on AIX.&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
&lt;br/&gt;
Log:&lt;br/&gt;
&lt;br/&gt;
stdout: [Triggering a JNI warning&lt;br/&gt;
Native thread is running and attaching as daemon ...&lt;br/&gt;
];&lt;br/&gt;
&amp;nbsp;stderr: [ Test ERROR. Can&amp;#39;t attach current thread: -1 ]&lt;br/&gt;
&amp;nbsp;exitValue = 1&lt;br/&gt;
&lt;br/&gt;
java.lang.RuntimeException: Expected to get exit value of [0], exit value is: [1]`</description>
                <environment></environment>
        <key id="5095434">JDK-8303549</key>
            <summary>[AIX] TestNativeStack.java is failing with exit value 1</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varadam">Varada M</assignee>
                                    <reporter username="amitkumar">Amit Kumar</reporter>
                        <labels>
                            <label>hgupdate-sync</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>noreg-self</label>
                            <label>oraclejdk-na</label>
                    </labels>
                <created>Thu, 2 Mar 2023 21:37:00 -0800</created>
                <updated>Thu, 8 May 2025 00:32:06 -0700</updated>
                            <resolved>Mon, 26 Jun 2023 07:29:39 -0700</resolved>
                                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14777102" author="roboduke" created="Tue, 6 May 2025 01:53:34 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/3547&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/3547&lt;/a&gt;&lt;br/&gt;
Date: 2025-05-06 08:49:03 +0000</comment>
                            <comment id="14777101" author="goetz" created="Tue, 6 May 2025 01:48:29 -0700"  >Fix request [17u]&lt;br/&gt;
&lt;br/&gt;
I backport this as we see the test failing in our internal 11 builds. Also, this fixes the AIX test regression in 17.0.15.&lt;br/&gt;
No risk, only a test change.&lt;br/&gt;
Clean backport.&lt;br/&gt;
Tests pass. SAP nightly testing passed.</comment>
                            <comment id="14777100" author="goetz" created="Tue, 6 May 2025 01:41:38 -0700"  >One of the two tests fixed in this change were added by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8308341&quot; title=&quot;JNI_GetCreatedJavaVMs returns a partially initialized JVM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8308341&quot;&gt;&lt;strike&gt;JDK-8308341&lt;/strike&gt;&lt;/a&gt;.</comment>
                            <comment id="14600692" author="roboduke" created="Tue, 1 Aug 2023 09:00:46 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/155&quot;&gt;https://git.openjdk.org/jdk21/pull/155&lt;/a&gt;&lt;br/&gt;
Date: 2023-08-01 15:56:01 +0000</comment>
                            <comment id="14592005" author="dukebot" created="Mon, 26 Jun 2023 07:29:38 -0700"  >Changeset: 5ff42d14&lt;br/&gt;
Author:    Varada M &amp;lt;&lt;a href=&apos;mailto:mvarada2000@gmail.com&apos;&gt;mvarada2000@gmail.com&lt;/a&gt;&amp;gt;&lt;br/&gt;
Committer: Tyler Steele &amp;lt;&lt;a href=&apos;mailto:tsteele@openjdk.org&apos;&gt;tsteele@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-26 14:28:40 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/5ff42d14294199eb3bf10b66530f9249fb68810d&quot;&gt;https://git.openjdk.org/jdk/commit/5ff42d14294199eb3bf10b66530f9249fb68810d&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14586135" author="dholmes" created="Wed, 31 May 2023 14:29:01 -0700"  >&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8219652&quot; title=&quot;[aix] Tests failing with JNI attach problems.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8219652&quot;&gt;&lt;strike&gt;JDK-8219652&lt;/strike&gt;&lt;/a&gt; lists other tests that likely need the same fix.</comment>
                            <comment id="14585443" author="roboduke" created="Mon, 29 May 2023 22:02:34 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14209&quot;&gt;https://git.openjdk.org/jdk/pull/14209&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-30 04:55:36 +0000</comment>
                            <comment id="14565747" author="JIRAUSER20704" created="Fri, 10 Mar 2023 00:05:31 -0800"  >Varada is working on this issue. </comment>
                            <comment id="14564540" author="dholmes" created="Sun, 5 Mar 2023 17:37:03 -0800"  >Filed &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8303624&quot; title=&quot;The java.lang.Thread.FieldHolder can be null for JNI attaching threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8303624&quot;&gt;&lt;strike&gt;JDK-8303624&lt;/strike&gt;&lt;/a&gt; for the VM bug.</comment>
                            <comment id="14564539" author="dholmes" created="Sun, 5 Mar 2023 17:20:42 -0800"  >Thanks! So there are two issues here:&lt;br/&gt;
&lt;br/&gt;
1. Something is going wrong on AIX and the attempt to execute the Thread constructor throws an exception.&lt;br/&gt;
2. There is a bug in the VM doe to the relocation of certain Thread fields to a FieldHolder object as part of Loom - that fieldholder may not be set when we try to access it.&lt;br/&gt;
&lt;br/&gt;
I will file a bug for #2 and fix it. In the meantime please run with -Xlog:exceptions and see why AIX is failing this simple code. Thanks.</comment>
                            <comment id="14564508" author="JIRAUSER20704" created="Fri, 3 Mar 2023 21:08:08 -0800"  >It is now available in attachment.</comment>
                            <comment id="14564477" author="dholmes" created="Fri, 3 Mar 2023 13:19:16 -0800"  >Okay but I think we need to understand the full reason as to why there is a problem, and exactly how it manifest as reported - a too small stack should trigger StackOverflowError or a crash. The above failure mode suggests we may not be checking for a pending exception somewhere.&lt;br/&gt;
&lt;br/&gt;
Can you provide a full hs_err file please?</comment>
                            <comment id="14564350" author="JIRAUSER20704" created="Fri, 3 Mar 2023 04:37:41 -0800"  >@dholmes  The default stack size on AIX as 196608 bytes. It might require a larger stack size, setting to 1MB solves the problem. She also noted that on AIX the stack size for primordial thread is not defined. It is just ignoring by assert statement -&amp;quot; os_aix.cpp&amp;quot; on line number 405 : guarantee0(!os::is_primordial_thread()); . She further need to investigate ,why default size is not enough for thread to initialise.</comment>
                            <comment id="14564288" author="dholmes" created="Thu, 2 Mar 2023 21:53:17 -0800"  >Please elaborate on what you think is happening. The pthread_create using the default attributes is obviously not failing (and one would never expect it to!). So what is actually going wrong?</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5107288">JDK-8313664</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5107621">JDK-8313940</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5158101">JDK-8356484</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10600">
                    <name>Causes</name>
                                                                <inwardlinks description="caused by">
                                        <issuelink>
            <issuekey id="5100921">JDK-8308341</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5095540">JDK-8303624</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="4984284">JDK-8219652</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="102888" name="hs_err_pid51642858.log" size="71117" author="amitkumar" created="Fri, 3 Mar 2023 21:06:39 -0800"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17024"><![CDATA[ppc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="18900"><![CDATA[aix]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30lnv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17314"><![CDATA[b04]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>