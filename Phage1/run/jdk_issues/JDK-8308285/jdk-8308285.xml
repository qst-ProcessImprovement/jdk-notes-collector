<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 19:32:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8308285] Assert on -Xshare:dump when running with -Xlog:cds=trace</title>
                <link>https://bugs.openjdk.org/browse/JDK-8308285</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>We assert for `java -Xshare:dump -Xlog:cds*=trace`:&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
#  assert(counter_check_mirror == java_class) failed: must be consistent&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
at&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
&amp;nbsp;&amp;nbsp;29 Stack: [0x00007f8821535000,0x00007f8821635000],  sp=0x00007f8821632e80,  free space=1015k&lt;br/&gt;
&amp;nbsp;&amp;nbsp;30 Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;31 V  [libjvm.so+0xda0155]  java_lang_Class::primitive_type(oopDesc*)+0x13d  (javaClasses.cpp:1367)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;32 V  [libjvm.so+0xd9fb95]  java_lang_Class::print_signature(oopDesc*, outputStream*)+0x9f  (javaClasses.cpp:1284)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;33 V  [libjvm.so+0xd623f5]  InstanceKlass::oop_print_on(oopDesc*, outputStream*)+0x175  (instanceKlass.cpp:3652)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;34 V  [libjvm.so+0x127ec71]  oopDesc::print_on(outputStream*) const+0x9f  (oop.cpp:47)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;35 V  [libjvm.so+0xd34621]  void WalkOopAndArchiveClosure::do_oop_work&amp;lt;narrowOop&amp;gt;(narrowOop*)+0x1e1  (heapShared.cpp:1124)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;36 V  [libjvm.so+0xd33261]  WalkOopAndArchiveClosure::do_oop(narrowOop*)+0x27  (heapShared.cpp:1107)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;37 V  [libjvm.so+0xd31cbe]  EnableIf&amp;lt;!std::is_same&amp;lt;WalkOopAndArchiveClosure, OopClosure&amp;gt;::value, void&amp;gt;::type call_do_oop&amp;lt;narrowOop, WalkOopAndArchiveClosure, OopClosure, WalkOopAndArchiveClosure&amp;gt;(void (WalkOopAndArchiveClosure::*)(narrowOop*), void (OopClosure::*)(narrowOop     *), WalkOopAndArchiveClosure*, narrowOop*)+0x46  (devirtualizer.inline.hpp:88)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;38 V  [libjvm.so+0xd3b99d]  void Devirtualizer::do_oop&amp;lt;WalkOopAndArchiveClosure, narrowOop&amp;gt;(WalkOopAndArchiveClosure*, narrowOop*)+0x4b  (devirtualizer.inline.hpp:93)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;39 V  [libjvm.so+0xd38129]  void InstanceMirrorKlass::oop_oop_iterate&amp;lt;narrowOop, WalkOopAndArchiveClosure&amp;gt;(oopDesc*, WalkOopAndArchiveClosure*)+0x13d  (instanceKlass.inline.hpp:97)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;40 V  [libjvm.so+0xd37192]  void OopOopIterateDispatch&amp;lt;WalkOopAndArchiveClosure&amp;gt;::Table::oop_oop_iterate&amp;lt;InstanceMirrorKlass, narrowOop&amp;gt;(WalkOopAndArchiveClosure*, oopDesc*, Klass*)+0x2f  (iterator.inline.hpp:110)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;41 V  [libjvm.so+0xd354db]  void OopIteratorClosureDispatch::oop_oop_iterate&amp;lt;WalkOopAndArchiveClosure&amp;gt;(WalkOopAndArchiveClosure*, oopDesc*, Klass*)+0x35  (iterator.inline.hpp:295)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;42 V  [libjvm.so+0xd349ca]  void oopDesc::oop_iterate&amp;lt;WalkOopAndArchiveClosure&amp;gt;(WalkOopAndArchiveClosure*)+0x36  (oop.inline.hpp:318)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;43 V  [libjvm.so+0xd2f920]  HeapShared::archive_reachable_objects_from(int, KlassSubGraphInfo*, oopDesc*)+0x2d4  (heapShared.cpp:1211)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;44 V  [libjvm.so+0xd2caeb]  HeapShared::archive_java_mirrors()+0x2a9  (heapShared.cpp:395)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;45 V  [libjvm.so+0xd2d842]  HeapShared::copy_special_objects()+0x12  (heapShared.cpp:567)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;46 V  [libjvm.so+0xd2d8bb]  HeapShared::copy_objects()+0x6b  (heapShared.cpp:576)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;47 V  [libjvm.so+0xd2d68c]  HeapShared::archive_objects(ArchiveHeapInfo*)+0xfe  (heapShared.cpp:538)                                                                                                                                                                              &lt;br/&gt;
&amp;nbsp;&amp;nbsp;48 V  [libjvm.so+0x11de094]  VM_PopulateDumpSharedSpace::dump_java_heap_objects(GrowableArray&amp;lt;Klass*&amp;gt;*)+0x188  (metaspaceShared.cpp:855)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;49 V  [libjvm.so+0x11dd06c]  VM_PopulateDumpSharedSpace::doit()+0xea  (metaspaceShared.cpp:510)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;50 V  [libjvm.so+0x166d3f6]  VM_Operation::evaluate()+0xde  (vmOperations.cpp:71)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;51 V  [libjvm.so+0x16d71f5]  VMThread::evaluate_operation(VM_Operation*)+0xdf  (vmThread.cpp:281)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;52 V  [libjvm.so+0x16d7b57]  VMThread::inner_execute(VM_Operation*)+0x343  (vmThread.cpp:428)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;53 V  [libjvm.so+0x16d7f4d]  VMThread::loop()+0x135  (vmThread.cpp:495)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;54 V  [libjvm.so+0x16d6d36]  VMThread::run()+0xfe  (vmThread.cpp:175)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;55 V  [libjvm.so+0x15bcca0]  Thread::call_run()+0x1a8  (thread.cpp:217)&lt;br/&gt;
&amp;nbsp;&amp;nbsp;56 V  [libjvm.so+0x129f358]  thread_native_entry(Thread*)+0x1a5  (os_linux.cpp:775)&lt;br/&gt;
&lt;br/&gt;
```&lt;br/&gt;
&lt;br/&gt;
The reason is that, when tracing with trace level, we print each copied oop in full, including the basic java mirrors. As part of the trace, we print the basic type. That function `BasicType java_lang_Class::primitive_type(oop java_class)` does a sanity check: the printed oop, that is supposed to be a class mirror for a basic type, must be the same as the oop resolved via (this oop)-&amp;gt;array_klass-&amp;gt;element_type-&amp;gt;mirror for that type).&lt;br/&gt;
&lt;br/&gt;
We crash when printing the mirror for &amp;quot;int&amp;quot; because there are two mirrors for int at this point: the one in `Universe::_basic_type_mirrors`, and the one in  `HeapShared::_scratch_basic_type_mirrors`.&lt;br/&gt;
&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5101138">JDK-8308285</key>
            <summary>Assert on -Xshare:dump when running with -Xlog:cds=trace</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stuefe">Thomas Stuefe</assignee>
                                    <reporter username="stuefe">Thomas Stuefe</reporter>
                        <labels>
                            <label>cds</label>
                    </labels>
                <created>Wed, 17 May 2023 05:11:45 -0700</created>
                <updated>Wed, 24 May 2023 23:09:41 -0700</updated>
                            <resolved>Wed, 17 May 2023 22:49:10 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14582532" author="dukebot" created="Wed, 17 May 2023 22:49:08 -0700"  >Changeset: 95da499e&lt;br/&gt;
Author:    Thomas Stuefe &amp;lt;&lt;a href=&apos;mailto:stuefe@openjdk.org&apos;&gt;stuefe@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-05-18 05:47:23 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/95da499ef229d0dfd5fc348f68b9bfd91015b045&quot;&gt;https://git.openjdk.org/jdk/commit/95da499ef229d0dfd5fc348f68b9bfd91015b045&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14582307" author="roboduke" created="Wed, 17 May 2023 05:23:29 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14031&quot;&gt;https://git.openjdk.org/jdk/pull/14031&lt;/a&gt;&lt;br/&gt;
Date: 2023-05-17 12:17:17 +0000</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31k4z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17436"><![CDATA[b24]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>