<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 16:56:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8302781] CDS archive heap not reproducible after JDK-8296344</title>
                <link>https://bugs.openjdk.org/browse/JDK-8302781</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>After &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296344&quot; title=&quot;Remove dependency on G1 for writing the CDS archive heap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296344&quot;&gt;&lt;strike&gt;JDK-8296344&lt;/strike&gt;&lt;/a&gt;, the identity_hash of archived Java objects become unpredictable (usually for -XX:-UseCompressedOops).&lt;br/&gt;
&lt;br/&gt;
***********************************&lt;br/&gt;
&lt;br/&gt;
The Mach5 Tier5 cmp-baseline task has been failing again&lt;br/&gt;
on macosx-aarch64, macosx-x64, linux-aarch64 and linux-x64.&lt;br/&gt;
&lt;br/&gt;
The files being complained about are related to CDS.&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a log file snippet from the macosx-x64-cmp-baseline task:&lt;br/&gt;
&lt;br/&gt;
[2023-02-16T07:22:51,678Z] JDK Other files with binary differences...&lt;br/&gt;
[2023-02-16T07:22:53,003Z] ./lib/server/classes_nocoops.jsa&lt;br/&gt;
[2023-02-16T07:22:53,003Z] Binary files /System/Volumes/Data/mesos/work_dir/slaves/91e16c40-06d4-468a-9fc3-7198a5bb7d5a-S84880/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/48898f90-0ce0-4db2-8162-e013d6755094/runs/a6e0c878-2894-4503-8013-b2aa826244c9/workspace/build/macosx-x64-cmp-baseline/images/jdk/./lib/server/classes_nocoops.jsa and /System/Volumes/Data/mesos/work_dir/slaves/91e16c40-06d4-468a-9fc3-7198a5bb7d5a-S84880/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/48898f90-0ce0-4db2-8162-e013d6755094/runs/a6e0c878-2894-4503-8013-b2aa826244c9/workspace/build/compare-build/macosx-x64-cmp-baseline/images/jdk/./lib/server/classes_nocoops.jsa differ&lt;br/&gt;
[2023-02-16T07:22:53,281Z] JDK Bundle Other files with binary differences...&lt;br/&gt;
[2023-02-16T07:22:54,543Z] ./jdk-21.jdk/Contents/Home/lib/server/classes_nocoops.jsa&lt;br/&gt;
[2023-02-16T07:22:54,543Z] Binary files /System/Volumes/Data/mesos/work_dir/slaves/91e16c40-06d4-468a-9fc3-7198a5bb7d5a-S84880/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/48898f90-0ce0-4db2-8162-e013d6755094/runs/a6e0c878-2894-4503-8013-b2aa826244c9/workspace/build/macosx-x64-cmp-baseline/images/jdk-bundle/./jdk-21.jdk/Contents/Home/lib/server/classes_nocoops.jsa and /System/Volumes/Data/mesos/work_dir/slaves/91e16c40-06d4-468a-9fc3-7198a5bb7d5a-S84880/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/48898f90-0ce0-4db2-8162-e013d6755094/runs/a6e0c878-2894-4503-8013-b2aa826244c9/workspace/build/compare-build/macosx-x64-cmp-baseline/images/jdk-bundle/./jdk-21.jdk/Contents/Home/lib/server/classes_nocoops.jsa differ&lt;br/&gt;
</description>
                <environment></environment>
        <key id="5094509">JDK-8302781</key>
            <summary>CDS archive heap not reproducible after JDK-8296344</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://bugs.openjdk.org/images/jbsImages/p3.png">P3</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="iklam">Ioi Lam</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>cds</label>
                            <label>reproducible-build</label>
                            <label>tier4</label>
                    </labels>
                <created>Fri, 17 Feb 2023 08:20:28 -0800</created>
                <updated>Thu, 3 Aug 2023 08:49:37 -0700</updated>
                            <resolved>Sat, 18 Feb 2023 22:01:45 -0800</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14561244" author="dukebot" created="Sat, 18 Feb 2023 22:01:44 -0800"  >Changeset: 7abe2693&lt;br/&gt;
Author:    Ioi Lam &amp;lt;&lt;a href=&apos;mailto:iklam@openjdk.org&apos;&gt;iklam@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-02-19 05:59:12 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/7abe26935ab4356de54acee93390a0d8be1ea289&quot;&gt;https://git.openjdk.org/jdk/commit/7abe26935ab4356de54acee93390a0d8be1ea289&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14561213" author="roboduke" created="Fri, 17 Feb 2023 20:46:59 -0800"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12628&quot;&gt;https://git.openjdk.org/jdk/pull/12628&lt;/a&gt;&lt;br/&gt;
Date: 2023-02-18 04:27:31 +0000</comment>
                            <comment id="14561164" author="iklam" created="Fri, 17 Feb 2023 14:22:11 -0800"  >The fix is to call obj-&amp;gt;identity_hash() at the same place as before  &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296344&quot; title=&quot;Remove dependency on G1 for writing the CDS archive heap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296344&quot;&gt;&lt;strike&gt;JDK-8296344&lt;/strike&gt;&lt;/a&gt;. I.e., when obj is discovered.</comment>
                            <comment id="14561163" author="iklam" created="Fri, 17 Feb 2023 14:21:07 -0800"  >Evaluation:&lt;br/&gt;
&lt;br/&gt;
From &amp;quot;java -Xshare:dump -XX:-UseCompressedOops -Xlog:cds+map=trace:file=old.map:none:filesize=0&amp;quot;, I can see that the differences are only in the header words (16 bytes) of the archived Java objects. And the only part of the difference is in the identity_hash part of the object header.&lt;br/&gt;
&lt;br/&gt;
****&lt;br/&gt;
&lt;br/&gt;
Before &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296344&quot; title=&quot;Remove dependency on G1 for writing the CDS archive heap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296344&quot;&gt;&lt;strike&gt;JDK-8296344&lt;/strike&gt;&lt;/a&gt;, for each archived obj, we compute obj-&amp;gt;identity_hash() when obj is discovered.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/f1d76fa92501e45f25a7d33d8c5eee7ef60973eb/src/hotspot/share/cds/heapShared.cpp#L326-L332&quot;&gt;https://github.com/openjdk/jdk/blob/f1d76fa92501e45f25a7d33d8c5eee7ef60973eb/src/hotspot/share/cds/heapShared.cpp#L326-L332&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
Because we always traverse the archived objects in a specific order, the order of discovery is always the same. &lt;br/&gt;
&lt;br/&gt;
obj-&amp;gt;identity_hash() eventually calls get_next_hash() in synchronizer.cpp&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/f1d76fa92501e45f25a7d33d8c5eee7ef60973eb/src/hotspot/share/runtime/synchronizer.cpp#L819-L825&quot;&gt;https://github.com/openjdk/jdk/blob/f1d76fa92501e45f25a7d33d8c5eee7ef60973eb/src/hotspot/share/runtime/synchronizer.cpp#L819-L825&lt;/a&gt;&lt;br/&gt;
&lt;br/&gt;
get_next_hash() always produces the same sequences of numbers. Therefore, across different runs of &amp;quot;java -Xshare:dump&amp;quot;, we can guarantee that every archived object is always assigned the same identity_hash&lt;br/&gt;
&lt;br/&gt;
****&lt;br/&gt;
&lt;br/&gt;
Since &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296344&quot; title=&quot;Remove dependency on G1 for writing the CDS archive heap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296344&quot;&gt;&lt;strike&gt;JDK-8296344&lt;/strike&gt;&lt;/a&gt;, the identity_hash() is computed when we make a final copy of the archived object. The copying order depends on the iteration order of HeapShared::archived_object_cache(), which depends on the addresses of the objects.&lt;br/&gt;
&lt;br/&gt;
When running with  -XX:-UseCompressedOops, the (source) archived objects will have different addresses across &amp;quot;java -Xshare:dump&amp;quot; runs. As a result, they get assigned different identity_hash().&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://github.com/openjdk/jdk/blob/6b082fb3c658524905a9a7b33dcb58e375c95c1b/src/hotspot/share/cds/archiveHeapWriter.cpp#L481-L501&quot;&gt;https://github.com/openjdk/jdk/blob/6b082fb3c658524905a9a7b33dcb58e375c95c1b/src/hotspot/share/cds/archiveHeapWriter.cpp#L481-L501&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14561092" author="erikj" created="Fri, 17 Feb 2023 08:52:48 -0800"  >In the first failing build, I found this change, &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8296344&quot; title=&quot;Remove dependency on G1 for writing the CDS archive heap &quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8296344&quot;&gt;&lt;strike&gt;JDK-8296344&lt;/strike&gt;&lt;/a&gt;, which seems like the most likely culprit. I haven&amp;#39;t bisected to prove it though.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="5094468">JDK-8302746</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5086765">JDK-8296344</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19000"><![CDATA[x86_64]]></customfieldvalue>
    <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    <customfieldvalue key="17017"><![CDATA[os_x]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30fyb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17311"><![CDATA[b11]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>