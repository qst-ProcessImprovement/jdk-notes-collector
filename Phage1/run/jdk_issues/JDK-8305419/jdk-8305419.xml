<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 18:15:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8305419] JDK-8301995 broke building libgraal</title>
                <link>https://bugs.openjdk.org/browse/JDK-8305419</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>As a result of the changes in jvmciCompilerToVM.cpp for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8301995&quot; title=&quot;Move invokedynamic resolution information out of ConstantPoolCacheEntry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8301995&quot;&gt;&lt;strike&gt;JDK-8301995&lt;/strike&gt;&lt;/a&gt;, building libgraal on jdk21+16 does not work:&lt;br/&gt;
&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  Internal Error (/Users/dnsimon/dev/jdk-jdk/open/src/hotspot/share/oops/constantPool.hpp:256), pid=30379, tid=9219&lt;br/&gt;
#  assert(is_invokedynamic_index(i)) failed: i=8&lt;br/&gt;
#&lt;br/&gt;
&lt;br/&gt;
Stack: [0x000000016ef70000,0x000000016f973000],  sp=0x000000016f96d2e0,  free space=10228k&lt;br/&gt;
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)&lt;br/&gt;
V  [libjvm.dylib+0x112dcdc]  VMError::report_and_die(int, char const*, char const*, char*, Thread*, unsigned char*, void*, void*, char const*, int, unsigned long)+0x990  (con&lt;br/&gt;
stantPool.hpp:256)&lt;br/&gt;
V  [libjvm.dylib+0x112e32c]  VMError::report_and_die(Thread*, void*, char const*, int, char const*, char const*, char*)+0x68&lt;br/&gt;
V  [libjvm.dylib+0x5d6358]  report_vm_error(char const*, int, char const*, char const*, ...)+0x60&lt;br/&gt;
V  [libjvm.dylib+0x5af0]  ConstantPool::decode_invokedynamic_index(int)+0x60&lt;br/&gt;
V  [libjvm.dylib+0xc6ed58]  LinkResolver::resolve_invokedynamic(CallInfo&amp;amp;, constantPoolHandle const&amp;amp;, int, JavaThread*)+0x44&lt;br/&gt;
V  [libjvm.dylib+0xc6e834]  LinkResolver::resolve_invoke(CallInfo&amp;amp;, Handle, constantPoolHandle const&amp;amp;, int, Bytecodes::Code, JavaThread*)+0x134&lt;br/&gt;
V  [libjvm.dylib+0xab7c90]  c2v_resolveInvokeDynamicInPool(JNIEnv_*, _jobject*, _jobject*, long, int)+0x1c8&lt;br/&gt;
j  jdk.vm.ci.hotspot.CompilerToVM.resolveInvokeDynamicInPool(Ljdk/vm/ci/hotspot/HotSpotConstantPool;JI)V+0 &lt;a href=&apos;mailto:jdk.internal.vm.ci@21-ea&apos;&gt;jdk.internal.vm.ci@21-ea&lt;/a&gt;&lt;br/&gt;
j  jdk.vm.ci.hotspot.CompilerToVM.resolveInvokeDynamicInPool(Ljdk/vm/ci/hotspot/HotSpotConstantPool;I)V+7 &lt;a href=&apos;mailto:jdk.internal.vm.ci@21-ea&apos;&gt;jdk.internal.vm.ci@21-ea&lt;/a&gt;&lt;br/&gt;
j  jdk.vm.ci.hotspot.HotSpotConstantPool.loadReferencedType(IIZ)V+173 &lt;a href=&apos;mailto:jdk.internal.vm.ci@21-ea&apos;&gt;jdk.internal.vm.ci@21-ea&lt;/a&gt;&lt;br/&gt;
j  com.oracle.graal.pointsto.infrastructure.WrappedConstantPool.loadReferencedType(Ljdk/vm/ci/meta/ConstantPool;IIZ)V+32 org.graalvm.nativeimage.pointsto&lt;br/&gt;
j  com.oracle.graal.pointsto.phases.NoClassInitializationPlugin.loadReferencedType(Lorg/graalvm/compiler/nodes/graphbuilderconf/GraphBuilderContext;Ljdk/vm/ci/meta/ConstantPool;II)V+5 org.graalvm.nativeimage.pointsto&lt;br/&gt;
&lt;br/&gt;
The above crash was produced with a slowdebug build based on openjdk 787832a58677205c9a11ae100dd8a2fbddb30a4a with the following patch:&lt;br/&gt;
&lt;br/&gt;
===========================================&lt;br/&gt;
diff --git a/src/hotspot/share/oops/constantPool.hpp b/src/hotspot/share/oops/constantPool.hpp&lt;br/&gt;
index 93a4f504448..e33fe336d05 100644&lt;br/&gt;
--- a/src/hotspot/share/oops/constantPool.hpp&lt;br/&gt;
+++ b/src/hotspot/share/oops/constantPool.hpp&lt;br/&gt;
@@ -253,7 +253,7 @@ class ConstantPool : public Metadata {&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// The main reason is that byte swapping is sometimes done on normal indexes.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// Finally, it is helpful for debugging to tell the two apart.&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;static bool is_invokedynamic_index(int i) { return (i &amp;lt; 0); }&lt;br/&gt;
-  static int  decode_invokedynamic_index(int i) { assert(is_invokedynamic_index(i),  &amp;quot;&amp;quot;); return ~i; }&lt;br/&gt;
+  static int  decode_invokedynamic_index(int i) { assert(is_invokedynamic_index(i),  &amp;quot;i=%d&amp;quot;, i); return ~i; }&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;static int  encode_invokedynamic_index(int i) { assert(!is_invokedynamic_index(i), &amp;quot;&amp;quot;); return ~i; }&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;// Given the per-instruction index of an indy instruction, report the&lt;br/&gt;
===========================================&lt;br/&gt;
&lt;br/&gt;
To reproduce:&lt;br/&gt;
&lt;br/&gt;
jdk/open&amp;gt; git checkout 787832a58677205c9a11ae100dd8a2fbddb30a4a&lt;br/&gt;
jdk/open&amp;gt; make graal-builder-image&lt;br/&gt;
jdk/open&amp;gt; export JAVA_HOME=$PWD/build/*/images/graal-builder-jdk&lt;br/&gt;
&lt;br/&gt;
&amp;gt; git clone &lt;a href=&quot;https://github.com/graalvm/mx.git&quot;&gt;https://github.com/graalvm/mx.git&lt;/a&gt;&lt;br/&gt;
&amp;gt; export MX_PYTHON=python3.8. # Ensure python3.8 is on PATH&lt;br/&gt;
&amp;gt; export PATH=$PWD/mx:$PATH&lt;br/&gt;
&lt;br/&gt;
&amp;gt; git clone &lt;a href=&quot;https://github.com/oracle/graal.git&quot;&gt;https://github.com/oracle/graal.git&lt;/a&gt;&lt;br/&gt;
&amp;gt; cd graal&lt;br/&gt;
&amp;gt; cd git reset --hard de7a57939aa17b069f22f49b7bd6cb0941c3153f&lt;br/&gt;
&amp;gt; cd vm&lt;br/&gt;
mx --env libgraal build</description>
                <environment></environment>
        <key id="5097715">JDK-8305419</key>
            <summary>JDK-8301995 broke building libgraal</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="never">Tom Rodriguez</assignee>
                                    <reporter username="dnsimon">Douglas Simon</reporter>
                        <labels>
                            <label>graal</label>
                            <label>jvmci</label>
                            <label>noreg-build</label>
                            <label>oracle-triage-11</label>
                            <label>oracle-triage-17</label>
                            <label>oracle-triage-21</label>
                    </labels>
                <created>Sun, 2 Apr 2023 13:35:24 -0700</created>
                <updated>Mon, 10 Jun 2024 01:35:36 -0700</updated>
                            <resolved>Tue, 11 Apr 2023 07:58:43 -0700</resolved>
                                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14573088" author="dukebot" created="Tue, 11 Apr 2023 07:58:42 -0700"  >Changeset: 12946f57&lt;br/&gt;
Author:    Tom Rodriguez &amp;lt;&lt;a href=&apos;mailto:never@openjdk.org&apos;&gt;never@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-04-11 14:55:55 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/12946f5748c819f436e9d16a150313656d059ec2&quot;&gt;https://git.openjdk.org/jdk/commit/12946f5748c819f436e9d16a150313656d059ec2&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14572519" author="roboduke" created="Fri, 7 Apr 2023 12:47:02 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/13392&quot;&gt;https://git.openjdk.org/jdk/pull/13392&lt;/a&gt;&lt;br/&gt;
Date: 2023-04-07 19:41:45 +0000</comment>
                            <comment id="14571236" author="chagedorn" created="Mon, 3 Apr 2023 05:55:50 -0700"  >[~matsaave] please have a look, thanks!</comment>
                            <comment id="14571235" author="chagedorn" created="Mon, 3 Apr 2023 05:54:37 -0700"  >ILW= Broken libgraal build, only affects libgraal, no workaround = HLH = P2</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                                                <inwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5093573">JDK-8301995</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="22711">21</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30zg3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17354"><![CDATA[b18]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>