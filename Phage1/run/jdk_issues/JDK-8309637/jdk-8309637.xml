<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:20:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8309637] runtime/handshake/HandshakeTimeoutTest.java fails with &quot;has not cleared handshake op&quot; and SIGILL</title>
                <link>https://bugs.openjdk.org/browse/JDK-8309637</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>The following test failed in the JDK21 CI:&lt;br/&gt;
&lt;br/&gt;
runtime/handshake/HandshakeTimeoutTest.java&lt;br/&gt;
&lt;br/&gt;
Here&amp;#39;s a snippet from the log file:&lt;br/&gt;
&lt;br/&gt;
#section:driver&lt;br/&gt;
----------messages:(10/314)----------&lt;br/&gt;
command: driver HandshakeTimeoutTest&lt;br/&gt;
reason: User specified action: run driver HandshakeTimeoutTest &lt;br/&gt;
started: Thu Jun 08 00:07:12 UTC 2023&lt;br/&gt;
Mode: agentvm&lt;br/&gt;
Agent id: 20&lt;br/&gt;
Timeout refired 480 times&lt;br/&gt;
Timeout information:&lt;br/&gt;
--- Timeout information end.&lt;br/&gt;
finished: Thu Jun 08 00:25:47 UTC 2023&lt;br/&gt;
elapsed time (seconds): 1114.304&lt;br/&gt;
----------configuration:(16/2322)----------&lt;br/&gt;
&lt;br/&gt;
&amp;lt;snip&amp;gt;&lt;br/&gt;
&lt;br/&gt;
----------System.out:(9/3199)----------&lt;br/&gt;
Command line: [/opt/mach5/mesos/work_dir/jib-master/install/jdk-21+26-2315/linux-aarch64-debug.jdk/jdk-21/fastdebug/bin/java -cp /opt/mach5/mesos/work_dir/slaves/cd627e65-f015-4fb1-a1d2-b6c9b8127f98-S1202/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/cd44baf6-092f-4661-a29c-adac949180d2/runs/a8c08a39-9b81-4625-911c-585bed94f792/testoutput/test-support/jtreg_open_test_hotspot_jtreg_tier1_runtime/classes/0/runtime/handshake/HandshakeTimeoutTest.d:/opt/mach5/mesos/work_dir/jib-master/install/jdk-21+26-2315/src.full/open/test/hotspot/jtreg/runtime/handshake:/opt/mach5/mesos/work_dir/slaves/cd627e65-f015-4fb1-a1d2-b6c9b8127f98-S1202/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/cd44baf6-092f-4661-a29c-adac949180d2/runs/a8c08a39-9b81-4625-911c-585bed94f792/testoutput/test-support/jtreg_open_test_hotspot_jtreg_tier1_runtime/classes/0/testlibrary:/opt/mach5/mesos/work_dir/slaves/cd627e65-f015-4fb1-a1d2-b6c9b8127f98-S1202/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/cd44baf6-092f-4661-a29c-adac949180d2/runs/a8c08a39-9b81-4625-911c-585bed94f792/testoutput/test-support/jtreg_open_test_hotspot_jtreg_tier1_runtime/classes/0/test/lib:/opt/mach5/mesos/work_dir/jib-master/install/jtreg/7.2/1/bundles/jtreg-7.2+1.zip/jtreg/lib/jtreg.jar:/opt/mach5/mesos/work_dir/jib-master/install/jtreg/7.2/1/bundles/jtreg-7.2+1.zip/jtreg/lib/junit-platform-console-standalone-1.9.2.jar:/opt/mach5/mesos/work_dir/jib-master/install/jtreg/7.2/1/bundles/jtreg-7.2+1.zip/jtreg/lib/testng-7.3.0.jar:/opt/mach5/mesos/work_dir/jib-master/install/jtreg/7.2/1/bundles/jtreg-7.2+1.zip/jtreg/lib/jcommander-1.78.jar:/opt/mach5/mesos/work_dir/jib-master/install/jtreg/7.2/1/bundles/jtreg-7.2+1.zip/jtreg/lib/guice-4.2.3.jar -XX:MaxRAMPercentage=6.25 -Dtest.boot.jdk=/opt/mach5/mesos/work_dir/jib-master/install/jdk/20/36/bundles/linux-aarch64/jdk-20_linux-aarch64_bin.tar.gz/jdk-20 -Djava.io.tmpdir=/opt/mach5/mesos/work_dir/slaves/cd627e65-f015-4fb1-a1d2-b6c9b8127f98-S1202/frameworks/1735e8a2-a1db-478c-8104-60c8b0af87dd-0196/executors/cd44baf6-092f-4661-a29c-adac949180d2/runs/a8c08a39-9b81-4625-911c-585bed94f792/testoutput/test-support/jtreg_open_test_hotspot_jtreg_tier1_runtime/tmp -XX:+UnlockExperimentalVMOptions -XX:LockingMode=2 -Xbootclasspath/a:. -XX:+UnlockDiagnosticVMOptions -XX:+WhiteBoxAPI -XX:+HandshakeALot -XX:GuaranteedSafepointInterval=10 -XX:ParallelGCThreads=1 -XX:ConcGCThreads=1 -XX:CICompilerCount=2 -XX:+UnlockExperimentalVMOptions -XX:HandshakeTimeout=50 -XX:-CreateCoredumpOnCrash HandshakeTimeoutTest$Test ]&lt;br/&gt;
[2023-06-08T00:07:12.855566071Z] Gathering output for process 425423&lt;br/&gt;
[2023-06-08T00:24:39.032496596Z] Waiting for completion for process 425423&lt;br/&gt;
[2023-06-08T00:24:39.033703163Z] Waiting for completion finished for process 425423&lt;br/&gt;
Output and diagnostic info for process 425423 was saved into &amp;#39;pid-425423-output.log&amp;#39;&lt;br/&gt;
[2023-06-08T00:24:39.044912100Z] Waiting for completion for process 425423&lt;br/&gt;
[2023-06-08T00:24:39.045004620Z] Waiting for completion finished for process 425423&lt;br/&gt;
[2023-06-08T00:24:39.045066061Z] Waiting for completion for process 425423&lt;br/&gt;
[2023-06-08T00:24:39.046061546Z] Waiting for completion finished for process 425423&lt;br/&gt;
----------System.err:(18/775)----------&lt;br/&gt;
&amp;nbsp;stdout: [[0.347s][error][handshake] Handshake timeout: HandshakeALot(0x0000ffff882b07f8), pending threads: 1&lt;br/&gt;
[0.348s][error][handshake] JavaThread 0x0000ffffa432b360 has not cleared handshake op: 0x0000ffff882b07f8&lt;br/&gt;
#&lt;br/&gt;
# A fatal error has been detected by the Java Runtime Environment:&lt;br/&gt;
#&lt;br/&gt;
#  SIGILL (0x4) at pc=0x0000ffffab082b48 (sent by kill), pid=425423, tid=425482&lt;br/&gt;
#&lt;br/&gt;
# JRE version: Java(TM) SE Runtime Environment (21.0+26) (fastdebug build 21-ea+26-LTS-2315)&lt;br/&gt;
# Java VM: Java HotSpot(TM) 64-Bit Server VM (fastdebug 21-ea+26-LTS-2315, mixed mode, sharing, tiered, compressed oops, compressed class ptrs, g1 gc, linux-aarch64)&lt;br/&gt;
# Problematic frame:&lt;br/&gt;
# C  [libc.so.6+0x23b48][thread 425475 also had an error]&lt;br/&gt;
];&lt;br/&gt;
&amp;nbsp;stderr: []&lt;br/&gt;
&amp;nbsp;exitValue = 134&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
JavaTest Message: Test complete.&lt;br/&gt;
&lt;br/&gt;
result: Error. Agent error: java.lang.Exception: Agent 20 timed out with a timeout of 480 seconds; check console log for any additional details&lt;br/&gt;
&lt;br/&gt;
While there is a SIGILL crash, the artifacts link does not include&lt;br/&gt;
an hs_err_pid file.</description>
                <environment></environment>
        <key id="5102716">JDK-8309637</key>
            <summary>runtime/handshake/HandshakeTimeoutTest.java fails with &quot;has not cleared handshake op&quot; and SIGILL</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pchilanomate">Patricio Chilano Mateo</assignee>
                                    <reporter username="dcubed">Daniel Daugherty</reporter>
                        <labels>
                            <label>amazon-interest</label>
                            <label>hgupdate-sync</label>
                            <label>intermittent</label>
                            <label>tier3</label>
                            <label>tier6</label>
                    </labels>
                <created>Wed, 7 Jun 2023 17:33:49 -0700</created>
                <updated>Tue, 2 Jan 2024 17:51:01 -0800</updated>
                            <resolved>Mon, 10 Jul 2023 12:10:51 -0700</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14595071" author="pchilanomate" created="Tue, 11 Jul 2023 09:54:56 -0700"  >[~shade] We didn&amp;#39;t seem to hit this issue before but yes this should also affect earlier releases.</comment>
                            <comment id="14595070" author="roboduke" created="Tue, 11 Jul 2023 09:53:05 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/112&quot;&gt;https://git.openjdk.org/jdk21/pull/112&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-11 15:42:45 +0000</comment>
                            <comment id="14595010" author="shade" created="Tue, 11 Jul 2023 05:48:39 -0700"  >This actually affects things prior to JDK 21 as well, right?</comment>
                            <comment id="14594835" author="dukebot" created="Mon, 10 Jul 2023 12:10:50 -0700"  >Changeset: 57e7e82f&lt;br/&gt;
Author:    Patricio Chilano Mateo &amp;lt;&lt;a href=&apos;mailto:pchilanomate@openjdk.org&apos;&gt;pchilanomate@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-07-10 19:09:27 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/57e7e82fa1cfb82bee6ff242d9a730c42bde663f&quot;&gt;https://git.openjdk.org/jdk/commit/57e7e82fa1cfb82bee6ff242d9a730c42bde663f&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14594114" author="roboduke" created="Wed, 5 Jul 2023 14:30:31 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14777&quot;&gt;https://git.openjdk.org/jdk/pull/14777&lt;/a&gt;&lt;br/&gt;
Date: 2023-07-05 18:15:50 +0000</comment>
                            <comment id="14593209" author="pchilanomate" created="Fri, 30 Jun 2023 22:39:46 -0700"  >The test is timing out because we are hitting a deadlock. The JavaThread doing the error reporting deadlocks trying to acquire a lock it already owns, and the Watcher thread never kicks in to shutdown the VM because it hasn&amp;#39;t been created yet and will never be: the &amp;quot;main&amp;quot; JavaThread is blocked in Threads::create_vm(), somewhere before creating the Watcher thread, waiting to acquire a lock that the error reporting thread owns.&lt;br/&gt;
&lt;br/&gt;
More specifically from the two core dumps I opened:&lt;br/&gt;
&lt;br/&gt;
- In one case, a compiler thread receives the SIGILL signal while inside a ThreadCritical section. It then calls ThreadCritical again from inside error reporting and deadlocks. Meanwhile the &amp;quot;main&amp;quot; thread has also blocked waiting to enter a ThreadCritical section while initializing some class somewhere around call_initPhase2().&lt;br/&gt;
&amp;nbsp;&lt;br/&gt;
- On the other case, a compiler thread receives the SIGILL signal while inside a malloc call in the C library. It then calls again malloc from inside the error reporting and deadlocks. Meanwhile the &amp;quot;main&amp;quot; thread has blocked waiting to acquire the CodeCache_lock while resolving some class also somewhere around call_initPhase2(), but the owner of the CodeCache_lock is the error reporting thread.&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
We could change the HandshakeTimeout value in the test to make sure the Watcher thread has already been created before the timeout. But it seems this has uncovered a more fundamental bug. The Watcher thread should be one of the very first things we create if we are using it as a watchdog in case of deadlocks during error reporting. Also, but less important, there is no specific Periodic task for monitoring hangs during error reporting and we are relying that the Watcher thread will be created due to the 2 Periodic tasks that I see are added during VM creation: ChunkPoolCleaner(5 seconds interval) and StatSamplerTask(interval controlled by PerfDataSamplingInterval, set to 50ms as default). </comment>
                            <comment id="14589047" author="mseledtsov" created="Tue, 13 Jun 2023 11:12:00 -0700"  >ILW = HLH = P2</comment>
                            <comment id="14587808" author="dholmes" created="Wed, 7 Jun 2023 17:46:05 -0700"  >Same failure mode has been seen in past 2 days without use of fast-locking.</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5105329">JDK-8311953</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5106410">JDK-8312904</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="19300"><![CDATA[aarch64]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10005" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>OS</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17023"><![CDATA[linux]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31tpn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17334"><![CDATA[b06]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="192"><![CDATA[runtime]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17000"><![CDATA[Verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>