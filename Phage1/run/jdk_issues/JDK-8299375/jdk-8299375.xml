<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 15:15:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8299375] [PPC64] GetStackTraceSuspendedStressTest tries to deoptimize frame with invalid fp</title>
                <link>https://bugs.openjdk.org/browse/JDK-8299375</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>Symptom&lt;br/&gt;
========&lt;br/&gt;
&lt;br/&gt;
The VM runs into the following assertion:&lt;br/&gt;
#  Internal Error (jdk/src/hotspot/cpu/ppc/frame_ppc.inline.hpp:80), pid=32736, tid=32774&lt;br/&gt;
#  assert(_on_heap || (is_aligned(_sp, alignment_in_bytes) || is_interpreted_frame()) &amp;amp;&amp;amp; is_aligned(_fp, alignment_in_bytes)) failed: invalid alignment ... fp:0xfffffffffffffffe (which matches &amp;quot;badAddress&amp;quot;)&lt;br/&gt;
&lt;br/&gt;
Stack:&lt;br/&gt;
V  [libjvm.so+0x6976d8]  frame::setup()+0x3b0  (frame_ppc.inline.hpp:80)&lt;br/&gt;
V  [libjvm.so+0x6978b8]  frame::frame(long*, unsigned char*, long*, long*, CodeBlob*)+0x9c  (frame_ppc.inline.hpp:97)&lt;br/&gt;
V  [libjvm.so+0xac5f34]  frame::patch_pc(Thread*, unsigned char*)+0x45c  (frame_ppc.cpp:266)&lt;br/&gt;
V  [libjvm.so+0xab748c]  frame::deoptimize(JavaThread*)+0x228  (frame.cpp:350)&lt;br/&gt;
V  [libjvm.so+0x8eedbc]  ThawBase::recurse_thaw_compiled_frame(frame const&amp;amp;, frame&amp;amp;, int, bool)+0x838  (continuationFreezeThaw.cpp:2241)&lt;br/&gt;
V  [libjvm.so+0x8ed8b4]  ThawBase::recurse_thaw(frame const&amp;amp;, frame&amp;amp;, int, bool)+0x29c  (continuationFreezeThaw.cpp:2018)&lt;br/&gt;
V  [libjvm.so+0x8fe4a8]  bool ThawBase::recurse_thaw_java_frame&amp;lt;ContinuationHelper::InterpretedFrame&amp;gt;(frame&amp;amp;, int)+0x2b4  (continuationFreezeThaw.cpp:2046)&lt;br/&gt;
V  [libjvm.so+0x8edf94]  ThawBase::recurse_thaw_interpreted_frame(frame const&amp;amp;, frame&amp;amp;, int)+0xf0  (continuationFreezeThaw.cpp:2135)&lt;br/&gt;
V  [libjvm.so+0x8ed8d0]  ThawBase::recurse_thaw(frame const&amp;amp;, frame&amp;amp;, int, bool)+0x2b8  (continuationFreezeThaw.cpp:2020)&lt;br/&gt;
V  [libjvm.so+0x8ed4ec]  ThawBase::thaw_slow(stackChunkOopDesc*, bool)+0x2ec  (continuationFreezeThaw.cpp:1994)&lt;br/&gt;
V  [libjvm.so+0x90df1c]  Thaw&amp;lt;Config&amp;lt;(oop_kind)0, CardTableBarrierSet&amp;gt; &amp;gt;::thaw(Continuation::thaw_kind)+0x24c  (continuationFreezeThaw.cpp:1788)&lt;br/&gt;
V  [libjvm.so+0x904908]  long* thaw_internal&amp;lt;Config&amp;lt;(oop_kind)0, CardTableBarrierSet&amp;gt; &amp;gt;(JavaThread*, Continuation::thaw_kind)+0x3c4  (continuationFreezeThaw.cpp:2392)&lt;br/&gt;
V  [libjvm.so+0x9034a0]  Config&amp;lt;(oop_kind)0, CardTableBarrierSet&amp;gt;::thaw(JavaThread*, Continuation::thaw_kind)+0x38  (continuationFreezeThaw.cpp:270)&lt;br/&gt;
V  [libjvm.so+0x8f1050]  long* thaw&amp;lt;Config&amp;lt;(oop_kind)0, CardTableBarrierSet&amp;gt; &amp;gt;(JavaThread*, int)+0x74  (continuationFreezeThaw.cpp:247)&lt;br/&gt;
v  ~BufferBlob::StubRoutines (3) 0x0000200010376844&lt;br/&gt;
J 489 c1 jdk.internal.vm.Continuation.run()V &lt;a href=&apos;mailto:java.base@21-internal&apos;&gt;java.base@21-internal&lt;/a&gt; (586 bytes) @ 0x0000200010d93084 [0x0000200010d92e80+0x0000000000000204]&lt;br/&gt;
&lt;br/&gt;
Issue is reproducible (not always, but most of the time) with JDK 20 and 21:&lt;br/&gt;
make run-test TEST=&amp;quot;serviceability/jvmti/stress/StackTrace/Suspended/GetStackTraceSuspendedStressTest.java&amp;quot; JTREG=&amp;quot;VM_OPTIONS=-XX:TieredStopAtLevel=1&amp;quot;&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8286302&quot; title=&quot;Port JEP 425 to PPC64&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8286302&quot;&gt;&lt;strike&gt;JDK-8286302&lt;/strike&gt;&lt;/a&gt; uses &amp;quot;patch_callee_link(hf, (intptr_t*)badAddress);&amp;quot; which doesn&amp;#39;t work for the usage given by the stack trace.&lt;br/&gt;
&lt;br/&gt;
Analysis&lt;br/&gt;
========&lt;br/&gt;
&lt;br/&gt;
- The frame that get&amp;#39;s deoptimized is not fully initialized.&lt;br/&gt;
&lt;br/&gt;
- The backlink will be initialized later because it is not yet known if the frame will be extended for its callee&lt;br/&gt;
&lt;br/&gt;
- The backlink was set to `badAddress` (0xfffffffffffffffe) when the frame was frozen&lt;br/&gt;
&lt;br/&gt;
- `badAddress` is not 16 byte aligned which causes the assertion&lt;br/&gt;
&lt;br/&gt;
- can be reproduce with the following command&lt;br/&gt;
&amp;nbsp;&amp;nbsp;make test TEST=serviceability/jvmti/stress/StackTrace/Suspended/GetStackTraceSuspendedStressTest.java \&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;TEST_VM_OPTS=&amp;quot;-Xcomp -XX:CompileCommand=compileonly,GetStackTraceSuspendedStressTest::*&amp;quot;</description>
                <environment></environment>
        <key id="5090432">JDK-8299375</key>
            <summary>[PPC64] GetStackTraceSuspendedStressTest tries to deoptimize frame with invalid fp</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://bugs.openjdk.org/images/jbsImages/p4.png">P4</priority>
                        <status id="5" iconUrl="https://bugs.openjdk.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rrich">Richard Reingruber</assignee>
                                    <reporter username="mdoerr">Martin Doerr</reporter>
                        <labels>
                            <label>c1</label>
                            <label>deopt</label>
                            <label>loom</label>
                            <label>oracle-triage-21</label>
                            <label>oraclejdk-na</label>
                    </labels>
                <created>Tue, 27 Dec 2022 08:13:10 -0800</created>
                <updated>Fri, 24 Jan 2025 00:42:57 -0800</updated>
                            <resolved>Fri, 17 Mar 2023 01:46:30 -0700</resolved>
                                    <version>20</version>
                    <version>21</version>
                                    <fixVersion>21</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14567699" author="dukebot" created="Fri, 17 Mar 2023 01:46:29 -0700"  >Changeset: 9d518c52&lt;br/&gt;
Author:    Richard Reingruber &amp;lt;&lt;a href=&apos;mailto:rrich@openjdk.org&apos;&gt;rrich@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-03-17 08:45:17 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/9d518c528b11953b556aa7585fc69ff9c9a22435&quot;&gt;https://git.openjdk.org/jdk/commit/9d518c528b11953b556aa7585fc69ff9c9a22435&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14566691" author="roboduke" created="Tue, 14 Mar 2023 03:32:18 -0700"  >A pull request was submitted for review.&lt;br/&gt;
Branch: master&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/12941&quot;&gt;https://git.openjdk.org/jdk/pull/12941&lt;/a&gt;&lt;br/&gt;
Date: 2023-03-09 10:46:05 +0000</comment>
                            <comment id="14552227" author="rrich" created="Wed, 18 Jan 2023 00:39:59 -0800"  >Hi Martin,&lt;br/&gt;
sorry, I should have assigned the ticket to me as I&amp;#39;ve already started to work on it.&lt;br/&gt;
I think the problem is that the frame just copied from the heap to the stack is not yet complete (missing backlink) when it gets deoptimized.&lt;br/&gt;
Unfortunately I haven&amp;#39;t been able to reproduce the issue yet.&lt;br/&gt;
Cheers, Richard.</comment>
                            <comment id="14552116" author="mdoerr" created="Tue, 17 Jan 2023 20:54:30 -0800"  >Hi [~rrich], I think you wanted to work on this issue. (Correct me if I&amp;#39;m wrong.) I just assigned it to you.</comment>
                            <comment id="14550575" author="thartmann" created="Wed, 11 Jan 2023 22:43:32 -0800"  >Hi [~mdoerr], do you intend to work on this or should it be assigned to someone else? (We just try to keep all targeted bugs assigned).</comment>
                            <comment id="14548252" author="chagedorn" created="Tue, 3 Jan 2023 00:40:53 -0800"  >ILW = Deoptimizing frame with invalid fp in stress test on PPC with C1, only one test and with PPC and intermittent, no workaround = MLH = P4</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="5074329">JDK-8286302</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10000" key="com.atlassian.jira.plugin.system.customfieldtypes:multiselect">
                        <customfieldname>CPU</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17024"><![CDATA[ppc]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zqsj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17352"><![CDATA[b15]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="208"><![CDATA[compiler]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>