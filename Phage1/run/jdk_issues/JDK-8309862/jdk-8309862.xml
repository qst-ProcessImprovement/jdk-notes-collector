<!-- 
RSS generated by JIRA (9.12.27#9120027-sha1:edc4490121e366e9e7bd2213d532dbe7e028fc5d) at Tue Sep 30 09:22:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>Java Bug System</title>
    <link>https://bugs.openjdk.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>9.12.27</version>
        <build-number>9120027</build-number>
        <build-date>02-09-2025</build-date>
    </build-info>


<item>
            <title>[JDK-8309862] Unsafe list operations in JfrStringPool</title>
                <link>https://bugs.openjdk.org/browse/JDK-8309862</link>
                <project id="10100" key="JDK">JDK</project>
                    <description>&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8233705&quot; title=&quot;Let artifact iteration running time be a function of incrementally tagged artifacts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8233705&quot;&gt;&lt;strike&gt;JDK-8233705&lt;/strike&gt;&lt;/a&gt; : Let artifact iteration running time be a function of incrementally tagged artifacts&lt;br/&gt;
&lt;br/&gt;
was a follow-up enhancement for improved performance and scalability for &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8226511&quot; title=&quot;Implement JFR Event Streaming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8226511&quot;&gt;&lt;strike&gt;JDK-8226511&lt;/strike&gt;&lt;/a&gt;: Implement JFR Event Streaming.&lt;br/&gt;
&lt;br/&gt;
With &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8226511&quot; title=&quot;Implement JFR Event Streaming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8226511&quot;&gt;&lt;strike&gt;JDK-8226511&lt;/strike&gt;&lt;/a&gt;, the Jfr Recorder Thread collects artifacts every second instead of only at chunk rotation. As such, it became crucial that the JFR subsystems support concurrent access.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8233705&quot; title=&quot;Let artifact iteration running time be a function of incrementally tagged artifacts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8233705&quot;&gt;&lt;strike&gt;JDK-8233705&lt;/strike&gt;&lt;/a&gt; extended the concept of a JfrMemorySpace, a JFR memory abstraction area, to make it &amp;quot;epoch-aware&amp;quot;. An epoch-aware mspace selects free and full lists as a function of the current epoch. An epoch-aware mspace lets the JFR Recorder Thread have exclusive access to the lists used in the previous epoch while the threads continue to operate on the current epoch lists.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8233705&quot; title=&quot;Let artifact iteration running time be a function of incrementally tagged artifacts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8233705&quot;&gt;&lt;strike&gt;JDK-8233705&lt;/strike&gt;&lt;/a&gt; updated the JfrCheckpointManager&amp;#39;s mspaces to become epoch-aware. A flush operation, performed by the JFR Recorder Thread every second, operates on the current live lists concurrently with other threads. As such, it must not make unsafe changes to this list, as other threads are iterating it. It only writes data from the list during flush and postpones destructive changes until after the epoch shift. This invariant allows the JFR Recorder Thread exclusive access to the previous epoch lists, letting it issue destructive operations exclusively.&lt;br/&gt;
&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8233705&quot; title=&quot;Let artifact iteration running time be a function of incrementally tagged artifacts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8233705&quot;&gt;&lt;strike&gt;JDK-8233705&lt;/strike&gt;&lt;/a&gt; also updated the operation types used in JfrStringPool to mirror JfrCheckpointManager. Unfortunately, those operation types only work correctly with an epoch-aware mspace because it builds on the invariant of exclusive list access for the JFR Recorder Thread, and the JfrStringPool mspace was not made epoch-aware.&lt;br/&gt;
&lt;br/&gt;
Typically, this is not a problem because the string pool pressure must be so high as to fill more than 1 Mb of strings, each having a max size of 128 bytes, approximately 8192 unique event strings, within a 1-second window. Should that occur, the system will dynamically allocate new memory for the mspace, in what is called a &amp;quot;transient&amp;quot; buffer.&lt;br/&gt;
&lt;br/&gt;
The bug is that the JFR Recorder Thread excises and deletes transient buffers in the JfrStringPool from the current epoch live lists, where this is only an allowed operation on previous epoch lists (for mutual exclusion). Another thread could be iterating the live list while the JFR Recorder Thread removes and deletes a node.&lt;br/&gt;
&lt;br/&gt;
This fix fills in the missing parts done to JfrCheckpointManager as part of &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8233705&quot; title=&quot;Let artifact iteration running time be a function of incrementally tagged artifacts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JDK-8233705&quot;&gt;&lt;strike&gt;JDK-8233705&lt;/strike&gt;&lt;/a&gt; but was omitted for JfrStringPool. Most importantly, it makes the underlying mspace epoch-aware, splits the write operation into a flush operation for current epoch lists (i.e. flush performs no destructive operations to the lists), and will let write and clear operate on the correct, previous epoch lists, exclusively where it can issue destructive operations.&lt;br/&gt;
&lt;br/&gt;
In addition, it includes better memory reuse of JfrStringPool transient buffers because they always accommodate at least 512 kb of size. Previously, the buffer was retired immediately, even though there might be a lot of free space left. Now the transient buffers are not retired immediately but only when full, in the same manner as for &amp;quot;regular&amp;quot; preallocated buffers.</description>
                <environment></environment>
        <key id="5102979">JDK-8309862</key>
            <summary>Unsafe list operations in JfrStringPool</summary>
                <type id="1" iconUrl="https://bugs.openjdk.org/secure/viewavatar?size=xsmall&amp;avatarId=14703&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://bugs.openjdk.org/images/jbsImages/p2.png">P2</priority>
                        <status id="6" iconUrl="https://bugs.openjdk.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="success"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgronlun">Markus Gr&#246;nlund</assignee>
                                    <reporter username="mgronlun">Markus Gr&#246;nlund</reporter>
                        <labels>
                            <label>8bpr-critical-approved</label>
                            <label>amazon-interest</label>
                            <label>bugdb_35469729</label>
                            <label>bugdb_35630692</label>
                            <label>hgupdate-sync</label>
                            <label>jdk17u-fix-request</label>
                            <label>jdk17u-fix-yes</label>
                            <label>noreg-hard</label>
                    </labels>
                <created>Mon, 12 Jun 2023 08:44:07 -0700</created>
                <updated>Fri, 5 Jan 2024 09:23:42 -0800</updated>
                            <resolved>Tue, 13 Jun 2023 04:49:55 -0700</resolved>
                                    <version>17</version>
                    <version>21</version>
                    <version>22</version>
                                    <fixVersion>22</fixVersion>
                                    <component>hotspot</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14589719" author="shade" created="Thu, 15 Jun 2023 11:45:36 -0700"  >True. The testing looks clean. I&amp;#39;ll wait a bit to see if there are any follow-up issues emerge.</comment>
                            <comment id="14589648" author="goetz" created="Thu, 15 Jun 2023 07:41:46 -0700"  >[17u] &lt;br/&gt;
It&amp;#39;s  brand new in head, but let&amp;#39;s hope it proves itself until 17.0.9 is delivered.</comment>
                            <comment id="14589356" author="shade" created="Wed, 14 Jun 2023 09:58:46 -0700"  >Fix Request (17u)&lt;br/&gt;
&lt;br/&gt;
Fixes the important bug in JFR, and matches 17.0.9-oracle. Does not apply cleanly due to contextual differences, but bots think the backport is clean after the merge. JFR tests pass.</comment>
                            <comment id="14589310" author="roboduke" created="Wed, 14 Jun 2023 08:00:36 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk17u-dev/pull/1439&quot;&gt;https://git.openjdk.org/jdk17u-dev/pull/1439&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-14 14:50:46 +0000</comment>
                            <comment id="14588944" author="roboduke" created="Tue, 13 Jun 2023 05:00:19 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk21/pull/12&quot;&gt;https://git.openjdk.org/jdk21/pull/12&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-13 11:52:29 +0000</comment>
                            <comment id="14588942" author="dukebot" created="Tue, 13 Jun 2023 04:49:54 -0700"  >Changeset: 05f896a1&lt;br/&gt;
Author:    Markus Gr&amp;#xF6;nlund &amp;lt;&lt;a href=&apos;mailto:mgronlun@openjdk.org&apos;&gt;mgronlun@openjdk.org&lt;/a&gt;&amp;gt;&lt;br/&gt;
Date:      2023-06-13 11:47:47 +0000&lt;br/&gt;
URL:       &lt;a href=&quot;https://git.openjdk.org/jdk/commit/05f896a153ee950b21bae251d2870a8adfe4f04a&quot;&gt;https://git.openjdk.org/jdk/commit/05f896a153ee950b21bae251d2870a8adfe4f04a&lt;/a&gt;&lt;br/&gt;
</comment>
                            <comment id="14588607" author="roboduke" created="Mon, 12 Jun 2023 12:21:14 -0700"  >A pull request was submitted for review.&lt;br/&gt;
URL: &lt;a href=&quot;https://git.openjdk.org/jdk/pull/14426&quot;&gt;https://git.openjdk.org/jdk/pull/14426&lt;/a&gt;&lt;br/&gt;
Date: 2023-06-12 19:07:09 +0000</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10200">
                    <name>Backport</name>
                                            <outwardlinks description="backported by">
                                        <issuelink>
            <issuekey id="5103054">JDK-8309931</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103956">JDK-8310714</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5103072">JDK-8309948</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10002">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                                        </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10003">
                    <name>Relates</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="4993829">JDK-8226511</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="5003805">JDK-8233705</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="relates to">
                                                        </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_11700" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10600" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-fixedBackportedCustomfield">
                        <customfieldname>Fixed</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_10004" key="com.atlassian.jira.plugin.system.customfieldtypes:version">
                        <customfieldname>Introduced In Version</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="20306">15</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_11100" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31vbf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_11004" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10006" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Resolved In Build</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17317"><![CDATA[b02]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10008" key="com.oracle.jira.jira-subcomponent-plugin:oracle-subComponentField">
                        <customfieldname>Subcomponent</customfieldname>
                        <customfieldvalues>
                             <customfieldvalue key="374"><![CDATA[jfr]]></customfieldvalue> 
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10601" key="com.oracle.jira.javabugsystem-jira-plugin:jbs-targetBackportedCustomfield">
                        <customfieldname>Targeted</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10100" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Verification</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="17001"><![CDATA[Not verified]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>